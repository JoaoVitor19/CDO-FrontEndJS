9d4755d5d10d7acd34b6a150ebc0da7a
'use strict';

exports.__esModule = true;
exports.default = void 0;

var _Animation2 = _interopRequireDefault(require("./Animation"));

var _NativeAnimatedHelper = require("../NativeAnimatedHelper");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _inheritsLoose(subClass, superClass) {
  subClass.prototype = Object.create(superClass.prototype);
  subClass.prototype.constructor = subClass;

  _setPrototypeOf(subClass, superClass);
}

function _setPrototypeOf(o, p) {
  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {
    o.__proto__ = p;
    return o;
  };

  return _setPrototypeOf(o, p);
}

var DecayAnimation = function (_Animation) {
  _inheritsLoose(DecayAnimation, _Animation);

  function DecayAnimation(config) {
    var _config$deceleration, _config$isInteraction, _config$iterations;

    var _this;

    _this = _Animation.call(this) || this;
    _this._deceleration = (_config$deceleration = config.deceleration) !== null && _config$deceleration !== void 0 ? _config$deceleration : 0.998;
    _this._velocity = config.velocity;
    _this._useNativeDriver = (0, _NativeAnimatedHelper.shouldUseNativeDriver)(config);
    _this.__isInteraction = (_config$isInteraction = config.isInteraction) !== null && _config$isInteraction !== void 0 ? _config$isInteraction : !_this._useNativeDriver;
    _this.__iterations = (_config$iterations = config.iterations) !== null && _config$iterations !== void 0 ? _config$iterations : 1;
    return _this;
  }

  var _proto = DecayAnimation.prototype;

  _proto.__getNativeAnimationConfig = function __getNativeAnimationConfig() {
    return {
      type: 'decay',
      deceleration: this._deceleration,
      velocity: this._velocity,
      iterations: this.__iterations
    };
  };

  _proto.start = function start(fromValue, onUpdate, onEnd, previousAnimation, animatedValue) {
    this.__active = true;
    this._lastValue = fromValue;
    this._fromValue = fromValue;
    this._onUpdate = onUpdate;
    this.__onEnd = onEnd;
    this._startTime = Date.now();

    if (this._useNativeDriver) {
      this.__startNativeAnimation(animatedValue);
    } else {
      this._animationFrame = requestAnimationFrame(this.onUpdate.bind(this));
    }
  };

  _proto.onUpdate = function onUpdate() {
    var now = Date.now();
    var value = this._fromValue + this._velocity / (1 - this._deceleration) * (1 - Math.exp(-(1 - this._deceleration) * (now - this._startTime)));

    this._onUpdate(value);

    if (Math.abs(this._lastValue - value) < 0.1) {
      this.__debouncedOnEnd({
        finished: true
      });

      return;
    }

    this._lastValue = value;

    if (this.__active) {
      this._animationFrame = requestAnimationFrame(this.onUpdate.bind(this));
    }
  };

  _proto.stop = function stop() {
    _Animation.prototype.stop.call(this);

    this.__active = false;
    global.cancelAnimationFrame(this._animationFrame);

    this.__debouncedOnEnd({
      finished: false
    });
  };

  return DecayAnimation;
}(_Animation2.default);

var _default = DecayAnimation;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRlY2F5QW5pbWF0aW9uLmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9BbmltYXRpb24yIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfTmF0aXZlQW5pbWF0ZWRIZWxwZXIiLCJvYmoiLCJfaW5oZXJpdHNMb29zZSIsInN1YkNsYXNzIiwic3VwZXJDbGFzcyIsInByb3RvdHlwZSIsIk9iamVjdCIsImNyZWF0ZSIsImNvbnN0cnVjdG9yIiwiX3NldFByb3RvdHlwZU9mIiwibyIsInAiLCJzZXRQcm90b3R5cGVPZiIsIl9fcHJvdG9fXyIsIkRlY2F5QW5pbWF0aW9uIiwiX0FuaW1hdGlvbiIsImNvbmZpZyIsIl9jb25maWckZGVjZWxlcmF0aW9uIiwiX2NvbmZpZyRpc0ludGVyYWN0aW9uIiwiX2NvbmZpZyRpdGVyYXRpb25zIiwiX3RoaXMiLCJjYWxsIiwiX2RlY2VsZXJhdGlvbiIsImRlY2VsZXJhdGlvbiIsIl92ZWxvY2l0eSIsInZlbG9jaXR5IiwiX3VzZU5hdGl2ZURyaXZlciIsInNob3VsZFVzZU5hdGl2ZURyaXZlciIsIl9faXNJbnRlcmFjdGlvbiIsImlzSW50ZXJhY3Rpb24iLCJfX2l0ZXJhdGlvbnMiLCJpdGVyYXRpb25zIiwiX3Byb3RvIiwiX19nZXROYXRpdmVBbmltYXRpb25Db25maWciLCJ0eXBlIiwic3RhcnQiLCJmcm9tVmFsdWUiLCJvblVwZGF0ZSIsIm9uRW5kIiwicHJldmlvdXNBbmltYXRpb24iLCJhbmltYXRlZFZhbHVlIiwiX19hY3RpdmUiLCJfbGFzdFZhbHVlIiwiX2Zyb21WYWx1ZSIsIl9vblVwZGF0ZSIsIl9fb25FbmQiLCJfc3RhcnRUaW1lIiwiRGF0ZSIsIm5vdyIsIl9fc3RhcnROYXRpdmVBbmltYXRpb24iLCJfYW5pbWF0aW9uRnJhbWUiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJiaW5kIiwidmFsdWUiLCJNYXRoIiwiZXhwIiwiYWJzIiwiX19kZWJvdW5jZWRPbkVuZCIsImZpbmlzaGVkIiwic3RvcCIsImdsb2JhbCIsImNhbmNlbEFuaW1hdGlvbkZyYW1lIiwiX2RlZmF1bHQiLCJtb2R1bGUiXSwibWFwcGluZ3MiOiJBQVNBOztBQUVBQSxPQUFPLENBQUNDLFVBQVIsR0FBcUIsSUFBckI7QUFDQUQsT0FBTyxDQUFDRSxPQUFSLEdBQWtCLEtBQUssQ0FBdkI7O0FBRUEsSUFBSUMsV0FBVyxHQUFHQyxzQkFBc0IsQ0FBQ0MsT0FBTyxlQUFSLENBQXhDOztBQUVBLElBQUlDLHFCQUFxQixHQUFHRCxPQUFPLDJCQUFuQzs7QUFFQSxTQUFTRCxzQkFBVCxDQUFnQ0csR0FBaEMsRUFBcUM7QUFBRSxTQUFPQSxHQUFHLElBQUlBLEdBQUcsQ0FBQ04sVUFBWCxHQUF3Qk0sR0FBeEIsR0FBOEI7QUFBRUwsSUFBQUEsT0FBTyxFQUFFSztBQUFYLEdBQXJDO0FBQXdEOztBQUUvRixTQUFTQyxjQUFULENBQXdCQyxRQUF4QixFQUFrQ0MsVUFBbEMsRUFBOEM7QUFBRUQsRUFBQUEsUUFBUSxDQUFDRSxTQUFULEdBQXFCQyxNQUFNLENBQUNDLE1BQVAsQ0FBY0gsVUFBVSxDQUFDQyxTQUF6QixDQUFyQjtBQUEwREYsRUFBQUEsUUFBUSxDQUFDRSxTQUFULENBQW1CRyxXQUFuQixHQUFpQ0wsUUFBakM7O0FBQTJDTSxFQUFBQSxlQUFlLENBQUNOLFFBQUQsRUFBV0MsVUFBWCxDQUFmO0FBQXdDOztBQUU3TCxTQUFTSyxlQUFULENBQXlCQyxDQUF6QixFQUE0QkMsQ0FBNUIsRUFBK0I7QUFBRUYsRUFBQUEsZUFBZSxHQUFHSCxNQUFNLENBQUNNLGNBQVAsSUFBeUIsU0FBU0gsZUFBVCxDQUF5QkMsQ0FBekIsRUFBNEJDLENBQTVCLEVBQStCO0FBQUVELElBQUFBLENBQUMsQ0FBQ0csU0FBRixHQUFjRixDQUFkO0FBQWlCLFdBQU9ELENBQVA7QUFBVyxHQUF4Rzs7QUFBMEcsU0FBT0QsZUFBZSxDQUFDQyxDQUFELEVBQUlDLENBQUosQ0FBdEI7QUFBK0I7O0FBRTFLLElB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LEtBQUtGLFVBQXhDLENBQVQsQ0FBakQsQ0FBOUI7O0FBRUEsU0FBS0YsU0FBTCxDQUFlUyxLQUFmOztBQUVBLFFBQUlDLElBQUksQ0FBQ0UsR0FBTCxDQUFTLEtBQUtkLFVBQUwsR0FBa0JXLEtBQTNCLElBQW9DLEdBQXhDLEVBQTZDO0FBQzNDLFdBQUtJLGdCQUFMLENBQXNCO0FBQ3BCQyxRQUFBQSxRQUFRLEVBQUU7QUFEVSxPQUF0Qjs7QUFJQTtBQUNEOztBQUVELFNBQUtoQixVQUFMLEdBQWtCVyxLQUFsQjs7QUFFQSxRQUFJLEtBQUtaLFFBQVQsRUFBbUI7QUFDakIsV0FBS1MsZUFBTCxHQUF1QkMscUJBQXFCLENBQUMsS0FBS2QsUUFBTCxDQUFjZSxJQUFkLENBQW1CLElBQW5CLENBQUQsQ0FBNUM7QUFDRDtBQUNGLEdBbkJEOztBQXFCQXBCLEVBQUFBLE1BQU0sQ0FBQzJCLElBQVAsR0FBYyxTQUFTQSxJQUFULEdBQWdCO0FBQzVCNUMsSUFBQUEsVUFBVSxDQUFDVixTQUFYLENBQXFCc0QsSUFBckIsQ0FBMEJ0QyxJQUExQixDQUErQixJQUEvQjs7QUFFQSxTQUFLb0IsUUFBTCxHQUFnQixLQUFoQjtBQUNBbUIsSUFBQUEsTUFBTSxDQUFDQyxvQkFBUCxDQUE0QixLQUFLWCxlQUFqQzs7QUFFQSxTQUFLTyxnQkFBTCxDQUFzQjtBQUNwQkMsTUFBQUEsUUFBUSxFQUFFO0FBRFUsS0FBdEI7QUFHRCxHQVREOztBQVdBLFNBQU81QyxjQUFQO0FBQ0QsQ0E1RWlDLENBNEVoQ2pCLFdBQVcsQ0FBQ0QsT0E1RW9CLENBQWxDOztBQThFQSxJQUFJa0UsUUFBUSxHQUFHaEQsY0FBZjtBQUNBcEIsT0FBTyxDQUFDRSxPQUFSLEdBQWtCa0UsUUFBbEI7QUFDQUMsTUFBTSxDQUFDckUsT0FBUCxHQUFpQkEsT0FBTyxDQUFDRSxPQUF6QiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogXG4gKiBAZm9ybWF0XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDtcblxudmFyIF9BbmltYXRpb24yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9BbmltYXRpb25cIikpO1xuXG52YXIgX05hdGl2ZUFuaW1hdGVkSGVscGVyID0gcmVxdWlyZShcIi4uL05hdGl2ZUFuaW1hdGVkSGVscGVyXCIpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHNMb29zZShzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MucHJvdG90eXBlKTsgc3ViQ2xhc3MucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gc3ViQ2xhc3M7IF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH1cblxuZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH1cblxudmFyIERlY2F5QW5pbWF0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQW5pbWF0aW9uKSB7XG4gIF9pbmhlcml0c0xvb3NlKERlY2F5QW5pbWF0aW9uLCBfQW5pbWF0aW9uKTtcblxuICBmdW5jdGlvbiBEZWNheUFuaW1hdGlvbihjb25maWcpIHtcbiAgICB2YXIgX2NvbmZpZyRkZWNlbGVyYXRpb24sIF9jb25maWckaXNJbnRlcmFjdGlvbiwgX2NvbmZpZyRpdGVyYXRpb25zO1xuXG4gICAgdmFyIF90aGlzO1xuXG4gICAgX3RoaXMgPSBfQW5pbWF0aW9uLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICBfdGhpcy5fZGVjZWxlcmF0aW9uID0gKF9jb25maWckZGVjZWxlcmF0aW9uID0gY29uZmlnLmRlY2VsZXJhdGlvbikgIT09IG51bGwgJiYgX2NvbmZpZyRkZWNlbGVyYXRpb24gIT09IHZvaWQgMCA/IF9jb25maWckZGVjZWxlcmF0aW9uIDogMC45OTg7XG4gICAgX3RoaXMuX3ZlbG9jaXR5ID0gY29uZmlnLnZlbG9jaXR5O1xuICAgIF90aGlzLl91c2VOYXRpdmVEcml2ZXIgPSAoMCwgX05hdGl2ZUFuaW1hdGVkSGVscGVyLnNob3VsZFVzZU5hdGl2ZURyaXZlcikoY29uZmlnKTtcbiAgICBfdGhpcy5fX2lzSW50ZXJhY3Rpb24gPSAoX2NvbmZpZyRpc0ludGVyYWN0aW9uID0gY29uZmlnLmlzSW50ZXJhY3Rpb24pICE9PSBudWxsICYmIF9jb25maWckaXNJbnRlcmFjdGlvbiAhPT0gdm9pZCAwID8gX2NvbmZpZyRpc0ludGVyYWN0aW9uIDogIV90aGlzLl91c2VOYXRpdmVEcml2ZXI7XG4gICAgX3RoaXMuX19pdGVyYXRpb25zID0gKF9jb25maWckaXRlcmF0aW9ucyA9IGNvbmZpZy5pdGVyYXRpb25zKSAhPT0gbnVsbCAmJiBfY29uZmlnJGl0ZXJhdGlvbnMgIT09IHZvaWQgMCA/IF9jb25maWckaXRlcmF0aW9ucyA6IDE7XG4gICAgcmV0dXJuIF90aGlzO1xuICB9XG5cbiAgdmFyIF9wcm90byA9IERlY2F5QW5pbWF0aW9uLnByb3RvdHlwZTtcblxuICBfcHJvdG8uX19nZXROYXRpdmVBbmltYXRpb25Db25maWcgPSBmdW5jdGlvbiBfX2dldE5hdGl2ZUFuaW1hdGlvbkNvbmZpZygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ2RlY2F5JyxcbiAgICAgIGRlY2VsZXJhdGlvbjogdGhpcy5fZGVjZWxlcmF0aW9uLFxuICAgICAgdmVsb2NpdHk6IHRoaXMuX3ZlbG9jaXR5LFxuICAgICAgaXRlcmF0aW9uczogdGhpcy5fX2l0ZXJhdGlvbnNcbiAgICB9O1xuICB9O1xuXG4gIF9wcm90by5zdGFydCA9IGZ1bmN0aW9uIHN0YXJ0KGZyb21WYWx1ZSwgb25VcGRhdGUsIG9uRW5kLCBwcmV2aW91c0FuaW1hdGlvbiwgYW5pbWF0ZWRWYWx1ZSkge1xuICAgIHRoaXMuX19hY3RpdmUgPSB0cnVlO1xuICAgIHRoaXMuX2xhc3RWYWx1ZSA9IGZyb21WYWx1ZTtcbiAgICB0aGlzLl9mcm9tVmFsdWUgPSBmcm9tVmFsdWU7XG4gICAgdGhpcy5fb25VcGRhdGUgPSBvblVwZGF0ZTtcbiAgICB0aGlzLl9fb25FbmQgPSBvbkVuZDtcbiAgICB0aGlzLl9zdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuXG4gICAgaWYgKHRoaXMuX3VzZU5hdGl2ZURyaXZlcikge1xuICAgICAgdGhpcy5fX3N0YXJ0TmF0aXZlQW5pbWF0aW9uKGFuaW1hdGVkVmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9hbmltYXRpb25GcmFtZSA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLm9uVXBkYXRlLmJpbmQodGhpcykpO1xuICAgIH1cbiAgfTtcblxuICBfcHJvdG8ub25VcGRhdGUgPSBmdW5jdGlvbiBvblVwZGF0ZSgpIHtcbiAgICB2YXIgbm93ID0gRGF0ZS5ub3coKTtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLl9mcm9tVmFsdWUgKyB0aGlzLl92ZWxvY2l0eSAvICgxIC0gdGhpcy5fZGVjZWxlcmF0aW9uKSAqICgxIC0gTWF0aC5leHAoLSgxIC0gdGhpcy5fZGVjZWxlcmF0aW9uKSAqIChub3cgLSB0aGlzLl9zdGFydFRpbWUpKSk7XG5cbiAgICB0aGlzLl9vblVwZGF0ZSh2YWx1ZSk7XG5cbiAgICBpZiAoTWF0aC5hYnModGhpcy5fbGFzdFZhbHVlIC0gdmFsdWUpIDwgMC4xKSB7XG4gICAgICB0aGlzLl9fZGVib3VuY2VkT25FbmQoe1xuICAgICAgICBmaW5pc2hlZDogdHJ1ZVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9sYXN0VmFsdWUgPSB2YWx1ZTtcblxuICAgIGlmICh0aGlzLl9fYWN0aXZlKSB7XG4gICAgICB0aGlzLl9hbmltYXRpb25GcmFtZSA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLm9uVXBkYXRlLmJpbmQodGhpcykpO1xuICAgIH1cbiAgfTtcblxuICBfcHJvdG8uc3RvcCA9IGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgX0FuaW1hdGlvbi5wcm90b3R5cGUuc3RvcC5jYWxsKHRoaXMpO1xuXG4gICAgdGhpcy5fX2FjdGl2ZSA9IGZhbHNlO1xuICAgIGdsb2JhbC5jYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLl9hbmltYXRpb25GcmFtZSk7XG5cbiAgICB0aGlzLl9fZGVib3VuY2VkT25FbmQoe1xuICAgICAgZmluaXNoZWQ6IGZhbHNlXG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIERlY2F5QW5pbWF0aW9uO1xufShfQW5pbWF0aW9uMi5kZWZhdWx0KTtcblxudmFyIF9kZWZhdWx0ID0gRGVjYXlBbmltYXRpb247XG5leHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0cy5kZWZhdWx0OyJdfQ==