9ce7f91160ff49e2323bf44fdbf71a0b
'use strict';

exports.__esModule = true;
exports.default = void 0;

var _NativeAnimatedHelper = _interopRequireDefault(require("../NativeAnimatedHelper"));

var _invariant = _interopRequireDefault(require("fbjs/lib/invariant"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

var NativeAnimatedAPI = _NativeAnimatedHelper.default.API;
var _uniqueId = 1;

var AnimatedNode = function () {
  var _proto = AnimatedNode.prototype;

  _proto.__attach = function __attach() {};

  _proto.__detach = function __detach() {
    if (this.__isNative && this.__nativeTag != null) {
      _NativeAnimatedHelper.default.API.dropAnimatedNode(this.__nativeTag);

      this.__nativeTag = undefined;
    }
  };

  _proto.__getValue = function __getValue() {};

  _proto.__getAnimatedValue = function __getAnimatedValue() {
    return this.__getValue();
  };

  _proto.__addChild = function __addChild(child) {};

  _proto.__removeChild = function __removeChild(child) {};

  _proto.__getChildren = function __getChildren() {
    return [];
  };

  function AnimatedNode() {
    this._listeners = {};
  }

  _proto.__makeNative = function __makeNative() {
    if (!this.__isNative) {
      throw new Error('This node cannot be made a "native" animated node');
    }

    if (this.hasListeners()) {
      this._startListeningToNativeValueUpdates();
    }
  };

  _proto.addListener = function addListener(callback) {
    var id = String(_uniqueId++);
    this._listeners[id] = callback;

    if (this.__isNative) {
      this._startListeningToNativeValueUpdates();
    }

    return id;
  };

  _proto.removeListener = function removeListener(id) {
    delete this._listeners[id];

    if (this.__isNative && !this.hasListeners()) {
      this._stopListeningForNativeValueUpdates();
    }
  };

  _proto.removeAllListeners = function removeAllListeners() {
    this._listeners = {};

    if (this.__isNative) {
      this._stopListeningForNativeValueUpdates();
    }
  };

  _proto.hasListeners = function hasListeners() {
    return !!Object.keys(this._listeners).length;
  };

  _proto._startListeningToNativeValueUpdates = function _startListeningToNativeValueUpdates() {
    var _this = this;

    if (this.__nativeAnimatedValueListener && !this.__shouldUpdateListenersForNewNativeTag) {
      return;
    }

    if (this.__shouldUpdateListenersForNewNativeTag) {
      this.__shouldUpdateListenersForNewNativeTag = false;

      this._stopListeningForNativeValueUpdates();
    }

    NativeAnimatedAPI.startListeningToAnimatedNodeValue(this.__getNativeTag());
    this.__nativeAnimatedValueListener = _NativeAnimatedHelper.default.nativeEventEmitter.addListener('onAnimatedValueUpdate', function (data) {
      if (data.tag !== _this.__getNativeTag()) {
        return;
      }

      _this._onAnimatedValueUpdateReceived(data.value);
    });
  };

  _proto._onAnimatedValueUpdateReceived = function _onAnimatedValueUpdateReceived(value) {
    this.__callListeners(value);
  };

  _proto.__callListeners = function __callListeners(value) {
    for (var _key in this._listeners) {
      this._listeners[_key]({
        value: value
      });
    }
  };

  _proto._stopListeningForNativeValueUpdates = function _stopListeningForNativeValueUpdates() {
    if (!this.__nativeAnimatedValueListener) {
      return;
    }

    this.__nativeAnimatedValueListener.remove();

    this.__nativeAnimatedValueListener = null;
    NativeAnimatedAPI.stopListeningToAnimatedNodeValue(this.__getNativeTag());
  };

  _proto.__getNativeTag = function __getNativeTag() {
    var _this$__nativeTag;

    _NativeAnimatedHelper.default.assertNativeAnimatedModule();

    (0, _invariant.default)(this.__isNative, 'Attempt to get native tag from node not marked as "native"');
    var nativeTag = (_this$__nativeTag = this.__nativeTag) !== null && _this$__nativeTag !== void 0 ? _this$__nativeTag : _NativeAnimatedHelper.default.generateNewNodeTag();

    if (this.__nativeTag == null) {
      this.__nativeTag = nativeTag;

      _NativeAnimatedHelper.default.API.createAnimatedNode(nativeTag, this.__getNativeConfig());

      this.__shouldUpdateListenersForNewNativeTag = true;
    }

    return nativeTag;
  };

  _proto.__getNativeConfig = function __getNativeConfig() {
    throw new Error('This JS animated node type cannot be used as native animated node');
  };

  _proto.toJSON = function toJSON() {
    return this.__getValue();
  };

  return AnimatedNode;
}();

var _default = AnimatedNode;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuaW1hdGVkTm9kZS5qcyJdLCJuYW1lcyI6WyJleHBvcnRzIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfTmF0aXZlQW5pbWF0ZWRIZWxwZXIiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9pbnZhcmlhbnQiLCJvYmoiLCJOYXRpdmVBbmltYXRlZEFQSSIsIkFQSSIsIl91bmlxdWVJZCIsIkFuaW1hdGVkTm9kZSIsIl9wcm90byIsInByb3RvdHlwZSIsIl9fYXR0YWNoIiwiX19kZXRhY2giLCJfX2lzTmF0aXZlIiwiX19uYXRpdmVUYWciLCJkcm9wQW5pbWF0ZWROb2RlIiwidW5kZWZpbmVkIiwiX19nZXRWYWx1ZSIsIl9fZ2V0QW5pbWF0ZWRWYWx1ZSIsIl9fYWRkQ2hpbGQiLCJjaGlsZCIsIl9fcmVtb3ZlQ2hpbGQiLCJfX2dldENoaWxkcmVuIiwiX2xpc3RlbmVycyIsIl9fbWFrZU5hdGl2ZSIsIkVycm9yIiwiaGFzTGlzdGVuZXJzIiwiX3N0YXJ0TGlzdGVuaW5nVG9OYXRpdmVWYWx1ZVVwZGF0ZXMiLCJhZGRMaXN0ZW5lciIsImNhbGxiYWNrIiwiaWQiLCJTdHJpbmciLCJyZW1vdmVMaXN0ZW5lciIsIl9zdG9wTGlzdGVuaW5nRm9yTmF0aXZlVmFsdWVVcGRhdGVzIiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsIl90aGlzIiwiX19uYXRpdmVBbmltYXRlZFZhbHVlTGlzdGVuZXIiLCJfX3Nob3VsZFVwZGF0ZUxpc3RlbmVyc0Zvck5ld05hdGl2ZVRhZyIsInN0YXJ0TGlzdGVuaW5nVG9BbmltYXRlZE5vZGVWYWx1ZSIsIl9fZ2V0TmF0aXZlVGFnIiwibmF0aXZlRXZlbnRFbWl0dGVyIiwiZGF0YSIsInRhZyIsIl9vbkFuaW1hdGVkVmFsdWVVcGRhdGVSZWNlaXZlZCIsInZhbHVlIiwiX19jYWxsTGlzdGVuZXJzIiwiX2tleSIsInJlbW92ZSIsInN0b3BMaXN0ZW5pbmdUb0FuaW1hdGVkTm9kZVZhbHVlIiwiX3RoaXMkX19uYXRpdmVUYWciLCJhc3NlcnROYXRpdmVBbmltYXRlZE1vZHVsZSIsIm5hdGl2ZVRhZyIsImdlbmVyYXRlTmV3Tm9kZVRhZyIsImNyZWF0ZUFuaW1hdGVkTm9kZSIsIl9fZ2V0TmF0aXZlQ29uZmlnIiwidG9KU09OIiwiX2RlZmF1bHQiLCJtb2R1bGUiXSwibWFwcGluZ3MiOiJBQVNBOztBQUVBQSxPQUFPLENBQUNDLFVBQVIsR0FBcUIsSUFBckI7QUFDQUQsT0FBTyxDQUFDRSxPQUFSLEdBQWtCLEtBQUssQ0FBdkI7O0FBRUEsSUFBSUMscUJBQXFCLEdBQUdDLHNCQUFzQixDQUFDQyxPQUFPLDJCQUFSLENBQWxEOztBQUVBLElBQUlDLFVBQVUsR0FBR0Ysc0JBQXNCLENBQUNDLE9BQU8sQ0FBQyxvQkFBRCxDQUFSLENBQXZDOztBQUVBLFNBQVNELHNCQUFULENBQWdDRyxHQUFoQyxFQUFxQztBQUFFLFNBQU9BLEdBQUcsSUFBSUEsR0FBRyxDQUFDTixVQUFYLEdBQXdCTSxHQUF4QixHQUE4QjtBQUFFTCxJQUFBQSxPQUFPLEVBQUVLO0FBQVgsR0FBckM7QUFBd0Q7O0FBRS9GLElBQUlDLGlCQUFpQixHQUFHTCxxQkFBcUIsQ0FBQ0QsT0FBdEIsQ0FBOEJPLEdBQXREO0FBQ0EsSUFBSUMsU0FBUyxHQUFHLENBQWhCOztBQUdBLElBQUlDLFlBQVksR0FBZ0IsWUFBWTtBQUMxQyxNQUFJQyxNQUFNLEdBQUdELFlBQVksQ0FBQ0UsU0FBMUI7O0FBRUFELEVBQUFBLE1BQU0sQ0FBQ0UsUUFBUCxHQUFrQixTQUFTQSxRQUFULEdBQW9CLENBQUUsQ0FBeEM7O0FBRUFGLEVBQUFBLE1BQU0sQ0FBQ0csUUFBUCxHQUFrQixTQUFTQSxRQUFULEdBQW9CO0FBQ3BDLFFBQUksS0FBS0MsVUFBTCxJQUFtQixLQUFLQyxXQUFMLElBQW9CLElBQTNDLEVBQWlEO0FBQy9DZCxNQUFBQSxxQkFBcUIsQ0FBQ0QsT0FBdEIsQ0FBOEJPLEdBQTlCLENBQWtDUyxnQkFBbEMsQ0FBbUQsS0FB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QUFHLENBQUNGLGlCQUFpQixHQUFHLEtBQUt0QyxXQUExQixNQUEyQyxJQUEzQyxJQUFtRHNDLGlCQUFpQixLQUFLLEtBQUssQ0FBOUUsR0FBa0ZBLGlCQUFsRixHQUFzR3BELHFCQUFxQixDQUFDRCxPQUF0QixDQUE4QndELGtCQUE5QixFQUF0SDs7QUFFQSxRQUFJLEtBQUt6QyxXQUFMLElBQW9CLElBQXhCLEVBQThCO0FBQzVCLFdBQUtBLFdBQUwsR0FBbUJ3QyxTQUFuQjs7QUFFQXRELE1BQUFBLHFCQUFxQixDQUFDRCxPQUF0QixDQUE4Qk8sR0FBOUIsQ0FBa0NrRCxrQkFBbEMsQ0FBcURGLFNBQXJELEVBQWdFLEtBQUtHLGlCQUFMLEVBQWhFOztBQUVBLFdBQUtqQixzQ0FBTCxHQUE4QyxJQUE5QztBQUNEOztBQUVELFdBQU9jLFNBQVA7QUFDRCxHQWpCRDs7QUFtQkE3QyxFQUFBQSxNQUFNLENBQUNnRCxpQkFBUCxHQUEyQixTQUFTQSxpQkFBVCxHQUE2QjtBQUN0RCxVQUFNLElBQUloQyxLQUFKLENBQVUsbUVBQVYsQ0FBTjtBQUNELEdBRkQ7O0FBSUFoQixFQUFBQSxNQUFNLENBQUNpRCxNQUFQLEdBQWdCLFNBQVNBLE1BQVQsR0FBa0I7QUFDaEMsV0FBTyxLQUFLekMsVUFBTCxFQUFQO0FBQ0QsR0FGRDs7QUFJQSxTQUFPVCxZQUFQO0FBQ0QsQ0F6SytCLEVBQWhDOztBQTJLQSxJQUFJbUQsUUFBUSxHQUFHbkQsWUFBZjtBQUNBWCxPQUFPLENBQUNFLE9BQVIsR0FBa0I0RCxRQUFsQjtBQUNBQyxNQUFNLENBQUMvRCxPQUFQLEdBQWlCQSxPQUFPLENBQUNFLE9BQXpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBcbiAqIEBmb3JtYXRcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwO1xuXG52YXIgX05hdGl2ZUFuaW1hdGVkSGVscGVyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vTmF0aXZlQW5pbWF0ZWRIZWxwZXJcIikpO1xuXG52YXIgX2ludmFyaWFudCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcImZianMvbGliL2ludmFyaWFudFwiKSk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbnZhciBOYXRpdmVBbmltYXRlZEFQSSA9IF9OYXRpdmVBbmltYXRlZEhlbHBlci5kZWZhdWx0LkFQSTtcbnZhciBfdW5pcXVlSWQgPSAxOyAvLyBOb3RlKHZqZXV4KTogdGhpcyB3b3VsZCBiZSBiZXR0ZXIgYXMgYW4gaW50ZXJmYWNlIGJ1dCBmbG93IGRvZXNuJ3Rcbi8vIHN1cHBvcnQgdGhlbSB5ZXRcblxudmFyIEFuaW1hdGVkTm9kZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gIHZhciBfcHJvdG8gPSBBbmltYXRlZE5vZGUucHJvdG90eXBlO1xuXG4gIF9wcm90by5fX2F0dGFjaCA9IGZ1bmN0aW9uIF9fYXR0YWNoKCkge307XG5cbiAgX3Byb3RvLl9fZGV0YWNoID0gZnVuY3Rpb24gX19kZXRhY2goKSB7XG4gICAgaWYgKHRoaXMuX19pc05hdGl2ZSAmJiB0aGlzLl9fbmF0aXZlVGFnICE9IG51bGwpIHtcbiAgICAgIF9OYXRpdmVBbmltYXRlZEhlbHBlci5kZWZhdWx0LkFQSS5kcm9wQW5pbWF0ZWROb2RlKHRoaXMuX19uYXRpdmVUYWcpO1xuXG4gICAgICB0aGlzLl9fbmF0aXZlVGFnID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfTtcblxuICBfcHJvdG8uX19nZXRWYWx1ZSA9IGZ1bmN0aW9uIF9fZ2V0VmFsdWUoKSB7fTtcblxuICBfcHJvdG8uX19nZXRBbmltYXRlZFZhbHVlID0gZnVuY3Rpb24gX19nZXRBbmltYXRlZFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLl9fZ2V0VmFsdWUoKTtcbiAgfTtcblxuICBfcHJvdG8uX19hZGRDaGlsZCA9IGZ1bmN0aW9uIF9fYWRkQ2hpbGQoY2hpbGQpIHt9O1xuXG4gIF9wcm90by5fX3JlbW92ZUNoaWxkID0gZnVuY3Rpb24gX19yZW1vdmVDaGlsZChjaGlsZCkge307XG5cbiAgX3Byb3RvLl9fZ2V0Q2hpbGRyZW4gPSBmdW5jdGlvbiBfX2dldENoaWxkcmVuKCkge1xuICAgIHJldHVybiBbXTtcbiAgfVxuICAvKiBNZXRob2RzIGFuZCBwcm9wcyB1c2VkIGJ5IG5hdGl2ZSBBbmltYXRlZCBpbXBsICovXG4gIDtcblxuICBmdW5jdGlvbiBBbmltYXRlZE5vZGUoKSB7XG4gICAgdGhpcy5fbGlzdGVuZXJzID0ge307XG4gIH1cblxuICBfcHJvdG8uX19tYWtlTmF0aXZlID0gZnVuY3Rpb24gX19tYWtlTmF0aXZlKCkge1xuICAgIGlmICghdGhpcy5fX2lzTmF0aXZlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgbm9kZSBjYW5ub3QgYmUgbWFkZSBhIFwibmF0aXZlXCIgYW5pbWF0ZWQgbm9kZScpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmhhc0xpc3RlbmVycygpKSB7XG4gICAgICB0aGlzLl9zdGFydExpc3RlbmluZ1RvTmF0aXZlVmFsdWVVcGRhdGVzKCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBBZGRzIGFuIGFzeW5jaHJvbm91cyBsaXN0ZW5lciB0byB0aGUgdmFsdWUgc28geW91IGNhbiBvYnNlcnZlIHVwZGF0ZXMgZnJvbVxuICAgKiBhbmltYXRpb25zLiAgVGhpcyBpcyB1c2VmdWwgYmVjYXVzZSB0aGVyZSBpcyBubyB3YXkgdG9cbiAgICogc3luY2hyb25vdXNseSByZWFkIHRoZSB2YWx1ZSBiZWNhdXNlIGl0IG1pZ2h0IGJlIGRyaXZlbiBuYXRpdmVseS5cbiAgICpcbiAgICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvYW5pbWF0ZWR2YWx1ZS5odG1sI2FkZGxpc3RlbmVyXG4gICAqL1xuICA7XG5cbiAgX3Byb3RvLmFkZExpc3RlbmVyID0gZnVuY3Rpb24gYWRkTGlzdGVuZXIoY2FsbGJhY2spIHtcbiAgICB2YXIgaWQgPSBTdHJpbmcoX3VuaXF1ZUlkKyspO1xuICAgIHRoaXMuX2xpc3RlbmVyc1tpZF0gPSBjYWxsYmFjaztcblxuICAgIGlmICh0aGlzLl9faXNOYXRpdmUpIHtcbiAgICAgIHRoaXMuX3N0YXJ0TGlzdGVuaW5nVG9OYXRpdmVWYWx1ZVVwZGF0ZXMoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gaWQ7XG4gIH1cbiAgLyoqXG4gICAqIFVucmVnaXN0ZXIgYSBsaXN0ZW5lci4gVGhlIGBpZGAgcGFyYW0gc2hhbGwgbWF0Y2ggdGhlIGlkZW50aWZpZXJcbiAgICogcHJldmlvdXNseSByZXR1cm5lZCBieSBgYWRkTGlzdGVuZXIoKWAuXG4gICAqXG4gICAqIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL2FuaW1hdGVkdmFsdWUuaHRtbCNyZW1vdmVsaXN0ZW5lclxuICAgKi9cbiAgO1xuXG4gIF9wcm90by5yZW1vdmVMaXN0ZW5lciA9IGZ1bmN0aW9uIHJlbW92ZUxpc3RlbmVyKGlkKSB7XG4gICAgZGVsZXRlIHRoaXMuX2xpc3RlbmVyc1tpZF07XG5cbiAgICBpZiAodGhpcy5fX2lzTmF0aXZlICYmICF0aGlzLmhhc0xpc3RlbmVycygpKSB7XG4gICAgICB0aGlzLl9zdG9wTGlzdGVuaW5nRm9yTmF0aXZlVmFsdWVVcGRhdGVzKCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBSZW1vdmUgYWxsIHJlZ2lzdGVyZWQgbGlzdGVuZXJzLlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9hbmltYXRlZHZhbHVlLmh0bWwjcmVtb3ZlYWxsbGlzdGVuZXJzXG4gICAqL1xuICA7XG5cbiAgX3Byb3RvLnJlbW92ZUFsbExpc3RlbmVycyA9IGZ1bmN0aW9uIHJlbW92ZUFsbExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTtcblxuICAgIGlmICh0aGlzLl9faXNOYXRpdmUpIHtcbiAgICAgIHRoaXMuX3N0b3BMaXN0ZW5pbmdGb3JOYXRpdmVWYWx1ZVVwZGF0ZXMoKTtcbiAgICB9XG4gIH07XG5cbiAgX3Byb3RvLmhhc0xpc3RlbmVycyA9IGZ1bmN0aW9uIGhhc0xpc3RlbmVycygpIHtcbiAgICByZXR1cm4gISFPYmplY3Qua2V5cyh0aGlzLl9saXN0ZW5lcnMpLmxlbmd0aDtcbiAgfTtcblxuICBfcHJvdG8uX3N0YXJ0TGlzdGVuaW5nVG9OYXRpdmVWYWx1ZVVwZGF0ZXMgPSBmdW5jdGlvbiBfc3RhcnRMaXN0ZW5pbmdUb05hdGl2ZVZhbHVlVXBkYXRlcygpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgaWYgKHRoaXMuX19uYXRpdmVBbmltYXRlZFZhbHVlTGlzdGVuZXIgJiYgIXRoaXMuX19zaG91bGRVcGRhdGVMaXN0ZW5lcnNGb3JOZXdOYXRpdmVUYWcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fX3Nob3VsZFVwZGF0ZUxpc3RlbmVyc0Zvck5ld05hdGl2ZVRhZykge1xuICAgICAgdGhpcy5fX3Nob3VsZFVwZGF0ZUxpc3RlbmVyc0Zvck5ld05hdGl2ZVRhZyA9IGZhbHNlO1xuXG4gICAgICB0aGlzLl9zdG9wTGlzdGVuaW5nRm9yTmF0aXZlVmFsdWVVcGRhdGVzKCk7XG4gICAgfVxuXG4gICAgTmF0aXZlQW5pbWF0ZWRBUEkuc3RhcnRMaXN0ZW5pbmdUb0FuaW1hdGVkTm9kZVZhbHVlKHRoaXMuX19nZXROYXRpdmVUYWcoKSk7XG4gICAgdGhpcy5fX25hdGl2ZUFuaW1hdGVkVmFsdWVMaXN0ZW5lciA9IF9OYXRpdmVBbmltYXRlZEhlbHBlci5kZWZhdWx0Lm5hdGl2ZUV2ZW50RW1pdHRlci5hZGRMaXN0ZW5lcignb25BbmltYXRlZFZhbHVlVXBkYXRlJywgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgIGlmIChkYXRhLnRhZyAhPT0gX3RoaXMuX19nZXROYXRpdmVUYWcoKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIF90aGlzLl9vbkFuaW1hdGVkVmFsdWVVcGRhdGVSZWNlaXZlZChkYXRhLnZhbHVlKTtcbiAgICB9KTtcbiAgfTtcblxuICBfcHJvdG8uX29uQW5pbWF0ZWRWYWx1ZVVwZGF0ZVJlY2VpdmVkID0gZnVuY3Rpb24gX29uQW5pbWF0ZWRWYWx1ZVVwZGF0ZVJlY2VpdmVkKHZhbHVlKSB7XG4gICAgdGhpcy5fX2NhbGxMaXN0ZW5lcnModmFsdWUpO1xuICB9O1xuXG4gIF9wcm90by5fX2NhbGxMaXN0ZW5lcnMgPSBmdW5jdGlvbiBfX2NhbGxMaXN0ZW5lcnModmFsdWUpIHtcbiAgICBmb3IgKHZhciBfa2V5IGluIHRoaXMuX2xpc3RlbmVycykge1xuICAgICAgdGhpcy5fbGlzdGVuZXJzW19rZXldKHtcbiAgICAgICAgdmFsdWU6IHZhbHVlXG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgX3Byb3RvLl9zdG9wTGlzdGVuaW5nRm9yTmF0aXZlVmFsdWVVcGRhdGVzID0gZnVuY3Rpb24gX3N0b3BMaXN0ZW5pbmdGb3JOYXRpdmVWYWx1ZVVwZGF0ZXMoKSB7XG4gICAgaWYgKCF0aGlzLl9fbmF0aXZlQW5pbWF0ZWRWYWx1ZUxpc3RlbmVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5fX25hdGl2ZUFuaW1hdGVkVmFsdWVMaXN0ZW5lci5yZW1vdmUoKTtcblxuICAgIHRoaXMuX19uYXRpdmVBbmltYXRlZFZhbHVlTGlzdGVuZXIgPSBudWxsO1xuICAgIE5hdGl2ZUFuaW1hdGVkQVBJLnN0b3BMaXN0ZW5pbmdUb0FuaW1hdGVkTm9kZVZhbHVlKHRoaXMuX19nZXROYXRpdmVUYWcoKSk7XG4gIH07XG5cbiAgX3Byb3RvLl9fZ2V0TmF0aXZlVGFnID0gZnVuY3Rpb24gX19nZXROYXRpdmVUYWcoKSB7XG4gICAgdmFyIF90aGlzJF9fbmF0aXZlVGFnO1xuXG4gICAgX05hdGl2ZUFuaW1hdGVkSGVscGVyLmRlZmF1bHQuYXNzZXJ0TmF0aXZlQW5pbWF0ZWRNb2R1bGUoKTtcblxuICAgICgwLCBfaW52YXJpYW50LmRlZmF1bHQpKHRoaXMuX19pc05hdGl2ZSwgJ0F0dGVtcHQgdG8gZ2V0IG5hdGl2ZSB0YWcgZnJvbSBub2RlIG5vdCBtYXJrZWQgYXMgXCJuYXRpdmVcIicpO1xuICAgIHZhciBuYXRpdmVUYWcgPSAoX3RoaXMkX19uYXRpdmVUYWcgPSB0aGlzLl9fbmF0aXZlVGFnKSAhPT0gbnVsbCAmJiBfdGhpcyRfX25hdGl2ZVRhZyAhPT0gdm9pZCAwID8gX3RoaXMkX19uYXRpdmVUYWcgOiBfTmF0aXZlQW5pbWF0ZWRIZWxwZXIuZGVmYXVsdC5nZW5lcmF0ZU5ld05vZGVUYWcoKTtcblxuICAgIGlmICh0aGlzLl9fbmF0aXZlVGFnID09IG51bGwpIHtcbiAgICAgIHRoaXMuX19uYXRpdmVUYWcgPSBuYXRpdmVUYWc7XG5cbiAgICAgIF9OYXRpdmVBbmltYXRlZEhlbHBlci5kZWZhdWx0LkFQSS5jcmVhdGVBbmltYXRlZE5vZGUobmF0aXZlVGFnLCB0aGlzLl9fZ2V0TmF0aXZlQ29uZmlnKCkpO1xuXG4gICAgICB0aGlzLl9fc2hvdWxkVXBkYXRlTGlzdGVuZXJzRm9yTmV3TmF0aXZlVGFnID0gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmF0aXZlVGFnO1xuICB9O1xuXG4gIF9wcm90by5fX2dldE5hdGl2ZUNvbmZpZyA9IGZ1bmN0aW9uIF9fZ2V0TmF0aXZlQ29uZmlnKCkge1xuICAgIHRocm93IG5ldyBFcnJvcignVGhpcyBKUyBhbmltYXRlZCBub2RlIHR5cGUgY2Fubm90IGJlIHVzZWQgYXMgbmF0aXZlIGFuaW1hdGVkIG5vZGUnKTtcbiAgfTtcblxuICBfcHJvdG8udG9KU09OID0gZnVuY3Rpb24gdG9KU09OKCkge1xuICAgIHJldHVybiB0aGlzLl9fZ2V0VmFsdWUoKTtcbiAgfTtcblxuICByZXR1cm4gQW5pbWF0ZWROb2RlO1xufSgpO1xuXG52YXIgX2RlZmF1bHQgPSBBbmltYXRlZE5vZGU7XG5leHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0cy5kZWZhdWx0OyJdfQ==