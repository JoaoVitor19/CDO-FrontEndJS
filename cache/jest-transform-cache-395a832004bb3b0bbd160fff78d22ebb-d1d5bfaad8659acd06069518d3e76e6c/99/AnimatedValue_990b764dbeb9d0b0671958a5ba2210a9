991eefe053cb49d4ff5c135724bb2214
'use strict';

exports.__esModule = true;
exports.default = void 0;

var _AnimatedInterpolation = _interopRequireDefault(require("./AnimatedInterpolation"));

var _AnimatedWithChildren2 = _interopRequireDefault(require("./AnimatedWithChildren"));

var _InteractionManager = _interopRequireDefault(require("../../../../exports/InteractionManager"));

var _NativeAnimatedHelper = _interopRequireDefault(require("../NativeAnimatedHelper"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _inheritsLoose(subClass, superClass) {
  subClass.prototype = Object.create(superClass.prototype);
  subClass.prototype.constructor = subClass;

  _setPrototypeOf(subClass, superClass);
}

function _setPrototypeOf(o, p) {
  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {
    o.__proto__ = p;
    return o;
  };

  return _setPrototypeOf(o, p);
}

var NativeAnimatedAPI = _NativeAnimatedHelper.default.API;

function _flush(rootNode) {
  var animatedStyles = new Set();

  function findAnimatedStyles(node) {
    if (typeof node.update === 'function') {
      animatedStyles.add(node);
    } else {
      node.__getChildren().forEach(findAnimatedStyles);
    }
  }

  findAnimatedStyles(rootNode);
  animatedStyles.forEach(function (animatedStyle) {
    return animatedStyle.update();
  });
}

var AnimatedValue = function (_AnimatedWithChildren) {
  _inheritsLoose(AnimatedValue, _AnimatedWithChildren);

  function AnimatedValue(value) {
    var _this;

    _this = _AnimatedWithChildren.call(this) || this;

    if (typeof value !== 'number') {
      throw new Error('AnimatedValue: Attempting to set value to undefined');
    }

    _this._startingValue = _this._value = value;
    _this._offset = 0;
    _this._animation = null;
    return _this;
  }

  var _proto = AnimatedValue.prototype;

  _proto.__detach = function __detach() {
    var _this2 = this;

    if (this.__isNative) {
      NativeAnimatedAPI.getValue(this.__getNativeTag(), function (value) {
        _this2._value = value;
      });
    }

    this.stopAnimation();

    _AnimatedWithChildren.prototype.__detach.call(this);
  };

  _proto.__getValue = function __getValue() {
    return this._value + this._offset;
  };

  _proto.setValue = function setValue(value) {
    if (this._animation) {
      this._animation.stop();

      this._animation = null;
    }

    this._updateValue(value, !this.__isNative);

    if (this.__isNative) {
      NativeAnimatedAPI.setAnimatedNodeValue(this.__getNativeTag(), value);
    }
  };

  _proto.setOffset = function setOffset(offset) {
    this._offset = offset;

    if (this.__isNative) {
      NativeAnimatedAPI.setAnimatedNodeOffset(this.__getNativeTag(), offset);
    }
  };

  _proto.flattenOffset = function flattenOffset() {
    this._value += this._offset;
    this._offset = 0;

    if (this.__isNative) {
      NativeAnimatedAPI.flattenAnimatedNodeOffset(this.__getNativeTag());
    }
  };

  _proto.extractOffset = function extractOffset() {
    this._offset += this._value;
    this._value = 0;

    if (this.__isNative) {
      NativeAnimatedAPI.extractAnimatedNodeOffset(this.__getNativeTag());
    }
  };

  _proto.stopAnimation = function stopAnimation(callback) {
    this.stopTracking();
    this._animation && this._animation.stop();
    this._animation = null;
    callback && callback(this.__getValue());
  };

  _proto.resetAnimation = function resetAnimation(callback) {
    this.stopAnimation(callback);
    this._value = this._startingValue;
  };

  _proto._onAnimatedValueUpdateReceived = function _onAnimatedValueUpdateReceived(value) {
    this._updateValue(value, false);
  };

  _proto.interpolate = function interpolate(config) {
    return new _AnimatedInterpolation.default(this, config);
  };

  _proto.animate = function animate(animation, callback) {
    var _this3 = this;

    var handle = null;

    if (animation.__isInteraction) {
      handle = _InteractionManager.default.createInteractionHandle();
    }

    var previousAnimation = this._animation;
    this._animation && this._animation.stop();
    this._animation = animation;
    animation.start(this._value, function (value) {
      _this3._updateValue(value, true);
    }, function (result) {
      _this3._animation = null;

      if (handle !== null) {
        _InteractionManager.default.clearInteractionHandle(handle);
      }

      callback && callback(result);
    }, previousAnimation, this);
  };

  _proto.stopTracking = function stopTracking() {
    this._tracking && this._tracking.__detach();
    this._tracking = null;
  };

  _proto.track = function track(tracking) {
    this.stopTracking();
    this._tracking = tracking;
  };

  _proto._updateValue = function _updateValue(value, flush) {
    if (value === undefined) {
      throw new Error('AnimatedValue: Attempting to set value to undefined');
    }

    this._value = value;

    if (flush) {
      _flush(this);
    }

    _AnimatedWithChildren.prototype.__callListeners.call(this, this.__getValue());
  };

  _proto.__getNativeConfig = function __getNativeConfig() {
    return {
      type: 'value',
      value: this._value,
      offset: this._offset
    };
  };

  return AnimatedValue;
}(_AnimatedWithChildren2.default);

var _default = AnimatedValue;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuaW1hdGVkVmFsdWUuanMiXSwibmFtZXMiOlsiZXhwb3J0cyIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiX0FuaW1hdGVkSW50ZXJwb2xhdGlvbiIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX0FuaW1hdGVkV2l0aENoaWxkcmVuMiIsIl9JbnRlcmFjdGlvbk1hbmFnZXIiLCJfTmF0aXZlQW5pbWF0ZWRIZWxwZXIiLCJvYmoiLCJfaW5oZXJpdHNMb29zZSIsInN1YkNsYXNzIiwic3VwZXJDbGFzcyIsInByb3RvdHlwZSIsIk9iamVjdCIsImNyZWF0ZSIsImNvbnN0cnVjdG9yIiwiX3NldFByb3RvdHlwZU9mIiwibyIsInAiLCJzZXRQcm90b3R5cGVPZiIsIl9fcHJvdG9fXyIsIk5hdGl2ZUFuaW1hdGVkQVBJIiwiQVBJIiwiX2ZsdXNoIiwicm9vdE5vZGUiLCJhbmltYXRlZFN0eWxlcyIsIlNldCIsImZpbmRBbmltYXRlZFN0eWxlcyIsIm5vZGUiLCJ1cGRhdGUiLCJhZGQiLCJfX2dldENoaWxkcmVuIiwiZm9yRWFjaCIsImFuaW1hdGVkU3R5bGUiLCJBbmltYXRlZFZhbHVlIiwiX0FuaW1hdGVkV2l0aENoaWxkcmVuIiwidmFsdWUiLCJfdGhpcyIsImNhbGwiLCJFcnJvciIsIl9zdGFydGluZ1ZhbHVlIiwiX3ZhbHVlIiwiX29mZnNldCIsIl9hbmltYXRpb24iLCJfcHJvdG8iLCJfX2RldGFjaCIsIl90aGlzMiIsIl9faXNOYXRpdmUiLCJnZXRWYWx1ZSIsIl9fZ2V0TmF0aXZlVGFnIiwic3RvcEFuaW1hdGlvbiIsIl9fZ2V0VmFsdWUiLCJzZXRWYWx1ZSIsInN0b3AiLCJfdXBkYXRlVmFsdWUiLCJzZXRBbmltYXRlZE5vZGVWYWx1ZSIsInNldE9mZnNldCIsIm9mZnNldCIsInNldEFuaW1hdGVkTm9kZU9mZnNldCIsImZsYXR0ZW5PZmZzZXQiLCJmbGF0dGVuQW5pbWF0ZWROb2RlT2Zmc2V0IiwiZXh0cmFjdE9mZnNldCIsImV4dHJhY3RBbmltYXRlZE5vZGVPZmZzZXQiLCJjYWxsYmFjayIsInN0b3BUcmFja2luZyIsInJlc2V0QW5pbWF0aW9uIiwiX29uQW5pbWF0ZWRWYWx1ZVVwZGF0ZVJlY2VpdmVkIiwiaW50ZXJwb2xhdGUiLCJjb25maWciLCJhbmltYXRlIiwiYW5pbWF0aW9uIiwiX3RoaXMzIiwiaGFuZGxlIiwiX19pc0ludGVyYWN0aW9uIiwiY3JlYXRlSW50ZXJhY3Rpb25IYW5kbGUiLCJwcmV2aW91c0FuaW1hdGlvbiIsInN0YXJ0IiwicmVzdWx0IiwiY2xlYXJJbnRlcmFjdGlvbkhhbmRsZSIsIl90cmFja2luZyIsInRyYWNrIiwidHJhY2tpbmciLCJmbHVzaCIsInVuZGVmaW5lZCIsIl9fY2FsbExpc3RlbmVycyIsIl9fZ2V0TmF0aXZlQ29uZmlnIiwidHlwZSIsIl9kZWZhdWx0IiwibW9kdWxlIl0sIm1hcHBpbmdzIjoiQUFTQTs7QUFFQUEsT0FBTyxDQUFDQyxVQUFSLEdBQXFCLElBQXJCO0FBQ0FELE9BQU8sQ0FBQ0UsT0FBUixHQUFrQixLQUFLLENBQXZCOztBQUVBLElBQUlDLHNCQUFzQixHQUFHQyxzQkFBc0IsQ0FBQ0MsT0FBTywyQkFBUixDQUFuRDs7QUFFQSxJQUFJQyxzQkFBc0IsR0FBR0Ysc0JBQXNCLENBQUNDLE9BQU8sMEJBQVIsQ0FBbkQ7O0FBRUEsSUFBSUUsbUJBQW1CLEdBQUdILHNCQUFzQixDQUFDQyxPQUFPLDBDQUFSLENBQWhEOztBQUVBLElBQUlHLHFCQUFxQixHQUFHSixzQkFBc0IsQ0FBQ0MsT0FBTywyQkFBUixDQUFsRDs7QUFFQSxTQUFTRCxzQkFBVCxDQUFnQ0ssR0FBaEMsRUFBcUM7QUFBRSxTQUFPQSxHQUFHLElBQUlBLEdBQUcsQ0FBQ1IsVUFBWCxHQUF3QlEsR0FBeEIsR0FBOEI7QUFBRVAsSUFBQUEsT0FBTyxFQUFFTztBQUFYLEdBQXJDO0FBQXdEOztBQUUvRixTQUFTQyxjQUFULENBQXdCQyxRQUF4QixFQUFrQ0MsVUFBbEMsRUFBOEM7QUFBRUQsRUFBQUEsUUFBUSxD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R0FBc0IsU0FBU0EsWUFBVCxDQUFzQmxCLEtBQXRCLEVBQTZCOEMsS0FBN0IsRUFBb0M7QUFDeEQsUUFBSTlDLEtBQUssS0FBSytDLFNBQWQsRUFBeUI7QUFDdkIsWUFBTSxJQUFJNUMsS0FBSixDQUFVLHFEQUFWLENBQU47QUFDRDs7QUFFRCxTQUFLRSxNQUFMLEdBQWNMLEtBQWQ7O0FBRUEsUUFBSThDLEtBQUosRUFBVztBQUNUM0QsTUFBQUEsTUFBTSxDQUFDLElBQUQsQ0FBTjtBQUNEOztBQUVEWSxJQUFBQSxxQkFBcUIsQ0FBQ3ZCLFNBQXRCLENBQWdDd0UsZUFBaEMsQ0FBZ0Q5QyxJQUFoRCxDQUFxRCxJQUFyRCxFQUEyRCxLQUFLYSxVQUFMLEVBQTNEO0FBQ0QsR0FaRDs7QUFjQVAsRUFBQUEsTUFBTSxDQUFDeUMsaUJBQVAsR0FBMkIsU0FBU0EsaUJBQVQsR0FBNkI7QUFDdEQsV0FBTztBQUNMQyxNQUFBQSxJQUFJLEVBQUUsT0FERDtBQUVMbEQsTUFBQUEsS0FBSyxFQUFFLEtBQUtLLE1BRlA7QUFHTGdCLE1BQUFBLE1BQU0sRUFBRSxLQUFLZjtBQUhSLEtBQVA7QUFLRCxHQU5EOztBQVFBLFNBQU9SLGFBQVA7QUFDRCxDQW5PZ0MsQ0FtTy9CN0Isc0JBQXNCLENBQUNKLE9Bbk9RLENBQWpDOztBQXFPQSxJQUFJc0YsUUFBUSxHQUFHckQsYUFBZjtBQUNBbkMsT0FBTyxDQUFDRSxPQUFSLEdBQWtCc0YsUUFBbEI7QUFDQUMsTUFBTSxDQUFDekYsT0FBUCxHQUFpQkEsT0FBTyxDQUFDRSxPQUF6QiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogXG4gKiBAZm9ybWF0XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDtcblxudmFyIF9BbmltYXRlZEludGVycG9sYXRpb24gPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL0FuaW1hdGVkSW50ZXJwb2xhdGlvblwiKSk7XG5cbnZhciBfQW5pbWF0ZWRXaXRoQ2hpbGRyZW4yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9BbmltYXRlZFdpdGhDaGlsZHJlblwiKSk7XG5cbnZhciBfSW50ZXJhY3Rpb25NYW5hZ2VyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vLi4vLi4vLi4vZXhwb3J0cy9JbnRlcmFjdGlvbk1hbmFnZXJcIikpO1xuXG52YXIgX05hdGl2ZUFuaW1hdGVkSGVscGVyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vTmF0aXZlQW5pbWF0ZWRIZWxwZXJcIikpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHNMb29zZShzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MucHJvdG90eXBlKTsgc3ViQ2xhc3MucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gc3ViQ2xhc3M7IF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH1cblxuZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH1cblxudmFyIE5hdGl2ZUFuaW1hdGVkQVBJID0gX05hdGl2ZUFuaW1hdGVkSGVscGVyLmRlZmF1bHQuQVBJO1xuLyoqXG4gKiBBbmltYXRlZCB3b3JrcyBieSBidWlsZGluZyBhIGRpcmVjdGVkIGFjeWNsaWMgZ3JhcGggb2YgZGVwZW5kZW5jaWVzXG4gKiB0cmFuc3BhcmVudGx5IHdoZW4geW91IHJlbmRlciB5b3VyIEFuaW1hdGVkIGNvbXBvbmVudHMuXG4gKlxuICogICAgICAgICAgICAgICBuZXcgQW5pbWF0ZWQuVmFsdWUoMClcbiAqICAgICAuaW50ZXJwb2xhdGUoKSAgICAgICAgLmludGVycG9sYXRlKCkgICAgbmV3IEFuaW1hdGVkLlZhbHVlKDEpXG4gKiAgICAgICAgIG9wYWNpdHkgICAgICAgICAgICAgICB0cmFuc2xhdGVZICAgICAgc2NhbGVcbiAqICAgICAgICAgIHN0eWxlICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybVxuICogICAgICAgICBWaWV3IzIzNCAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZpZXcjMTIzXG4gKlxuICogQSkgVG9wIERvd24gcGhhc2VcbiAqIFdoZW4gYW4gQW5pbWF0ZWQuVmFsdWUgaXMgdXBkYXRlZCwgd2UgcmVjdXJzaXZlbHkgZ28gZG93biB0aHJvdWdoIHRoaXNcbiAqIGdyYXBoIGluIG9yZGVyIHRvIGZpbmQgbGVhZiBub2RlczogdGhlIHZpZXdzIHRoYXQgd2UgZmxhZyBhcyBuZWVkaW5nXG4gKiBhbiB1cGRhdGUuXG4gKlxuICogQikgQm90dG9tIFVwIHBoYXNlXG4gKiBXaGVuIGEgdmlldyBpcyBmbGFnZ2VkIGFzIG5lZWRpbmcgYW4gdXBkYXRlLCB3ZSByZWN1cnNpdmVseSBnbyBiYWNrIHVwXG4gKiBpbiBvcmRlciB0byBidWlsZCB0aGUgbmV3IHZhbHVlIHRoYXQgaXQgbmVlZHMuIFRoZSByZWFzb24gd2h5IHdlIG5lZWRcbiAqIHRoaXMgdHdvLXBoYXNlcyBwcm9jZXNzIGlzIHRvIGRlYWwgd2l0aCBjb21wb3NpdGUgcHJvcHMgc3VjaCBhc1xuICogdHJhbnNmb3JtIHdoaWNoIGNhbiByZWNlaXZlIHZhbHVlcyBmcm9tIG11bHRpcGxlIHBhcmVudHMuXG4gKi9cblxuZnVuY3Rpb24gX2ZsdXNoKHJvb3ROb2RlKSB7XG4gIHZhciBhbmltYXRlZFN0eWxlcyA9IG5ldyBTZXQoKTtcblxuICBmdW5jdGlvbiBmaW5kQW5pbWF0ZWRTdHlsZXMobm9kZSkge1xuICAgIC8qICRGbG93Rml4TWUoPj0wLjY4LjAgc2l0ZT1yZWFjdF9uYXRpdmVfZmIpIFRoaXMgY29tbWVudCBzdXBwcmVzc2VzIGFuXG4gICAgICogZXJyb3IgZm91bmQgd2hlbiBGbG93IHYwLjY4IHdhcyBkZXBsb3llZC4gVG8gc2VlIHRoZSBlcnJvciBkZWxldGUgdGhpc1xuICAgICAqIGNvbW1lbnQgYW5kIHJ1biBGbG93LiAqL1xuICAgIGlmICh0eXBlb2Ygbm9kZS51cGRhdGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGFuaW1hdGVkU3R5bGVzLmFkZChub2RlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbm9kZS5fX2dldENoaWxkcmVuKCkuZm9yRWFjaChmaW5kQW5pbWF0ZWRTdHlsZXMpO1xuICAgIH1cbiAgfVxuXG4gIGZpbmRBbmltYXRlZFN0eWxlcyhyb290Tm9kZSk7XG4gIC8qICRGbG93Rml4TWUgKi9cblxuICBhbmltYXRlZFN0eWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChhbmltYXRlZFN0eWxlKSB7XG4gICAgcmV0dXJuIGFuaW1hdGVkU3R5bGUudXBkYXRlKCk7XG4gIH0pO1xufVxuLyoqXG4gKiBTdGFuZGFyZCB2YWx1ZSBmb3IgZHJpdmluZyBhbmltYXRpb25zLiAgT25lIGBBbmltYXRlZC5WYWx1ZWAgY2FuIGRyaXZlXG4gKiBtdWx0aXBsZSBwcm9wZXJ0aWVzIGluIGEgc3luY2hyb25pemVkIGZhc2hpb24sIGJ1dCBjYW4gb25seSBiZSBkcml2ZW4gYnkgb25lXG4gKiBtZWNoYW5pc20gYXQgYSB0aW1lLiAgVXNpbmcgYSBuZXcgbWVjaGFuaXNtIChlLmcuIHN0YXJ0aW5nIGEgbmV3IGFuaW1hdGlvbixcbiAqIG9yIGNhbGxpbmcgYHNldFZhbHVlYCkgd2lsbCBzdG9wIGFueSBwcmV2aW91cyBvbmVzLlxuICpcbiAqIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL2FuaW1hdGVkdmFsdWUuaHRtbFxuICovXG5cblxudmFyIEFuaW1hdGVkVmFsdWUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9BbmltYXRlZFdpdGhDaGlsZHJlbikge1xuICBfaW5oZXJpdHNMb29zZShBbmltYXRlZFZhbHVlLCBfQW5pbWF0ZWRXaXRoQ2hpbGRyZW4pO1xuXG4gIGZ1bmN0aW9uIEFuaW1hdGVkVmFsdWUodmFsdWUpIHtcbiAgICB2YXIgX3RoaXM7XG5cbiAgICBfdGhpcyA9IF9BbmltYXRlZFdpdGhDaGlsZHJlbi5jYWxsKHRoaXMpIHx8IHRoaXM7XG5cbiAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnbnVtYmVyJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBbmltYXRlZFZhbHVlOiBBdHRlbXB0aW5nIHRvIHNldCB2YWx1ZSB0byB1bmRlZmluZWQnKTtcbiAgICB9XG5cbiAgICBfdGhpcy5fc3RhcnRpbmdWYWx1ZSA9IF90aGlzLl92YWx1ZSA9IHZhbHVlO1xuICAgIF90aGlzLl9vZmZzZXQgPSAwO1xuICAgIF90aGlzLl9hbmltYXRpb24gPSBudWxsO1xuICAgIHJldHVybiBfdGhpcztcbiAgfVxuXG4gIHZhciBfcHJvdG8gPSBBbmltYXRlZFZhbHVlLnByb3RvdHlwZTtcblxuICBfcHJvdG8uX19kZXRhY2ggPSBmdW5jdGlvbiBfX2RldGFjaCgpIHtcbiAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgIGlmICh0aGlzLl9faXNOYXRpdmUpIHtcbiAgICAgIE5hdGl2ZUFuaW1hdGVkQVBJLmdldFZhbHVlKHRoaXMuX19nZXROYXRpdmVUYWcoKSwgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIF90aGlzMi5fdmFsdWUgPSB2YWx1ZTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMuc3RvcEFuaW1hdGlvbigpO1xuXG4gICAgX0FuaW1hdGVkV2l0aENoaWxkcmVuLnByb3RvdHlwZS5fX2RldGFjaC5jYWxsKHRoaXMpO1xuICB9O1xuXG4gIF9wcm90by5fX2dldFZhbHVlID0gZnVuY3Rpb24gX19nZXRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fdmFsdWUgKyB0aGlzLl9vZmZzZXQ7XG4gIH1cbiAgLyoqXG4gICAqIERpcmVjdGx5IHNldCB0aGUgdmFsdWUuICBUaGlzIHdpbGwgc3RvcCBhbnkgYW5pbWF0aW9ucyBydW5uaW5nIG9uIHRoZSB2YWx1ZVxuICAgKiBhbmQgdXBkYXRlIGFsbCB0aGUgYm91bmQgcHJvcGVydGllcy5cbiAgICpcbiAgICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvYW5pbWF0ZWR2YWx1ZS5odG1sI3NldHZhbHVlXG4gICAqL1xuICA7XG5cbiAgX3Byb3RvLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUodmFsdWUpIHtcbiAgICBpZiAodGhpcy5fYW5pbWF0aW9uKSB7XG4gICAgICB0aGlzLl9hbmltYXRpb24uc3RvcCgpO1xuXG4gICAgICB0aGlzLl9hbmltYXRpb24gPSBudWxsO1xuICAgIH1cblxuICAgIHRoaXMuX3VwZGF0ZVZhbHVlKHZhbHVlLCAhdGhpcy5fX2lzTmF0aXZlXG4gICAgLyogZG9uJ3QgcGVyZm9ybSBhIGZsdXNoIGZvciBuYXRpdmVseSBkcml2ZW4gdmFsdWVzICovXG4gICAgKTtcblxuICAgIGlmICh0aGlzLl9faXNOYXRpdmUpIHtcbiAgICAgIE5hdGl2ZUFuaW1hdGVkQVBJLnNldEFuaW1hdGVkTm9kZVZhbHVlKHRoaXMuX19nZXROYXRpdmVUYWcoKSwgdmFsdWUpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogU2V0cyBhbiBvZmZzZXQgdGhhdCBpcyBhcHBsaWVkIG9uIHRvcCBvZiB3aGF0ZXZlciB2YWx1ZSBpcyBzZXQsIHdoZXRoZXIgdmlhXG4gICAqIGBzZXRWYWx1ZWAsIGFuIGFuaW1hdGlvbiwgb3IgYEFuaW1hdGVkLmV2ZW50YC4gIFVzZWZ1bCBmb3IgY29tcGVuc2F0aW5nXG4gICAqIHRoaW5ncyBsaWtlIHRoZSBzdGFydCBvZiBhIHBhbiBnZXN0dXJlLlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9hbmltYXRlZHZhbHVlLmh0bWwjc2V0b2Zmc2V0XG4gICAqL1xuICA7XG5cbiAgX3Byb3RvLnNldE9mZnNldCA9IGZ1bmN0aW9uIHNldE9mZnNldChvZmZzZXQpIHtcbiAgICB0aGlzLl9vZmZzZXQgPSBvZmZzZXQ7XG5cbiAgICBpZiAodGhpcy5fX2lzTmF0aXZlKSB7XG4gICAgICBOYXRpdmVBbmltYXRlZEFQSS5zZXRBbmltYXRlZE5vZGVPZmZzZXQodGhpcy5fX2dldE5hdGl2ZVRhZygpLCBvZmZzZXQpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogTWVyZ2VzIHRoZSBvZmZzZXQgdmFsdWUgaW50byB0aGUgYmFzZSB2YWx1ZSBhbmQgcmVzZXRzIHRoZSBvZmZzZXQgdG8gemVyby5cbiAgICogVGhlIGZpbmFsIG91dHB1dCBvZiB0aGUgdmFsdWUgaXMgdW5jaGFuZ2VkLlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9hbmltYXRlZHZhbHVlLmh0bWwjZmxhdHRlbm9mZnNldFxuICAgKi9cbiAgO1xuXG4gIF9wcm90by5mbGF0dGVuT2Zmc2V0ID0gZnVuY3Rpb24gZmxhdHRlbk9mZnNldCgpIHtcbiAgICB0aGlzLl92YWx1ZSArPSB0aGlzLl9vZmZzZXQ7XG4gICAgdGhpcy5fb2Zmc2V0ID0gMDtcblxuICAgIGlmICh0aGlzLl9faXNOYXRpdmUpIHtcbiAgICAgIE5hdGl2ZUFuaW1hdGVkQVBJLmZsYXR0ZW5BbmltYXRlZE5vZGVPZmZzZXQodGhpcy5fX2dldE5hdGl2ZVRhZygpKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFNldHMgdGhlIG9mZnNldCB2YWx1ZSB0byB0aGUgYmFzZSB2YWx1ZSwgYW5kIHJlc2V0cyB0aGUgYmFzZSB2YWx1ZSB0byB6ZXJvLlxuICAgKiBUaGUgZmluYWwgb3V0cHV0IG9mIHRoZSB2YWx1ZSBpcyB1bmNoYW5nZWQuXG4gICAqXG4gICAqIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL2FuaW1hdGVkdmFsdWUuaHRtbCNleHRyYWN0b2Zmc2V0XG4gICAqL1xuICA7XG5cbiAgX3Byb3RvLmV4dHJhY3RPZmZzZXQgPSBmdW5jdGlvbiBleHRyYWN0T2Zmc2V0KCkge1xuICAgIHRoaXMuX29mZnNldCArPSB0aGlzLl92YWx1ZTtcbiAgICB0aGlzLl92YWx1ZSA9IDA7XG5cbiAgICBpZiAodGhpcy5fX2lzTmF0aXZlKSB7XG4gICAgICBOYXRpdmVBbmltYXRlZEFQSS5leHRyYWN0QW5pbWF0ZWROb2RlT2Zmc2V0KHRoaXMuX19nZXROYXRpdmVUYWcoKSk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBTdG9wcyBhbnkgcnVubmluZyBhbmltYXRpb24gb3IgdHJhY2tpbmcuIGBjYWxsYmFja2AgaXMgaW52b2tlZCB3aXRoIHRoZVxuICAgKiBmaW5hbCB2YWx1ZSBhZnRlciBzdG9wcGluZyB0aGUgYW5pbWF0aW9uLCB3aGljaCBpcyB1c2VmdWwgZm9yIHVwZGF0aW5nXG4gICAqIHN0YXRlIHRvIG1hdGNoIHRoZSBhbmltYXRpb24gcG9zaXRpb24gd2l0aCBsYXlvdXQuXG4gICAqXG4gICAqIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL2FuaW1hdGVkdmFsdWUuaHRtbCNzdG9wYW5pbWF0aW9uXG4gICAqL1xuICA7XG5cbiAgX3Byb3RvLnN0b3BBbmltYXRpb24gPSBmdW5jdGlvbiBzdG9wQW5pbWF0aW9uKGNhbGxiYWNrKSB7XG4gICAgdGhpcy5zdG9wVHJhY2tpbmcoKTtcbiAgICB0aGlzLl9hbmltYXRpb24gJiYgdGhpcy5fYW5pbWF0aW9uLnN0b3AoKTtcbiAgICB0aGlzLl9hbmltYXRpb24gPSBudWxsO1xuICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKHRoaXMuX19nZXRWYWx1ZSgpKTtcbiAgfVxuICAvKipcbiAgICogU3RvcHMgYW55IGFuaW1hdGlvbiBhbmQgcmVzZXRzIHRoZSB2YWx1ZSB0byBpdHMgb3JpZ2luYWwuXG4gICAqXG4gICAqIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL2FuaW1hdGVkdmFsdWUuaHRtbCNyZXNldGFuaW1hdGlvblxuICAgKi9cbiAgO1xuXG4gIF9wcm90by5yZXNldEFuaW1hdGlvbiA9IGZ1bmN0aW9uIHJlc2V0QW5pbWF0aW9uKGNhbGxiYWNrKSB7XG4gICAgdGhpcy5zdG9wQW5pbWF0aW9uKGNhbGxiYWNrKTtcbiAgICB0aGlzLl92YWx1ZSA9IHRoaXMuX3N0YXJ0aW5nVmFsdWU7XG4gIH07XG5cbiAgX3Byb3RvLl9vbkFuaW1hdGVkVmFsdWVVcGRhdGVSZWNlaXZlZCA9IGZ1bmN0aW9uIF9vbkFuaW1hdGVkVmFsdWVVcGRhdGVSZWNlaXZlZCh2YWx1ZSkge1xuICAgIHRoaXMuX3VwZGF0ZVZhbHVlKHZhbHVlLCBmYWxzZVxuICAgIC8qZmx1c2gqL1xuICAgICk7XG4gIH1cbiAgLyoqXG4gICAqIEludGVycG9sYXRlcyB0aGUgdmFsdWUgYmVmb3JlIHVwZGF0aW5nIHRoZSBwcm9wZXJ0eSwgZS5nLiBtYXBwaW5nIDAtMSB0b1xuICAgKiAwLTEwLlxuICAgKi9cbiAgO1xuXG4gIF9wcm90by5pbnRlcnBvbGF0ZSA9IGZ1bmN0aW9uIGludGVycG9sYXRlKGNvbmZpZykge1xuICAgIHJldHVybiBuZXcgX0FuaW1hdGVkSW50ZXJwb2xhdGlvbi5kZWZhdWx0KHRoaXMsIGNvbmZpZyk7XG4gIH1cbiAgLyoqXG4gICAqIFR5cGljYWxseSBvbmx5IHVzZWQgaW50ZXJuYWxseSwgYnV0IGNvdWxkIGJlIHVzZWQgYnkgYSBjdXN0b20gQW5pbWF0aW9uXG4gICAqIGNsYXNzLlxuICAgKlxuICAgKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9hbmltYXRlZHZhbHVlLmh0bWwjYW5pbWF0ZVxuICAgKi9cbiAgO1xuXG4gIF9wcm90by5hbmltYXRlID0gZnVuY3Rpb24gYW5pbWF0ZShhbmltYXRpb24sIGNhbGxiYWNrKSB7XG4gICAgdmFyIF90aGlzMyA9IHRoaXM7XG5cbiAgICB2YXIgaGFuZGxlID0gbnVsbDtcblxuICAgIGlmIChhbmltYXRpb24uX19pc0ludGVyYWN0aW9uKSB7XG4gICAgICBoYW5kbGUgPSBfSW50ZXJhY3Rpb25NYW5hZ2VyLmRlZmF1bHQuY3JlYXRlSW50ZXJhY3Rpb25IYW5kbGUoKTtcbiAgICB9XG5cbiAgICB2YXIgcHJldmlvdXNBbmltYXRpb24gPSB0aGlzLl9hbmltYXRpb247XG4gICAgdGhpcy5fYW5pbWF0aW9uICYmIHRoaXMuX2FuaW1hdGlvbi5zdG9wKCk7XG4gICAgdGhpcy5fYW5pbWF0aW9uID0gYW5pbWF0aW9uO1xuICAgIGFuaW1hdGlvbi5zdGFydCh0aGlzLl92YWx1ZSwgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAvLyBOYXRpdmVseSBkcml2ZW4gYW5pbWF0aW9ucyB3aWxsIG5ldmVyIGNhbGwgaW50byB0aGF0IGNhbGxiYWNrLCB0aGVyZWZvcmUgd2UgY2FuIGFsd2F5c1xuICAgICAgLy8gcGFzcyBmbHVzaCA9IHRydWUgdG8gYWxsb3cgdGhlIHVwZGF0ZWQgdmFsdWUgdG8gcHJvcGFnYXRlIHRvIG5hdGl2ZSB3aXRoIHNldE5hdGl2ZVByb3BzXG4gICAgICBfdGhpczMuX3VwZGF0ZVZhbHVlKHZhbHVlLCB0cnVlXG4gICAgICAvKiBmbHVzaCAqL1xuICAgICAgKTtcbiAgICB9LCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICBfdGhpczMuX2FuaW1hdGlvbiA9IG51bGw7XG5cbiAgICAgIGlmIChoYW5kbGUgIT09IG51bGwpIHtcbiAgICAgICAgX0ludGVyYWN0aW9uTWFuYWdlci5kZWZhdWx0LmNsZWFySW50ZXJhY3Rpb25IYW5kbGUoaGFuZGxlKTtcbiAgICAgIH1cblxuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2socmVzdWx0KTtcbiAgICB9LCBwcmV2aW91c0FuaW1hdGlvbiwgdGhpcyk7XG4gIH1cbiAgLyoqXG4gICAqIFR5cGljYWxseSBvbmx5IHVzZWQgaW50ZXJuYWxseS5cbiAgICovXG4gIDtcblxuICBfcHJvdG8uc3RvcFRyYWNraW5nID0gZnVuY3Rpb24gc3RvcFRyYWNraW5nKCkge1xuICAgIHRoaXMuX3RyYWNraW5nICYmIHRoaXMuX3RyYWNraW5nLl9fZGV0YWNoKCk7XG4gICAgdGhpcy5fdHJhY2tpbmcgPSBudWxsO1xuICB9XG4gIC8qKlxuICAgKiBUeXBpY2FsbHkgb25seSB1c2VkIGludGVybmFsbHkuXG4gICAqL1xuICA7XG5cbiAgX3Byb3RvLnRyYWNrID0gZnVuY3Rpb24gdHJhY2sodHJhY2tpbmcpIHtcbiAgICB0aGlzLnN0b3BUcmFja2luZygpO1xuICAgIHRoaXMuX3RyYWNraW5nID0gdHJhY2tpbmc7XG4gIH07XG5cbiAgX3Byb3RvLl91cGRhdGVWYWx1ZSA9IGZ1bmN0aW9uIF91cGRhdGVWYWx1ZSh2YWx1ZSwgZmx1c2gpIHtcbiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBbmltYXRlZFZhbHVlOiBBdHRlbXB0aW5nIHRvIHNldCB2YWx1ZSB0byB1bmRlZmluZWQnKTtcbiAgICB9XG5cbiAgICB0aGlzLl92YWx1ZSA9IHZhbHVlO1xuXG4gICAgaWYgKGZsdXNoKSB7XG4gICAgICBfZmx1c2godGhpcyk7XG4gICAgfVxuXG4gICAgX0FuaW1hdGVkV2l0aENoaWxkcmVuLnByb3RvdHlwZS5fX2NhbGxMaXN0ZW5lcnMuY2FsbCh0aGlzLCB0aGlzLl9fZ2V0VmFsdWUoKSk7XG4gIH07XG5cbiAgX3Byb3RvLl9fZ2V0TmF0aXZlQ29uZmlnID0gZnVuY3Rpb24gX19nZXROYXRpdmVDb25maWcoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICd2YWx1ZScsXG4gICAgICB2YWx1ZTogdGhpcy5fdmFsdWUsXG4gICAgICBvZmZzZXQ6IHRoaXMuX29mZnNldFxuICAgIH07XG4gIH07XG5cbiAgcmV0dXJuIEFuaW1hdGVkVmFsdWU7XG59KF9BbmltYXRlZFdpdGhDaGlsZHJlbjIuZGVmYXVsdCk7XG5cbnZhciBfZGVmYXVsdCA9IEFuaW1hdGVkVmFsdWU7XG5leHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0cy5kZWZhdWx0OyJdfQ==