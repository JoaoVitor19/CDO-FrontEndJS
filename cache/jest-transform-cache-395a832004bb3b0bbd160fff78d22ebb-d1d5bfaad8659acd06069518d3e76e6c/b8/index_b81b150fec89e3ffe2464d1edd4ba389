6ef4ae51a1fe2ccd8fe8a1d60484be78
'use strict';

exports.__esModule = true;
exports.default = void 0;

var _InteractionManager = _interopRequireDefault(require("../../../exports/InteractionManager"));

var _TouchHistoryMath = _interopRequireDefault(require("../TouchHistoryMath"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

var currentCentroidXOfTouchesChangedAfter = _TouchHistoryMath.default.currentCentroidXOfTouchesChangedAfter;
var currentCentroidYOfTouchesChangedAfter = _TouchHistoryMath.default.currentCentroidYOfTouchesChangedAfter;
var previousCentroidXOfTouchesChangedAfter = _TouchHistoryMath.default.previousCentroidXOfTouchesChangedAfter;
var previousCentroidYOfTouchesChangedAfter = _TouchHistoryMath.default.previousCentroidYOfTouchesChangedAfter;
var currentCentroidX = _TouchHistoryMath.default.currentCentroidX;
var currentCentroidY = _TouchHistoryMath.default.currentCentroidY;
var PanResponder = {
  _initializeGestureState: function _initializeGestureState(gestureState) {
    gestureState.moveX = 0;
    gestureState.moveY = 0;
    gestureState.x0 = 0;
    gestureState.y0 = 0;
    gestureState.dx = 0;
    gestureState.dy = 0;
    gestureState.vx = 0;
    gestureState.vy = 0;
    gestureState.numberActiveTouches = 0;
    gestureState._accountsForMovesUpTo = 0;
  },
  _updateGestureStateOnMove: function _updateGestureStateOnMove(gestureState, touchHistory) {
    gestureState.numberActiveTouches = touchHistory.numberActiveTouches;
    gestureState.moveX = currentCentroidXOfTouchesChangedAfter(touchHistory, gestureState._accountsForMovesUpTo);
    gestureState.moveY = currentCentroidYOfTouchesChangedAfter(touchHistory, gestureState._accountsForMovesUpTo);
    var movedAfter = gestureState._accountsForMovesUpTo;
    var prevX = previousCentroidXOfTouchesChangedAfter(touchHistory, movedAfter);
    var x = currentCentroidXOfTouchesChangedAfter(touchHistory, movedAfter);
    var prevY = previousCentroidYOfTouchesChangedAfter(touchHistory, movedAfter);
    var y = currentCentroidYOfTouchesChangedAfter(touchHistory, movedAfter);
    var nextDX = gestureState.dx + (x - prevX);
    var nextDY = gestureState.dy + (y - prevY);
    var dt = touchHistory.mostRecentTimeStamp - gestureState._accountsForMovesUpTo;
    gestureState.vx = (nextDX - gestureState.dx) / dt;
    gestureState.vy = (nextDY - gestureState.dy) / dt;
    gestureState.dx = nextDX;
    gestureState.dy = nextDY;
    gestureState._accountsForMovesUpTo = touchHistory.mostRecentTimeStamp;
  },
  create: function create(config) {
    var interactionState = {
      handle: null,
      shouldCancelClick: false,
      timeout: null
    };
    var gestureState = {
      stateID: Math.random(),
      moveX: 0,
      moveY: 0,
      x0: 0,
      y0: 0,
      dx: 0,
      dy: 0,
      vx: 0,
      vy: 0,
      numberActiveTouches: 0,
      _accountsForMovesUpTo: 0
    };
    var panHandlers = {
      onStartShouldSetResponder: function onStartShouldSetResponder(event) {
        return config.onStartShouldSetPanResponder == null ? false : config.onStartShouldSetPanResponder(event, gestureState);
      },
      onMoveShouldSetResponder: function onMoveShouldSetResponder(event) {
        return config.onMoveShouldSetPanResponder == null ? false : config.onMoveShouldSetPanResponder(event, gestureState);
      },
      onStartShouldSetResponderCapture: function onStartShouldSetResponderCapture(event) {
        if (event.nativeEvent.touches.length === 1) {
          PanResponder._initializeGestureState(gestureState);
        }

        gestureState.numberActiveTouches = event.touchHistory.numberActiveTouches;
        return config.onStartShouldSetPanResponderCapture != null ? config.onStartShouldSetPanResponderCapture(event, gestureState) : false;
      },
      onMoveShouldSetResponderCapture: function onMoveShouldSetResponderCapture(event) {
        var touchHistory = event.touchHistory;

        if (gestureState._accountsForMovesUpTo === touchHistory.mostRecentTimeStamp) {
          return false;
        }

        PanResponder._updateGestureStateOnMove(gestureState, touchHistory);

        return config.onMoveShouldSetPanResponderCapture ? config.onMoveShouldSetPanResponderCapture(event, gestureState) : false;
      },
      onResponderGrant: function onResponderGrant(event) {
        if (!interactionState.handle) {
          interactionState.handle = _InteractionManager.default.createInteractionHandle();
        }

        if (interactionState.timeout) {
          clearInteractionTimeout(interactionState);
        }

        interactionState.shouldCancelClick = true;
        gestureState.x0 = currentCentroidX(event.touchHistory);
        gestureState.y0 = currentCentroidY(event.touchHistory);
        gestureState.dx = 0;
        gestureState.dy = 0;

        if (config.onPanResponderGrant) {
          config.onPanResponderGrant(event, gestureState);
        }

        return config.onShouldBlockNativeResponder == null ? true : config.onShouldBlockNativeResponder(event, gestureState);
      },
      onResponderReject: function onResponderReject(event) {
        clearInteractionHandle(interactionState, config.onPanResponderReject, event, gestureState);
      },
      onResponderRelease: function onResponderRelease(event) {
        clearInteractionHandle(interactionState, config.onPanResponderRelease, event, gestureState);
        setInteractionTimeout(interactionState);

        PanResponder._initializeGestureState(gestureState);
      },
      onResponderStart: function onResponderStart(event) {
        var touchHistory = event.touchHistory;
        gestureState.numberActiveTouches = touchHistory.numberActiveTouches;

        if (config.onPanResponderStart) {
          config.onPanResponderStart(event, gestureState);
        }
      },
      onResponderMove: function onResponderMove(event) {
        var touchHistory = event.touchHistory;

        if (gestureState._accountsForMovesUpTo === touchHistory.mostRecentTimeStamp) {
          return;
        }

        PanResponder._updateGestureStateOnMove(gestureState, touchHistory);

        if (config.onPanResponderMove) {
          config.onPanResponderMove(event, gestureState);
        }
      },
      onResponderEnd: function onResponderEnd(event) {
        var touchHistory = event.touchHistory;
        gestureState.numberActiveTouches = touchHistory.numberActiveTouches;
        clearInteractionHandle(interactionState, config.onPanResponderEnd, event, gestureState);
      },
      onResponderTerminate: function onResponderTerminate(event) {
        clearInteractionHandle(interactionState, config.onPanResponderTerminate, event, gestureState);
        setInteractionTimeout(interactionState);

        PanResponder._initializeGestureState(gestureState);
      },
      onResponderTerminationRequest: function onResponderTerminationRequest(event) {
        return config.onPanResponderTerminationRequest == null ? true : config.onPanResponderTerminationRequest(event, gestureState);
      },
      onClickCapture: function onClickCapture(event) {
        if (interactionState.shouldCancelClick === true) {
          event.stopPropagation();
          event.preventDefault();
        }
      }
    };
    return {
      panHandlers: panHandlers,
      getInteractionHandle: function getInteractionHandle() {
        return interactionState.handle;
      }
    };
  }
};

function clearInteractionHandle(interactionState, callback, event, gestureState) {
  if (interactionState.handle) {
    _InteractionManager.default.clearInteractionHandle(interactionState.handle);

    interactionState.handle = null;
  }

  if (callback) {
    callback(event, gestureState);
  }
}

function clearInteractionTimeout(interactionState) {
  clearTimeout(interactionState.timeout);
}

function setInteractionTimeout(interactionState) {
  interactionState.timeout = setTimeout(function () {
    interactionState.shouldCancelClick = false;
  }, 250);
}

var _default = PanResponder;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9JbnRlcmFjdGlvbk1hbmFnZXIiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9Ub3VjaEhpc3RvcnlNYXRoIiwib2JqIiwiY3VycmVudENlbnRyb2lkWE9mVG91Y2hlc0NoYW5nZWRBZnRlciIsImN1cnJlbnRDZW50cm9pZFlPZlRvdWNoZXNDaGFuZ2VkQWZ0ZXIiLCJwcmV2aW91c0NlbnRyb2lkWE9mVG91Y2hlc0NoYW5nZWRBZnRlciIsInByZXZpb3VzQ2VudHJvaWRZT2ZUb3VjaGVzQ2hhbmdlZEFmdGVyIiwiY3VycmVudENlbnRyb2lkWCIsImN1cnJlbnRDZW50cm9pZFkiLCJQYW5SZXNwb25kZXIiLCJfaW5pdGlhbGl6ZUdlc3R1cmVTdGF0ZSIsImdlc3R1cmVTdGF0ZSIsIm1vdmVYIiwibW92ZVkiLCJ4MCIsInkwIiwiZHgiLCJkeSIsInZ4IiwidnkiLCJudW1iZXJBY3RpdmVUb3VjaGVzIiwiX2FjY291bnRzRm9yTW92ZXNVcFRvIiwiX3VwZGF0ZUdlc3R1cmVTdGF0ZU9uTW92ZSIsInRvdWNoSGlzdG9yeSIsIm1vdmVkQWZ0ZXIiLCJwcmV2WCIsIngiLCJwcmV2WSIsInkiLCJuZXh0RFgiLCJuZXh0RFkiLCJkdCIsIm1vc3RSZWNlbnRUaW1lU3RhbXAiLCJjcmVhdGUiLCJjb25maWciLCJpbnRlcmFjdGlvblN0YXRlIiwiaGFuZGxlIiwic2hvdWxkQ2FuY2VsQ2xpY2siLCJ0aW1lb3V0Iiwic3RhdGVJRCIsIk1hdGgiLCJyYW5kb20iLCJwYW5IYW5kbGVycyIsIm9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXIiLCJldmVudCIsIm9uU3RhcnRTaG91bGRTZXRQYW5SZXNwb25kZXIiLCJvbk1vdmVTaG91bGRTZXRSZXNwb25kZXIiLCJvbk1vdmVTaG91bGRTZXRQYW5SZXNwb25kZXIiLCJvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZSIsIm5hdGl2ZUV2ZW50IiwidG91Y2hlcyIsImxlbmd0aCIsIm9uU3RhcnRTaG91bGRTZXRQYW5SZXNwb25kZXJDYXB0dXJlIiwib25Nb3ZlU2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZSIsIm9uTW92ZVNob3VsZFNldFBhblJlc3BvbmRlckNhcHR1cmUiLCJvblJlc3BvbmRlckdyYW50IiwiY3JlYXRlSW50ZXJhY3Rpb25IYW5kbGUiLCJjbGVhckludGVyYWN0aW9uVGltZW91dCIsIm9uUGFuUmVzcG9uZGVyR3JhbnQiLCJvblNob3VsZEJsb2NrTmF0aXZlUmVzcG9uZGVyIiwib25SZXNwb25kZXJSZWplY3QiLCJjbGVhckludGVyYWN0aW9uSGFuZGxlIiwib25QYW5SZXNwb25kZXJSZWplY3QiLCJvblJlc3BvbmRlclJlbGVhc2UiLCJvblBhblJlc3BvbmRlclJlbGVhc2UiLCJzZXRJbnRlcmFjdGlvblRpbWVvdXQiLCJvblJlc3BvbmRlclN0YXJ0Iiwib25QYW5SZXNwb25kZXJTdGFydCIsIm9uUmVzcG9uZGVyTW92ZSIsIm9uUGFuUmVzcG9uZGVyTW92ZSIsIm9uUmVzcG9uZGVyRW5kIiwib25QYW5SZXNwb25kZXJFbmQiLCJvblJlc3BvbmRlclRlcm1pbmF0ZSIsIm9uUGFuUmVzcG9uZGVyVGVybWluYXRlIiwib25SZXNwb25kZXJUZXJtaW5hdGlvblJlcXVlc3QiLCJvblBhblJlc3BvbmRlclRlcm1pbmF0aW9uUmVxdWVzdCIsIm9uQ2xpY2tDYXB0dXJlIiwic3RvcFByb3BhZ2F0aW9uIiwicHJldmVudERlZmF1bHQiLCJnZXRJbnRlcmFjdGlvbkhhbmRsZSIsImNhbGxiYWNrIiwiY2xlYXJUaW1lb3V0Iiwic2V0VGltZW91dCIsIl9kZWZhdWx0IiwibW9kdWxlIl0sIm1hcHBpbmdzIjoiQUFTQTs7QUFFQUEsT0FBTyxDQUFDQyxVQUFSLEdBQXFCLElBQXJCO0FBQ0FELE9BQU8sQ0FBQ0UsT0FBUixHQUFrQixLQUFLLENBQXZCOztBQUVBLElBQUlDLG1CQUFtQixHQUFHQyxzQkFB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LE9BQU8sQ0FBQ0UsT0FBUixHQUFrQnNGLFFBQWxCO0FBQ0FDLE1BQU0sQ0FBQ3pGLE9BQVAsR0FBaUJBLE9BQU8sQ0FBQ0UsT0FBekIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIFxuICogQGZvcm1hdFxuICovXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5leHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7XG5cbnZhciBfSW50ZXJhY3Rpb25NYW5hZ2VyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vLi4vLi4vZXhwb3J0cy9JbnRlcmFjdGlvbk1hbmFnZXJcIikpO1xuXG52YXIgX1RvdWNoSGlzdG9yeU1hdGggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi9Ub3VjaEhpc3RvcnlNYXRoXCIpKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxudmFyIGN1cnJlbnRDZW50cm9pZFhPZlRvdWNoZXNDaGFuZ2VkQWZ0ZXIgPSBfVG91Y2hIaXN0b3J5TWF0aC5kZWZhdWx0LmN1cnJlbnRDZW50cm9pZFhPZlRvdWNoZXNDaGFuZ2VkQWZ0ZXI7XG52YXIgY3VycmVudENlbnRyb2lkWU9mVG91Y2hlc0NoYW5nZWRBZnRlciA9IF9Ub3VjaEhpc3RvcnlNYXRoLmRlZmF1bHQuY3VycmVudENlbnRyb2lkWU9mVG91Y2hlc0NoYW5nZWRBZnRlcjtcbnZhciBwcmV2aW91c0NlbnRyb2lkWE9mVG91Y2hlc0NoYW5nZWRBZnRlciA9IF9Ub3VjaEhpc3RvcnlNYXRoLmRlZmF1bHQucHJldmlvdXNDZW50cm9pZFhPZlRvdWNoZXNDaGFuZ2VkQWZ0ZXI7XG52YXIgcHJldmlvdXNDZW50cm9pZFlPZlRvdWNoZXNDaGFuZ2VkQWZ0ZXIgPSBfVG91Y2hIaXN0b3J5TWF0aC5kZWZhdWx0LnByZXZpb3VzQ2VudHJvaWRZT2ZUb3VjaGVzQ2hhbmdlZEFmdGVyO1xudmFyIGN1cnJlbnRDZW50cm9pZFggPSBfVG91Y2hIaXN0b3J5TWF0aC5kZWZhdWx0LmN1cnJlbnRDZW50cm9pZFg7XG52YXIgY3VycmVudENlbnRyb2lkWSA9IF9Ub3VjaEhpc3RvcnlNYXRoLmRlZmF1bHQuY3VycmVudENlbnRyb2lkWTtcbi8qKlxuICogYFBhblJlc3BvbmRlcmAgcmVjb25jaWxlcyBzZXZlcmFsIHRvdWNoZXMgaW50byBhIHNpbmdsZSBnZXN0dXJlLiBJdCBtYWtlc1xuICogc2luZ2xlLXRvdWNoIGdlc3R1cmVzIHJlc2lsaWVudCB0byBleHRyYSB0b3VjaGVzLCBhbmQgY2FuIGJlIHVzZWQgdG9cbiAqIHJlY29nbml6ZSBzaW1wbGUgbXVsdGktdG91Y2ggZ2VzdHVyZXMuXG4gKlxuICogQnkgZGVmYXVsdCwgYFBhblJlc3BvbmRlcmAgaG9sZHMgYW4gYEludGVyYWN0aW9uTWFuYWdlcmAgaGFuZGxlIHRvIGJsb2NrXG4gKiBsb25nLXJ1bm5pbmcgSlMgZXZlbnRzIGZyb20gaW50ZXJydXB0aW5nIGFjdGl2ZSBnZXN0dXJlcy5cbiAqXG4gKiBJdCBwcm92aWRlcyBhIHByZWRpY3RhYmxlIHdyYXBwZXIgb2YgdGhlIHJlc3BvbmRlciBoYW5kbGVycyBwcm92aWRlZCBieSB0aGVcbiAqIFtnZXN0dXJlIHJlc3BvbmRlciBzeXN0ZW1dKGRvY3MvZ2VzdHVyZS1yZXNwb25kZXItc3lzdGVtLmh0bWwpLlxuICogRm9yIGVhY2ggaGFuZGxlciwgaXQgcHJvdmlkZXMgYSBuZXcgYGdlc3R1cmVTdGF0ZWAgb2JqZWN0IGFsb25nc2lkZSB0aGVcbiAqIG5hdGl2ZSBldmVudCBvYmplY3Q6XG4gKlxuICogYGBgXG4gKiBvblBhblJlc3BvbmRlck1vdmU6IChldmVudCwgZ2VzdHVyZVN0YXRlKSA9PiB7fVxuICogYGBgXG4gKlxuICogQSBuYXRpdmUgZXZlbnQgaXMgYSBzeW50aGV0aWMgdG91Y2ggZXZlbnQgd2l0aCB0aGUgZm9sbG93aW5nIGZvcm06XG4gKlxuICogIC0gYG5hdGl2ZUV2ZW50YFxuICogICAgICArIGBjaGFuZ2VkVG91Y2hlc2AgLSBBcnJheSBvZiBhbGwgdG91Y2ggZXZlbnRzIHRoYXQgaGF2ZSBjaGFuZ2VkIHNpbmNlIHRoZSBsYXN0IGV2ZW50XG4gKiAgICAgICsgYGlkZW50aWZpZXJgIC0gVGhlIElEIG9mIHRoZSB0b3VjaFxuICogICAgICArIGBsb2NhdGlvblhgIC0gVGhlIFggcG9zaXRpb24gb2YgdGhlIHRvdWNoLCByZWxhdGl2ZSB0byB0aGUgZWxlbWVudFxuICogICAgICArIGBsb2NhdGlvbllgIC0gVGhlIFkgcG9zaXRpb24gb2YgdGhlIHRvdWNoLCByZWxhdGl2ZSB0byB0aGUgZWxlbWVudFxuICogICAgICArIGBwYWdlWGAgLSBUaGUgWCBwb3NpdGlvbiBvZiB0aGUgdG91Y2gsIHJlbGF0aXZlIHRvIHRoZSByb290IGVsZW1lbnRcbiAqICAgICAgKyBgcGFnZVlgIC0gVGhlIFkgcG9zaXRpb24gb2YgdGhlIHRvdWNoLCByZWxhdGl2ZSB0byB0aGUgcm9vdCBlbGVtZW50XG4gKiAgICAgICsgYHRhcmdldGAgLSBUaGUgbm9kZSBpZCBvZiB0aGUgZWxlbWVudCByZWNlaXZpbmcgdGhlIHRvdWNoIGV2ZW50XG4gKiAgICAgICsgYHRpbWVzdGFtcGAgLSBBIHRpbWUgaWRlbnRpZmllciBmb3IgdGhlIHRvdWNoLCB1c2VmdWwgZm9yIHZlbG9jaXR5IGNhbGN1bGF0aW9uXG4gKiAgICAgICsgYHRvdWNoZXNgIC0gQXJyYXkgb2YgYWxsIGN1cnJlbnQgdG91Y2hlcyBvbiB0aGUgc2NyZWVuXG4gKlxuICogQSBgZ2VzdHVyZVN0YXRlYCBvYmplY3QgaGFzIHRoZSBmb2xsb3dpbmc6XG4gKlxuICogIC0gYHN0YXRlSURgIC0gSUQgb2YgdGhlIGdlc3R1cmVTdGF0ZS0gcGVyc2lzdGVkIGFzIGxvbmcgYXMgdGhlcmUgYXQgbGVhc3RcbiAqICAgICBvbmUgdG91Y2ggb24gc2NyZWVuXG4gKiAgLSBgbW92ZVhgIC0gdGhlIGxhdGVzdCBzY3JlZW4gY29vcmRpbmF0ZXMgb2YgdGhlIHJlY2VudGx5LW1vdmVkIHRvdWNoXG4gKiAgLSBgbW92ZVlgIC0gdGhlIGxhdGVzdCBzY3JlZW4gY29vcmRpbmF0ZXMgb2YgdGhlIHJlY2VudGx5LW1vdmVkIHRvdWNoXG4gKiAgLSBgeDBgIC0gdGhlIHNjcmVlbiBjb29yZGluYXRlcyBvZiB0aGUgcmVzcG9uZGVyIGdyYW50XG4gKiAgLSBgeTBgIC0gdGhlIHNjcmVlbiBjb29yZGluYXRlcyBvZiB0aGUgcmVzcG9uZGVyIGdyYW50XG4gKiAgLSBgZHhgIC0gYWNjdW11bGF0ZWQgZGlzdGFuY2Ugb2YgdGhlIGdlc3R1cmUgc2luY2UgdGhlIHRvdWNoIHN0YXJ0ZWRcbiAqICAtIGBkeWAgLSBhY2N1bXVsYXRlZCBkaXN0YW5jZSBvZiB0aGUgZ2VzdHVyZSBzaW5jZSB0aGUgdG91Y2ggc3RhcnRlZFxuICogIC0gYHZ4YCAtIGN1cnJlbnQgdmVsb2NpdHkgb2YgdGhlIGdlc3R1cmVcbiAqICAtIGB2eWAgLSBjdXJyZW50IHZlbG9jaXR5IG9mIHRoZSBnZXN0dXJlXG4gKiAgLSBgbnVtYmVyQWN0aXZlVG91Y2hlc2AgLSBOdW1iZXIgb2YgdG91Y2hlcyBjdXJyZW50bHkgb24gc2NyZWVuXG4gKlxuICogIyMjIEJhc2ljIFVzYWdlXG4gKlxuICogYGBgXG4gKiAgIGNvbXBvbmVudFdpbGxNb3VudDogZnVuY3Rpb24oKSB7XG4gKiAgICAgdGhpcy5fcGFuUmVzcG9uZGVyID0gUGFuUmVzcG9uZGVyLmNyZWF0ZSh7XG4gKiAgICAgICAvLyBBc2sgdG8gYmUgdGhlIHJlc3BvbmRlcjpcbiAqICAgICAgIG9uU3RhcnRTaG91bGRTZXRQYW5SZXNwb25kZXI6IChldnQsIGdlc3R1cmVTdGF0ZSkgPT4gdHJ1ZSxcbiAqICAgICAgIG9uU3RhcnRTaG91bGRTZXRQYW5SZXNwb25kZXJDYXB0dXJlOiAoZXZ0LCBnZXN0dXJlU3RhdGUpID0+IHRydWUsXG4gKiAgICAgICBvbk1vdmVTaG91bGRTZXRQYW5SZXNwb25kZXI6IChldnQsIGdlc3R1cmVTdGF0ZSkgPT4gdHJ1ZSxcbiAqICAgICAgIG9uTW92ZVNob3VsZFNldFBhblJlc3BvbmRlckNhcHR1cmU6IChldnQsIGdlc3R1cmVTdGF0ZSkgPT4gdHJ1ZSxcbiAqXG4gKiAgICAgICBvblBhblJlc3BvbmRlckdyYW50OiAoZXZ0LCBnZXN0dXJlU3RhdGUpID0+IHtcbiAqICAgICAgICAgLy8gVGhlIGdlc3R1cmUgaGFzIHN0YXJ0ZWQuIFNob3cgdmlzdWFsIGZlZWRiYWNrIHNvIHRoZSB1c2VyIGtub3dzXG4gKiAgICAgICAgIC8vIHdoYXQgaXMgaGFwcGVuaW5nIVxuICpcbiAqICAgICAgICAgLy8gZ2VzdHVyZVN0YXRlLmR7eCx5fSB3aWxsIGJlIHNldCB0byB6ZXJvIG5vd1xuICogICAgICAgfSxcbiAqICAgICAgIG9uUGFuUmVzcG9uZGVyTW92ZTogKGV2dCwgZ2VzdHVyZVN0YXRlKSA9PiB7XG4gKiAgICAgICAgIC8vIFRoZSBtb3N0IHJlY2VudCBtb3ZlIGRpc3RhbmNlIGlzIGdlc3R1cmVTdGF0ZS5tb3Zle1gsWX1cbiAqXG4gKiAgICAgICAgIC8vIFRoZSBhY2N1bXVsYXRlZCBnZXN0dXJlIGRpc3RhbmNlIHNpbmNlIGJlY29taW5nIHJlc3BvbmRlciBpc1xuICogICAgICAgICAvLyBnZXN0dXJlU3RhdGUuZHt4LHl9XG4gKiAgICAgICB9LFxuICogICAgICAgb25QYW5SZXNwb25kZXJUZXJtaW5hdGlvblJlcXVlc3Q6IChldnQsIGdlc3R1cmVTdGF0ZSkgPT4gdHJ1ZSxcbiAqICAgICAgIG9uUGFuUmVzcG9uZGVyUmVsZWFzZTogKGV2dCwgZ2VzdHVyZVN0YXRlKSA9PiB7XG4gKiAgICAgICAgIC8vIFRoZSB1c2VyIGhhcyByZWxlYXNlZCBhbGwgdG91Y2hlcyB3aGlsZSB0aGlzIHZpZXcgaXMgdGhlXG4gKiAgICAgICAgIC8vIHJlc3BvbmRlci4gVGhpcyB0eXBpY2FsbHkgbWVhbnMgYSBnZXN0dXJlIGhhcyBzdWNjZWVkZWRcbiAqICAgICAgIH0sXG4gKiAgICAgICBvblBhblJlc3BvbmRlclRlcm1pbmF0ZTogKGV2dCwgZ2VzdHVyZVN0YXRlKSA9PiB7XG4gKiAgICAgICAgIC8vIEFub3RoZXIgY29tcG9uZW50IGhhcyBiZWNvbWUgdGhlIHJlc3BvbmRlciwgc28gdGhpcyBnZXN0dXJlXG4gKiAgICAgICAgIC8vIHNob3VsZCBiZSBjYW5jZWxsZWRcbiAqICAgICAgIH0sXG4gKiAgICAgICBvblNob3VsZEJsb2NrTmF0aXZlUmVzcG9uZGVyOiAoZXZ0LCBnZXN0dXJlU3RhdGUpID0+IHtcbiAqICAgICAgICAgLy8gUmV0dXJucyB3aGV0aGVyIHRoaXMgY29tcG9uZW50IHNob3VsZCBibG9jayBuYXRpdmUgY29tcG9uZW50cyBmcm9tIGJlY29taW5nIHRoZSBKU1xuICogICAgICAgICAvLyByZXNwb25kZXIuIFJldHVybnMgdHJ1ZSBieSBkZWZhdWx0LiBJcyBjdXJyZW50bHkgb25seSBzdXBwb3J0ZWQgb24gYW5kcm9pZC5cbiAqICAgICAgICAgcmV0dXJuIHRydWU7XG4gKiAgICAgICB9LFxuICogICAgIH0pO1xuICogICB9LFxuICpcbiAqICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAqICAgICByZXR1cm4gKFxuICogICAgICAgPFZpZXcgey4uLnRoaXMuX3BhblJlc3BvbmRlci5wYW5IYW5kbGVyc30gLz5cbiAqICAgICApO1xuICogICB9LFxuICpcbiAqIGBgYFxuICpcbiAqICMjIyBXb3JraW5nIEV4YW1wbGVcbiAqXG4gKiBUbyBzZWUgaXQgaW4gYWN0aW9uLCB0cnkgdGhlXG4gKiBbUGFuUmVzcG9uZGVyIGV4YW1wbGUgaW4gUk5UZXN0ZXJdKGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWFjdC1uYXRpdmUvYmxvYi9tYXN0ZXIvUk5UZXN0ZXIvanMvUGFuUmVzcG9uZGVyRXhhbXBsZS5qcylcbiAqL1xuXG52YXIgUGFuUmVzcG9uZGVyID0ge1xuICAvKipcbiAgICpcbiAgICogQSBncmFwaGljYWwgZXhwbGFuYXRpb24gb2YgdGhlIHRvdWNoIGRhdGEgZmxvdzpcbiAgICpcbiAgICogKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rICAgICAgICAgICAgICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAgICogfCBSZXNwb25kZXJUb3VjaEhpc3RvcnlTdG9yZSB8ICAgICAgICAgICAgIHxUb3VjaEhpc3RvcnlNYXRoICAgICAgICAgICAgICAgIHxcbiAgICogKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rICAgICAgICAgICAgICstLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAgICogfEdsb2JhbCBzdG9yZSBvZiB0b3VjaEhpc3Rvcnl8ICAgICAgICAgICAgIHxBbGxvY2F0aW9uLWxlc3MgbWF0aCB1dGlsICAgICAgIHxcbiAgICogfGluY2x1ZGluZyBhY3RpdmVuZXNzLCBzdGFydCB8ICAgICAgICAgICAgIHxvbiB0b3VjaCBoaXN0b3J5IChjZW50cm9pZHMgICAgIHxcbiAgICogfHBvc2l0aW9uLCBwcmV2L2N1ciBwb3NpdGlvbi58ICAgICAgICAgICAgIHxhbmQgbXVsdGl0b3VjaCBtb3ZlbWVudCBldGMpICAgIHxcbiAgICogfCAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICogKy0tLS1eLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rICAgICAgICAgICAgICstLS0tXi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAgICogICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICAgKiAgICAgIHwgKHJlY29yZHMgcmVsZXZhbnQgaGlzdG9yeSAgICAgICAgICAgICAgICB8XG4gICAqICAgICAgfCAgb2YgdG91Y2hlcyByZWxldmFudCBmb3IgICAgICAgICAgICAgICAgIHxcbiAgICogICAgICB8ICBpbXBsZW1lbnRpbmcgaGlnaGVyIGxldmVsICAgICAgICAgICAgICAgfFxuICAgKiAgICAgIHwgIGdlc3R1cmVzKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gICAqICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICogKy0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rICAgICAgICAgICAgICstLS0tfC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAgICogfCBSZXNwb25kZXJFdmVudFBsdWdpbiAgICAgICB8ICAgICAgICAgICAgIHwgICAgfCAgIFlvdXIgQXBwL0NvbXBvbmVudCAgICAgIHxcbiAgICogKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rICAgICAgICAgICAgICstLS0tfC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAgICogfE5lZ290aWF0ZXMgd2hpY2ggdmlldyBnZXRzICB8IExvdyBsZXZlbCAgIHwgICAgfCAgICAgICAgICAgICBIaWdoIGxldmVsICAgIHxcbiAgICogfG9uUmVzcG9uZGVyTW92ZSBldmVudHMuICAgICB8IGV2ZW50cyB3LyAgIHwgICstKy0tLS0tLS0rICAgICBldmVudHMgdy8gICAgIHxcbiAgICogfEFsc28gcmVjb3JkcyBoaXN0b3J5IGludG8gICB8IHRvdWNoSGlzdG9yeXwgIHwgICBQYW4gICB8ICAgICBtdWx0aXRvdWNoICsgIHxcbiAgICogfFJlc3BvbmRlclRvdWNoSGlzdG9yeVN0b3JlLiArLS0tLS0tLS0tLS0tLS0tLT5SZXNwb25kZXIrLS0tLS0+IGFjY3VtdWxhdGl2ZXxcbiAgICogKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rIGF0dGFjaGVkIHRvIHwgIHwgICAgICAgICB8ICAgICBkaXN0YW5jZSBhbmQgIHxcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlYWNoIGV2ZW50IHwgICstLS0tLS0tLS0rICAgICB2ZWxvY2l0eS4gICAgIHxcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAgICpcbiAgICpcbiAgICpcbiAgICogR2VzdHVyZSB0aGF0IGNhbGN1bGF0ZXMgY3VtdWxhdGl2ZSBtb3ZlbWVudCBvdmVyIHRpbWUgaW4gYSB3YXkgdGhhdCBqdXN0XG4gICAqIFwiZG9lcyB0aGUgcmlnaHQgdGhpbmdcIiBmb3IgbXVsdGlwbGUgdG91Y2hlcy4gVGhlIFwicmlnaHQgdGhpbmdcIiBpcyB2ZXJ5XG4gICAqIG51YW5jZWQuIFdoZW4gbW92aW5nIHR3byB0b3VjaGVzIGluIG9wcG9zaXRlIGRpcmVjdGlvbnMsIHRoZSBjdW11bGF0aXZlXG4gICAqIGRpc3RhbmNlIGlzIHplcm8gaW4gZWFjaCBkaW1lbnNpb24uIFdoZW4gdHdvIHRvdWNoZXMgbW92ZSBpbiBwYXJhbGxlbCBmaXZlXG4gICAqIHBpeGVscyBpbiB0aGUgc2FtZSBkaXJlY3Rpb24sIHRoZSBjdW11bGF0aXZlIGRpc3RhbmNlIGlzIGZpdmUsIG5vdCB0ZW4uIElmXG4gICAqIHR3byB0b3VjaGVzIHN0YXJ0LCBvbmUgbW92ZXMgZml2ZSBpbiBhIGRpcmVjdGlvbiwgdGhlbiBzdG9wcyBhbmQgdGhlIG90aGVyXG4gICAqIHRvdWNoIG1vdmVzIGZpdmVzIGluIHRoZSBzYW1lIGRpcmVjdGlvbiwgdGhlIGN1bXVsYXRpdmUgZGlzdGFuY2UgaXMgdGVuLlxuICAgKlxuICAgKiBUaGlzIGxvZ2ljIHJlcXVpcmVzIGEga2luZCBvZiBwcm9jZXNzaW5nIG9mIHRpbWUgXCJjbHVzdGVyc1wiIG9mIHRvdWNoIGV2ZW50c1xuICAgKiBzbyB0aGF0IHR3byB0b3VjaCBtb3ZlcyB0aGF0IGVzc2VudGlhbGx5IG9jY3VyIGluIHBhcmFsbGVsIGJ1dCBtb3ZlIGV2ZXJ5XG4gICAqIG90aGVyIGZyYW1lIHJlc3BlY3RpdmVseSwgYXJlIGNvbnNpZGVyZWQgcGFydCBvZiB0aGUgc2FtZSBtb3ZlbWVudC5cbiAgICpcbiAgICogRXhwbGFuYXRpb24gb2Ygc29tZSBvZiB0aGUgbm9uLW9idmlvdXMgZmllbGRzOlxuICAgKlxuICAgKiAtIG1vdmVYL21vdmVZOiBJZiBubyBtb3ZlIGV2ZW50IGhhcyBiZWVuIG9ic2VydmVkLCB0aGVuIGAobW92ZVgsIG1vdmVZKWAgaXNcbiAgICogICBpbnZhbGlkLiBJZiBhIG1vdmUgZXZlbnQgaGFzIGJlZW4gb2JzZXJ2ZWQsIGAobW92ZVgsIG1vdmVZKWAgaXMgdGhlXG4gICAqICAgY2VudHJvaWQgb2YgdGhlIG1vc3QgcmVjZW50bHkgbW92ZWQgXCJjbHVzdGVyXCIgb2YgYWN0aXZlIHRvdWNoZXMuXG4gICAqICAgKEN1cnJlbnRseSBhbGwgbW92ZSBoYXZlIHRoZSBzYW1lIHRpbWVTdGFtcCwgYnV0IGxhdGVyIHdlIHNob3VsZCBhZGQgc29tZVxuICAgKiAgIHRocmVzaG9sZCBmb3Igd2hhdCBpcyBjb25zaWRlcmVkIHRvIGJlIFwibW92aW5nXCIpLiBJZiBhIHBhbG0gaXNcbiAgICogICBhY2NpZGVudGFsbHkgY291bnRlZCBhcyBhIHRvdWNoLCBidXQgYSBmaW5nZXIgaXMgbW92aW5nIGdyZWF0bHksIHRoZSBwYWxtXG4gICAqICAgd2lsbCBtb3ZlIHNsaWdodGx5LCBidXQgd2Ugb25seSB3YW50IHRvIGNvdW50IHRoZSBzaW5nbGUgbW92aW5nIHRvdWNoLlxuICAgKiAtIHgwL3kwOiBDZW50cm9pZCBsb2NhdGlvbiAobm9uLWN1bXVsYXRpdmUpIGF0IHRoZSB0aW1lIG9mIGJlY29taW5nXG4gICAqICAgcmVzcG9uZGVyLlxuICAgKiAtIGR4L2R5OiBDdW11bGF0aXZlIHRvdWNoIGRpc3RhbmNlIC0gbm90IHRoZSBzYW1lIHRoaW5nIGFzIHN1bSBvZiBlYWNoIHRvdWNoXG4gICAqICAgZGlzdGFuY2UuIEFjY291bnRzIGZvciB0b3VjaCBtb3ZlcyB0aGF0IGFyZSBjbHVzdGVyZWQgdG9nZXRoZXIgaW4gdGltZSxcbiAgICogICBtb3ZpbmcgdGhlIHNhbWUgZGlyZWN0aW9uLiBPbmx5IHZhbGlkIHdoZW4gY3VycmVudGx5IHJlc3BvbmRlciAob3RoZXJ3aXNlLFxuICAgKiAgIGl0IG9ubHkgcmVwcmVzZW50cyB0aGUgZHJhZyBkaXN0YW5jZSBiZWxvdyB0aGUgdGhyZXNob2xkKS5cbiAgICogLSB2eC92eTogVmVsb2NpdHkuXG4gICAqL1xuICBfaW5pdGlhbGl6ZUdlc3R1cmVTdGF0ZTogZnVuY3Rpb24gX2luaXRpYWxpemVHZXN0dXJlU3RhdGUoZ2VzdHVyZVN0YXRlKSB7XG4gICAgZ2VzdHVyZVN0YXRlLm1vdmVYID0gMDtcbiAgICBnZXN0dXJlU3RhdGUubW92ZVkgPSAwO1xuICAgIGdlc3R1cmVTdGF0ZS54MCA9IDA7XG4gICAgZ2VzdHVyZVN0YXRlLnkwID0gMDtcbiAgICBnZXN0dXJlU3RhdGUuZHggPSAwO1xuICAgIGdlc3R1cmVTdGF0ZS5keSA9IDA7XG4gICAgZ2VzdHVyZVN0YXRlLnZ4ID0gMDtcbiAgICBnZXN0dXJlU3RhdGUudnkgPSAwO1xuICAgIGdlc3R1cmVTdGF0ZS5udW1iZXJBY3RpdmVUb3VjaGVzID0gMDsgLy8gQWxsIGBnZXN0dXJlU3RhdGVgIGFjY291bnRzIGZvciB0aW1lU3RhbXBzIHVwIHVudGlsOlxuXG4gICAgZ2VzdHVyZVN0YXRlLl9hY2NvdW50c0Zvck1vdmVzVXBUbyA9IDA7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFRoaXMgaXMgbnVhbmNlZCBhbmQgaXMgbmVjZXNzYXJ5LiBJdCBpcyBpbmNvcnJlY3QgdG8gY29udGludW91c2x5IHRha2UgYWxsXG4gICAqIGFjdGl2ZSAqYW5kKiByZWNlbnRseSBtb3ZlZCB0b3VjaGVzLCBmaW5kIHRoZSBjZW50cm9pZCwgYW5kIHRyYWNrIGhvdyB0aGF0XG4gICAqIHJlc3VsdCBjaGFuZ2VzIG92ZXIgdGltZS4gSW5zdGVhZCwgd2UgbXVzdCB0YWtlIGFsbCByZWNlbnRseSBtb3ZlZFxuICAgKiB0b3VjaGVzLCBhbmQgY2FsY3VsYXRlIGhvdyB0aGUgY2VudHJvaWQgaGFzIGNoYW5nZWQganVzdCBmb3IgdGhvc2VcbiAgICogcmVjZW50bHkgbW92ZWQgdG91Y2hlcywgYW5kIGFwcGVuZCB0aGF0IGNoYW5nZSB0byBhbiBhY2N1bXVsYXRvci4gVGhpcyBpc1xuICAgKiB0byAoYXQgbGVhc3QpIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGUgdXNlciBpcyBtb3ZpbmcgdGhyZWUgZmluZ2VycywgYW5kXG4gICAqIHRoZW4gb25lIG9mIHRoZSBmaW5nZXJzIHN0b3BzIGJ1dCB0aGUgb3RoZXIgdHdvIGNvbnRpbnVlLlxuICAgKlxuICAgKiBUaGlzIGlzIHZlcnkgZGlmZmVyZW50IHRoYW4gdGFraW5nIGFsbCBvZiB0aGUgcmVjZW50bHkgbW92ZWQgdG91Y2hlcyBhbmRcbiAgICogc3RvcmluZyB0aGVpciBjZW50cm9pZCBhcyBgZHgvZHlgLiBGb3IgY29ycmVjdG5lc3MsIHdlIG11c3QgKmFjY3VtdWxhdGVcbiAgICogY2hhbmdlcyogaW4gdGhlIGNlbnRyb2lkIG9mIHJlY2VudGx5IG1vdmVkIHRvdWNoZXMuXG4gICAqXG4gICAqIFRoZXJlIGlzIGFsc28gc29tZSBudWFuY2Ugd2l0aCBob3cgd2UgaGFuZGxlIG11bHRpcGxlIG1vdmVkIHRvdWNoZXMgaW4gYVxuICAgKiBzaW5nbGUgZXZlbnQuIFdpdGggdGhlIHdheSBgUmVhY3ROYXRpdmVFdmVudEVtaXR0ZXJgIGRpc3BhdGNoZXMgdG91Y2hlcyBhc1xuICAgKiBpbmRpdmlkdWFsIGV2ZW50cywgbXVsdGlwbGUgdG91Y2hlcyBnZW5lcmF0ZSB0d28gJ21vdmUnIGV2ZW50cywgZWFjaCBvZlxuICAgKiB0aGVtIHRyaWdnZXJpbmcgYG9uUmVzcG9uZGVyTW92ZWAuIEJ1dCB3aXRoIHRoZSB3YXkgYFBhblJlc3BvbmRlcmAgd29ya3MsXG4gICAqIGFsbCBvZiB0aGUgZ2VzdHVyZSBpbmZlcmVuY2UgaXMgcGVyZm9ybWVkIG9uIHRoZSBmaXJzdCBkaXNwYXRjaCwgc2luY2UgaXRcbiAgICogbG9va3MgYXQgYWxsIG9mIHRoZSB0b3VjaGVzIChldmVuIHRoZSBvbmVzIGZvciB3aGljaCB0aGVyZSBoYXNuJ3QgYmVlbiBhXG4gICAqIG5hdGl2ZSBkaXNwYXRjaCB5ZXQpLiBUaGVyZWZvcmUsIGBQYW5SZXNwb25kZXJgIGRvZXMgbm90IGNhbGxcbiAgICogYG9uUmVzcG9uZGVyTW92ZWAgcGFzc2VkIHRoZSBmaXJzdCBkaXNwYXRjaC4gVGhpcyBkaXZlcmdlcyBmcm9tIHRoZVxuICAgKiB0eXBpY2FsIHJlc3BvbmRlciBjYWxsYmFjayBwYXR0ZXJuICh3aXRob3V0IHVzaW5nIGBQYW5SZXNwb25kZXJgKSwgYnV0XG4gICAqIGF2b2lkcyBtb3JlIGRpc3BhdGNoZXMgdGhhbiBuZWNlc3NhcnkuXG4gICAqL1xuICBfdXBkYXRlR2VzdHVyZVN0YXRlT25Nb3ZlOiBmdW5jdGlvbiBfdXBkYXRlR2VzdHVyZVN0YXRlT25Nb3ZlKGdlc3R1cmVTdGF0ZSwgdG91Y2hIaXN0b3J5KSB7XG4gICAgZ2VzdHVyZVN0YXRlLm51bWJlckFjdGl2ZVRvdWNoZXMgPSB0b3VjaEhpc3RvcnkubnVtYmVyQWN0aXZlVG91Y2hlcztcbiAgICBnZXN0dXJlU3RhdGUubW92ZVggPSBjdXJyZW50Q2VudHJvaWRYT2ZUb3VjaGVzQ2hhbmdlZEFmdGVyKHRvdWNoSGlzdG9yeSwgZ2VzdHVyZVN0YXRlLl9hY2NvdW50c0Zvck1vdmVzVXBUbyk7XG4gICAgZ2VzdHVyZVN0YXRlLm1vdmVZID0gY3VycmVudENlbnRyb2lkWU9mVG91Y2hlc0NoYW5nZWRBZnRlcih0b3VjaEhpc3RvcnksIGdlc3R1cmVTdGF0ZS5fYWNjb3VudHNGb3JNb3Zlc1VwVG8pO1xuICAgIHZhciBtb3ZlZEFmdGVyID0gZ2VzdHVyZVN0YXRlLl9hY2NvdW50c0Zvck1vdmVzVXBUbztcbiAgICB2YXIgcHJldlggPSBwcmV2aW91c0NlbnRyb2lkWE9mVG91Y2hlc0NoYW5nZWRBZnRlcih0b3VjaEhpc3RvcnksIG1vdmVkQWZ0ZXIpO1xuICAgIHZhciB4ID0gY3VycmVudENlbnRyb2lkWE9mVG91Y2hlc0NoYW5nZWRBZnRlcih0b3VjaEhpc3RvcnksIG1vdmVkQWZ0ZXIpO1xuICAgIHZhciBwcmV2WSA9IHByZXZpb3VzQ2VudHJvaWRZT2ZUb3VjaGVzQ2hhbmdlZEFmdGVyKHRvdWNoSGlzdG9yeSwgbW92ZWRBZnRlcik7XG4gICAgdmFyIHkgPSBjdXJyZW50Q2VudHJvaWRZT2ZUb3VjaGVzQ2hhbmdlZEFmdGVyKHRvdWNoSGlzdG9yeSwgbW92ZWRBZnRlcik7XG4gICAgdmFyIG5leHREWCA9IGdlc3R1cmVTdGF0ZS5keCArICh4IC0gcHJldlgpO1xuICAgIHZhciBuZXh0RFkgPSBnZXN0dXJlU3RhdGUuZHkgKyAoeSAtIHByZXZZKTsgLy8gVE9ETzogVGhpcyBtdXN0IGJlIGZpbHRlcmVkIGludGVsbGlnZW50bHkuXG5cbiAgICB2YXIgZHQgPSB0b3VjaEhpc3RvcnkubW9zdFJlY2VudFRpbWVTdGFtcCAtIGdlc3R1cmVTdGF0ZS5fYWNjb3VudHNGb3JNb3Zlc1VwVG87XG4gICAgZ2VzdHVyZVN0YXRlLnZ4ID0gKG5leHREWCAtIGdlc3R1cmVTdGF0ZS5keCkgLyBkdDtcbiAgICBnZXN0dXJlU3RhdGUudnkgPSAobmV4dERZIC0gZ2VzdHVyZVN0YXRlLmR5KSAvIGR0O1xuICAgIGdlc3R1cmVTdGF0ZS5keCA9IG5leHREWDtcbiAgICBnZXN0dXJlU3RhdGUuZHkgPSBuZXh0RFk7XG4gICAgZ2VzdHVyZVN0YXRlLl9hY2NvdW50c0Zvck1vdmVzVXBUbyA9IHRvdWNoSGlzdG9yeS5tb3N0UmVjZW50VGltZVN0YW1wO1xuICB9LFxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge29iamVjdH0gY29uZmlnIEVuaGFuY2VkIHZlcnNpb25zIG9mIGFsbCBvZiB0aGUgcmVzcG9uZGVyIGNhbGxiYWNrc1xuICAgKiB0aGF0IHByb3ZpZGUgbm90IG9ubHkgdGhlIHR5cGljYWwgYFJlc3BvbmRlclN5bnRoZXRpY0V2ZW50YCwgYnV0IGFsc28gdGhlXG4gICAqIGBQYW5SZXNwb25kZXJgIGdlc3R1cmUgc3RhdGUuICBTaW1wbHkgcmVwbGFjZSB0aGUgd29yZCBgUmVzcG9uZGVyYCB3aXRoXG4gICAqIGBQYW5SZXNwb25kZXJgIGluIGVhY2ggb2YgdGhlIHR5cGljYWwgYG9uUmVzcG9uZGVyKmAgY2FsbGJhY2tzLiBGb3JcbiAgICogZXhhbXBsZSwgdGhlIGBjb25maWdgIG9iamVjdCB3b3VsZCBsb29rIGxpa2U6XG4gICAqXG4gICAqICAtIGBvbk1vdmVTaG91bGRTZXRQYW5SZXNwb25kZXI6IChlLCBnZXN0dXJlU3RhdGUpID0+IHsuLi59YFxuICAgKiAgLSBgb25Nb3ZlU2hvdWxkU2V0UGFuUmVzcG9uZGVyQ2FwdHVyZTogKGUsIGdlc3R1cmVTdGF0ZSkgPT4gey4uLn1gXG4gICAqICAtIGBvblN0YXJ0U2hvdWxkU2V0UGFuUmVzcG9uZGVyOiAoZSwgZ2VzdHVyZVN0YXRlKSA9PiB7Li4ufWBcbiAgICogIC0gYG9uU3RhcnRTaG91bGRTZXRQYW5SZXNwb25kZXJDYXB0dXJlOiAoZSwgZ2VzdHVyZVN0YXRlKSA9PiB7Li4ufWBcbiAgICogIC0gYG9uUGFuUmVzcG9uZGVyUmVqZWN0OiAoZSwgZ2VzdHVyZVN0YXRlKSA9PiB7Li4ufWBcbiAgICogIC0gYG9uUGFuUmVzcG9uZGVyR3JhbnQ6IChlLCBnZXN0dXJlU3RhdGUpID0+IHsuLi59YFxuICAgKiAgLSBgb25QYW5SZXNwb25kZXJTdGFydDogKGUsIGdlc3R1cmVTdGF0ZSkgPT4gey4uLn1gXG4gICAqICAtIGBvblBhblJlc3BvbmRlckVuZDogKGUsIGdlc3R1cmVTdGF0ZSkgPT4gey4uLn1gXG4gICAqICAtIGBvblBhblJlc3BvbmRlclJlbGVhc2U6IChlLCBnZXN0dXJlU3RhdGUpID0+IHsuLi59YFxuICAgKiAgLSBgb25QYW5SZXNwb25kZXJNb3ZlOiAoZSwgZ2VzdHVyZVN0YXRlKSA9PiB7Li4ufWBcbiAgICogIC0gYG9uUGFuUmVzcG9uZGVyVGVybWluYXRlOiAoZSwgZ2VzdHVyZVN0YXRlKSA9PiB7Li4ufWBcbiAgICogIC0gYG9uUGFuUmVzcG9uZGVyVGVybWluYXRpb25SZXF1ZXN0OiAoZSwgZ2VzdHVyZVN0YXRlKSA9PiB7Li4ufWBcbiAgICogIC0gYG9uU2hvdWxkQmxvY2tOYXRpdmVSZXNwb25kZXI6IChlLCBnZXN0dXJlU3RhdGUpID0+IHsuLi59YFxuICAgKlxuICAgKiAgSW4gZ2VuZXJhbCwgZm9yIGV2ZW50cyB0aGF0IGhhdmUgY2FwdHVyZSBlcXVpdmFsZW50cywgd2UgdXBkYXRlIHRoZVxuICAgKiAgZ2VzdHVyZVN0YXRlIG9uY2UgaW4gdGhlIGNhcHR1cmUgcGhhc2UgYW5kIGNhbiB1c2UgaXQgaW4gdGhlIGJ1YmJsZSBwaGFzZVxuICAgKiAgYXMgd2VsbC5cbiAgICpcbiAgICogIEJlIGNhcmVmdWwgd2l0aCBvblN0YXJ0U2hvdWxkKiBjYWxsYmFja3MuIFRoZXkgb25seSByZWZsZWN0IHVwZGF0ZWRcbiAgICogIGBnZXN0dXJlU3RhdGVgIGZvciBzdGFydC9lbmQgZXZlbnRzIHRoYXQgYnViYmxlL2NhcHR1cmUgdG8gdGhlIE5vZGUuXG4gICAqICBPbmNlIHRoZSBub2RlIGlzIHRoZSByZXNwb25kZXIsIHlvdSBjYW4gcmVseSBvbiBldmVyeSBzdGFydC9lbmQgZXZlbnRcbiAgICogIGJlaW5nIHByb2Nlc3NlZCBieSB0aGUgZ2VzdHVyZSBhbmQgYGdlc3R1cmVTdGF0ZWAgYmVpbmcgdXBkYXRlZFxuICAgKiAgYWNjb3JkaW5nbHkuIChudW1iZXJBY3RpdmVUb3VjaGVzKSBtYXkgbm90IGJlIHRvdGFsbHkgYWNjdXJhdGUgdW5sZXNzIHlvdVxuICAgKiAgYXJlIHRoZSByZXNwb25kZXIuXG4gICAqL1xuICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZShjb25maWcpIHtcbiAgICB2YXIgaW50ZXJhY3Rpb25TdGF0ZSA9IHtcbiAgICAgIGhhbmRsZTogbnVsbCxcbiAgICAgIHNob3VsZENhbmNlbENsaWNrOiBmYWxzZSxcbiAgICAgIHRpbWVvdXQ6IG51bGxcbiAgICB9O1xuICAgIHZhciBnZXN0dXJlU3RhdGUgPSB7XG4gICAgICAvLyBVc2VmdWwgZm9yIGRlYnVnZ2luZ1xuICAgICAgc3RhdGVJRDogTWF0aC5yYW5kb20oKSxcbiAgICAgIG1vdmVYOiAwLFxuICAgICAgbW92ZVk6IDAsXG4gICAgICB4MDogMCxcbiAgICAgIHkwOiAwLFxuICAgICAgZHg6IDAsXG4gICAgICBkeTogMCxcbiAgICAgIHZ4OiAwLFxuICAgICAgdnk6IDAsXG4gICAgICBudW1iZXJBY3RpdmVUb3VjaGVzOiAwLFxuICAgICAgX2FjY291bnRzRm9yTW92ZXNVcFRvOiAwXG4gICAgfTtcbiAgICB2YXIgcGFuSGFuZGxlcnMgPSB7XG4gICAgICBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyOiBmdW5jdGlvbiBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyKGV2ZW50KSB7XG4gICAgICAgIHJldHVybiBjb25maWcub25TdGFydFNob3VsZFNldFBhblJlc3BvbmRlciA9PSBudWxsID8gZmFsc2UgOiBjb25maWcub25TdGFydFNob3VsZFNldFBhblJlc3BvbmRlcihldmVudCwgZ2VzdHVyZVN0YXRlKTtcbiAgICAgIH0sXG4gICAgICBvbk1vdmVTaG91bGRTZXRSZXNwb25kZXI6IGZ1bmN0aW9uIG9uTW92ZVNob3VsZFNldFJlc3BvbmRlcihldmVudCkge1xuICAgICAgICByZXR1cm4gY29uZmlnLm9uTW92ZVNob3VsZFNldFBhblJlc3BvbmRlciA9PSBudWxsID8gZmFsc2UgOiBjb25maWcub25Nb3ZlU2hvdWxkU2V0UGFuUmVzcG9uZGVyKGV2ZW50LCBnZXN0dXJlU3RhdGUpO1xuICAgICAgfSxcbiAgICAgIG9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXJDYXB0dXJlOiBmdW5jdGlvbiBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZShldmVudCkge1xuICAgICAgICAvLyBUT0RPOiBBY3R1YWxseSwgd2Ugc2hvdWxkIHJlaW5pdGlhbGl6ZSB0aGUgc3RhdGUgYW55IHRpbWVcbiAgICAgICAgLy8gdG91Y2hlcy5sZW5ndGggaW5jcmVhc2VzIGZyb20gMCBhY3RpdmUgdG8gPiAwIGFjdGl2ZS5cbiAgICAgICAgaWYgKGV2ZW50Lm5hdGl2ZUV2ZW50LnRvdWNoZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgUGFuUmVzcG9uZGVyLl9pbml0aWFsaXplR2VzdHVyZVN0YXRlKGdlc3R1cmVTdGF0ZSk7XG4gICAgICAgIH1cblxuICAgICAgICBnZXN0dXJlU3RhdGUubnVtYmVyQWN0aXZlVG91Y2hlcyA9IGV2ZW50LnRvdWNoSGlzdG9yeS5udW1iZXJBY3RpdmVUb3VjaGVzO1xuICAgICAgICByZXR1cm4gY29uZmlnLm9uU3RhcnRTaG91bGRTZXRQYW5SZXNwb25kZXJDYXB0dXJlICE9IG51bGwgPyBjb25maWcub25TdGFydFNob3VsZFNldFBhblJlc3BvbmRlckNhcHR1cmUoZXZlbnQsIGdlc3R1cmVTdGF0ZSkgOiBmYWxzZTtcbiAgICAgIH0sXG4gICAgICBvbk1vdmVTaG91bGRTZXRSZXNwb25kZXJDYXB0dXJlOiBmdW5jdGlvbiBvbk1vdmVTaG91bGRTZXRSZXNwb25kZXJDYXB0dXJlKGV2ZW50KSB7XG4gICAgICAgIHZhciB0b3VjaEhpc3RvcnkgPSBldmVudC50b3VjaEhpc3Rvcnk7IC8vIFJlc3BvbmRlciBzeXN0ZW0gaW5jb3JyZWN0bHkgZGlzcGF0Y2hlcyBzaG91bGQqIHRvIGN1cnJlbnQgcmVzcG9uZGVyXG4gICAgICAgIC8vIEZpbHRlciBvdXQgYW55IHRvdWNoIG1vdmVzIHBhc3QgdGhlIGZpcnN0IG9uZSAtIHdlIHdvdWxkIGhhdmVcbiAgICAgICAgLy8gYWxyZWFkeSBwcm9jZXNzZWQgbXVsdGktdG91Y2ggZ2VvbWV0cnkgZHVyaW5nIHRoZSBmaXJzdCBldmVudC5cblxuICAgICAgICBpZiAoZ2VzdHVyZVN0YXRlLl9hY2NvdW50c0Zvck1vdmVzVXBUbyA9PT0gdG91Y2hIaXN0b3J5Lm1vc3RSZWNlbnRUaW1lU3RhbXApIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBQYW5SZXNwb25kZXIuX3VwZGF0ZUdlc3R1cmVTdGF0ZU9uTW92ZShnZXN0dXJlU3RhdGUsIHRvdWNoSGlzdG9yeSk7XG5cbiAgICAgICAgcmV0dXJuIGNvbmZpZy5vbk1vdmVTaG91bGRTZXRQYW5SZXNwb25kZXJDYXB0dXJlID8gY29uZmlnLm9uTW92ZVNob3VsZFNldFBhblJlc3BvbmRlckNhcHR1cmUoZXZlbnQsIGdlc3R1cmVTdGF0ZSkgOiBmYWxzZTtcbiAgICAgIH0sXG4gICAgICBvblJlc3BvbmRlckdyYW50OiBmdW5jdGlvbiBvblJlc3BvbmRlckdyYW50KGV2ZW50KSB7XG4gICAgICAgIGlmICghaW50ZXJhY3Rpb25TdGF0ZS5oYW5kbGUpIHtcbiAgICAgICAgICBpbnRlcmFjdGlvblN0YXRlLmhhbmRsZSA9IF9JbnRlcmFjdGlvbk1hbmFnZXIuZGVmYXVsdC5jcmVhdGVJbnRlcmFjdGlvbkhhbmRsZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGludGVyYWN0aW9uU3RhdGUudGltZW91dCkge1xuICAgICAgICAgIGNsZWFySW50ZXJhY3Rpb25UaW1lb3V0KGludGVyYWN0aW9uU3RhdGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaW50ZXJhY3Rpb25TdGF0ZS5zaG91bGRDYW5jZWxDbGljayA9IHRydWU7XG4gICAgICAgIGdlc3R1cmVTdGF0ZS54MCA9IGN1cnJlbnRDZW50cm9pZFgoZXZlbnQudG91Y2hIaXN0b3J5KTtcbiAgICAgICAgZ2VzdHVyZVN0YXRlLnkwID0gY3VycmVudENlbnRyb2lkWShldmVudC50b3VjaEhpc3RvcnkpO1xuICAgICAgICBnZXN0dXJlU3RhdGUuZHggPSAwO1xuICAgICAgICBnZXN0dXJlU3RhdGUuZHkgPSAwO1xuXG4gICAgICAgIGlmIChjb25maWcub25QYW5SZXNwb25kZXJHcmFudCkge1xuICAgICAgICAgIGNvbmZpZy5vblBhblJlc3BvbmRlckdyYW50KGV2ZW50LCBnZXN0dXJlU3RhdGUpO1xuICAgICAgICB9IC8vIFRPRE86IHQ3NDY3MTI0IGludmVzdGlnYXRlIGlmIHRoaXMgY2FuIGJlIHJlbW92ZWRcblxuXG4gICAgICAgIHJldHVybiBjb25maWcub25TaG91bGRCbG9ja05hdGl2ZVJlc3BvbmRlciA9PSBudWxsID8gdHJ1ZSA6IGNvbmZpZy5vblNob3VsZEJsb2NrTmF0aXZlUmVzcG9uZGVyKGV2ZW50LCBnZXN0dXJlU3RhdGUpO1xuICAgICAgfSxcbiAgICAgIG9uUmVzcG9uZGVyUmVqZWN0OiBmdW5jdGlvbiBvblJlc3BvbmRlclJlamVjdChldmVudCkge1xuICAgICAgICBjbGVhckludGVyYWN0aW9uSGFuZGxlKGludGVyYWN0aW9uU3RhdGUsIGNvbmZpZy5vblBhblJlc3BvbmRlclJlamVjdCwgZXZlbnQsIGdlc3R1cmVTdGF0ZSk7XG4gICAgICB9LFxuICAgICAgb25SZXNwb25kZXJSZWxlYXNlOiBmdW5jdGlvbiBvblJlc3BvbmRlclJlbGVhc2UoZXZlbnQpIHtcbiAgICAgICAgY2xlYXJJbnRlcmFjdGlvbkhhbmRsZShpbnRlcmFjdGlvblN0YXRlLCBjb25maWcub25QYW5SZXNwb25kZXJSZWxlYXNlLCBldmVudCwgZ2VzdHVyZVN0YXRlKTtcbiAgICAgICAgc2V0SW50ZXJhY3Rpb25UaW1lb3V0KGludGVyYWN0aW9uU3RhdGUpO1xuXG4gICAgICAgIFBhblJlc3BvbmRlci5faW5pdGlhbGl6ZUdlc3R1cmVTdGF0ZShnZXN0dXJlU3RhdGUpO1xuICAgICAgfSxcbiAgICAgIG9uUmVzcG9uZGVyU3RhcnQ6IGZ1bmN0aW9uIG9uUmVzcG9uZGVyU3RhcnQoZXZlbnQpIHtcbiAgICAgICAgdmFyIHRvdWNoSGlzdG9yeSA9IGV2ZW50LnRvdWNoSGlzdG9yeTtcbiAgICAgICAgZ2VzdHVyZVN0YXRlLm51bWJlckFjdGl2ZVRvdWNoZXMgPSB0b3VjaEhpc3RvcnkubnVtYmVyQWN0aXZlVG91Y2hlcztcblxuICAgICAgICBpZiAoY29uZmlnLm9uUGFuUmVzcG9uZGVyU3RhcnQpIHtcbiAgICAgICAgICBjb25maWcub25QYW5SZXNwb25kZXJTdGFydChldmVudCwgZ2VzdHVyZVN0YXRlKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG9uUmVzcG9uZGVyTW92ZTogZnVuY3Rpb24gb25SZXNwb25kZXJNb3ZlKGV2ZW50KSB7XG4gICAgICAgIHZhciB0b3VjaEhpc3RvcnkgPSBldmVudC50b3VjaEhpc3Rvcnk7IC8vIEd1YXJkIGFnYWluc3QgdGhlIGRpc3BhdGNoIG9mIHR3byB0b3VjaCBtb3ZlcyB3aGVuIHRoZXJlIGFyZSB0d29cbiAgICAgICAgLy8gc2ltdWx0YW5lb3VzbHkgY2hhbmdlZCB0b3VjaGVzLlxuXG4gICAgICAgIGlmIChnZXN0dXJlU3RhdGUuX2FjY291bnRzRm9yTW92ZXNVcFRvID09PSB0b3VjaEhpc3RvcnkubW9zdFJlY2VudFRpbWVTdGFtcCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSAvLyBGaWx0ZXIgb3V0IGFueSB0b3VjaCBtb3ZlcyBwYXN0IHRoZSBmaXJzdCBvbmUgLSB3ZSB3b3VsZCBoYXZlXG4gICAgICAgIC8vIGFscmVhZHkgcHJvY2Vzc2VkIG11bHRpLXRvdWNoIGdlb21ldHJ5IGR1cmluZyB0aGUgZmlyc3QgZXZlbnQuXG5cblxuICAgICAgICBQYW5SZXNwb25kZXIuX3VwZGF0ZUdlc3R1cmVTdGF0ZU9uTW92ZShnZXN0dXJlU3RhdGUsIHRvdWNoSGlzdG9yeSk7XG5cbiAgICAgICAgaWYgKGNvbmZpZy5vblBhblJlc3BvbmRlck1vdmUpIHtcbiAgICAgICAgICBjb25maWcub25QYW5SZXNwb25kZXJNb3ZlKGV2ZW50LCBnZXN0dXJlU3RhdGUpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgb25SZXNwb25kZXJFbmQ6IGZ1bmN0aW9uIG9uUmVzcG9uZGVyRW5kKGV2ZW50KSB7XG4gICAgICAgIHZhciB0b3VjaEhpc3RvcnkgPSBldmVudC50b3VjaEhpc3Rvcnk7XG4gICAgICAgIGdlc3R1cmVTdGF0ZS5udW1iZXJBY3RpdmVUb3VjaGVzID0gdG91Y2hIaXN0b3J5Lm51bWJlckFjdGl2ZVRvdWNoZXM7XG4gICAgICAgIGNsZWFySW50ZXJhY3Rpb25IYW5kbGUoaW50ZXJhY3Rpb25TdGF0ZSwgY29uZmlnLm9uUGFuUmVzcG9uZGVyRW5kLCBldmVudCwgZ2VzdHVyZVN0YXRlKTtcbiAgICAgIH0sXG4gICAgICBvblJlc3BvbmRlclRlcm1pbmF0ZTogZnVuY3Rpb24gb25SZXNwb25kZXJUZXJtaW5hdGUoZXZlbnQpIHtcbiAgICAgICAgY2xlYXJJbnRlcmFjdGlvbkhhbmRsZShpbnRlcmFjdGlvblN0YXRlLCBjb25maWcub25QYW5SZXNwb25kZXJUZXJtaW5hdGUsIGV2ZW50LCBnZXN0dXJlU3RhdGUpO1xuICAgICAgICBzZXRJbnRlcmFjdGlvblRpbWVvdXQoaW50ZXJhY3Rpb25TdGF0ZSk7XG5cbiAgICAgICAgUGFuUmVzcG9uZGVyLl9pbml0aWFsaXplR2VzdHVyZVN0YXRlKGdlc3R1cmVTdGF0ZSk7XG4gICAgICB9LFxuICAgICAgb25SZXNwb25kZXJUZXJtaW5hdGlvblJlcXVlc3Q6IGZ1bmN0aW9uIG9uUmVzcG9uZGVyVGVybWluYXRpb25SZXF1ZXN0KGV2ZW50KSB7XG4gICAgICAgIHJldHVybiBjb25maWcub25QYW5SZXNwb25kZXJUZXJtaW5hdGlvblJlcXVlc3QgPT0gbnVsbCA/IHRydWUgOiBjb25maWcub25QYW5SZXNwb25kZXJUZXJtaW5hdGlvblJlcXVlc3QoZXZlbnQsIGdlc3R1cmVTdGF0ZSk7XG4gICAgICB9LFxuICAgICAgLy8gV2UgZG8gbm90IHdhbnQgdG8gdHJpZ2dlciAnY2xpY2snIGFjdGl2YXRlZCBnZXN0dXJlcyBvciBuYXRpdmUgYmVoYXZpb3JzXG4gICAgICAvLyBvbiBhbnkgcGFuIHRhcmdldCB0aGF0IGlzIHVuZGVyIGEgbW91c2UgY3Vyc29yIHdoZW4gaXQgaXMgcmVsZWFzZWQuXG4gICAgICAvLyBCcm93c2VycyB3aWxsIG5hdGl2ZWx5IGNhbmNlbCAnY2xpY2snIGV2ZW50cyBvbiBhIHRhcmdldCBpZiBhIG5vbi1tb3VzZVxuICAgICAgLy8gYWN0aXZlIHBvaW50ZXIgbW92ZXMuXG4gICAgICBvbkNsaWNrQ2FwdHVyZTogZnVuY3Rpb24gb25DbGlja0NhcHR1cmUoZXZlbnQpIHtcbiAgICAgICAgaWYgKGludGVyYWN0aW9uU3RhdGUuc2hvdWxkQ2FuY2VsQ2xpY2sgPT09IHRydWUpIHtcbiAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgcGFuSGFuZGxlcnM6IHBhbkhhbmRsZXJzLFxuICAgICAgZ2V0SW50ZXJhY3Rpb25IYW5kbGU6IGZ1bmN0aW9uIGdldEludGVyYWN0aW9uSGFuZGxlKCkge1xuICAgICAgICByZXR1cm4gaW50ZXJhY3Rpb25TdGF0ZS5oYW5kbGU7XG4gICAgICB9XG4gICAgfTtcbiAgfVxufTtcblxuZnVuY3Rpb24gY2xlYXJJbnRlcmFjdGlvbkhhbmRsZShpbnRlcmFjdGlvblN0YXRlLCBjYWxsYmFjaywgZXZlbnQsIGdlc3R1cmVTdGF0ZSkge1xuICBpZiAoaW50ZXJhY3Rpb25TdGF0ZS5oYW5kbGUpIHtcbiAgICBfSW50ZXJhY3Rpb25NYW5hZ2VyLmRlZmF1bHQuY2xlYXJJbnRlcmFjdGlvbkhhbmRsZShpbnRlcmFjdGlvblN0YXRlLmhhbmRsZSk7XG5cbiAgICBpbnRlcmFjdGlvblN0YXRlLmhhbmRsZSA9IG51bGw7XG4gIH1cblxuICBpZiAoY2FsbGJhY2spIHtcbiAgICBjYWxsYmFjayhldmVudCwgZ2VzdHVyZVN0YXRlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjbGVhckludGVyYWN0aW9uVGltZW91dChpbnRlcmFjdGlvblN0YXRlKSB7XG4gIGNsZWFyVGltZW91dChpbnRlcmFjdGlvblN0YXRlLnRpbWVvdXQpO1xufVxuXG5mdW5jdGlvbiBzZXRJbnRlcmFjdGlvblRpbWVvdXQoaW50ZXJhY3Rpb25TdGF0ZSkge1xuICBpbnRlcmFjdGlvblN0YXRlLnRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICBpbnRlcmFjdGlvblN0YXRlLnNob3VsZENhbmNlbENsaWNrID0gZmFsc2U7XG4gIH0sIDI1MCk7XG59XG5cbnZhciBfZGVmYXVsdCA9IFBhblJlc3BvbmRlcjtcbmV4cG9ydHMuZGVmYXVsdCA9IF9kZWZhdWx0O1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzLmRlZmF1bHQ7Il19