d079564a6ffa9a3f557853c6fe40d8f7
"use strict";

exports.__esModule = true;
exports.default = createOrderedCSSStyleSheet;
var slice = Array.prototype.slice;

function createOrderedCSSStyleSheet(sheet) {
  var groups = {};
  var selectors = {};

  if (sheet != null) {
    var group;
    slice.call(sheet.cssRules).forEach(function (cssRule, i) {
      var cssText = cssRule.cssText;

      if (cssText.indexOf('stylesheet-group') > -1) {
        group = decodeGroupRule(cssRule);
        groups[group] = {
          start: i,
          rules: [cssText]
        };
      } else {
        var selectorText = getSelectorText(cssText);

        if (selectorText != null) {
          selectors[selectorText] = true;
          groups[group].rules.push(cssText);
        }
      }
    });
  }

  function sheetInsert(sheet, group, text) {
    var orderedGroups = getOrderedGroups(groups);
    var groupIndex = orderedGroups.indexOf(group);
    var nextGroupIndex = groupIndex + 1;
    var nextGroup = orderedGroups[nextGroupIndex];
    var position = nextGroup != null && groups[nextGroup].start != null ? groups[nextGroup].start : sheet.cssRules.length;
    var isInserted = insertRuleAt(sheet, text, position);

    if (isInserted) {
      if (groups[group].start == null) {
        groups[group].start = position;
      }

      for (var i = nextGroupIndex; i < orderedGroups.length; i += 1) {
        var groupNumber = orderedGroups[i];
        var previousStart = groups[groupNumber].start || 0;
        groups[groupNumber].start = previousStart + 1;
      }
    }

    return isInserted;
  }

  var OrderedCSSStyleSheet = {
    getTextContent: function getTextContent() {
      return getOrderedGroups(groups).map(function (group) {
        var rules = groups[group].rules;
        return rules.join('\n');
      }).join('\n');
    },
    insert: function insert(cssText, groupValue) {
      var group = Number(groupValue);

      if (groups[group] == null) {
        var markerRule = encodeGroupRule(group);
        groups[group] = {
          start: null,
          rules: [markerRule]
        };

        if (sheet != null) {
          sheetInsert(sheet, group, markerRule);
        }
      }

      var selectorText = getSelectorText(cssText);

      if (selectorText != null && selectors[selectorText] == null) {
        selectors[selectorText] = true;
        groups[group].rules.push(cssText);

        if (sheet != null) {
          var isInserted = sheetInsert(sheet, group, cssText);

          if (!isInserted) {
            groups[group].rules.pop();
          }
        }
      }
    }
  };
  return OrderedCSSStyleSheet;
}

function encodeGroupRule(group) {
  return "[stylesheet-group=\"" + group + "\"]{}";
}

function decodeGroupRule(cssRule) {
  return Number(cssRule.selectorText.split(/["']/)[1]);
}

function getOrderedGroups(obj) {
  return Object.keys(obj).map(Number).sort(function (a, b) {
    return a > b ? 1 : -1;
  });
}

var pattern = /\s*([,])\s*/g;

function getSelectorText(cssText) {
  var selector = cssText.split('{')[0].trim();
  return selector !== '' ? selector.replace(pattern, '$1') : null;
}

function insertRuleAt(root, cssText, position) {
  try {
    root.insertRule(cssText, position);
    return true;
  } catch (e) {
    return false;
  }
}

module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZU9yZGVyZWRDU1NTdHlsZVNoZWV0LmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsImNyZWF0ZU9yZGVyZWRDU1NTdHlsZVNoZWV0Iiwic2xpY2UiLCJBcnJheSIsInByb3RvdHlwZSIsInNoZWV0IiwiZ3JvdXBzIiwic2VsZWN0b3JzIiwiZ3JvdXAiLCJjYWxsIiwiY3NzUnVsZXMiLCJmb3JFYWNoIiwiY3NzUnVsZSIsImkiLCJjc3NUZXh0IiwiaW5kZXhPZiIsImRlY29kZUdyb3VwUnVsZSIsInN0YXJ0IiwicnVsZXMiLCJzZWxlY3RvclRleHQiLCJnZXRTZWxlY3RvclRleHQiLCJwdXNoIiwic2hlZXRJbnNlcnQiLCJ0ZXh0Iiwib3JkZXJlZEdyb3VwcyIsImdldE9yZGVyZWRHcm91cHMiLCJncm91cEluZGV4IiwibmV4dEdyb3VwSW5kZXgiLCJuZXh0R3JvdXAiLCJwb3NpdGlvbiIsImxlbmd0aCIsImlzSW5zZXJ0ZWQiLCJpbnNlcnRSdWxlQXQiLCJncm91cE51bWJlciIsInByZXZpb3VzU3RhcnQiLCJPcmRlcmVkQ1NTU3R5bGVTaGVldCIsImdldFRleHRDb250ZW50IiwibWFwIiwiam9pbiIsImluc2VydCIsImdyb3VwVmFsdWUiLCJOdW1iZXIiLCJtYXJrZXJSdWxlIiwiZW5jb2RlR3JvdXBSdWxlIiwicG9wIiwic3BsaXQiLCJvYmoiLCJPYmplY3QiLCJrZXlzIiwic29ydCIsImEiLCJiIiwicGF0dGVybiIsInNlbGVjdG9yIiwidHJpbSIsInJlcGxhY2UiLCJyb290IiwiaW5zZXJ0UnVsZSIsImUiLCJtb2R1bGUiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBQSxPQUFPLENBQUNDLFVBQVIsR0FBcUIsSUFBckI7QUFDQUQsT0FBTyxDQUFDRSxPQUFSLEdBQWtCQywwQkFBbEI7QUFVQSxJQUFJQyxLQUFLLEdBQUdDLEtBQUssQ0FBQ0MsU0FBTixDQUFnQkYsS0FBNUI7O0FBaUJBLFNBQVNELDBCQUFU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QXFDZSxRQUFyQyxFQUErQztBQUM3QyxNQUFJO0FBRUYyQixJQUFBQSxJQUFJLENBQUNDLFVBQUwsQ0FBZ0IzQyxPQUFoQixFQUF5QmUsUUFBekI7QUFDQSxXQUFPLElBQVA7QUFDRCxHQUpELENBSUUsT0FBTzZCLENBQVAsRUFBVTtBQUdWLFdBQU8sS0FBUDtBQUNEO0FBQ0Y7O0FBRURDLE1BQU0sQ0FBQzdELE9BQVAsR0FBaUJBLE9BQU8sQ0FBQ0UsT0FBekIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuZGVmYXVsdCA9IGNyZWF0ZU9yZGVyZWRDU1NTdHlsZVNoZWV0O1xuXG4vKipcbiAqIENvcHlyaWdodCAoYykgTmljb2xhcyBHYWxsYWdoZXIuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogXG4gKi9cbnZhciBzbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTtcbi8qKlxuICogT3JkZXItYmFzZWQgaW5zZXJ0aW9uIG9mIENTUy5cbiAqXG4gKiBFYWNoIHJ1bGUgaXMgYXNzb2NpYXRlZCB3aXRoIGEgbnVtZXJpY2FsbHkgZGVmaW5lZCBncm91cC5cbiAqIEdyb3VwcyBhcmUgb3JkZXJlZCB3aXRoaW4gdGhlIHN0eWxlIHNoZWV0IGFjY29yZGluZyB0byB0aGVpciBudW1iZXIsIHdpdGggdGhlXG4gKiBsb3dlc3QgZmlyc3QuXG4gKlxuICogR3JvdXBzIGFyZSBpbXBsZW1lbnRlZCB1c2luZyBtYXJrZXIgcnVsZXMuIFRoZSBzZWxlY3RvciBvZiB0aGUgZmlyc3QgcnVsZSBvZlxuICogZWFjaCBncm91cCBpcyB1c2VkIG9ubHkgdG8gZW5jb2RlIHRoZSBncm91cCBudW1iZXIgZm9yIGh5ZHJhdGlvbi4gQW5cbiAqIGFsdGVybmF0aXZlIGltcGxlbWVudGF0aW9uIGNvdWxkIHJlbHkgb24gQ1NTTWVkaWFSdWxlLCBhbGxvd2luZyBncm91cHMgdG8gYmVcbiAqIHRyZWF0ZWQgYXMgYSBzdWItc2hlZXQsIGJ1dCB0aGUgRWRnZSBpbXBsZW1lbnRhdGlvbiBvZiBDU1NNZWRpYVJ1bGUgaXNcbiAqIGJyb2tlbi5cbiAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9DU1NNZWRpYVJ1bGVcbiAqIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL25lY29sYXMvYWEwYzM3ODQ2YWQ2YmQzYjA1YjcyN2I5NTllODI2NzRcbiAqL1xuXG5mdW5jdGlvbiBjcmVhdGVPcmRlcmVkQ1NTU3R5bGVTaGVldChzaGVldCkge1xuICB2YXIgZ3JvdXBzID0ge307XG4gIHZhciBzZWxlY3RvcnMgPSB7fTtcbiAgLyoqXG4gICAqIEh5ZHJhdGUgYXBwcm94aW1hdGUgcmVjb3JkIGZyb20gYW55IGV4aXN0aW5nIHJ1bGVzIGluIHRoZSBzaGVldC5cbiAgICovXG5cbiAgaWYgKHNoZWV0ICE9IG51bGwpIHtcbiAgICB2YXIgZ3JvdXA7XG4gICAgc2xpY2UuY2FsbChzaGVldC5jc3NSdWxlcykuZm9yRWFjaChmdW5jdGlvbiAoY3NzUnVsZSwgaSkge1xuICAgICAgdmFyIGNzc1RleHQgPSBjc3NSdWxlLmNzc1RleHQ7IC8vIENyZWF0ZSByZWNvcmQgb2YgZXhpc3Rpbmcgc2VsZWN0b3JzIGFuZCBydWxlc1xuXG4gICAgICBpZiAoY3NzVGV4dC5pbmRleE9mKCdzdHlsZXNoZWV0LWdyb3VwJykgPiAtMSkge1xuICAgICAgICBncm91cCA9IGRlY29kZUdyb3VwUnVsZShjc3NSdWxlKTtcbiAgICAgICAgZ3JvdXBzW2dyb3VwXSA9IHtcbiAgICAgICAgICBzdGFydDogaSxcbiAgICAgICAgICBydWxlczogW2Nzc1RleHRdXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgc2VsZWN0b3JUZXh0ID0gZ2V0U2VsZWN0b3JUZXh0KGNzc1RleHQpO1xuXG4gICAgICAgIGlmIChzZWxlY3RvclRleHQgIT0gbnVsbCkge1xuICAgICAgICAgIHNlbGVjdG9yc1tzZWxlY3RvclRleHRdID0gdHJ1ZTtcbiAgICAgICAgICBncm91cHNbZ3JvdXBdLnJ1bGVzLnB1c2goY3NzVGV4dCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNoZWV0SW5zZXJ0KHNoZWV0LCBncm91cCwgdGV4dCkge1xuICAgIHZhciBvcmRlcmVkR3JvdXBzID0gZ2V0T3JkZXJlZEdyb3Vwcyhncm91cHMpO1xuICAgIHZhciBncm91cEluZGV4ID0gb3JkZXJlZEdyb3Vwcy5pbmRleE9mKGdyb3VwKTtcbiAgICB2YXIgbmV4dEdyb3VwSW5kZXggPSBncm91cEluZGV4ICsgMTtcbiAgICB2YXIgbmV4dEdyb3VwID0gb3JkZXJlZEdyb3Vwc1tuZXh0R3JvdXBJbmRleF07IC8vIEluc2VydCBydWxlIGJlZm9yZSB0aGUgbmV4dCBncm91cCwgb3IgYXQgdGhlIGVuZCBvZiB0aGUgc3R5bGVzaGVldFxuXG4gICAgdmFyIHBvc2l0aW9uID0gbmV4dEdyb3VwICE9IG51bGwgJiYgZ3JvdXBzW25leHRHcm91cF0uc3RhcnQgIT0gbnVsbCA/IGdyb3Vwc1tuZXh0R3JvdXBdLnN0YXJ0IDogc2hlZXQuY3NzUnVsZXMubGVuZ3RoO1xuICAgIHZhciBpc0luc2VydGVkID0gaW5zZXJ0UnVsZUF0KHNoZWV0LCB0ZXh0LCBwb3NpdGlvbik7XG5cbiAgICBpZiAoaXNJbnNlcnRlZCkge1xuICAgICAgLy8gU2V0IHRoZSBzdGFydGluZyBpbmRleCBvZiB0aGUgbmV3IGdyb3VwXG4gICAgICBpZiAoZ3JvdXBzW2dyb3VwXS5zdGFydCA9PSBudWxsKSB7XG4gICAgICAgIGdyb3Vwc1tncm91cF0uc3RhcnQgPSBwb3NpdGlvbjtcbiAgICAgIH0gLy8gSW5jcmVtZW50IHRoZSBzdGFydGluZyBpbmRleCBvZiBhbGwgc3Vic2VxdWVudCBncm91cHNcblxuXG4gICAgICBmb3IgKHZhciBpID0gbmV4dEdyb3VwSW5kZXg7IGkgPCBvcmRlcmVkR3JvdXBzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIHZhciBncm91cE51bWJlciA9IG9yZGVyZWRHcm91cHNbaV07XG4gICAgICAgIHZhciBwcmV2aW91c1N0YXJ0ID0gZ3JvdXBzW2dyb3VwTnVtYmVyXS5zdGFydCB8fCAwO1xuICAgICAgICBncm91cHNbZ3JvdXBOdW1iZXJdLnN0YXJ0ID0gcHJldmlvdXNTdGFydCArIDE7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGlzSW5zZXJ0ZWQ7XG4gIH1cblxuICB2YXIgT3JkZXJlZENTU1N0eWxlU2hlZXQgPSB7XG4gICAgLyoqXG4gICAgICogVGhlIHRleHRDb250ZW50IG9mIHRoZSBzdHlsZSBzaGVldC5cbiAgICAgKi9cbiAgICBnZXRUZXh0Q29udGVudDogZnVuY3Rpb24gZ2V0VGV4dENvbnRlbnQoKSB7XG4gICAgICByZXR1cm4gZ2V0T3JkZXJlZEdyb3Vwcyhncm91cHMpLm1hcChmdW5jdGlvbiAoZ3JvdXApIHtcbiAgICAgICAgdmFyIHJ1bGVzID0gZ3JvdXBzW2dyb3VwXS5ydWxlcztcbiAgICAgICAgcmV0dXJuIHJ1bGVzLmpvaW4oJ1xcbicpO1xuICAgICAgfSkuam9pbignXFxuJyk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluc2VydCBhIHJ1bGUgaW50byB0aGUgc3R5bGUgc2hlZXRcbiAgICAgKi9cbiAgICBpbnNlcnQ6IGZ1bmN0aW9uIGluc2VydChjc3NUZXh0LCBncm91cFZhbHVlKSB7XG4gICAgICB2YXIgZ3JvdXAgPSBOdW1iZXIoZ3JvdXBWYWx1ZSk7IC8vIENyZWF0ZSBhIG5ldyBncm91cC5cblxuICAgICAgaWYgKGdyb3Vwc1tncm91cF0gPT0gbnVsbCkge1xuICAgICAgICB2YXIgbWFya2VyUnVsZSA9IGVuY29kZUdyb3VwUnVsZShncm91cCk7IC8vIENyZWF0ZSB0aGUgaW50ZXJuYWwgcmVjb3JkLlxuXG4gICAgICAgIGdyb3Vwc1tncm91cF0gPSB7XG4gICAgICAgICAgc3RhcnQ6IG51bGwsXG4gICAgICAgICAgcnVsZXM6IFttYXJrZXJSdWxlXVxuICAgICAgICB9OyAvLyBVcGRhdGUgQ1NTT00uXG5cbiAgICAgICAgaWYgKHNoZWV0ICE9IG51bGwpIHtcbiAgICAgICAgICBzaGVldEluc2VydChzaGVldCwgZ3JvdXAsIG1hcmtlclJ1bGUpO1xuICAgICAgICB9XG4gICAgICB9IC8vIHNlbGVjdG9yVGV4dCBpcyBtb3JlIHJlbGlhYmxlIHRoYW4gY3NzVGV4dCBmb3IgaW5zZXJ0aW9uIGNoZWNrcy4gVGhlXG4gICAgICAvLyBicm93c2VyIGV4Y2x1ZGVzIHZlbmRvci1wcmVmaXhlZCBwcm9wZXJ0aWVzIGFuZCByZXdyaXRlcyBjZXJ0YWluIHZhbHVlc1xuICAgICAgLy8gbWFraW5nIGNzc1RleHQgbW9yZSBsaWtlbHkgdG8gYmUgZGlmZmVyZW50IGZyb20gd2hhdCB3YXMgaW5zZXJ0ZWQuXG5cblxuICAgICAgdmFyIHNlbGVjdG9yVGV4dCA9IGdldFNlbGVjdG9yVGV4dChjc3NUZXh0KTtcblxuICAgICAgaWYgKHNlbGVjdG9yVGV4dCAhPSBudWxsICYmIHNlbGVjdG9yc1tzZWxlY3RvclRleHRdID09IG51bGwpIHtcbiAgICAgICAgLy8gVXBkYXRlIHRoZSBpbnRlcm5hbCByZWNvcmRzLlxuICAgICAgICBzZWxlY3RvcnNbc2VsZWN0b3JUZXh0XSA9IHRydWU7XG4gICAgICAgIGdyb3Vwc1tncm91cF0ucnVsZXMucHVzaChjc3NUZXh0KTsgLy8gVXBkYXRlIENTU09NLlxuXG4gICAgICAgIGlmIChzaGVldCAhPSBudWxsKSB7XG4gICAgICAgICAgdmFyIGlzSW5zZXJ0ZWQgPSBzaGVldEluc2VydChzaGVldCwgZ3JvdXAsIGNzc1RleHQpO1xuXG4gICAgICAgICAgaWYgKCFpc0luc2VydGVkKSB7XG4gICAgICAgICAgICAvLyBSZXZlcnQgaW50ZXJuYWwgcmVjb3JkIGNoYW5nZSBpZiBhIHJ1bGUgd2FzIHJlamVjdGVkIChlLmcuLFxuICAgICAgICAgICAgLy8gdW5yZWNvZ25pemVkIHBzZXVkby1zZWxlY3RvcilcbiAgICAgICAgICAgIGdyb3Vwc1tncm91cF0ucnVsZXMucG9wKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gT3JkZXJlZENTU1N0eWxlU2hlZXQ7XG59XG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbnNcbiAqL1xuXG5cbmZ1bmN0aW9uIGVuY29kZUdyb3VwUnVsZShncm91cCkge1xuICByZXR1cm4gXCJbc3R5bGVzaGVldC1ncm91cD1cXFwiXCIgKyBncm91cCArIFwiXFxcIl17fVwiO1xufVxuXG5mdW5jdGlvbiBkZWNvZGVHcm91cFJ1bGUoY3NzUnVsZSkge1xuICByZXR1cm4gTnVtYmVyKGNzc1J1bGUuc2VsZWN0b3JUZXh0LnNwbGl0KC9bXCInXS8pWzFdKTtcbn1cblxuZnVuY3Rpb24gZ2V0T3JkZXJlZEdyb3VwcyhvYmopIHtcbiAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikubWFwKE51bWJlcikuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgIHJldHVybiBhID4gYiA/IDEgOiAtMTtcbiAgfSk7XG59XG5cbnZhciBwYXR0ZXJuID0gL1xccyooWyxdKVxccyovZztcblxuZnVuY3Rpb24gZ2V0U2VsZWN0b3JUZXh0KGNzc1RleHQpIHtcbiAgdmFyIHNlbGVjdG9yID0gY3NzVGV4dC5zcGxpdCgneycpWzBdLnRyaW0oKTtcbiAgcmV0dXJuIHNlbGVjdG9yICE9PSAnJyA/IHNlbGVjdG9yLnJlcGxhY2UocGF0dGVybiwgJyQxJykgOiBudWxsO1xufVxuXG5mdW5jdGlvbiBpbnNlcnRSdWxlQXQocm9vdCwgY3NzVGV4dCwgcG9zaXRpb24pIHtcbiAgdHJ5IHtcbiAgICAvLyAkRmxvd0ZpeE1lOiBGbG93IGlzIG1pc3NpbmcgQ1NTT00gdHlwZXMgbmVlZGVkIHRvIHR5cGUgJ3Jvb3QnLlxuICAgIHJvb3QuaW5zZXJ0UnVsZShjc3NUZXh0LCBwb3NpdGlvbik7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICAvLyBKU0RPTSBkb2Vzbid0IHN1cHBvcnQgYENTU1NNZWRpYVJ1bGUjaW5zZXJ0UnVsZWAuXG4gICAgLy8gQWxzbyBpZ25vcmUgZXJyb3JzIHRoYXQgb2NjdXIgZnJvbSBhdHRlbXB0aW5nIHRvIGluc2VydCB2ZW5kb3ItcHJlZml4ZWQgc2VsZWN0b3JzLlxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHMuZGVmYXVsdDsiXX0=