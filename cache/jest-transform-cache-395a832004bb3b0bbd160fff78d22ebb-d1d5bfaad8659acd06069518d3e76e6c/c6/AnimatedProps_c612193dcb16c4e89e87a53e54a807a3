96d0f81e2e469e1853664910471be374
'use strict';

exports.__esModule = true;
exports.default = void 0;

var _AnimatedEvent = require("../AnimatedEvent");

var _AnimatedNode2 = _interopRequireDefault(require("./AnimatedNode"));

var _AnimatedStyle = _interopRequireDefault(require("./AnimatedStyle"));

var _NativeAnimatedHelper = _interopRequireDefault(require("../NativeAnimatedHelper"));

var _findNodeHandle = _interopRequireDefault(require("../../../../exports/findNodeHandle"));

var _invariant = _interopRequireDefault(require("fbjs/lib/invariant"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function ownKeys(object, enumerableOnly) {
  var keys = Object.keys(object);

  if (Object.getOwnPropertySymbols) {
    var symbols = Object.getOwnPropertySymbols(object);
    if (enumerableOnly) symbols = symbols.filter(function (sym) {
      return Object.getOwnPropertyDescriptor(object, sym).enumerable;
    });
    keys.push.apply(keys, symbols);
  }

  return keys;
}

function _objectSpread(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};

    if (i % 2) {
      ownKeys(Object(source), true).forEach(function (key) {
        _defineProperty(target, key, source[key]);
      });
    } else if (Object.getOwnPropertyDescriptors) {
      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));
    } else {
      ownKeys(Object(source)).forEach(function (key) {
        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
      });
    }
  }

  return target;
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

function _inheritsLoose(subClass, superClass) {
  subClass.prototype = Object.create(superClass.prototype);
  subClass.prototype.constructor = subClass;

  _setPrototypeOf(subClass, superClass);
}

function _setPrototypeOf(o, p) {
  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {
    o.__proto__ = p;
    return o;
  };

  return _setPrototypeOf(o, p);
}

var AnimatedProps = function (_AnimatedNode) {
  _inheritsLoose(AnimatedProps, _AnimatedNode);

  function AnimatedProps(props, callback) {
    var _this;

    _this = _AnimatedNode.call(this) || this;

    if (props.style) {
      props = _objectSpread(_objectSpread({}, props), {}, {
        style: new _AnimatedStyle.default(props.style)
      });
    }

    _this._props = props;
    _this._callback = callback;

    _this.__attach();

    return _this;
  }

  var _proto = AnimatedProps.prototype;

  _proto.__getValue = function __getValue() {
    var props = {};

    for (var key in this._props) {
      var value = this._props[key];

      if (value instanceof _AnimatedNode2.default) {
        if (!value.__isNative || value instanceof _AnimatedStyle.default) {
          props[key] = value.__getValue();
        }
      } else if (value instanceof _AnimatedEvent.AnimatedEvent) {
        props[key] = value.__getHandler();
      } else {
        props[key] = value;
      }
    }

    return props;
  };

  _proto.__getAnimatedValue = function __getAnimatedValue() {
    var props = {};

    for (var key in this._props) {
      var value = this._props[key];

      if (value instanceof _AnimatedNode2.default) {
        props[key] = value.__getAnimatedValue();
      }
    }

    return props;
  };

  _proto.__attach = function __attach() {
    for (var key in this._props) {
      var value = this._props[key];

      if (value instanceof _AnimatedNode2.default) {
        value.__addChild(this);
      }
    }
  };

  _proto.__detach = function __detach() {
    if (this.__isNative && this._animatedView) {
      this.__disconnectAnimatedView();
    }

    for (var key in this._props) {
      var value = this._props[key];

      if (value instanceof _AnimatedNode2.default) {
        value.__removeChild(this);
      }
    }

    _AnimatedNode.prototype.__detach.call(this);
  };

  _proto.update = function update() {
    this._callback();
  };

  _proto.__makeNative = function __makeNative() {
    if (!this.__isNative) {
      this.__isNative = true;

      for (var key in this._props) {
        var value = this._props[key];

        if (value instanceof _AnimatedNode2.default) {
          value.__makeNative();
        }
      }

      if (this._animatedView) {
        this.__connectAnimatedView();
      }
    }
  };

  _proto.setNativeView = function setNativeView(animatedView) {
    if (this._animatedView === animatedView) {
      return;
    }

    this._animatedView = animatedView;

    if (this.__isNative) {
      this.__connectAnimatedView();
    }
  };

  _proto.__connectAnimatedView = function __connectAnimatedView() {
    (0, _invariant.default)(this.__isNative, 'Expected node to be marked as "native"');
    var nativeViewTag = (0, _findNodeHandle.default)(this._animatedView);
    (0, _invariant.default)(nativeViewTag != null, 'Unable to locate attached view in the native tree');

    _NativeAnimatedHelper.default.API.connectAnimatedNodeToView(this.__getNativeTag(), nativeViewTag);
  };

  _proto.__disconnectAnimatedView = function __disconnectAnimatedView() {
    (0, _invariant.default)(this.__isNative, 'Expected node to be marked as "native"');
    var nativeViewTag = (0, _findNodeHandle.default)(this._animatedView);
    (0, _invariant.default)(nativeViewTag != null, 'Unable to locate attached view in the native tree');

    _NativeAnimatedHelper.default.API.disconnectAnimatedNodeFromView(this.__getNativeTag(), nativeViewTag);
  };

  _proto.__restoreDefaultValues = function __restoreDefaultValues() {
    if (this.__isNative) {
      _NativeAnimatedHelper.default.API.restoreDefaultValues(this.__getNativeTag());
    }
  };

  _proto.__getNativeConfig = function __getNativeConfig() {
    var propsConfig = {};

    for (var propKey in this._props) {
      var value = this._props[propKey];

      if (value instanceof _AnimatedNode2.default) {
        value.__makeNative();

        propsConfig[propKey] = value.__getNativeTag();
      }
    }

    return {
      type: 'props',
      props: propsConfig
    };
  };

  return AnimatedProps;
}(_AnimatedNode2.default);

var _default = AnimatedProps;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuaW1hdGVkUHJvcHMuanMiXSwibmFtZXMiOlsiZXhwb3J0cyIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiX0FuaW1hdGVkRXZlbnQiLCJyZXF1aXJlIiwiX0FuaW1hdGVkTm9kZTIiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX0FuaW1hdGVkU3R5bGUiLCJfTmF0aXZlQW5pbWF0ZWRIZWxwZXIiLCJfZmluZE5vZGVIYW5kbGUiLCJfaW52YXJpYW50Iiwib2JqIiwib3duS2V5cyIsIm9iamVjdCIsImVudW1lcmFibGVPbmx5Iiwia2V5cyIsIk9iamVjdCIsImdldE93blByb3BlcnR5U3ltYm9scyIsInN5bWJvbHMiLCJmaWx0ZXIiLCJzeW0iLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwicHVzaCIsImFwcGx5IiwiX29iamVjdFNwcmVhZCIsInRhcmdldCIsImkiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJzb3VyY2UiLCJmb3JFYWNoIiwia2V5IiwiX2RlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyIsImRlZmluZVByb3BlcnRpZXMiLCJkZWZpbmVQcm9wZXJ0eSIsInZhbHVlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJfaW5oZXJpdHNMb29zZSIsInN1YkNsYXNzIiwic3VwZXJDbGFzcyIsInByb3RvdHlwZSIsImNyZWF0ZSIsImNvbnN0cnVjdG9yIiwiX3NldFByb3RvdHlwZU9mIiwibyIsInAiLCJzZXRQcm90b3R5cGVPZiIsIl9fcHJvdG9fXyIsIkFuaW1hdGVkUHJvcHMiLCJfQW5pbWF0ZWROb2RlIiwicHJvcHMiLCJjYWxsYmFjayIsIl90aGlzIiwiY2FsbCIsInN0eWxlIiwiX3Byb3BzIiwiX2NhbGxiYWNrIiwiX19hdHRhY2giLCJfcHJvdG8iLCJfX2dldFZhbHVlIiwiX19pc05hdGl2ZSIsIkFuaW1hdGVkRXZlbnQiLCJfX2dldEhhbmRsZXIiLCJfX2dldEFuaW1hdGVkVmFsdWUiLCJfX2FkZENoaWxkIiwiX19kZXRhY2giLCJfYW5pbWF0ZWRWaWV3IiwiX19kaXNjb25uZWN0QW5pbWF0ZWRWaWV3IiwiX19yZW1vdmVDaGlsZCIsInVwZGF0ZSIsIl9fbWFrZU5hdGl2ZSIsIl9fY29ubmVjdEFuaW1hdGVkVmlldyIsInNldE5hdGl2ZVZpZXciLCJhbmltYXRlZFZpZXciLCJuYXRpdmVWaWV3VGFnIiwiQVBJIiwiY29ubmVjdEFuaW1hdGVkTm9kZVRvVmlldyIsIl9fZ2V0TmF0aXZlVGFnIiwiZGlzY29ubmVjdEFuaW1hdGVkTm9kZUZyb21WaWV3IiwiX19yZXN0b3JlRGVmYXVsdFZhbHVlcyIsInJlc3RvcmVEZWZhdWx0VmFsdWVzIiwiX19nZXROYXRpdmVDb25maWciLCJwcm9wc0NvbmZpZyIsInByb3BLZXkiLCJ0eXBlIiwiX2RlZmF1bHQiLCJtb2R1bGUiXSwibWFwcGluZ3MiOiJBQVNBOztBQUVBQSxPQUFPLENBQUNDLFVBQVIsR0FBcUIsSUFBckI7QUFDQUQsT0FBTyxDQUFDRSxPQUFSLEdBQWtCLEtBQUssQ0FBdkI7O0FBRUEsSUFBSUMsY0FBYyxHQUFHQyxPQUFPLG9CQUE1Qjs7QUFFQSxJQUFJQyxjQUFjLEdBQUdDLHNCQUFzQixDQUFDRixPQUFPLGtCQUFSLENBQTNDOztBQUVBLElBQUlHLGNBQWMsR0FBR0Qsc0JBQXNCLENBQUNGLE9BQU8sbUJBQVIsQ0FBM0M7O0FBRUEsSUFBSUkscUJBQXFCLEdBQUdGLHNCQUFzQixDQUFDRixPQUFPLDJCQUFSLENBQWxEOztBQUVBLElBQUlLLGVBQWUsR0FBR0gsc0JBQXNCLENBQUNGLE9BQU8sc0NBQVIsQ0FBNUM7O0FBRUEsSUFBSU0sVUFBVSxHQUFHSixzQkFBc0IsQ0FBQ0YsT0FBTyxDQUFDLG9CQUFELENBQVIsQ0FBdkM7O0FBRUEsU0FBU0Usc0JBQVQsQ0FBZ0NLLEdBQWhDLEVBQXFDO0FBQUUsU0FBT0EsR0FBRyxJQUFJQSxHQUFHLENBQUNWLFVBQVgsR0FBd0JVLEdBQXhCLEdBQThCO0FBQUVULElBQUFBLE9BQU8s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RUQsV0FBTztBQUNMTyxNQUFBQSxJQUFJLEVBQUUsT0FERDtBQUVMbEMsTUFBQUEsS0FBSyxFQUFFZ0M7QUFGRixLQUFQO0FBSUQsR0FqQkQ7O0FBbUJBLFNBQU9sQyxhQUFQO0FBQ0QsQ0F0S2dDLENBc0svQjlDLGNBQWMsQ0FBQ0gsT0F0S2dCLENBQWpDOztBQXdLQSxJQUFJc0YsUUFBUSxHQUFHckMsYUFBZjtBQUNBbkQsT0FBTyxDQUFDRSxPQUFSLEdBQWtCc0YsUUFBbEI7QUFDQUMsTUFBTSxDQUFDekYsT0FBUCxHQUFpQkEsT0FBTyxDQUFDRSxPQUF6QiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogXG4gKiBAZm9ybWF0XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDtcblxudmFyIF9BbmltYXRlZEV2ZW50ID0gcmVxdWlyZShcIi4uL0FuaW1hdGVkRXZlbnRcIik7XG5cbnZhciBfQW5pbWF0ZWROb2RlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vQW5pbWF0ZWROb2RlXCIpKTtcblxudmFyIF9BbmltYXRlZFN0eWxlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9BbmltYXRlZFN0eWxlXCIpKTtcblxudmFyIF9OYXRpdmVBbmltYXRlZEhlbHBlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4uL05hdGl2ZUFuaW1hdGVkSGVscGVyXCIpKTtcblxudmFyIF9maW5kTm9kZUhhbmRsZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4uLy4uLy4uLy4uL2V4cG9ydHMvZmluZE5vZGVIYW5kbGVcIikpO1xuXG52YXIgX2ludmFyaWFudCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcImZianMvbGliL2ludmFyaWFudFwiKSk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9XG5cbmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfVxuXG5mdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHNMb29zZShzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MucHJvdG90eXBlKTsgc3ViQ2xhc3MucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gc3ViQ2xhc3M7IF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH1cblxuZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH1cblxudmFyIEFuaW1hdGVkUHJvcHMgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9BbmltYXRlZE5vZGUpIHtcbiAgX2luaGVyaXRzTG9vc2UoQW5pbWF0ZWRQcm9wcywgX0FuaW1hdGVkTm9kZSk7XG5cbiAgZnVuY3Rpb24gQW5pbWF0ZWRQcm9wcyhwcm9wcywgY2FsbGJhY2spIHtcbiAgICB2YXIgX3RoaXM7XG5cbiAgICBfdGhpcyA9IF9BbmltYXRlZE5vZGUuY2FsbCh0aGlzKSB8fCB0aGlzO1xuXG4gICAgaWYgKHByb3BzLnN0eWxlKSB7XG4gICAgICBwcm9wcyA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgcHJvcHMpLCB7fSwge1xuICAgICAgICBzdHlsZTogbmV3IF9BbmltYXRlZFN0eWxlLmRlZmF1bHQocHJvcHMuc3R5bGUpXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBfdGhpcy5fcHJvcHMgPSBwcm9wcztcbiAgICBfdGhpcy5fY2FsbGJhY2sgPSBjYWxsYmFjaztcblxuICAgIF90aGlzLl9fYXR0YWNoKCk7XG5cbiAgICByZXR1cm4gX3RoaXM7XG4gIH1cblxuICB2YXIgX3Byb3RvID0gQW5pbWF0ZWRQcm9wcy5wcm90b3R5cGU7XG5cbiAgX3Byb3RvLl9fZ2V0VmFsdWUgPSBmdW5jdGlvbiBfX2dldFZhbHVlKCkge1xuICAgIHZhciBwcm9wcyA9IHt9O1xuXG4gICAgZm9yICh2YXIga2V5IGluIHRoaXMuX3Byb3BzKSB7XG4gICAgICB2YXIgdmFsdWUgPSB0aGlzLl9wcm9wc1trZXldO1xuXG4gICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBfQW5pbWF0ZWROb2RlMi5kZWZhdWx0KSB7XG4gICAgICAgIGlmICghdmFsdWUuX19pc05hdGl2ZSB8fCB2YWx1ZSBpbnN0YW5jZW9mIF9BbmltYXRlZFN0eWxlLmRlZmF1bHQpIHtcbiAgICAgICAgICAvLyBXZSBjYW5ub3QgdXNlIHZhbHVlIG9mIG5hdGl2ZWx5IGRyaXZlbiBub2RlcyB0aGlzIHdheSBhcyB0aGUgdmFsdWUgd2UgaGF2ZSBhY2Nlc3MgZnJvbVxuICAgICAgICAgIC8vIEpTIG1heSBub3QgYmUgdXAgdG8gZGF0ZS5cbiAgICAgICAgICBwcm9wc1trZXldID0gdmFsdWUuX19nZXRWYWx1ZSgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgX0FuaW1hdGVkRXZlbnQuQW5pbWF0ZWRFdmVudCkge1xuICAgICAgICBwcm9wc1trZXldID0gdmFsdWUuX19nZXRIYW5kbGVyKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwcm9wc1trZXldID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHByb3BzO1xuICB9O1xuXG4gIF9wcm90by5fX2dldEFuaW1hdGVkVmFsdWUgPSBmdW5jdGlvbiBfX2dldEFuaW1hdGVkVmFsdWUoKSB7XG4gICAgdmFyIHByb3BzID0ge307XG5cbiAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5fcHJvcHMpIHtcbiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuX3Byb3BzW2tleV07XG5cbiAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIF9BbmltYXRlZE5vZGUyLmRlZmF1bHQpIHtcbiAgICAgICAgcHJvcHNba2V5XSA9IHZhbHVlLl9fZ2V0QW5pbWF0ZWRWYWx1ZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBwcm9wcztcbiAgfTtcblxuICBfcHJvdG8uX19hdHRhY2ggPSBmdW5jdGlvbiBfX2F0dGFjaCgpIHtcbiAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5fcHJvcHMpIHtcbiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuX3Byb3BzW2tleV07XG5cbiAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIF9BbmltYXRlZE5vZGUyLmRlZmF1bHQpIHtcbiAgICAgICAgdmFsdWUuX19hZGRDaGlsZCh0aGlzKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgX3Byb3RvLl9fZGV0YWNoID0gZnVuY3Rpb24gX19kZXRhY2goKSB7XG4gICAgaWYgKHRoaXMuX19pc05hdGl2ZSAmJiB0aGlzLl9hbmltYXRlZFZpZXcpIHtcbiAgICAgIHRoaXMuX19kaXNjb25uZWN0QW5pbWF0ZWRWaWV3KCk7XG4gICAgfVxuXG4gICAgZm9yICh2YXIga2V5IGluIHRoaXMuX3Byb3BzKSB7XG4gICAgICB2YXIgdmFsdWUgPSB0aGlzLl9wcm9wc1trZXldO1xuXG4gICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBfQW5pbWF0ZWROb2RlMi5kZWZhdWx0KSB7XG4gICAgICAgIHZhbHVlLl9fcmVtb3ZlQ2hpbGQodGhpcyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgX0FuaW1hdGVkTm9kZS5wcm90b3R5cGUuX19kZXRhY2guY2FsbCh0aGlzKTtcbiAgfTtcblxuICBfcHJvdG8udXBkYXRlID0gZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIHRoaXMuX2NhbGxiYWNrKCk7XG4gIH07XG5cbiAgX3Byb3RvLl9fbWFrZU5hdGl2ZSA9IGZ1bmN0aW9uIF9fbWFrZU5hdGl2ZSgpIHtcbiAgICBpZiAoIXRoaXMuX19pc05hdGl2ZSkge1xuICAgICAgdGhpcy5fX2lzTmF0aXZlID0gdHJ1ZTtcblxuICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMuX3Byb3BzKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuX3Byb3BzW2tleV07XG5cbiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgX0FuaW1hdGVkTm9kZTIuZGVmYXVsdCkge1xuICAgICAgICAgIHZhbHVlLl9fbWFrZU5hdGl2ZSgpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLl9hbmltYXRlZFZpZXcpIHtcbiAgICAgICAgdGhpcy5fX2Nvbm5lY3RBbmltYXRlZFZpZXcoKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgX3Byb3RvLnNldE5hdGl2ZVZpZXcgPSBmdW5jdGlvbiBzZXROYXRpdmVWaWV3KGFuaW1hdGVkVmlldykge1xuICAgIGlmICh0aGlzLl9hbmltYXRlZFZpZXcgPT09IGFuaW1hdGVkVmlldykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX2FuaW1hdGVkVmlldyA9IGFuaW1hdGVkVmlldztcblxuICAgIGlmICh0aGlzLl9faXNOYXRpdmUpIHtcbiAgICAgIHRoaXMuX19jb25uZWN0QW5pbWF0ZWRWaWV3KCk7XG4gICAgfVxuICB9O1xuXG4gIF9wcm90by5fX2Nvbm5lY3RBbmltYXRlZFZpZXcgPSBmdW5jdGlvbiBfX2Nvbm5lY3RBbmltYXRlZFZpZXcoKSB7XG4gICAgKDAsIF9pbnZhcmlhbnQuZGVmYXVsdCkodGhpcy5fX2lzTmF0aXZlLCAnRXhwZWN0ZWQgbm9kZSB0byBiZSBtYXJrZWQgYXMgXCJuYXRpdmVcIicpO1xuICAgIHZhciBuYXRpdmVWaWV3VGFnID0gKDAsIF9maW5kTm9kZUhhbmRsZS5kZWZhdWx0KSh0aGlzLl9hbmltYXRlZFZpZXcpO1xuICAgICgwLCBfaW52YXJpYW50LmRlZmF1bHQpKG5hdGl2ZVZpZXdUYWcgIT0gbnVsbCwgJ1VuYWJsZSB0byBsb2NhdGUgYXR0YWNoZWQgdmlldyBpbiB0aGUgbmF0aXZlIHRyZWUnKTtcblxuICAgIF9OYXRpdmVBbmltYXRlZEhlbHBlci5kZWZhdWx0LkFQSS5jb25uZWN0QW5pbWF0ZWROb2RlVG9WaWV3KHRoaXMuX19nZXROYXRpdmVUYWcoKSwgbmF0aXZlVmlld1RhZyk7XG4gIH07XG5cbiAgX3Byb3RvLl9fZGlzY29ubmVjdEFuaW1hdGVkVmlldyA9IGZ1bmN0aW9uIF9fZGlzY29ubmVjdEFuaW1hdGVkVmlldygpIHtcbiAgICAoMCwgX2ludmFyaWFudC5kZWZhdWx0KSh0aGlzLl9faXNOYXRpdmUsICdFeHBlY3RlZCBub2RlIHRvIGJlIG1hcmtlZCBhcyBcIm5hdGl2ZVwiJyk7XG4gICAgdmFyIG5hdGl2ZVZpZXdUYWcgPSAoMCwgX2ZpbmROb2RlSGFuZGxlLmRlZmF1bHQpKHRoaXMuX2FuaW1hdGVkVmlldyk7XG4gICAgKDAsIF9pbnZhcmlhbnQuZGVmYXVsdCkobmF0aXZlVmlld1RhZyAhPSBudWxsLCAnVW5hYmxlIHRvIGxvY2F0ZSBhdHRhY2hlZCB2aWV3IGluIHRoZSBuYXRpdmUgdHJlZScpO1xuXG4gICAgX05hdGl2ZUFuaW1hdGVkSGVscGVyLmRlZmF1bHQuQVBJLmRpc2Nvbm5lY3RBbmltYXRlZE5vZGVGcm9tVmlldyh0aGlzLl9fZ2V0TmF0aXZlVGFnKCksIG5hdGl2ZVZpZXdUYWcpO1xuICB9O1xuXG4gIF9wcm90by5fX3Jlc3RvcmVEZWZhdWx0VmFsdWVzID0gZnVuY3Rpb24gX19yZXN0b3JlRGVmYXVsdFZhbHVlcygpIHtcbiAgICAvLyBXaGVuIHVzaW5nIHRoZSBuYXRpdmUgZHJpdmVyLCB2aWV3IHByb3BlcnRpZXMgbmVlZCB0byBiZSByZXN0b3JlZCB0b1xuICAgIC8vIHRoZWlyIGRlZmF1bHQgdmFsdWVzIG1hbnVhbGx5IHNpbmNlIHJlYWN0IG5vIGxvbmdlciB0cmFja3MgdGhlbS4gVGhpc1xuICAgIC8vIGlzIG5lZWRlZCB0byBoYW5kbGUgY2FzZXMgd2hlcmUgYSBwcm9wIGRyaXZlbiBieSBuYXRpdmUgYW5pbWF0ZWQgaXMgcmVtb3ZlZFxuICAgIC8vIGFmdGVyIGhhdmluZyBiZWVuIGNoYW5nZWQgbmF0aXZlbHkgYnkgYW4gYW5pbWF0aW9uLlxuICAgIGlmICh0aGlzLl9faXNOYXRpdmUpIHtcbiAgICAgIF9OYXRpdmVBbmltYXRlZEhlbHBlci5kZWZhdWx0LkFQSS5yZXN0b3JlRGVmYXVsdFZhbHVlcyh0aGlzLl9fZ2V0TmF0aXZlVGFnKCkpO1xuICAgIH1cbiAgfTtcblxuICBfcHJvdG8uX19nZXROYXRpdmVDb25maWcgPSBmdW5jdGlvbiBfX2dldE5hdGl2ZUNvbmZpZygpIHtcbiAgICB2YXIgcHJvcHNDb25maWcgPSB7fTtcblxuICAgIGZvciAodmFyIHByb3BLZXkgaW4gdGhpcy5fcHJvcHMpIHtcbiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuX3Byb3BzW3Byb3BLZXldO1xuXG4gICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBfQW5pbWF0ZWROb2RlMi5kZWZhdWx0KSB7XG4gICAgICAgIHZhbHVlLl9fbWFrZU5hdGl2ZSgpO1xuXG4gICAgICAgIHByb3BzQ29uZmlnW3Byb3BLZXldID0gdmFsdWUuX19nZXROYXRpdmVUYWcoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ3Byb3BzJyxcbiAgICAgIHByb3BzOiBwcm9wc0NvbmZpZ1xuICAgIH07XG4gIH07XG5cbiAgcmV0dXJuIEFuaW1hdGVkUHJvcHM7XG59KF9BbmltYXRlZE5vZGUyLmRlZmF1bHQpO1xuXG52YXIgX2RlZmF1bHQgPSBBbmltYXRlZFByb3BzO1xuZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHMuZGVmYXVsdDsiXX0=