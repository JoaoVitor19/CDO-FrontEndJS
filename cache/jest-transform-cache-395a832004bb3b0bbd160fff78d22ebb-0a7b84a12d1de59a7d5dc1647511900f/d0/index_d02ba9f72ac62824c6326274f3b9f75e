0765c9e0331f12efb9e565618ad457d2
'use strict';

exports.__esModule = true;
exports.default = void 0;

var React = _interopRequireWildcard(require("react"));

var _useMergeRefs = _interopRequireDefault(require("../../modules/useMergeRefs"));

var _useHover = _interopRequireDefault(require("../../modules/useHover"));

var _usePressEvents = _interopRequireDefault(require("../../modules/usePressEvents"));

var _StyleSheet = _interopRequireDefault(require("../StyleSheet"));

var _View = _interopRequireDefault(require("../View"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _getRequireWildcardCache() {
  if (typeof WeakMap !== "function") return null;
  var cache = new WeakMap();

  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };

  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache();

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _extends() {
  _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  return _extends.apply(this, arguments);
}

function _objectWithoutPropertiesLoose(source, excluded) {
  if (source == null) return {};
  var target = {};
  var sourceKeys = Object.keys(source);
  var key, i;

  for (i = 0; i < sourceKeys.length; i++) {
    key = sourceKeys[i];
    if (excluded.indexOf(key) >= 0) continue;
    target[key] = source[key];
  }

  return target;
}

function Pressable(props, forwardedRef) {
  var children = props.children,
      delayLongPress = props.delayLongPress,
      delayPressIn = props.delayPressIn,
      delayPressOut = props.delayPressOut,
      disabled = props.disabled,
      focusable = props.focusable,
      onBlur = props.onBlur,
      onContextMenu = props.onContextMenu,
      onFocus = props.onFocus,
      onHoverIn = props.onHoverIn,
      onHoverOut = props.onHoverOut,
      onKeyDown = props.onKeyDown,
      onLongPress = props.onLongPress,
      onPress = props.onPress,
      onPressMove = props.onPressMove,
      onPressIn = props.onPressIn,
      onPressOut = props.onPressOut,
      style = props.style,
      testOnly_hovered = props.testOnly_hovered,
      testOnly_pressed = props.testOnly_pressed,
      rest = _objectWithoutPropertiesLoose(props, ["children", "delayLongPress", "delayPressIn", "delayPressOut", "disabled", "focusable", "onBlur", "onContextMenu", "onFocus", "onHoverIn", "onHoverOut", "onKeyDown", "onLongPress", "onPress", "onPressMove", "onPressIn", "onPressOut", "style", "testOnly_hovered", "testOnly_pressed"]);

  var _useForceableState = useForceableState(testOnly_hovered === true),
      hovered = _useForceableState[0],
      setHovered = _useForceableState[1];

  var _useForceableState2 = useForceableState(false),
      focused = _useForceableState2[0],
      setFocused = _useForceableState2[1];

  var _useForceableState3 = useForceableState(testOnly_pressed === true),
      pressed = _useForceableState3[0],
      setPressed = _useForceableState3[1];

  var hostRef = (0, React.useRef)(null);
  var setRef = (0, _useMergeRefs.default)(forwardedRef, hostRef);
  var pressConfig = (0, React.useMemo)(function () {
    return {
      delayLongPress: delayLongPress,
      delayPressStart: delayPressIn,
      delayPressEnd: delayPressOut,
      disabled: disabled,
      onLongPress: onLongPress,
      onPress: onPress,
      onPressChange: setPressed,
      onPressStart: onPressIn,
      onPressMove: onPressMove,
      onPressEnd: onPressOut
    };
  }, [delayLongPress, delayPressIn, delayPressOut, disabled, onLongPress, onPress, onPressIn, onPressMove, onPressOut, setPressed]);
  var pressEventHandlers = (0, _usePressEvents.default)(hostRef, pressConfig);
  var onContextMenuPress = pressEventHandlers.onContextMenu,
      onKeyDownPress = pressEventHandlers.onKeyDown;
  (0, _useHover.default)(hostRef, {
    contain: true,
    disabled: disabled,
    onHoverChange: setHovered,
    onHoverStart: onHoverIn,
    onHoverEnd: onHoverOut
  });
  var interactionState = {
    hovered: hovered,
    focused: focused,
    pressed: pressed
  };
  var blurHandler = React.useCallback(function (e) {
    if (e.nativeEvent.target === hostRef.current) {
      setFocused(false);

      if (onBlur != null) {
        onBlur(e);
      }
    }
  }, [hostRef, setFocused, onBlur]);
  var focusHandler = React.useCallback(function (e) {
    if (e.nativeEvent.target === hostRef.current) {
      setFocused(true);

      if (onFocus != null) {
        onFocus(e);
      }
    }
  }, [hostRef, setFocused, onFocus]);
  var contextMenuHandler = React.useCallback(function (e) {
    if (onContextMenuPress != null) {
      onContextMenuPress(e);
    }

    if (onContextMenu != null) {
      onContextMenu(e);
    }
  }, [onContextMenu, onContextMenuPress]);
  var keyDownHandler = React.useCallback(function (e) {
    if (onKeyDownPress != null) {
      onKeyDownPress(e);
    }

    if (onKeyDown != null) {
      onKeyDown(e);
    }
  }, [onKeyDown, onKeyDownPress]);
  return React.createElement(_View.default, _extends({}, rest, pressEventHandlers, {
    accessibilityDisabled: disabled,
    focusable: !disabled && focusable !== false,
    onBlur: blurHandler,
    onContextMenu: contextMenuHandler,
    onFocus: focusHandler,
    onKeyDown: keyDownHandler,
    ref: setRef,
    style: [!disabled && styles.root, typeof style === 'function' ? style(interactionState) : style]
  }), typeof children === 'function' ? children(interactionState) : children);
}

function useForceableState(forced) {
  var _useState = (0, React.useState)(false),
      bool = _useState[0],
      setBool = _useState[1];

  return [bool || forced, setBool];
}

var styles = _StyleSheet.default.create({
  root: {
    cursor: 'pointer',
    touchAction: 'manipulation'
  }
});

var MemoedPressable = (0, React.memo)((0, React.forwardRef)(Pressable));
MemoedPressable.displayName = 'Pressable';
var _default = MemoedPressable;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIlJlYWN0IiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJyZXF1aXJlIiwiX3VzZU1lcmdlUmVmcyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfdXNlSG92ZXIiLCJfdXNlUHJlc3NFdmVudHMiLCJfU3R5bGVTaGVldCIsIl9WaWV3Iiwib2JqIiwiX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlIiwiV2Vha01hcCIsImNhY2hlIiwiaGFzIiwiZ2V0IiwibmV3T2JqIiwiaGFzUHJvcGVydHlEZXNjcmlwdG9yIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJrZXkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJkZXNjIiwic2V0IiwiX2V4dGVuZHMiLCJhc3NpZ24iLCJ0YXJnZXQiLCJpIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwic291cmNlIiwiYXBwbHkiLCJfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZSIsImV4Y2x1ZGVkIiwic291cmNlS2V5cyIsImtleXMiLCJpbmRleE9mIiwiUHJlc3NhYmxlIiwicHJvcHMiLCJmb3J3YXJkZWRSZWYiLCJjaGlsZHJlbiIsImRlbGF5TG9uZ1ByZXNzIiwiZGVsYXlQcmVzc0luIiwiZGVsYXlQcmVzc091dCIsImRpc2FibGVkIiwiZm9jdXNhYmxlIiwib25CbHVyIiwib25Db250ZXh0TWVudSIsIm9uRm9jdXMiLCJvbkhvdmVySW4iLCJvbkhvdmVyT3V0Iiwib25LZXlEb3duIiwib25Mb25nUHJlc3MiLCJvblByZXNzIiwib25QcmVzc01vdmUiLCJvblByZXNzSW4iLCJvblByZXNzT3V0Iiwic3R5bGUiLCJ0ZXN0T25seV9ob3ZlcmVkIiwidGVzdE9ubHlfcHJlc3NlZCIsInJlc3QiLCJfdXNlRm9yY2VhYmxlU3RhdGUiLCJ1c2VGb3JjZWFibGVTdGF0ZSIsImhvdmVyZWQiLCJzZXRIb3ZlcmVkIiwiX3VzZUZvcmNlYWJsZVN0YXRlMiIsImZvY3VzZWQiLCJzZXRGb2N1c2VkIiwiX3VzZUZvcmNlYWJsZVN0YXRlMyIsInByZXNzZWQiLCJzZXRQcmVzc2VkIiwiaG9zdFJlZiIsInVzZVJlZiIsInNldFJlZiIsInByZXNzQ29uZmlnIiwidXNlTWVtbyIsImRlbGF5UHJlc3NTdGFydCIsImRlbGF5UHJlc3NFbmQiLCJvblByZXNzQ2hhbmdlIiwib25QcmVzc1N0YXJ0Iiwib25QcmVzc0VuZCIsInByZXNzRXZlbnRIYW5kbGVycyIsIm9uQ29udGV4dE1lbnVQcmVzcyIsIm9uS2V5RG93blByZXNzIiwiY29udGFpbiIsIm9uSG92ZXJDaGFuZ2UiLCJvbkhvdmVyU3RhcnQiLCJvbkhvdmVyRW5kIiwiaW50ZXJhY3Rpb25TdGF0ZSIsImJsdXJIYW5kbGVyIiwidXNlQ2FsbGJhY2siLCJlIiwibmF0aXZlRXZlbnQiLCJjdXJyZW50IiwiZm9jdXNIYW5kbGVyIiwiY29udGV4dE1lbnVIYW5kbGVyIiwia2V5RG93bkhhbmRsZXIiLCJjcmVhdGVFbGVtZW50IiwiYWNjZXNzaWJpbGl0eURpc2FibGVkIiwicmVmIiwic3R5bGVzIiwicm9vdCIsImZvcmNlZCIsIl91c2VTdGF0ZSIsInVzZVN0YXRlIiwiYm9vbCIsInNldEJvb2wiLCJjcmVhdGUiLCJjdXJzb3IiLCJ0b3VjaEFjdGlvbiIsIk1lbW9lZFByZXNzYWJsZSIsIm1lbW8iLCJmb3J3YXJkUmVmIiwiZGlzcGxheU5hbWUiLCJfZGVmYXVsdCIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6IkFBU0E7O0FBRUFBLE9BQU8sQ0FBQ0MsVUFBUixHQUFxQixJQUFyQjtBQUNBRCxPQUFPLENBQUNFLE9BQVIsR0FBa0IsS0FBSyxDQUF2Qjs7QUFFQSxJQUFJQyxLQUFLLEdBQUdDLHVCQUF1QixDQUFDQyxPQUFPLENBQUMsT0FBRCxDQUFSLENBQW5DOztBQUVBLElBQUlDLGFBQWEsR0FBR0Msc0JBQXNCLENBQUNGLE9B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OztBQUVELFNBQVNzQixpQkFBVCxDQUEyQndDLE1BQTNCLEVBQW1DO0FBQ2pDLE1BQUlDLFNBQVMsR0FBRyxDQUFDLEdBQUd6RyxLQUFLLENBQUMwRyxRQUFWLEVBQW9CLEtBQXBCLENBQWhCO0FBQUEsTUFDSUMsSUFBSSxHQUFHRixTQUFTLENBQUMsQ0FBRCxDQURwQjtBQUFBLE1BRUlHLE9BQU8sR0FBR0gsU0FBUyxDQUFDLENBQUQsQ0FGdkI7O0FBSUEsU0FBTyxDQUFDRSxJQUFJLElBQUlILE1BQVQsRUFBaUJJLE9BQWpCLENBQVA7QUFDRDs7QUFFRCxJQUFJTixNQUFNLEdBQUcvRixXQUFXLENBQUNSLE9BQVosQ0FBb0I4RyxNQUFwQixDQUEyQjtBQUN0Q04sRUFBQUEsSUFBSSxFQUFFO0FBQ0pPLElBQUFBLE1BQU0sRUFBRSxTQURKO0FBRUpDLElBQUFBLFdBQVcsRUFBRTtBQUZUO0FBRGdDLENBQTNCLENBQWI7O0FBT0EsSUFBSUMsZUFBZSxHQUFnQixDQUFDLEdBQUdoSCxLQUFLLENBQUNpSCxJQUFWLEVBQThCLENBQUMsR0FBR2pILEtBQUssQ0FBQ2tILFVBQVYsRUFBc0IzRSxTQUF0QixDQUE5QixDQUFuQztBQUNBeUUsZUFBZSxDQUFDRyxXQUFoQixHQUE4QixXQUE5QjtBQUNBLElBQUlDLFFBQVEsR0FBR0osZUFBZjtBQUNBbkgsT0FBTyxDQUFDRSxPQUFSLEdBQWtCcUgsUUFBbEI7QUFDQUMsTUFBTSxDQUFDeEgsT0FBUCxHQUFpQkEsT0FBTyxDQUFDRSxPQUF6QiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogXG4gKiBAZm9ybWF0XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDtcblxudmFyIFJlYWN0ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZShcInJlYWN0XCIpKTtcblxudmFyIF91c2VNZXJnZVJlZnMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi8uLi9tb2R1bGVzL3VzZU1lcmdlUmVmc1wiKSk7XG5cbnZhciBfdXNlSG92ZXIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi8uLi9tb2R1bGVzL3VzZUhvdmVyXCIpKTtcblxudmFyIF91c2VQcmVzc0V2ZW50cyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4uLy4uL21vZHVsZXMvdXNlUHJlc3NFdmVudHNcIikpO1xuXG52YXIgX1N0eWxlU2hlZXQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi9TdHlsZVNoZWV0XCIpKTtcblxudmFyIF9WaWV3ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vVmlld1wiKSk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSgpIHsgaWYgKHR5cGVvZiBXZWFrTWFwICE9PSBcImZ1bmN0aW9uXCIpIHJldHVybiBudWxsOyB2YXIgY2FjaGUgPSBuZXcgV2Vha01hcCgpOyBfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUgPSBmdW5jdGlvbiBfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUoKSB7IHJldHVybiBjYWNoZTsgfTsgcmV0dXJuIGNhY2hlOyB9XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgeyBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7IHJldHVybiBvYmo7IH0gaWYgKG9iaiA9PT0gbnVsbCB8fCB0eXBlb2Ygb2JqICE9PSBcIm9iamVjdFwiICYmIHR5cGVvZiBvYmogIT09IFwiZnVuY3Rpb25cIikgeyByZXR1cm4geyBkZWZhdWx0OiBvYmogfTsgfSB2YXIgY2FjaGUgPSBfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUoKTsgaWYgKGNhY2hlICYmIGNhY2hlLmhhcyhvYmopKSB7IHJldHVybiBjYWNoZS5nZXQob2JqKTsgfSB2YXIgbmV3T2JqID0ge307IHZhciBoYXNQcm9wZXJ0eURlc2NyaXB0b3IgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsgZm9yICh2YXIga2V5IGluIG9iaikgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgeyB2YXIgZGVzYyA9IGhhc1Byb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDogbnVsbDsgaWYgKGRlc2MgJiYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOyB9IGVsc2UgeyBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgaWYgKGNhY2hlKSB7IGNhY2hlLnNldChvYmosIG5ld09iaik7IH0gcmV0dXJuIG5ld09iajsgfVxuXG5mdW5jdGlvbiBfZXh0ZW5kcygpIHsgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgeyB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOyB9IH0gfSByZXR1cm4gdGFyZ2V0OyB9OyByZXR1cm4gX2V4dGVuZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfVxuXG5mdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKSB7IGlmIChzb3VyY2UgPT0gbnVsbCkgcmV0dXJuIHt9OyB2YXIgdGFyZ2V0ID0ge307IHZhciBzb3VyY2VLZXlzID0gT2JqZWN0LmtleXMoc291cmNlKTsgdmFyIGtleSwgaTsgZm9yIChpID0gMDsgaSA8IHNvdXJjZUtleXMubGVuZ3RoOyBpKyspIHsga2V5ID0gc291cmNlS2V5c1tpXTsgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSByZXR1cm4gdGFyZ2V0OyB9XG5cbi8qKlxuICogQ29tcG9uZW50IHVzZWQgdG8gYnVpbGQgZGlzcGxheSBjb21wb25lbnRzIHRoYXQgc2hvdWxkIHJlc3BvbmQgdG8gd2hldGhlciB0aGVcbiAqIGNvbXBvbmVudCBpcyBjdXJyZW50bHkgcHJlc3NlZCBvciBub3QuXG4gKi9cbmZ1bmN0aW9uIFByZXNzYWJsZShwcm9wcywgZm9yd2FyZGVkUmVmKSB7XG4gIHZhciBjaGlsZHJlbiA9IHByb3BzLmNoaWxkcmVuLFxuICAgICAgZGVsYXlMb25nUHJlc3MgPSBwcm9wcy5kZWxheUxvbmdQcmVzcyxcbiAgICAgIGRlbGF5UHJlc3NJbiA9IHByb3BzLmRlbGF5UHJlc3NJbixcbiAgICAgIGRlbGF5UHJlc3NPdXQgPSBwcm9wcy5kZWxheVByZXNzT3V0LFxuICAgICAgZGlzYWJsZWQgPSBwcm9wcy5kaXNhYmxlZCxcbiAgICAgIGZvY3VzYWJsZSA9IHByb3BzLmZvY3VzYWJsZSxcbiAgICAgIG9uQmx1ciA9IHByb3BzLm9uQmx1cixcbiAgICAgIG9uQ29udGV4dE1lbnUgPSBwcm9wcy5vbkNvbnRleHRNZW51LFxuICAgICAgb25Gb2N1cyA9IHByb3BzLm9uRm9jdXMsXG4gICAgICBvbkhvdmVySW4gPSBwcm9wcy5vbkhvdmVySW4sXG4gICAgICBvbkhvdmVyT3V0ID0gcHJvcHMub25Ib3Zlck91dCxcbiAgICAgIG9uS2V5RG93biA9IHByb3BzLm9uS2V5RG93bixcbiAgICAgIG9uTG9uZ1ByZXNzID0gcHJvcHMub25Mb25nUHJlc3MsXG4gICAgICBvblByZXNzID0gcHJvcHMub25QcmVzcyxcbiAgICAgIG9uUHJlc3NNb3ZlID0gcHJvcHMub25QcmVzc01vdmUsXG4gICAgICBvblByZXNzSW4gPSBwcm9wcy5vblByZXNzSW4sXG4gICAgICBvblByZXNzT3V0ID0gcHJvcHMub25QcmVzc091dCxcbiAgICAgIHN0eWxlID0gcHJvcHMuc3R5bGUsXG4gICAgICB0ZXN0T25seV9ob3ZlcmVkID0gcHJvcHMudGVzdE9ubHlfaG92ZXJlZCxcbiAgICAgIHRlc3RPbmx5X3ByZXNzZWQgPSBwcm9wcy50ZXN0T25seV9wcmVzc2VkLFxuICAgICAgcmVzdCA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHByb3BzLCBbXCJjaGlsZHJlblwiLCBcImRlbGF5TG9uZ1ByZXNzXCIsIFwiZGVsYXlQcmVzc0luXCIsIFwiZGVsYXlQcmVzc091dFwiLCBcImRpc2FibGVkXCIsIFwiZm9jdXNhYmxlXCIsIFwib25CbHVyXCIsIFwib25Db250ZXh0TWVudVwiLCBcIm9uRm9jdXNcIiwgXCJvbkhvdmVySW5cIiwgXCJvbkhvdmVyT3V0XCIsIFwib25LZXlEb3duXCIsIFwib25Mb25nUHJlc3NcIiwgXCJvblByZXNzXCIsIFwib25QcmVzc01vdmVcIiwgXCJvblByZXNzSW5cIiwgXCJvblByZXNzT3V0XCIsIFwic3R5bGVcIiwgXCJ0ZXN0T25seV9ob3ZlcmVkXCIsIFwidGVzdE9ubHlfcHJlc3NlZFwiXSk7XG5cbiAgdmFyIF91c2VGb3JjZWFibGVTdGF0ZSA9IHVzZUZvcmNlYWJsZVN0YXRlKHRlc3RPbmx5X2hvdmVyZWQgPT09IHRydWUpLFxuICAgICAgaG92ZXJlZCA9IF91c2VGb3JjZWFibGVTdGF0ZVswXSxcbiAgICAgIHNldEhvdmVyZWQgPSBfdXNlRm9yY2VhYmxlU3RhdGVbMV07XG5cbiAgdmFyIF91c2VGb3JjZWFibGVTdGF0ZTIgPSB1c2VGb3JjZWFibGVTdGF0ZShmYWxzZSksXG4gICAgICBmb2N1c2VkID0gX3VzZUZvcmNlYWJsZVN0YXRlMlswXSxcbiAgICAgIHNldEZvY3VzZWQgPSBfdXNlRm9yY2VhYmxlU3RhdGUyWzFdO1xuXG4gIHZhciBfdXNlRm9yY2VhYmxlU3RhdGUzID0gdXNlRm9yY2VhYmxlU3RhdGUodGVzdE9ubHlfcHJlc3NlZCA9PT0gdHJ1ZSksXG4gICAgICBwcmVzc2VkID0gX3VzZUZvcmNlYWJsZVN0YXRlM1swXSxcbiAgICAgIHNldFByZXNzZWQgPSBfdXNlRm9yY2VhYmxlU3RhdGUzWzFdO1xuXG4gIHZhciBob3N0UmVmID0gKDAsIFJlYWN0LnVzZVJlZikobnVsbCk7XG4gIHZhciBzZXRSZWYgPSAoMCwgX3VzZU1lcmdlUmVmcy5kZWZhdWx0KShmb3J3YXJkZWRSZWYsIGhvc3RSZWYpO1xuICB2YXIgcHJlc3NDb25maWcgPSAoMCwgUmVhY3QudXNlTWVtbykoZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICBkZWxheUxvbmdQcmVzczogZGVsYXlMb25nUHJlc3MsXG4gICAgICBkZWxheVByZXNzU3RhcnQ6IGRlbGF5UHJlc3NJbixcbiAgICAgIGRlbGF5UHJlc3NFbmQ6IGRlbGF5UHJlc3NPdXQsXG4gICAgICBkaXNhYmxlZDogZGlzYWJsZWQsXG4gICAgICBvbkxvbmdQcmVzczogb25Mb25nUHJlc3MsXG4gICAgICBvblByZXNzOiBvblByZXNzLFxuICAgICAgb25QcmVzc0NoYW5nZTogc2V0UHJlc3NlZCxcbiAgICAgIG9uUHJlc3NTdGFydDogb25QcmVzc0luLFxuICAgICAgb25QcmVzc01vdmU6IG9uUHJlc3NNb3ZlLFxuICAgICAgb25QcmVzc0VuZDogb25QcmVzc091dFxuICAgIH07XG4gIH0sIFtkZWxheUxvbmdQcmVzcywgZGVsYXlQcmVzc0luLCBkZWxheVByZXNzT3V0LCBkaXNhYmxlZCwgb25Mb25nUHJlc3MsIG9uUHJlc3MsIG9uUHJlc3NJbiwgb25QcmVzc01vdmUsIG9uUHJlc3NPdXQsIHNldFByZXNzZWRdKTtcbiAgdmFyIHByZXNzRXZlbnRIYW5kbGVycyA9ICgwLCBfdXNlUHJlc3NFdmVudHMuZGVmYXVsdCkoaG9zdFJlZiwgcHJlc3NDb25maWcpO1xuICB2YXIgb25Db250ZXh0TWVudVByZXNzID0gcHJlc3NFdmVudEhhbmRsZXJzLm9uQ29udGV4dE1lbnUsXG4gICAgICBvbktleURvd25QcmVzcyA9IHByZXNzRXZlbnRIYW5kbGVycy5vbktleURvd247XG4gICgwLCBfdXNlSG92ZXIuZGVmYXVsdCkoaG9zdFJlZiwge1xuICAgIGNvbnRhaW46IHRydWUsXG4gICAgZGlzYWJsZWQ6IGRpc2FibGVkLFxuICAgIG9uSG92ZXJDaGFuZ2U6IHNldEhvdmVyZWQsXG4gICAgb25Ib3ZlclN0YXJ0OiBvbkhvdmVySW4sXG4gICAgb25Ib3ZlckVuZDogb25Ib3Zlck91dFxuICB9KTtcbiAgdmFyIGludGVyYWN0aW9uU3RhdGUgPSB7XG4gICAgaG92ZXJlZDogaG92ZXJlZCxcbiAgICBmb2N1c2VkOiBmb2N1c2VkLFxuICAgIHByZXNzZWQ6IHByZXNzZWRcbiAgfTtcbiAgdmFyIGJsdXJIYW5kbGVyID0gUmVhY3QudXNlQ2FsbGJhY2soZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoZS5uYXRpdmVFdmVudC50YXJnZXQgPT09IGhvc3RSZWYuY3VycmVudCkge1xuICAgICAgc2V0Rm9jdXNlZChmYWxzZSk7XG5cbiAgICAgIGlmIChvbkJsdXIgIT0gbnVsbCkge1xuICAgICAgICBvbkJsdXIoZSk7XG4gICAgICB9XG4gICAgfVxuICB9LCBbaG9zdFJlZiwgc2V0Rm9jdXNlZCwgb25CbHVyXSk7XG4gIHZhciBmb2N1c0hhbmRsZXIgPSBSZWFjdC51c2VDYWxsYmFjayhmdW5jdGlvbiAoZSkge1xuICAgIGlmIChlLm5hdGl2ZUV2ZW50LnRhcmdldCA9PT0gaG9zdFJlZi5jdXJyZW50KSB7XG4gICAgICBzZXRGb2N1c2VkKHRydWUpO1xuXG4gICAgICBpZiAob25Gb2N1cyAhPSBudWxsKSB7XG4gICAgICAgIG9uRm9jdXMoZSk7XG4gICAgICB9XG4gICAgfVxuICB9LCBbaG9zdFJlZiwgc2V0Rm9jdXNlZCwgb25Gb2N1c10pO1xuICB2YXIgY29udGV4dE1lbnVIYW5kbGVyID0gUmVhY3QudXNlQ2FsbGJhY2soZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAob25Db250ZXh0TWVudVByZXNzICE9IG51bGwpIHtcbiAgICAgIG9uQ29udGV4dE1lbnVQcmVzcyhlKTtcbiAgICB9XG5cbiAgICBpZiAob25Db250ZXh0TWVudSAhPSBudWxsKSB7XG4gICAgICBvbkNvbnRleHRNZW51KGUpO1xuICAgIH1cbiAgfSwgW29uQ29udGV4dE1lbnUsIG9uQ29udGV4dE1lbnVQcmVzc10pO1xuICB2YXIga2V5RG93bkhhbmRsZXIgPSBSZWFjdC51c2VDYWxsYmFjayhmdW5jdGlvbiAoZSkge1xuICAgIGlmIChvbktleURvd25QcmVzcyAhPSBudWxsKSB7XG4gICAgICBvbktleURvd25QcmVzcyhlKTtcbiAgICB9XG5cbiAgICBpZiAob25LZXlEb3duICE9IG51bGwpIHtcbiAgICAgIG9uS2V5RG93bihlKTtcbiAgICB9XG4gIH0sIFtvbktleURvd24sIG9uS2V5RG93blByZXNzXSk7XG4gIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChfVmlldy5kZWZhdWx0LCBfZXh0ZW5kcyh7fSwgcmVzdCwgcHJlc3NFdmVudEhhbmRsZXJzLCB7XG4gICAgYWNjZXNzaWJpbGl0eURpc2FibGVkOiBkaXNhYmxlZCxcbiAgICBmb2N1c2FibGU6ICFkaXNhYmxlZCAmJiBmb2N1c2FibGUgIT09IGZhbHNlLFxuICAgIG9uQmx1cjogYmx1ckhhbmRsZXIsXG4gICAgb25Db250ZXh0TWVudTogY29udGV4dE1lbnVIYW5kbGVyLFxuICAgIG9uRm9jdXM6IGZvY3VzSGFuZGxlcixcbiAgICBvbktleURvd246IGtleURvd25IYW5kbGVyLFxuICAgIHJlZjogc2V0UmVmLFxuICAgIHN0eWxlOiBbIWRpc2FibGVkICYmIHN0eWxlcy5yb290LCB0eXBlb2Ygc3R5bGUgPT09ICdmdW5jdGlvbicgPyBzdHlsZShpbnRlcmFjdGlvblN0YXRlKSA6IHN0eWxlXVxuICB9KSwgdHlwZW9mIGNoaWxkcmVuID09PSAnZnVuY3Rpb24nID8gY2hpbGRyZW4oaW50ZXJhY3Rpb25TdGF0ZSkgOiBjaGlsZHJlbik7XG59XG5cbmZ1bmN0aW9uIHVzZUZvcmNlYWJsZVN0YXRlKGZvcmNlZCkge1xuICB2YXIgX3VzZVN0YXRlID0gKDAsIFJlYWN0LnVzZVN0YXRlKShmYWxzZSksXG4gICAgICBib29sID0gX3VzZVN0YXRlWzBdLFxuICAgICAgc2V0Qm9vbCA9IF91c2VTdGF0ZVsxXTtcblxuICByZXR1cm4gW2Jvb2wgfHwgZm9yY2VkLCBzZXRCb29sXTtcbn1cblxudmFyIHN0eWxlcyA9IF9TdHlsZVNoZWV0LmRlZmF1bHQuY3JlYXRlKHtcbiAgcm9vdDoge1xuICAgIGN1cnNvcjogJ3BvaW50ZXInLFxuICAgIHRvdWNoQWN0aW9uOiAnbWFuaXB1bGF0aW9uJ1xuICB9XG59KTtcblxudmFyIE1lbW9lZFByZXNzYWJsZSA9IC8qI19fUFVSRV9fKi8oMCwgUmVhY3QubWVtbykoIC8qI19fUFVSRV9fKi8oMCwgUmVhY3QuZm9yd2FyZFJlZikoUHJlc3NhYmxlKSk7XG5NZW1vZWRQcmVzc2FibGUuZGlzcGxheU5hbWUgPSAnUHJlc3NhYmxlJztcbnZhciBfZGVmYXVsdCA9IE1lbW9lZFByZXNzYWJsZTtcbmV4cG9ydHMuZGVmYXVsdCA9IF9kZWZhdWx0O1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzLmRlZmF1bHQ7Il19