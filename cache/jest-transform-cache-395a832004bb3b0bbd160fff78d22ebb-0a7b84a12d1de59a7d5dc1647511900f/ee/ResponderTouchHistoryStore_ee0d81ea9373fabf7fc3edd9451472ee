c8086cd0043811c7dc0f4701643cb6b4
"use strict";

exports.__esModule = true;
exports.default = void 0;

var _ResponderEventTypes = require("./ResponderEventTypes");

var __DEV__ = process.env.NODE_ENV !== 'production';

var MAX_TOUCH_BANK = 20;
var touchBank = [];
var touchHistory = {
  touchBank: touchBank,
  numberActiveTouches: 0,
  indexOfSingleActiveTouch: -1,
  mostRecentTimeStamp: 0
};

function timestampForTouch(touch) {
  return touch.timeStamp || touch.timestamp;
}

function createTouchRecord(touch) {
  return {
    touchActive: true,
    startPageX: touch.pageX,
    startPageY: touch.pageY,
    startTimeStamp: timestampForTouch(touch),
    currentPageX: touch.pageX,
    currentPageY: touch.pageY,
    currentTimeStamp: timestampForTouch(touch),
    previousPageX: touch.pageX,
    previousPageY: touch.pageY,
    previousTimeStamp: timestampForTouch(touch)
  };
}

function resetTouchRecord(touchRecord, touch) {
  touchRecord.touchActive = true;
  touchRecord.startPageX = touch.pageX;
  touchRecord.startPageY = touch.pageY;
  touchRecord.startTimeStamp = timestampForTouch(touch);
  touchRecord.currentPageX = touch.pageX;
  touchRecord.currentPageY = touch.pageY;
  touchRecord.currentTimeStamp = timestampForTouch(touch);
  touchRecord.previousPageX = touch.pageX;
  touchRecord.previousPageY = touch.pageY;
  touchRecord.previousTimeStamp = timestampForTouch(touch);
}

function getTouchIdentifier(_ref) {
  var identifier = _ref.identifier;

  if (identifier == null) {
    console.error('Touch object is missing identifier.');
  }

  if (__DEV__) {
    if (identifier > MAX_TOUCH_BANK) {
      console.error('Touch identifier %s is greater than maximum supported %s which causes ' + 'performance issues backfilling array locations for all of the indices.', identifier, MAX_TOUCH_BANK);
    }
  }

  return identifier;
}

function recordTouchStart(touch) {
  var identifier = getTouchIdentifier(touch);
  var touchRecord = touchBank[identifier];

  if (touchRecord) {
    resetTouchRecord(touchRecord, touch);
  } else {
    touchBank[identifier] = createTouchRecord(touch);
  }

  touchHistory.mostRecentTimeStamp = timestampForTouch(touch);
}

function recordTouchMove(touch) {
  var touchRecord = touchBank[getTouchIdentifier(touch)];

  if (touchRecord) {
    touchRecord.touchActive = true;
    touchRecord.previousPageX = touchRecord.currentPageX;
    touchRecord.previousPageY = touchRecord.currentPageY;
    touchRecord.previousTimeStamp = touchRecord.currentTimeStamp;
    touchRecord.currentPageX = touch.pageX;
    touchRecord.currentPageY = touch.pageY;
    touchRecord.currentTimeStamp = timestampForTouch(touch);
    touchHistory.mostRecentTimeStamp = timestampForTouch(touch);
  } else {
    console.warn('Cannot record touch move without a touch start.\n', "Touch Move: " + printTouch(touch) + "\n", "Touch Bank: " + printTouchBank());
  }
}

function recordTouchEnd(touch) {
  var touchRecord = touchBank[getTouchIdentifier(touch)];

  if (touchRecord) {
    touchRecord.touchActive = false;
    touchRecord.previousPageX = touchRecord.currentPageX;
    touchRecord.previousPageY = touchRecord.currentPageY;
    touchRecord.previousTimeStamp = touchRecord.currentTimeStamp;
    touchRecord.currentPageX = touch.pageX;
    touchRecord.currentPageY = touch.pageY;
    touchRecord.currentTimeStamp = timestampForTouch(touch);
    touchHistory.mostRecentTimeStamp = timestampForTouch(touch);
  } else {
    console.warn('Cannot record touch end without a touch start.\n', "Touch End: " + printTouch(touch) + "\n", "Touch Bank: " + printTouchBank());
  }
}

function printTouch(touch) {
  return JSON.stringify({
    identifier: touch.identifier,
    pageX: touch.pageX,
    pageY: touch.pageY,
    timestamp: timestampForTouch(touch)
  });
}

function printTouchBank() {
  var printed = JSON.stringify(touchBank.slice(0, MAX_TOUCH_BANK));

  if (touchBank.length > MAX_TOUCH_BANK) {
    printed += ' (original size: ' + touchBank.length + ')';
  }

  return printed;
}

var ResponderTouchHistoryStore = {
  recordTouchTrack: function recordTouchTrack(topLevelType, nativeEvent) {
    if ((0, _ResponderEventTypes.isMoveish)(topLevelType)) {
      nativeEvent.changedTouches.forEach(recordTouchMove);
    } else if ((0, _ResponderEventTypes.isStartish)(topLevelType)) {
      nativeEvent.changedTouches.forEach(recordTouchStart);
      touchHistory.numberActiveTouches = nativeEvent.touches.length;

      if (touchHistory.numberActiveTouches === 1) {
        touchHistory.indexOfSingleActiveTouch = nativeEvent.touches[0].identifier;
      }
    } else if ((0, _ResponderEventTypes.isEndish)(topLevelType)) {
      nativeEvent.changedTouches.forEach(recordTouchEnd);
      touchHistory.numberActiveTouches = nativeEvent.touches.length;

      if (touchHistory.numberActiveTouches === 1) {
        for (var i = 0; i < touchBank.length; i++) {
          var touchTrackToCheck = touchBank[i];

          if (touchTrackToCheck != null && touchTrackToCheck.touchActive) {
            touchHistory.indexOfSingleActiveTouch = i;
            break;
          }
        }

        if (__DEV__) {
          var activeRecord = touchBank[touchHistory.indexOfSingleActiveTouch];

          if (!(activeRecord != null && activeRecord.touchActive)) {
            console.error('Cannot find single active touch.');
          }
        }
      }
    }
  },
  touchHistory: touchHistory
};
var _default = ResponderTouchHistoryStore;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlJlc3BvbmRlclRvdWNoSGlzdG9yeVN0b3JlLmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9SZXNwb25kZXJFdmVudFR5cGVzIiwicmVxdWlyZSIsIl9fREVWX18iLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJNQVhfVE9VQ0hfQkFOSyIsInRvdWNoQmFuayIsInRvdWNoSGlzdG9yeSIsIm51bWJlckFjdGl2ZVRvdWNoZXMiLCJpbmRleE9mU2luZ2xlQWN0aXZlVG91Y2giLCJtb3N0UmVjZW50VGltZVN0YW1wIiwidGltZXN0YW1wRm9yVG91Y2giLCJ0b3VjaCIsInRpbWVTdGFtcCIsInRpbWVzdGFtcCIsImNyZWF0ZVRvdWNoUmVjb3JkIiwidG91Y2hBY3RpdmUiLCJzdGFydFBhZ2VYIiwicGFnZVgiLCJzdGFydFBhZ2VZIiwicGFnZVkiLCJzdGFydFRpbWVTdGFtcCIsImN1cnJlbnRQYWdlWCIsImN1cnJlbnRQYWdlWSIsImN1cnJlbnRUaW1lU3RhbXAiLCJwcmV2aW91c1BhZ2VYIiwicHJldmlvdXNQYWdlWSIsInByZXZpb3VzVGltZVN0YW1wIiwicmVzZXRUb3VjaFJlY29yZCIsInRvdWNoUmVjb3JkIiwiZ2V0VG91Y2hJZGVudGlmaWVyIiwiX3JlZiIsImlkZW50aWZpZXIiLCJjb25zb2xlIiwiZXJyb3IiLCJyZWNvcmRUb3VjaFN0YXJ0IiwicmVjb3JkVG91Y2hNb3ZlIiwid2FybiIsInByaW50VG91Y2giLCJwcmludFRvdWNoQmFuayIsInJlY29yZFRvdWNoRW5kIiwiSlNPTiIsInN0cmluZ2lmeSIsInByaW50ZWQiLCJzbGljZSIsImxlbmd0aCIsIlJlc3BvbmRlclRvdWNoSGlzdG9yeVN0b3JlIiwicmVjb3JkVG91Y2hUcmFjayIsInRvcExldmVsVHlwZSIsIm5hdGl2ZUV2ZW50IiwiaXNNb3ZlaXNoIiwiY2hhbmdlZFRvdWNoZXMiLCJmb3JFYWNoIiwiaXNTdGFydGlzaCIsInRvdWNoZXMiLCJpc0VuZGlzaCIsImkiLCJ0b3VjaFRyYWNrVG9DaGVjayIsImFjdGl2ZVJlY29yZCIsIl9kZWZhdWx0IiwibW9kdWxlIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQUEsT0FBTyxDQUFDQyxVQUFSLEdBQXFCLElBQXJCO0FBQ0FELE9BQU8sQ0FBQ0UsT0FBUixHQUFrQixLQUFLLENBQXZCOztBQUVBLElBQUlDLG9CQUFvQixHQUFHQyxPQUFPLHlCQUFsQzs7QUFnQkEsSUFBSUMsT0FBTyxHQUFHQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsUUFBWixLQUF5QixZQUF2Qzs7QUFFQSxJQUFJQyxjQUFjLEdBQUcsRUFBckI7QUFDQSxJQUFJQyxTQUFTLEdBQUcsRUFBaEI7QUFDQSxJQUFJQyxZQUFZLEdBQUc7QUFDakJELEVBQUFBLFNBQVMsRUFBRUEsU0FETTtBQUVqQkUsRUFBQUEsbUJBQW1CLEVBQUUsQ0FGSjtBQU1qQkMsRUFBQUEsd0JBQXdCLEVBQUUsQ0FBQyxDQU5WO0FBT2pCQyxFQUFBQSxtQkFBbUIsRUFBRTtBQVBKLENBQW5COztBQVVBLFNBQVNDLGlCQUFULENBQTJCQyxLQUEzQixFQUFrQztBQUdoQyxTQUFPQSxLQUFLLENBQUNDLFNBQU4sSUFBbUJELEtBQUssQ0FBQ0UsU0FBaEM7QUFDRDs7QUFPRCxTQUFTQyxpQkFBVCxDQUEyQkgsS0FBM0IsRUFBa0M7QUFDaEMsU0FBTztBQUNMSSxJQUFBQSxXQUFXLEVBQUUsSUFEUjtBQUVMQyxJQUFBQSxVQUFVLEVBQUVMLEtBQUssQ0FBQ00sS0FGYjtBQUdMQyxJQUFBQSxVQUFVLEVBQUVQLEtBQUssQ0FBQ1EsS0FIYjtBQUlMQyxJQUFBQSxjQUFjLEVBQUVWLGlCQUFpQixDQUFDQyxLQUFELENBSjVCO0FBS0xVLElBQUFBLFlBQVksRUFBRVYsS0FBSyxDQUFDTSxLQUxmO0FBTUxLLElBQUFBLFlBQVksRUFBRVgsS0FBSyxDQUFDUSxLQU5mO0FBT0xJLElBQUFBLGdCQUFnQixFQUFFYixpQkFBaUIsQ0FBQ0MsS0FBRCxDQVA5QjtBQVFMYSxJQUFBQSxh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QyxDQUFKLEVBQXlEO0FBQ3ZEaUIsWUFBQUEsT0FBTyxDQUFDQyxLQUFSLENBQWMsa0NBQWQ7QUFDRDtBQUNGO0FBQ0Y7QUFDRjtBQUNGLEdBbEM4QjtBQW1DL0IzQixFQUFBQSxZQUFZLEVBQUVBO0FBbkNpQixDQUFqQztBQXFDQSxJQUFJb0QsUUFBUSxHQUFHYiwwQkFBZjtBQUNBbEQsT0FBTyxDQUFDRSxPQUFSLEdBQWtCNkQsUUFBbEI7QUFDQUMsTUFBTSxDQUFDaEUsT0FBUCxHQUFpQkEsT0FBTyxDQUFDRSxPQUF6QiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwO1xuXG52YXIgX1Jlc3BvbmRlckV2ZW50VHlwZXMgPSByZXF1aXJlKFwiLi9SZXNwb25kZXJFdmVudFR5cGVzXCIpO1xuXG4vKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIFxuICovXG5cbi8qKlxuICogVHJhY2tzIHRoZSBwb3NpdGlvbiBhbmQgdGltZSBvZiBlYWNoIGFjdGl2ZSB0b3VjaCBieSBgdG91Y2guaWRlbnRpZmllcmAuIFdlXG4gKiBzaG91bGQgdHlwaWNhbGx5IG9ubHkgc2VlIElEcyBpbiB0aGUgcmFuZ2Ugb2YgMS0yMCBiZWNhdXNlIElEcyBnZXQgcmVjeWNsZWRcbiAqIHdoZW4gdG91Y2hlcyBlbmQgYW5kIHN0YXJ0IGFnYWluLlxuICovXG52YXIgX19ERVZfXyA9IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbic7XG5cbnZhciBNQVhfVE9VQ0hfQkFOSyA9IDIwO1xudmFyIHRvdWNoQmFuayA9IFtdO1xudmFyIHRvdWNoSGlzdG9yeSA9IHtcbiAgdG91Y2hCYW5rOiB0b3VjaEJhbmssXG4gIG51bWJlckFjdGl2ZVRvdWNoZXM6IDAsXG4gIC8vIElmIHRoZXJlIGlzIG9ubHkgb25lIGFjdGl2ZSB0b3VjaCwgd2UgcmVtZW1iZXIgaXRzIGxvY2F0aW9uLiBUaGlzIHByZXZlbnRzXG4gIC8vIHVzIGhhdmluZyB0byBsb29wIHRocm91Z2ggYWxsIG9mIHRoZSB0b3VjaGVzIGFsbCB0aGUgdGltZSBpbiB0aGUgbW9zdFxuICAvLyBjb21tb24gY2FzZS5cbiAgaW5kZXhPZlNpbmdsZUFjdGl2ZVRvdWNoOiAtMSxcbiAgbW9zdFJlY2VudFRpbWVTdGFtcDogMFxufTtcblxuZnVuY3Rpb24gdGltZXN0YW1wRm9yVG91Y2godG91Y2gpIHtcbiAgLy8gVGhlIGxlZ2FjeSBpbnRlcm5hbCBpbXBsZW1lbnRhdGlvbiBwcm92aWRlcyBcInRpbWVTdGFtcFwiLCB3aGljaCBoYXMgYmVlblxuICAvLyByZW5hbWVkIHRvIFwidGltZXN0YW1wXCIuXG4gIHJldHVybiB0b3VjaC50aW1lU3RhbXAgfHwgdG91Y2gudGltZXN0YW1wO1xufVxuLyoqXG4gKiBUT0RPOiBJbnN0ZWFkIG9mIG1ha2luZyBnZXN0dXJlcyByZWNvbXB1dGUgZmlsdGVyZWQgdmVsb2NpdHksIHdlIGNvdWxkXG4gKiBpbmNsdWRlIGEgYnVpbHQgaW4gdmVsb2NpdHkgY29tcHV0YXRpb24gdGhhdCBjYW4gYmUgcmV1c2VkIGdsb2JhbGx5LlxuICovXG5cblxuZnVuY3Rpb24gY3JlYXRlVG91Y2hSZWNvcmQodG91Y2gpIHtcbiAgcmV0dXJuIHtcbiAgICB0b3VjaEFjdGl2ZTogdHJ1ZSxcbiAgICBzdGFydFBhZ2VYOiB0b3VjaC5wYWdlWCxcbiAgICBzdGFydFBhZ2VZOiB0b3VjaC5wYWdlWSxcbiAgICBzdGFydFRpbWVTdGFtcDogdGltZXN0YW1wRm9yVG91Y2godG91Y2gpLFxuICAgIGN1cnJlbnRQYWdlWDogdG91Y2gucGFnZVgsXG4gICAgY3VycmVudFBhZ2VZOiB0b3VjaC5wYWdlWSxcbiAgICBjdXJyZW50VGltZVN0YW1wOiB0aW1lc3RhbXBGb3JUb3VjaCh0b3VjaCksXG4gICAgcHJldmlvdXNQYWdlWDogdG91Y2gucGFnZVgsXG4gICAgcHJldmlvdXNQYWdlWTogdG91Y2gucGFnZVksXG4gICAgcHJldmlvdXNUaW1lU3RhbXA6IHRpbWVzdGFtcEZvclRvdWNoKHRvdWNoKVxuICB9O1xufVxuXG5mdW5jdGlvbiByZXNldFRvdWNoUmVjb3JkKHRvdWNoUmVjb3JkLCB0b3VjaCkge1xuICB0b3VjaFJlY29yZC50b3VjaEFjdGl2ZSA9IHRydWU7XG4gIHRvdWNoUmVjb3JkLnN0YXJ0UGFnZVggPSB0b3VjaC5wYWdlWDtcbiAgdG91Y2hSZWNvcmQuc3RhcnRQYWdlWSA9IHRvdWNoLnBhZ2VZO1xuICB0b3VjaFJlY29yZC5zdGFydFRpbWVTdGFtcCA9IHRpbWVzdGFtcEZvclRvdWNoKHRvdWNoKTtcbiAgdG91Y2hSZWNvcmQuY3VycmVudFBhZ2VYID0gdG91Y2gucGFnZVg7XG4gIHRvdWNoUmVjb3JkLmN1cnJlbnRQYWdlWSA9IHRvdWNoLnBhZ2VZO1xuICB0b3VjaFJlY29yZC5jdXJyZW50VGltZVN0YW1wID0gdGltZXN0YW1wRm9yVG91Y2godG91Y2gpO1xuICB0b3VjaFJlY29yZC5wcmV2aW91c1BhZ2VYID0gdG91Y2gucGFnZVg7XG4gIHRvdWNoUmVjb3JkLnByZXZpb3VzUGFnZVkgPSB0b3VjaC5wYWdlWTtcbiAgdG91Y2hSZWNvcmQucHJldmlvdXNUaW1lU3RhbXAgPSB0aW1lc3RhbXBGb3JUb3VjaCh0b3VjaCk7XG59XG5cbmZ1bmN0aW9uIGdldFRvdWNoSWRlbnRpZmllcihfcmVmKSB7XG4gIHZhciBpZGVudGlmaWVyID0gX3JlZi5pZGVudGlmaWVyO1xuXG4gIGlmIChpZGVudGlmaWVyID09IG51bGwpIHtcbiAgICBjb25zb2xlLmVycm9yKCdUb3VjaCBvYmplY3QgaXMgbWlzc2luZyBpZGVudGlmaWVyLicpO1xuICB9XG5cbiAgaWYgKF9fREVWX18pIHtcbiAgICBpZiAoaWRlbnRpZmllciA+IE1BWF9UT1VDSF9CQU5LKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdUb3VjaCBpZGVudGlmaWVyICVzIGlzIGdyZWF0ZXIgdGhhbiBtYXhpbXVtIHN1cHBvcnRlZCAlcyB3aGljaCBjYXVzZXMgJyArICdwZXJmb3JtYW5jZSBpc3N1ZXMgYmFja2ZpbGxpbmcgYXJyYXkgbG9jYXRpb25zIGZvciBhbGwgb2YgdGhlIGluZGljZXMuJywgaWRlbnRpZmllciwgTUFYX1RPVUNIX0JBTkspO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBpZGVudGlmaWVyO1xufVxuXG5mdW5jdGlvbiByZWNvcmRUb3VjaFN0YXJ0KHRvdWNoKSB7XG4gIHZhciBpZGVudGlmaWVyID0gZ2V0VG91Y2hJZGVudGlmaWVyKHRvdWNoKTtcbiAgdmFyIHRvdWNoUmVjb3JkID0gdG91Y2hCYW5rW2lkZW50aWZpZXJdO1xuXG4gIGlmICh0b3VjaFJlY29yZCkge1xuICAgIHJlc2V0VG91Y2hSZWNvcmQodG91Y2hSZWNvcmQsIHRvdWNoKTtcbiAgfSBlbHNlIHtcbiAgICB0b3VjaEJhbmtbaWRlbnRpZmllcl0gPSBjcmVhdGVUb3VjaFJlY29yZCh0b3VjaCk7XG4gIH1cblxuICB0b3VjaEhpc3RvcnkubW9zdFJlY2VudFRpbWVTdGFtcCA9IHRpbWVzdGFtcEZvclRvdWNoKHRvdWNoKTtcbn1cblxuZnVuY3Rpb24gcmVjb3JkVG91Y2hNb3ZlKHRvdWNoKSB7XG4gIHZhciB0b3VjaFJlY29yZCA9IHRvdWNoQmFua1tnZXRUb3VjaElkZW50aWZpZXIodG91Y2gpXTtcblxuICBpZiAodG91Y2hSZWNvcmQpIHtcbiAgICB0b3VjaFJlY29yZC50b3VjaEFjdGl2ZSA9IHRydWU7XG4gICAgdG91Y2hSZWNvcmQucHJldmlvdXNQYWdlWCA9IHRvdWNoUmVjb3JkLmN1cnJlbnRQYWdlWDtcbiAgICB0b3VjaFJlY29yZC5wcmV2aW91c1BhZ2VZID0gdG91Y2hSZWNvcmQuY3VycmVudFBhZ2VZO1xuICAgIHRvdWNoUmVjb3JkLnByZXZpb3VzVGltZVN0YW1wID0gdG91Y2hSZWNvcmQuY3VycmVudFRpbWVTdGFtcDtcbiAgICB0b3VjaFJlY29yZC5jdXJyZW50UGFnZVggPSB0b3VjaC5wYWdlWDtcbiAgICB0b3VjaFJlY29yZC5jdXJyZW50UGFnZVkgPSB0b3VjaC5wYWdlWTtcbiAgICB0b3VjaFJlY29yZC5jdXJyZW50VGltZVN0YW1wID0gdGltZXN0YW1wRm9yVG91Y2godG91Y2gpO1xuICAgIHRvdWNoSGlzdG9yeS5tb3N0UmVjZW50VGltZVN0YW1wID0gdGltZXN0YW1wRm9yVG91Y2godG91Y2gpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2FybignQ2Fubm90IHJlY29yZCB0b3VjaCBtb3ZlIHdpdGhvdXQgYSB0b3VjaCBzdGFydC5cXG4nLCBcIlRvdWNoIE1vdmU6IFwiICsgcHJpbnRUb3VjaCh0b3VjaCkgKyBcIlxcblwiLCBcIlRvdWNoIEJhbms6IFwiICsgcHJpbnRUb3VjaEJhbmsoKSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gcmVjb3JkVG91Y2hFbmQodG91Y2gpIHtcbiAgdmFyIHRvdWNoUmVjb3JkID0gdG91Y2hCYW5rW2dldFRvdWNoSWRlbnRpZmllcih0b3VjaCldO1xuXG4gIGlmICh0b3VjaFJlY29yZCkge1xuICAgIHRvdWNoUmVjb3JkLnRvdWNoQWN0aXZlID0gZmFsc2U7XG4gICAgdG91Y2hSZWNvcmQucHJldmlvdXNQYWdlWCA9IHRvdWNoUmVjb3JkLmN1cnJlbnRQYWdlWDtcbiAgICB0b3VjaFJlY29yZC5wcmV2aW91c1BhZ2VZID0gdG91Y2hSZWNvcmQuY3VycmVudFBhZ2VZO1xuICAgIHRvdWNoUmVjb3JkLnByZXZpb3VzVGltZVN0YW1wID0gdG91Y2hSZWNvcmQuY3VycmVudFRpbWVTdGFtcDtcbiAgICB0b3VjaFJlY29yZC5jdXJyZW50UGFnZVggPSB0b3VjaC5wYWdlWDtcbiAgICB0b3VjaFJlY29yZC5jdXJyZW50UGFnZVkgPSB0b3VjaC5wYWdlWTtcbiAgICB0b3VjaFJlY29yZC5jdXJyZW50VGltZVN0YW1wID0gdGltZXN0YW1wRm9yVG91Y2godG91Y2gpO1xuICAgIHRvdWNoSGlzdG9yeS5tb3N0UmVjZW50VGltZVN0YW1wID0gdGltZXN0YW1wRm9yVG91Y2godG91Y2gpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2FybignQ2Fubm90IHJlY29yZCB0b3VjaCBlbmQgd2l0aG91dCBhIHRvdWNoIHN0YXJ0LlxcbicsIFwiVG91Y2ggRW5kOiBcIiArIHByaW50VG91Y2godG91Y2gpICsgXCJcXG5cIiwgXCJUb3VjaCBCYW5rOiBcIiArIHByaW50VG91Y2hCYW5rKCkpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHByaW50VG91Y2godG91Y2gpIHtcbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHtcbiAgICBpZGVudGlmaWVyOiB0b3VjaC5pZGVudGlmaWVyLFxuICAgIHBhZ2VYOiB0b3VjaC5wYWdlWCxcbiAgICBwYWdlWTogdG91Y2gucGFnZVksXG4gICAgdGltZXN0YW1wOiB0aW1lc3RhbXBGb3JUb3VjaCh0b3VjaClcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHByaW50VG91Y2hCYW5rKCkge1xuICB2YXIgcHJpbnRlZCA9IEpTT04uc3RyaW5naWZ5KHRvdWNoQmFuay5zbGljZSgwLCBNQVhfVE9VQ0hfQkFOSykpO1xuXG4gIGlmICh0b3VjaEJhbmsubGVuZ3RoID4gTUFYX1RPVUNIX0JBTkspIHtcbiAgICBwcmludGVkICs9ICcgKG9yaWdpbmFsIHNpemU6ICcgKyB0b3VjaEJhbmsubGVuZ3RoICsgJyknO1xuICB9XG5cbiAgcmV0dXJuIHByaW50ZWQ7XG59XG5cbnZhciBSZXNwb25kZXJUb3VjaEhpc3RvcnlTdG9yZSA9IHtcbiAgcmVjb3JkVG91Y2hUcmFjazogZnVuY3Rpb24gcmVjb3JkVG91Y2hUcmFjayh0b3BMZXZlbFR5cGUsIG5hdGl2ZUV2ZW50KSB7XG4gICAgaWYgKCgwLCBfUmVzcG9uZGVyRXZlbnRUeXBlcy5pc01vdmVpc2gpKHRvcExldmVsVHlwZSkpIHtcbiAgICAgIG5hdGl2ZUV2ZW50LmNoYW5nZWRUb3VjaGVzLmZvckVhY2gocmVjb3JkVG91Y2hNb3ZlKTtcbiAgICB9IGVsc2UgaWYgKCgwLCBfUmVzcG9uZGVyRXZlbnRUeXBlcy5pc1N0YXJ0aXNoKSh0b3BMZXZlbFR5cGUpKSB7XG4gICAgICBuYXRpdmVFdmVudC5jaGFuZ2VkVG91Y2hlcy5mb3JFYWNoKHJlY29yZFRvdWNoU3RhcnQpO1xuICAgICAgdG91Y2hIaXN0b3J5Lm51bWJlckFjdGl2ZVRvdWNoZXMgPSBuYXRpdmVFdmVudC50b3VjaGVzLmxlbmd0aDtcblxuICAgICAgaWYgKHRvdWNoSGlzdG9yeS5udW1iZXJBY3RpdmVUb3VjaGVzID09PSAxKSB7XG4gICAgICAgIHRvdWNoSGlzdG9yeS5pbmRleE9mU2luZ2xlQWN0aXZlVG91Y2ggPSBuYXRpdmVFdmVudC50b3VjaGVzWzBdLmlkZW50aWZpZXI7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICgoMCwgX1Jlc3BvbmRlckV2ZW50VHlwZXMuaXNFbmRpc2gpKHRvcExldmVsVHlwZSkpIHtcbiAgICAgIG5hdGl2ZUV2ZW50LmNoYW5nZWRUb3VjaGVzLmZvckVhY2gocmVjb3JkVG91Y2hFbmQpO1xuICAgICAgdG91Y2hIaXN0b3J5Lm51bWJlckFjdGl2ZVRvdWNoZXMgPSBuYXRpdmVFdmVudC50b3VjaGVzLmxlbmd0aDtcblxuICAgICAgaWYgKHRvdWNoSGlzdG9yeS5udW1iZXJBY3RpdmVUb3VjaGVzID09PSAxKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdG91Y2hCYW5rLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdmFyIHRvdWNoVHJhY2tUb0NoZWNrID0gdG91Y2hCYW5rW2ldO1xuXG4gICAgICAgICAgaWYgKHRvdWNoVHJhY2tUb0NoZWNrICE9IG51bGwgJiYgdG91Y2hUcmFja1RvQ2hlY2sudG91Y2hBY3RpdmUpIHtcbiAgICAgICAgICAgIHRvdWNoSGlzdG9yeS5pbmRleE9mU2luZ2xlQWN0aXZlVG91Y2ggPSBpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF9fREVWX18pIHtcbiAgICAgICAgICB2YXIgYWN0aXZlUmVjb3JkID0gdG91Y2hCYW5rW3RvdWNoSGlzdG9yeS5pbmRleE9mU2luZ2xlQWN0aXZlVG91Y2hdO1xuXG4gICAgICAgICAgaWYgKCEoYWN0aXZlUmVjb3JkICE9IG51bGwgJiYgYWN0aXZlUmVjb3JkLnRvdWNoQWN0aXZlKSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ2Fubm90IGZpbmQgc2luZ2xlIGFjdGl2ZSB0b3VjaC4nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHRvdWNoSGlzdG9yeTogdG91Y2hIaXN0b3J5XG59O1xudmFyIF9kZWZhdWx0ID0gUmVzcG9uZGVyVG91Y2hIaXN0b3J5U3RvcmU7XG5leHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0cy5kZWZhdWx0OyJdfQ==