aac91f9f59535c86679c95af2a353924
'use strict';

exports.__esModule = true;
exports.default = void 0;

var React = _interopRequireWildcard(require("react"));

var _useMergeRefs = _interopRequireDefault(require("../../modules/useMergeRefs"));

var _usePressEvents = _interopRequireDefault(require("../../modules/usePressEvents"));

var _StyleSheet = _interopRequireDefault(require("../StyleSheet"));

var _View = _interopRequireDefault(require("../View"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _getRequireWildcardCache() {
  if (typeof WeakMap !== "function") return null;
  var cache = new WeakMap();

  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };

  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache();

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _extends() {
  _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  return _extends.apply(this, arguments);
}

function _objectWithoutPropertiesLoose(source, excluded) {
  if (source == null) return {};
  var target = {};
  var sourceKeys = Object.keys(source);
  var key, i;

  for (i = 0; i < sourceKeys.length; i++) {
    key = sourceKeys[i];
    if (excluded.indexOf(key) >= 0) continue;
    target[key] = source[key];
  }

  return target;
}

function createExtraStyles(activeOpacity, underlayColor) {
  return {
    child: {
      opacity: activeOpacity !== null && activeOpacity !== void 0 ? activeOpacity : 0.85
    },
    underlay: {
      backgroundColor: underlayColor === undefined ? 'black' : underlayColor
    }
  };
}

function hasPressHandler(props) {
  return props.onPress != null || props.onPressIn != null || props.onPressOut != null || props.onLongPress != null;
}

function TouchableHighlight(props, forwardedRef) {
  var activeOpacity = props.activeOpacity,
      children = props.children,
      delayPressIn = props.delayPressIn,
      delayPressOut = props.delayPressOut,
      delayLongPress = props.delayLongPress,
      disabled = props.disabled,
      focusable = props.focusable,
      onHideUnderlay = props.onHideUnderlay,
      onLongPress = props.onLongPress,
      onPress = props.onPress,
      onPressIn = props.onPressIn,
      onPressOut = props.onPressOut,
      onShowUnderlay = props.onShowUnderlay,
      rejectResponderTermination = props.rejectResponderTermination,
      style = props.style,
      testOnly_pressed = props.testOnly_pressed,
      underlayColor = props.underlayColor,
      rest = _objectWithoutPropertiesLoose(props, ["activeOpacity", "children", "delayPressIn", "delayPressOut", "delayLongPress", "disabled", "focusable", "onHideUnderlay", "onLongPress", "onPress", "onPressIn", "onPressOut", "onShowUnderlay", "rejectResponderTermination", "style", "testOnly_pressed", "underlayColor"]);

  var hostRef = (0, React.useRef)(null);
  var setRef = (0, _useMergeRefs.default)(forwardedRef, hostRef);

  var _useState = (0, React.useState)(testOnly_pressed === true ? createExtraStyles(activeOpacity, underlayColor) : null),
      extraStyles = _useState[0],
      setExtraStyles = _useState[1];

  var showUnderlay = (0, React.useCallback)(function () {
    if (!hasPressHandler(props)) {
      return;
    }

    setExtraStyles(createExtraStyles(activeOpacity, underlayColor));

    if (onShowUnderlay != null) {
      onShowUnderlay();
    }
  }, [activeOpacity, onShowUnderlay, props, underlayColor]);
  var hideUnderlay = (0, React.useCallback)(function () {
    if (testOnly_pressed === true) {
      return;
    }

    if (hasPressHandler(props)) {
      setExtraStyles(null);

      if (onHideUnderlay != null) {
        onHideUnderlay();
      }
    }
  }, [onHideUnderlay, props, testOnly_pressed]);
  var pressConfig = (0, React.useMemo)(function () {
    return {
      cancelable: !rejectResponderTermination,
      disabled: disabled,
      delayLongPress: delayLongPress,
      delayPressStart: delayPressIn,
      delayPressEnd: delayPressOut,
      onLongPress: onLongPress,
      onPress: onPress,
      onPressStart: function onPressStart(event) {
        showUnderlay();

        if (onPressIn != null) {
          onPressIn(event);
        }
      },
      onPressEnd: function onPressEnd(event) {
        hideUnderlay();

        if (onPressOut != null) {
          onPressOut(event);
        }
      }
    };
  }, [delayLongPress, delayPressIn, delayPressOut, disabled, onLongPress, onPress, onPressIn, onPressOut, rejectResponderTermination, showUnderlay, hideUnderlay]);
  var pressEventHandlers = (0, _usePressEvents.default)(hostRef, pressConfig);
  var child = React.Children.only(children);
  return React.createElement(_View.default, _extends({}, rest, pressEventHandlers, {
    accessibilityDisabled: disabled,
    focusable: !disabled && focusable !== false,
    ref: setRef,
    style: [styles.root, style, !disabled && styles.actionable, extraStyles && extraStyles.underlay]
  }), React.cloneElement(child, {
    style: _StyleSheet.default.compose(child.props.style, extraStyles && extraStyles.child)
  }));
}

var styles = _StyleSheet.default.create({
  root: {
    userSelect: 'none'
  },
  actionable: {
    cursor: 'pointer',
    touchAction: 'manipulation'
  }
});

var MemoedTouchableHighlight = React.memo(React.forwardRef(TouchableHighlight));
MemoedTouchableHighlight.displayName = 'TouchableHighlight';
var _default = MemoedTouchableHighlight;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIlJlYWN0IiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJyZXF1aXJlIiwiX3VzZU1lcmdlUmVmcyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfdXNlUHJlc3NFdmVudHMiLCJfU3R5bGVTaGVldCIsIl9WaWV3Iiwib2JqIiwiX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlIiwiV2Vha01hcCIsImNhY2hlIiwiaGFzIiwiZ2V0IiwibmV3T2JqIiwiaGFzUHJvcGVydHlEZXNjcmlwdG9yIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJrZXkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJkZXNjIiwic2V0IiwiX2V4dGVuZHMiLCJhc3NpZ24iLCJ0YXJnZXQiLCJpIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwic291cmNlIiwiYXBwbHkiLCJfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZSIsImV4Y2x1ZGVkIiwic291cmNlS2V5cyIsImtleXMiLCJpbmRleE9mIiwiY3JlYXRlRXh0cmFTdHlsZXMiLCJhY3RpdmVPcGFjaXR5IiwidW5kZXJsYXlDb2xvciIsImNoaWxkIiwib3BhY2l0eSIsInVuZGVybGF5IiwiYmFja2dyb3VuZENvbG9yIiwidW5kZWZpbmVkIiwiaGFzUHJlc3NIYW5kbGVyIiwicHJvcHMiLCJvblByZXNzIiwib25QcmVzc0luIiwib25QcmVzc091dCIsIm9uTG9uZ1ByZXNzIiwiVG91Y2hhYmxlSGlnaGxpZ2h0IiwiZm9yd2FyZGVkUmVmIiwiY2hpbGRyZW4iLCJkZWxheVByZXNzSW4iLCJkZWxheVByZXNzT3V0IiwiZGVsYXlMb25nUHJlc3MiLCJkaXNhYmxlZCIsImZvY3VzYWJsZSIsIm9uSGlkZVVuZGVybGF5Iiwib25TaG93VW5kZXJsYXkiLCJyZWplY3RSZXNwb25kZXJUZXJtaW5hdGlvbiIsInN0eWxlIiwidGVzdE9ubHlfcHJlc3NlZCIsInJlc3QiLCJob3N0UmVmIiwidXNlUmVmIiwic2V0UmVmIiwiX3VzZVN0YXRlIiwidXNlU3RhdGUiLCJleHRyYVN0eWxlcyIsInNldEV4dHJhU3R5bGVzIiwic2hvd1VuZGVybGF5IiwidXNlQ2FsbGJhY2siLCJoaWRlVW5kZXJsYXkiLCJwcmVzc0NvbmZpZyIsInVzZU1lbW8iLCJjYW5jZWxhYmxlIiwiZGVsYXlQcmVzc1N0YXJ0IiwiZGVsYXlQcmVzc0VuZCIsIm9uUHJlc3NTdGFydCIsImV2ZW50Iiwib25QcmVzc0VuZCIsInByZXNzRXZlbnRIYW5kbGVycyIsIkNoaWxkcmVuIiwib25seSIsImNyZWF0ZUVsZW1lbnQiLCJhY2Nlc3NpYmlsaXR5RGlzYWJsZWQiLCJyZWYiLCJzdHlsZXMiLCJyb290IiwiYWN0aW9uYWJsZSIsImNsb25lRWxlbWVudCIsImNvbXBvc2UiLCJjcmVhdGUiLCJ1c2VyU2VsZWN0IiwiY3Vyc29yIiwidG91Y2hBY3Rpb24iLCJNZW1vZWRUb3VjaGFibGVIaWdobGlnaHQiLCJtZW1vIiwiZm9yd2FyZFJlZiIsImRpc3BsYXlOYW1lIiwiX2RlZmF1bHQiLCJtb2R1bGUiXSwibWFwcGluZ3MiOiJBQVNBOztBQUVBQSxPQUFPLENBQUNDLFVBQVIsR0FBcUIsSUFBckI7QUFDQUQsT0FBTyxDQUFDRSxPQUFSLEdBQWtCLEtBQUssQ0FBdkI7O0FBRUEsSUFBSUMsS0FBSyxHQUFHQyx1QkFBdUIsQ0FBQ0MsT0FBTyxDQUFDLE9BQUQsQ0FBUixDQUFuQzs7QUFFQSxJQUFJQyxhQUFhLEdBQUdDLHNCQUFzQixDQUFDRixPQUFPLDhCQUFSLENBQTFDOztBQUVBLElBQUlHLGVBQWUsR0FBR0Qsc0JBQXNCLENBQUNGLE9BQU8sZ0NBQVIsQ0FBNUM7O0FBRUEsSUFBSUksV0FBVyxHQUFHRixzQkFBc0IsQ0FBQ0YsT0FBTyxpQkFBUixDQUF4Qzs7QUFFQSxJQUFJSyxLQUFLLEdBQUdILHNCQUFzQixDQUFDRixPQUFPLFdBQVIsQ0FBbEM7O0FBRUEsU0FBU0Usc0JBQVQsQ0FBZ0NJLEdBQWhDLEVBQXFDO0FBQUUsU0FBT0EsR0FBRyxJQUFJQSxHQUFHLENBQUNWLFVBQVgsR0FBd0JVLEdBQXhCLEdBQThCO0FBQUVULElBQUFBLE9BQU8sRUFBRVM7QUFBWCxHQUFyQztBQUF3RDs7QUFFL0YsU0FBU0Msd0JBQVQsR0FBb0M7QUFBRSxNQUFJLE9BQU9DLE9BQVAsS0FBbUIsVUFBdkIsRUFBbUMsT0FBTyxJQUFQO0FBQWEsTUFBSUMsS0FBSyxHQUFHLElBQUlELE9BQUosRUFBWjs7QUFBMkJELEVBQUFBLHdCQUF3QixHQUFHLFNBQVNBLHdCQUFULEdBQW9DO0FBQUUsV0FBT0UsS0FBUDtBQUFlLEdBQWhGOztBQUFrRixTQUFPQSxLQUFQO0FBQWU7O0FBRWxOLFNBQVNWLHVCQUFULENBQWlDTyxHQUFqQyxFQUFzQztBQUFFLE1BQUlBLEdBQUcsSUFBSUEsR0FBRyxDQUFDVixVQUFmLEVBQTJCO0FBQUUsV0FBT1UsR0FBUDtBQUFhOztBQUFDLE1BQUlBLEdBQUcsS0FBSyxJQUFSLElBQWdCLE9BQU9BLEdBQVAsS0FBZSxRQUFmLElBQTJCLE9BQU9BLEdBQVAsS0FBZSxVQUE5RCxFQUEwRTtBQUFFLFdBQU87QUFBRVQsTUFBQUEsT0FBTyxFQUFFUztBQUFYLEtBQVA7QUFBMEI7O0FBQUMsTUFBSUcsS0FBSyxHQUFHRix3QkFBd0IsRUFBcEM7O0FBQXdDLE1BQUlFLEtBQUssSUFBSUEsS0FBSyxDQUFDQyxHQUFOLENBQVVKLEdBQVYsQ0FBYixFQUE2QjtBQUFFLFdBQU9HLEtBQUssQ0FBQ0UsR0FBTixDQUFVTCxHQUFWLENBQVA7QUFBd0I7O0FBQUMsTUFBSU0sTUFBTSxHQUFHLEVBQWI7QUFBaUIsTUFBSUMscUJBQXFCLEdBQUdDLE1BQU0sQ0FBQ0MsY0FBUCxJQUF5QkQsTUFBTSxDQUFDRSx3QkFBNUQ7O0FBQXNGLE9BQUssSUFBSUMsR0FBVCxJQUFnQlgsR0FBaEIsRUFBcUI7QUFBRSxRQUFJUSxNQUFNLENBQUNJLFNBQVAsQ0FBaUJDLGNBQWpCLENBQWdDQyxJQUFoQyxDQUFxQ2QsR0FBckMsRUFBMENXLEdBQTFDLENBQUosRUFBb0Q7QUFBRSxVQUFJSSxJQUFJLEdBQUdSLHFCQUFxQixHQUFHQyxNQUFNLENBQUNFLHdCQUFQLENBQWdDVixHQUFoQyxFQUFxQ1csR0FBckMsQ0FBSCxHQUErQyxJQUEvRTs7QUFBcUYsVUFBSUksSUFBSSxLQUFLQSxJQUFJLENBQUNWLEdBQUwsSUFBWVUsSUFBSSxDQUFDQyxHQUF0QixDQUFSLEVBQW9DO0FBQUVSLFFBQUFBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkgsTUFBdEIsRUFBOEJLLEdBQTlCLEVBQW1DSSxJQUFuQztBQUEyQyxPQUFqRixNQUF1RjtBQUFFVCxRQUFBQSxNQUFNLENBQUNLLEdBQUQsQ0FBTixHQUFjWCxHQUFHLENBQUNXLEdBQUQsQ0FBakI7QUFBeUI7QUFBRTtBQUFFOztBQUFDTCxFQUFBQSxNQUFNLENBQUNmLE9BQVAsR0FBaUJTLEdBQWpCOztBQUFzQixNQUFJRyxLQUFKLEVBQVc7QUFBRUEsSUFBQUEsS0FBSyxDQUFDYSxHQUFOLENBQVVoQixHQUFWLEVBQWVNLE1BQWY7QUFBeUI7O0FBQUMsU0FBT0EsTUFBUDtBQUFnQjs7QUFFdnVCLFNBQVNXLFFBQVQsR0FBb0I7QUFBRUEsRUFBQUEsUUFBUSxHQUFHVCxNQUFNLENBQUNVLE1BQVAsSUFBaUIsVUFBVUMsTUFBVixFQUFrQjtBQUFFLFNBQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0MsU0FBUyxDQUFDQyxNQUE5QixFQUFzQ0YsQ0FBQyxFQUF2QyxFQUEyQztBQUFFLFVBQUlHLE1BQU0sR0FBR0YsU0FBUyxDQUFDRCxDQUFELENBQXRCOztBQUEyQixXQUFLLElBQUlULEdBQVQsSUFBZ0JZLE1BQWhCLEVBQXdCO0FBQUUsWUFBSWYsTUFBTSxDQUFDSSxTQUFQLENBQWlCQyxjQUFqQixDQUFnQ0MsSUFBaEMsQ0FBcUNTLE1BQXJDLEVBQTZDWixHQUE3QyxDQUFKLEVBQXVEO0FBQUVRLFVBQUFBLE1BQU0sQ0FBQ1IsR0FBRCxDQUFOLEdBQWNZLE1BQU0sQ0FBQ1osR0FBRCxDQUFwQjtBQUE0QjtBQUFFO0FBQUU7O0FBQUMsV0FBT1EsTUFBUDtBQUFnQixHQUE1UDs7QUFBOFAsU0FBT0YsUUFBUSxDQUFDTyxLQUFULENBQWUsSUFBZixFQUFxQkgsU0FBckIsQ0FBUDtBQUF5Qzs7QUFFN1QsU0FBU0ksNkJBQVQsQ0FBdUNGLE1BQXZDLEVBQStDRyxRQUEvQyxFQUF5RDtBQUFFLE1BQUlILE1BQU0sSUFBSSxJQUFkLEVBQW9CLE9BQU8sRUFBUDtBQUFXLE1BQUlKLE1BQU0sR0FBRyxFQUFiO0FBQWlCLE1BQUlRLFVBQVUsR0FBR25CLE1BQU0sQ0FBQ29CLElBQVAsQ0FBWUwsTUFBWixDQUFqQjtBQUFzQyxNQUFJWixHQUFKLEVBQVNTLENBQVQ7O0FBQVksT0FBS0EsQ0FBQyxHQUFHLENBQVQsRUFBWUEsQ0FBQyxHQUFHTyxVQUFVLENBQUNMLE1BQTNCLEVBQW1DRixDQUFDLEVBQXBDLEVBQXdDO0FBQUVULElBQUFBLEdBQUcsR0FBR2dCLFVBQVUsQ0FBQ1AsQ0FBRCxDQUFoQjtBQUFxQixRQUFJTSxRQUFRLENBQUNHLE9BQVQsQ0FBaUJsQixHQUFqQixLQUF5QixDQUE3QixFQUFnQztBQUFVUSxJQUFBQSxNQUFNLENBQUNSLEdBQUQsQ0FBTixHQUFjWSxNQUFNLENBQUNaLEdBQUQsQ0FBcEI7QUFBNEI7O0FBQUMsU0FBT1EsTUFBUDtBQUFnQjs7QUFFblQsU0FBU1csaUJBQVQsQ0FBMkJDLGFBQTNCLEVBQTBDQyxhQUExQyxFQUF5RDtBQUN2RCxTQUFPO0FBQ0xDLElBQUFBLEtBQUssRUFBRTtBQUNMQyxNQUFBQSxPQUFPLEVBQUVILGFBQWEsS0FBSyxJQUFsQixJQUEwQkEsYUFBYSxLQUFLLEtBQUssQ0FBakQsR0FBcURBLGFBQXJELEdBQXFFO0FBRHpFLEtBREY7QUFJTEksSUFBQUEsUUFBUSxFQUFFO0FBQ1JDLE1BQUFBLGVBQWUsRUFBRUosYUFBYSxLQUFLSyxTQUFsQixHQUE4QixPQUE5QixHQUF3Q0w7QUFEakQ7QUFKTCxHQUFQO0FBUUQ7O0FBRUQsU0FBU00sZUFBVCxDQUF5QkMsS0FBekIsRUFBZ0M7QUFDOUIsU0FBT0EsS0FBSyxDQUFDQyxPQUFOLElBQWlCLElBQWpCLElBQXlCRCxLQUFLLENBQUNFLFNBQU4sSUFBbUIsSUFBNUMsSUFBb0RGLEtBQUssQ0FBQ0csVUFBTixJQUFvQixJQUF4RSxJQUFnRkgsS0FBSyxDQUFDSSxXQUFOLElBQXFCLElBQTVHO0FBQ0Q7O0FBZ0JELFNBQVNDLGtCQUFULENBQTRCTCxLQUE1QixFQUFtQ00sWUFBbkMsRUFBaUQ7QUFDL0MsTUFBSWQsYUFBYSxHQUFHUSxLQUFLLENBQUNSLGFBQTFCO0FBQUEsTUFDSWUsUUFBUSxHQUFHUCxLQUFLLENBQUNPLFFBRHJCO0FBQUEsTUFFSUMsWUFBWSxHQUFHUixLQUFLLENBQUNRLFlBRnpCO0FBQUEsTUFHSUMsYUFBYSxHQUFHVCxLQUFLLENBQUNTLGFBSDFCO0FBQUEsTUFJSUMsY0FBYyxHQUFHVixLQUFLLENBQUNVLGNBSjNCO0FBQUEsTUFLSUMsUUFBUSxHQUFHWCxLQUFLLENBQUNXLFFBTHJCO0FBQUEsTUFNSUMsU0FBUyxHQUFHWixLQUFLLENBQUNZLFNBTnRCO0FBQUEsTUFPSUMsY0FBYyxHQUFHYixLQUFLLENBQUNhLGNBUDNCO0FBQUEsTUFRSVQsV0FBVyxHQUFHSixLQUFLLENBQUNJLFdBUnhCO0FBQUEsTUFTSUgsT0FBTyxHQUFHRCxLQUFLLENBQUNDLE9BVHBCO0FBQUEsTUFVSUMsU0FBUyxHQUFHRixLQUFLLENBQUNFLFNBVnRCO0FBQUEsTUFXSUMsVUFBVSxHQUFHSCxLQUFLLENBQUNHLFVBWHZCO0FBQUEsTUFZSVcsY0FBYyxHQUFHZCxLQUFLLENBQUNjLGNBWjNCO0FBQUEsTUFhSUMsMEJBQTBCLEdBQUdmLEtBQUssQ0FBQ2UsMEJBYnZDO0FBQUEsTUFjSUMsS0FBSyxHQUFHaEIsS0FBSyxDQUFDZ0IsS0FkbEI7QUFBQSxNQWVJQyxnQkFBZ0IsR0FBR2pCLEtBQUssQ0FBQ2lCLGdCQWY3QjtBQUFBLE1BZ0JJeEIsYUFBYSxHQUFHTyxLQUFLLENBQUNQLGFBaEIxQjtBQUFBLE1BaUJJeUIsSUFBSSxHQUFHaEMsNkJBQTZCLENBQUNjLEtBQUQsRUFBUSxDQUFDLGVBQUQsRUFBa0IsVUFBbEIsRUFBOEIsY0FBOUIsRUFBOEMsZUFBOUMsRUFBK0QsZ0JBQS9ELEVBQWlGLFVBQWpGLEVBQTZGLFdBQTdGLEVBQTBHLGdCQUExRyxFQUE0SCxhQUE1SCxFQUEySSxTQUEzSSxFQUFzSixXQUF0SixFQUFtSyxZQUFuSyxFQUFpTCxnQkFBakwsRUFBbU0sNEJBQW5NLEVBQWlPLE9BQWpPLEVBQTBPLGtCQUExTyxFQUE4UCxlQUE5UCxDQUFSLENBakJ4Qzs7QUFtQkEsTUFBSW1CLE9BQU8sR0FBRyxDQUFDLEdBQUdsRSxLQUFLLENBQUNtRSxNQUFWLEVBQWtCLElBQWxCLENBQWQ7QUFDQSxNQUFJQyxNQUFNLEdBQUcsQ0FBQyxHQUFHakUsYUFBYSxDQUFDSixPQUFsQixFQUEyQnNELFlBQTNCLEVBQXlDYSxPQUF6QyxDQUFiOztBQUVBLE1BQUlHLFNBQVMsR0FBRyxDQUFDLEdBQUdyRSxLQUFLLENBQUNzRSxRQUFWLEVBQW9CTixnQkFBZ0IsS0FBSyxJQUFyQixHQUE0QjFCLGlCQUFpQixDQUFDQyxhQUFELEVBQWdCQyxhQUFoQixDQUE3QyxHQUE4RSxJQUFsRyxDQUFoQjtBQUFBLE1BQ0krQixXQUFXLEdBQUdGLFNBQVMsQ0FBQyxDQUFELENBRDNCO0FBQUEsTUFFSUcsY0FBYyxHQUFHSCxTQUFTLENBQUMsQ0FBRCxDQUY5Qjs7QUFJQSxNQUFJSSxZQUFZLEdBQUcsQ0FBQyxHQUFHekUsS0FBSyxDQUFDMEUsV0FBVixFQUF1QixZQUFZO0FBQ3BELFFBQUksQ0FBQzVCLGVBQWUsQ0FBQ0MsS0FBRCxDQUFwQixFQUE2QjtBQUMzQjtBQUNEOztBQUVEeUIsSUFBQUEsY0FBYyxDQUFDbEMsaUJBQWlCLENBQUNDLGFBQUQsRUFBZ0JDLGFBQWhCLENBQWxCLENBQWQ7O0FBRUEsUUFBSXFCLGNBQWMsSUFBSSxJQUF0QixFQUE0QjtBQUMxQkEsTUFBQUEsY0FBYztBQUNmO0FBQ0YsR0FWa0IsRUFVaEIsQ0FBQ3RCLGFBQUQsRUFBZ0JzQixjQUFoQixFQUFnQ2QsS0FBaEMsRUFBdUNQLGFBQXZDLENBVmdCLENBQW5CO0FBV0EsTUFBSW1DLFlBQVksR0FBRyxDQUFDLEdBQUczRSxLQUFLLENBQUMwRSxXQUFWLEVBQXVCLFlBQVk7QUFDcEQsUUFBSVYsZ0JBQWdCLEtBQUssSUFBekIsRUFBK0I7QUFDN0I7QUFDRDs7QUFFRCxRQUFJbEIsZUFBZSxDQUFDQyxLQUFELENBQW5CLEVBQTRCO0FBQzFCeUIsTUFBQUEsY0FBYyxDQUFDLElBQUQsQ0FBZDs7QUFFQSxVQUFJWixjQUFjLElBQUksSUFBdEIsRUFBNEI7QUFDMUJBLFFBQUFBLGNBQWM7QUFDZjtBQUNGO0FBQ0YsR0Faa0IsRUFZaEIsQ0FBQ0EsY0FBRCxFQUFpQmIsS0FBakIsRUFBd0JpQixnQkFBeEIsQ0FaZ0IsQ0FBbkI7QUFhQSxNQUFJWSxXQUFXLEdBQUcsQ0FBQyxHQUFHNUUsS0FBSyxDQUFDNkUsT0FBVixFQUFtQixZQUFZO0FBQy9DLFdBQU87QUFDTEMsTUFBQUEsVUFBVSxFQUFFLENBQUNoQiwwQkFEUjtBQUVMSixNQUFBQSxRQUFRLEVBQUVBLFFBRkw7QUFHTEQsTUFBQUEsY0FBYyxFQUFFQSxjQUhYO0FBSUxzQixNQUFBQSxlQUFlLEVBQUV4QixZQUpaO0FBS0x5QixNQUFBQSxhQUFhLEVBQUV4QixhQUxWO0FBTUxMLE1BQUFBLFdBQVcsRUFBRUEsV0FOUjtBQU9MSCxNQUFBQSxPQUFPLEVBQUVBLE9BUEo7QUFRTGlDLE1BQUFBLFlBQVksRUFBRSxTQUFTQSxZQUFULENBQXNCQyxLQUF0QixFQUE2QjtBQUN6Q1QsUUFBQUEsWUFBWTs7QUFFWixZQUFJeEIsU0FBUyxJQUFJLElBQWpCLEVBQXVCO0FBQ3JCQSxVQUFBQSxTQUFTLENBQUNpQyxLQUFELENBQVQ7QUFDRDtBQUNGLE9BZEk7QUFlTEMsTUFBQUEsVUFBVSxFQUFFLFNBQVNBLFVBQVQsQ0FBb0JELEtBQXBCLEVBQTJCO0FBQ3JDUCxRQUFBQSxZQUFZOztBQUVaLFlBQUl6QixVQUFVLElBQUksSUFBbEIsRUFBd0I7QUFDdEJBLFVBQUFBLFVBQVUsQ0FBQ2dDLEtBQUQsQ0FBVjtBQUNEO0FBQ0Y7QUFyQkksS0FBUDtBQXVCRCxHQXhCaUIsRUF3QmYsQ0FBQ3pCLGNBQUQsRUFBaUJGLFlBQWpCLEVBQStCQyxhQUEvQixFQUE4Q0UsUUFBOUMsRUFBd0RQLFdBQXhELEVBQXFFSCxPQUFyRSxFQUE4RUMsU0FBOUUsRUFBeUZDLFVBQXpGLEVBQXFHWSwwQkFBckcsRUFBaUlXLFlBQWpJLEVBQStJRSxZQUEvSSxDQXhCZSxDQUFsQjtBQXlCQSxNQUFJUyxrQkFBa0IsR0FBRyxDQUFDLEdBQUcvRSxlQUFlLENBQUNOLE9BQXBCLEVBQTZCbUUsT0FBN0IsRUFBc0NVLFdBQXRDLENBQXpCO0FBQ0EsTUFBSW5DLEtBQUssR0FBR3pDLEtBQUssQ0FBQ3FGLFFBQU4sQ0FBZUMsSUFBZixDQUFvQmhDLFFBQXBCLENBQVo7QUFDQSxTQUFvQnRELEtBQUssQ0FBQ3VGLGFBQU4sQ0FBb0JoRixLQUFLLENBQUNSLE9BQTFCLEVBQW1DMEIsUUFBUSxDQUFDLEVBQUQsRUFBS3dDLElBQUwsRUFBV21CLGtCQUFYLEVBQStCO0FBQzVGSSxJQUFBQSxxQkFBcUIsRUFBRTlCLFFBRHFFO0FBRTVGQyxJQUFBQSxTQUFTLEVBQUUsQ0FBQ0QsUUFBRCxJQUFhQyxTQUFTLEtBQUssS0FGc0Q7QUFHNUY4QixJQUFBQSxHQUFHLEVBQUVyQixNQUh1RjtBQUk1RkwsSUFBQUEsS0FBSyxFQUFFLENBQUMyQixNQUFNLENBQUNDLElBQVIsRUFBYzVCLEtBQWQsRUFBcUIsQ0FBQ0wsUUFBRCxJQUFhZ0MsTUFBTSxDQUFDRSxVQUF6QyxFQUFxRHJCLFdBQVcsSUFBSUEsV0FBVyxDQUFDNUIsUUFBaEY7QUFKcUYsR0FBL0IsQ0FBM0MsRUFLSDNDLEtBQUssQ0FBQzZGLFlBQU4sQ0FBbUJwRCxLQUFuQixFQUEwQjtBQUN6Q3NCLElBQUFBLEtBQUssRUFBRXpELFdBQVcsQ0FBQ1AsT0FBWixDQUFvQitGLE9BQXBCLENBQTRCckQsS0FBSyxDQUFDTSxLQUFOLENBQVlnQixLQUF4QyxFQUErQ1EsV0FBVyxJQUFJQSxXQUFXLENBQUM5QixLQUExRTtBQURrQyxHQUExQixDQUxHLENBQXBCO0FBUUQ7O0FBRUQsSUFBSWlELE1BQU0sR0FBR3BGLFdBQVcsQ0FBQ1AsT0FBWixDQUFvQmdHLE1BQXBCLENBQTJCO0FBQ3RDSixFQUFBQSxJQUFJLEVBQUU7QUFDSkssSUFBQUEsVUFBVSxFQUFFO0FBRFIsR0FEZ0M7QUFJdENKLEVBQUFBLFVBQVUsRUFBRTtBQUNWSyxJQUFBQSxNQUFNLEVBQUUsU0FERTtBQUVWQyxJQUFBQSxXQUFXLEVBQUU7QUFGSDtBQUowQixDQUEzQixDQUFiOztBQVVBLElBQUlDLHdCQUF3QixHQUFnQm5HLEtBQUssQ0FBQ29HLElBQU4sQ0FBeUJwRyxLQUFLLENBQUNxRyxVQUFOLENBQWlCakQsa0JBQWpCLENBQXpCLENBQTVDO0FBQ0ErQyx3QkFBd0IsQ0FBQ0csV0FBekIsR0FBdUMsb0JBQXZDO0FBQ0EsSUFBSUMsUUFBUSxHQUFHSix3QkFBZjtBQUNBdEcsT0FBTyxDQUFDRSxPQUFSLEdBQWtCd0csUUFBbEI7QUFDQUMsTUFBTSxDQUFDM0csT0FBUCxHQUFpQkEsT0FBTyxDQUFDRSxPQUF6QiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogXG4gKiBAZm9ybWF0XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDtcblxudmFyIFJlYWN0ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZShcInJlYWN0XCIpKTtcblxudmFyIF91c2VNZXJnZVJlZnMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi8uLi9tb2R1bGVzL3VzZU1lcmdlUmVmc1wiKSk7XG5cbnZhciBfdXNlUHJlc3NFdmVudHMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi8uLi9tb2R1bGVzL3VzZVByZXNzRXZlbnRzXCIpKTtcblxudmFyIF9TdHlsZVNoZWV0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vU3R5bGVTaGVldFwiKSk7XG5cbnZhciBfVmlldyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4uL1ZpZXdcIikpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUoKSB7IGlmICh0eXBlb2YgV2Vha01hcCAhPT0gXCJmdW5jdGlvblwiKSByZXR1cm4gbnVsbDsgdmFyIGNhY2hlID0gbmV3IFdlYWtNYXAoKTsgX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlID0gZnVuY3Rpb24gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKCkgeyByZXR1cm4gY2FjaGU7IH07IHJldHVybiBjYWNoZTsgfVxuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGlmIChvYmogPT09IG51bGwgfHwgdHlwZW9mIG9iaiAhPT0gXCJvYmplY3RcIiAmJiB0eXBlb2Ygb2JqICE9PSBcImZ1bmN0aW9uXCIpIHsgcmV0dXJuIHsgZGVmYXVsdDogb2JqIH07IH0gdmFyIGNhY2hlID0gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKCk7IGlmIChjYWNoZSAmJiBjYWNoZS5oYXMob2JqKSkgeyByZXR1cm4gY2FjaGUuZ2V0KG9iaik7IH0gdmFyIG5ld09iaiA9IHt9OyB2YXIgaGFzUHJvcGVydHlEZXNjcmlwdG9yID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsgdmFyIGRlc2MgPSBoYXNQcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IG51bGw7IGlmIChkZXNjICYmIChkZXNjLmdldCB8fCBkZXNjLnNldCkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsgfSBlbHNlIHsgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IH0gbmV3T2JqLmRlZmF1bHQgPSBvYmo7IGlmIChjYWNoZSkgeyBjYWNoZS5zZXQob2JqLCBuZXdPYmopOyB9IHJldHVybiBuZXdPYmo7IH1cblxuZnVuY3Rpb24gX2V4dGVuZHMoKSB7IF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTsgcmV0dXJuIF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH1cblxuZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2Uoc291cmNlLCBleGNsdWRlZCkgeyBpZiAoc291cmNlID09IG51bGwpIHJldHVybiB7fTsgdmFyIHRhcmdldCA9IHt9OyB2YXIgc291cmNlS2V5cyA9IE9iamVjdC5rZXlzKHNvdXJjZSk7IHZhciBrZXksIGk7IGZvciAoaSA9IDA7IGkgPCBzb3VyY2VLZXlzLmxlbmd0aDsgaSsrKSB7IGtleSA9IHNvdXJjZUtleXNbaV07IGlmIChleGNsdWRlZC5pbmRleE9mKGtleSkgPj0gMCkgY29udGludWU7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gcmV0dXJuIHRhcmdldDsgfVxuXG5mdW5jdGlvbiBjcmVhdGVFeHRyYVN0eWxlcyhhY3RpdmVPcGFjaXR5LCB1bmRlcmxheUNvbG9yKSB7XG4gIHJldHVybiB7XG4gICAgY2hpbGQ6IHtcbiAgICAgIG9wYWNpdHk6IGFjdGl2ZU9wYWNpdHkgIT09IG51bGwgJiYgYWN0aXZlT3BhY2l0eSAhPT0gdm9pZCAwID8gYWN0aXZlT3BhY2l0eSA6IDAuODVcbiAgICB9LFxuICAgIHVuZGVybGF5OiB7XG4gICAgICBiYWNrZ3JvdW5kQ29sb3I6IHVuZGVybGF5Q29sb3IgPT09IHVuZGVmaW5lZCA/ICdibGFjaycgOiB1bmRlcmxheUNvbG9yXG4gICAgfVxuICB9O1xufVxuXG5mdW5jdGlvbiBoYXNQcmVzc0hhbmRsZXIocHJvcHMpIHtcbiAgcmV0dXJuIHByb3BzLm9uUHJlc3MgIT0gbnVsbCB8fCBwcm9wcy5vblByZXNzSW4gIT0gbnVsbCB8fCBwcm9wcy5vblByZXNzT3V0ICE9IG51bGwgfHwgcHJvcHMub25Mb25nUHJlc3MgIT0gbnVsbDtcbn1cbi8qKlxuICogQSB3cmFwcGVyIGZvciBtYWtpbmcgdmlld3MgcmVzcG9uZCBwcm9wZXJseSB0byB0b3VjaGVzLlxuICogT24gcHJlc3MgZG93biwgdGhlIG9wYWNpdHkgb2YgdGhlIHdyYXBwZWQgdmlldyBpcyBkZWNyZWFzZWQsIHdoaWNoIGFsbG93c1xuICogdGhlIHVuZGVybGF5IGNvbG9yIHRvIHNob3cgdGhyb3VnaCwgZGFya2VuaW5nIG9yIHRpbnRpbmcgdGhlIHZpZXcuXG4gKlxuICogVGhlIHVuZGVybGF5IGNvbWVzIGZyb20gd3JhcHBpbmcgdGhlIGNoaWxkIGluIGEgbmV3IFZpZXcsIHdoaWNoIGNhbiBhZmZlY3RcbiAqIGxheW91dCwgYW5kIHNvbWV0aW1lcyBjYXVzZSB1bndhbnRlZCB2aXN1YWwgYXJ0aWZhY3RzIGlmIG5vdCB1c2VkIGNvcnJlY3RseSxcbiAqIGZvciBleGFtcGxlIGlmIHRoZSBiYWNrZ3JvdW5kQ29sb3Igb2YgdGhlIHdyYXBwZWQgdmlldyBpc24ndCBleHBsaWNpdGx5IHNldFxuICogdG8gYW4gb3BhcXVlIGNvbG9yLlxuICpcbiAqIFRvdWNoYWJsZUhpZ2hsaWdodCBtdXN0IGhhdmUgb25lIGNoaWxkIChub3QgemVybyBvciBtb3JlIHRoYW4gb25lKS5cbiAqIElmIHlvdSB3aXNoIHRvIGhhdmUgc2V2ZXJhbCBjaGlsZCBjb21wb25lbnRzLCB3cmFwIHRoZW0gaW4gYSBWaWV3LlxuICovXG5cblxuZnVuY3Rpb24gVG91Y2hhYmxlSGlnaGxpZ2h0KHByb3BzLCBmb3J3YXJkZWRSZWYpIHtcbiAgdmFyIGFjdGl2ZU9wYWNpdHkgPSBwcm9wcy5hY3RpdmVPcGFjaXR5LFxuICAgICAgY2hpbGRyZW4gPSBwcm9wcy5jaGlsZHJlbixcbiAgICAgIGRlbGF5UHJlc3NJbiA9IHByb3BzLmRlbGF5UHJlc3NJbixcbiAgICAgIGRlbGF5UHJlc3NPdXQgPSBwcm9wcy5kZWxheVByZXNzT3V0LFxuICAgICAgZGVsYXlMb25nUHJlc3MgPSBwcm9wcy5kZWxheUxvbmdQcmVzcyxcbiAgICAgIGRpc2FibGVkID0gcHJvcHMuZGlzYWJsZWQsXG4gICAgICBmb2N1c2FibGUgPSBwcm9wcy5mb2N1c2FibGUsXG4gICAgICBvbkhpZGVVbmRlcmxheSA9IHByb3BzLm9uSGlkZVVuZGVybGF5LFxuICAgICAgb25Mb25nUHJlc3MgPSBwcm9wcy5vbkxvbmdQcmVzcyxcbiAgICAgIG9uUHJlc3MgPSBwcm9wcy5vblByZXNzLFxuICAgICAgb25QcmVzc0luID0gcHJvcHMub25QcmVzc0luLFxuICAgICAgb25QcmVzc091dCA9IHByb3BzLm9uUHJlc3NPdXQsXG4gICAgICBvblNob3dVbmRlcmxheSA9IHByb3BzLm9uU2hvd1VuZGVybGF5LFxuICAgICAgcmVqZWN0UmVzcG9uZGVyVGVybWluYXRpb24gPSBwcm9wcy5yZWplY3RSZXNwb25kZXJUZXJtaW5hdGlvbixcbiAgICAgIHN0eWxlID0gcHJvcHMuc3R5bGUsXG4gICAgICB0ZXN0T25seV9wcmVzc2VkID0gcHJvcHMudGVzdE9ubHlfcHJlc3NlZCxcbiAgICAgIHVuZGVybGF5Q29sb3IgPSBwcm9wcy51bmRlcmxheUNvbG9yLFxuICAgICAgcmVzdCA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHByb3BzLCBbXCJhY3RpdmVPcGFjaXR5XCIsIFwiY2hpbGRyZW5cIiwgXCJkZWxheVByZXNzSW5cIiwgXCJkZWxheVByZXNzT3V0XCIsIFwiZGVsYXlMb25nUHJlc3NcIiwgXCJkaXNhYmxlZFwiLCBcImZvY3VzYWJsZVwiLCBcIm9uSGlkZVVuZGVybGF5XCIsIFwib25Mb25nUHJlc3NcIiwgXCJvblByZXNzXCIsIFwib25QcmVzc0luXCIsIFwib25QcmVzc091dFwiLCBcIm9uU2hvd1VuZGVybGF5XCIsIFwicmVqZWN0UmVzcG9uZGVyVGVybWluYXRpb25cIiwgXCJzdHlsZVwiLCBcInRlc3RPbmx5X3ByZXNzZWRcIiwgXCJ1bmRlcmxheUNvbG9yXCJdKTtcblxuICB2YXIgaG9zdFJlZiA9ICgwLCBSZWFjdC51c2VSZWYpKG51bGwpO1xuICB2YXIgc2V0UmVmID0gKDAsIF91c2VNZXJnZVJlZnMuZGVmYXVsdCkoZm9yd2FyZGVkUmVmLCBob3N0UmVmKTtcblxuICB2YXIgX3VzZVN0YXRlID0gKDAsIFJlYWN0LnVzZVN0YXRlKSh0ZXN0T25seV9wcmVzc2VkID09PSB0cnVlID8gY3JlYXRlRXh0cmFTdHlsZXMoYWN0aXZlT3BhY2l0eSwgdW5kZXJsYXlDb2xvcikgOiBudWxsKSxcbiAgICAgIGV4dHJhU3R5bGVzID0gX3VzZVN0YXRlWzBdLFxuICAgICAgc2V0RXh0cmFTdHlsZXMgPSBfdXNlU3RhdGVbMV07XG5cbiAgdmFyIHNob3dVbmRlcmxheSA9ICgwLCBSZWFjdC51c2VDYWxsYmFjaykoZnVuY3Rpb24gKCkge1xuICAgIGlmICghaGFzUHJlc3NIYW5kbGVyKHByb3BzKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHNldEV4dHJhU3R5bGVzKGNyZWF0ZUV4dHJhU3R5bGVzKGFjdGl2ZU9wYWNpdHksIHVuZGVybGF5Q29sb3IpKTtcblxuICAgIGlmIChvblNob3dVbmRlcmxheSAhPSBudWxsKSB7XG4gICAgICBvblNob3dVbmRlcmxheSgpO1xuICAgIH1cbiAgfSwgW2FjdGl2ZU9wYWNpdHksIG9uU2hvd1VuZGVybGF5LCBwcm9wcywgdW5kZXJsYXlDb2xvcl0pO1xuICB2YXIgaGlkZVVuZGVybGF5ID0gKDAsIFJlYWN0LnVzZUNhbGxiYWNrKShmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRlc3RPbmx5X3ByZXNzZWQgPT09IHRydWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoaGFzUHJlc3NIYW5kbGVyKHByb3BzKSkge1xuICAgICAgc2V0RXh0cmFTdHlsZXMobnVsbCk7XG5cbiAgICAgIGlmIChvbkhpZGVVbmRlcmxheSAhPSBudWxsKSB7XG4gICAgICAgIG9uSGlkZVVuZGVybGF5KCk7XG4gICAgICB9XG4gICAgfVxuICB9LCBbb25IaWRlVW5kZXJsYXksIHByb3BzLCB0ZXN0T25seV9wcmVzc2VkXSk7XG4gIHZhciBwcmVzc0NvbmZpZyA9ICgwLCBSZWFjdC51c2VNZW1vKShmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNhbmNlbGFibGU6ICFyZWplY3RSZXNwb25kZXJUZXJtaW5hdGlvbixcbiAgICAgIGRpc2FibGVkOiBkaXNhYmxlZCxcbiAgICAgIGRlbGF5TG9uZ1ByZXNzOiBkZWxheUxvbmdQcmVzcyxcbiAgICAgIGRlbGF5UHJlc3NTdGFydDogZGVsYXlQcmVzc0luLFxuICAgICAgZGVsYXlQcmVzc0VuZDogZGVsYXlQcmVzc091dCxcbiAgICAgIG9uTG9uZ1ByZXNzOiBvbkxvbmdQcmVzcyxcbiAgICAgIG9uUHJlc3M6IG9uUHJlc3MsXG4gICAgICBvblByZXNzU3RhcnQ6IGZ1bmN0aW9uIG9uUHJlc3NTdGFydChldmVudCkge1xuICAgICAgICBzaG93VW5kZXJsYXkoKTtcblxuICAgICAgICBpZiAob25QcmVzc0luICE9IG51bGwpIHtcbiAgICAgICAgICBvblByZXNzSW4oZXZlbnQpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgb25QcmVzc0VuZDogZnVuY3Rpb24gb25QcmVzc0VuZChldmVudCkge1xuICAgICAgICBoaWRlVW5kZXJsYXkoKTtcblxuICAgICAgICBpZiAob25QcmVzc091dCAhPSBudWxsKSB7XG4gICAgICAgICAgb25QcmVzc091dChldmVudCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9LCBbZGVsYXlMb25nUHJlc3MsIGRlbGF5UHJlc3NJbiwgZGVsYXlQcmVzc091dCwgZGlzYWJsZWQsIG9uTG9uZ1ByZXNzLCBvblByZXNzLCBvblByZXNzSW4sIG9uUHJlc3NPdXQsIHJlamVjdFJlc3BvbmRlclRlcm1pbmF0aW9uLCBzaG93VW5kZXJsYXksIGhpZGVVbmRlcmxheV0pO1xuICB2YXIgcHJlc3NFdmVudEhhbmRsZXJzID0gKDAsIF91c2VQcmVzc0V2ZW50cy5kZWZhdWx0KShob3N0UmVmLCBwcmVzc0NvbmZpZyk7XG4gIHZhciBjaGlsZCA9IFJlYWN0LkNoaWxkcmVuLm9ubHkoY2hpbGRyZW4pO1xuICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoX1ZpZXcuZGVmYXVsdCwgX2V4dGVuZHMoe30sIHJlc3QsIHByZXNzRXZlbnRIYW5kbGVycywge1xuICAgIGFjY2Vzc2liaWxpdHlEaXNhYmxlZDogZGlzYWJsZWQsXG4gICAgZm9jdXNhYmxlOiAhZGlzYWJsZWQgJiYgZm9jdXNhYmxlICE9PSBmYWxzZSxcbiAgICByZWY6IHNldFJlZixcbiAgICBzdHlsZTogW3N0eWxlcy5yb290LCBzdHlsZSwgIWRpc2FibGVkICYmIHN0eWxlcy5hY3Rpb25hYmxlLCBleHRyYVN0eWxlcyAmJiBleHRyYVN0eWxlcy51bmRlcmxheV1cbiAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jbG9uZUVsZW1lbnQoY2hpbGQsIHtcbiAgICBzdHlsZTogX1N0eWxlU2hlZXQuZGVmYXVsdC5jb21wb3NlKGNoaWxkLnByb3BzLnN0eWxlLCBleHRyYVN0eWxlcyAmJiBleHRyYVN0eWxlcy5jaGlsZClcbiAgfSkpO1xufVxuXG52YXIgc3R5bGVzID0gX1N0eWxlU2hlZXQuZGVmYXVsdC5jcmVhdGUoe1xuICByb290OiB7XG4gICAgdXNlclNlbGVjdDogJ25vbmUnXG4gIH0sXG4gIGFjdGlvbmFibGU6IHtcbiAgICBjdXJzb3I6ICdwb2ludGVyJyxcbiAgICB0b3VjaEFjdGlvbjogJ21hbmlwdWxhdGlvbidcbiAgfVxufSk7XG5cbnZhciBNZW1vZWRUb3VjaGFibGVIaWdobGlnaHQgPSAvKiNfX1BVUkVfXyovUmVhY3QubWVtbyggLyojX19QVVJFX18qL1JlYWN0LmZvcndhcmRSZWYoVG91Y2hhYmxlSGlnaGxpZ2h0KSk7XG5NZW1vZWRUb3VjaGFibGVIaWdobGlnaHQuZGlzcGxheU5hbWUgPSAnVG91Y2hhYmxlSGlnaGxpZ2h0JztcbnZhciBfZGVmYXVsdCA9IE1lbW9lZFRvdWNoYWJsZUhpZ2hsaWdodDtcbmV4cG9ydHMuZGVmYXVsdCA9IF9kZWZhdWx0O1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzLmRlZmF1bHQ7Il19