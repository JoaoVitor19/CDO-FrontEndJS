64613fe391b150c42732d38e432008f9
"use strict";

exports.__esModule = true;
exports.setResponderId = setResponderId;
exports.getResponderPaths = getResponderPaths;
exports.getLowestCommonAncestor = getLowestCommonAncestor;
exports.hasTargetTouches = hasTargetTouches;
exports.hasValidSelection = hasValidSelection;
exports.isPrimaryPointerDown = isPrimaryPointerDown;

var _isSelectionValid = _interopRequireDefault(require("../../modules/isSelectionValid"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

var keyName = '__reactResponderId';

function getEventPath(domEvent) {
  if (domEvent.type === 'selectionchange') {
    var target = window.getSelection().anchorNode;
    return composedPathFallback(target);
  } else {
    var path = domEvent.composedPath != null ? domEvent.composedPath() : composedPathFallback(domEvent.target);
    return path;
  }
}

function composedPathFallback(target) {
  var path = [];

  while (target != null && target !== document.body) {
    path.push(target);
    target = target.parentNode;
  }

  return path;
}

function getResponderId(node) {
  if (node != null) {
    return node[keyName];
  }

  return null;
}

function setResponderId(node, id) {
  if (node != null) {
    node[keyName] = id;
  }
}

function getResponderPaths(domEvent) {
  var idPath = [];
  var nodePath = [];
  var eventPath = getEventPath(domEvent);

  for (var i = 0; i < eventPath.length; i++) {
    var node = eventPath[i];
    var id = getResponderId(node);

    if (id != null) {
      idPath.push(id);
      nodePath.push(node);
    }
  }

  return {
    idPath: idPath,
    nodePath: nodePath
  };
}

function getLowestCommonAncestor(pathA, pathB) {
  var pathALength = pathA.length;
  var pathBLength = pathB.length;

  if (pathALength === 0 || pathBLength === 0 || pathA[pathALength - 1] !== pathB[pathBLength - 1]) {
    return null;
  }

  var itemA = pathA[0];
  var indexA = 0;
  var itemB = pathB[0];
  var indexB = 0;

  if (pathALength - pathBLength > 0) {
    indexA = pathALength - pathBLength;
    itemA = pathA[indexA];
    pathALength = pathBLength;
  }

  if (pathBLength - pathALength > 0) {
    indexB = pathBLength - pathALength;
    itemB = pathB[indexB];
    pathBLength = pathALength;
  }

  var depth = pathALength;

  while (depth--) {
    if (itemA === itemB) {
      return itemA;
    }

    itemA = pathA[indexA++];
    itemB = pathB[indexB++];
  }

  return null;
}

function hasTargetTouches(target, touches) {
  if (!touches || touches.length === 0) {
    return false;
  }

  for (var i = 0; i < touches.length; i++) {
    var node = touches[i].target;

    if (node != null) {
      if (target.contains(node)) {
        return true;
      }
    }
  }

  return false;
}

function hasValidSelection(domEvent) {
  if (domEvent.type === 'selectionchange') {
    return (0, _isSelectionValid.default)();
  }

  return domEvent.type === 'select';
}

function isPrimaryPointerDown(domEvent) {
  var altKey = domEvent.altKey,
      button = domEvent.button,
      buttons = domEvent.buttons,
      ctrlKey = domEvent.ctrlKey,
      type = domEvent.type;
  var isTouch = type === 'touchstart' || type === 'touchmove';
  var isPrimaryMouseDown = type === 'mousedown' && (button === 0 || buttons === 1);
  var isPrimaryMouseMove = type === 'mousemove' && buttons === 1;
  var noModifiers = altKey === false && ctrlKey === false;

  if (isTouch || isPrimaryMouseDown && noModifiers || isPrimaryMouseMove && noModifiers) {
    return true;
  }

  return false;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwic2V0UmVzcG9uZGVySWQiLCJnZXRSZXNwb25kZXJQYXRocyIsImdldExvd2VzdENvbW1vbkFuY2VzdG9yIiwiaGFzVGFyZ2V0VG91Y2hlcyIsImhhc1ZhbGlkU2VsZWN0aW9uIiwiaXNQcmltYXJ5UG9pbnRlckRvd24iLCJfaXNTZWxlY3Rpb25WYWxpZCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwib2JqIiwiZGVmYXVsdCIsImtleU5hbWUiLCJnZXRFdmVudFBhdGgiLCJkb21FdmVudCIsInR5cGUiLCJ0YXJnZXQiLCJ3aW5kb3ciLCJnZXRTZWxlY3Rpb24iLCJhbmNob3JOb2RlIiwiY29tcG9zZWRQYXRoRmFsbGJhY2siLCJwYXRoIiwiY29tcG9zZWRQYXRoIiwiZG9jdW1lbnQiLCJib2R5IiwicHVzaCIsInBhcmVudE5vZGUiLCJnZXRSZXNwb25kZXJJZCIsIm5vZGUiLCJpZCIsImlkUGF0aCIsIm5vZGVQYXRoIiwiZXZlbnRQYXRoIiwiaSIsImxlbmd0aCIsInBhdGhBIiwicGF0aEIiLCJwYXRoQUxlbmd0aCIsInBhdGhCTGVuZ3RoIiwiaXRlbUEiLCJpbmRleEEiLCJpdGVtQiIsImluZGV4QiIsImRlcHRoIiwidG91Y2hlcyIsImNvbnRhaW5zIiwiYWx0S2V5IiwiYnV0dG9uIiwiYnV0dG9ucyIsImN0cmxLZXkiLCJpc1RvdWNoIiwiaXNQcmltYXJ5TW91c2VEb3duIiwiaXNQcmltYXJ5TW91c2VNb3ZlIiwibm9Nb2RpZmllcnMiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBQSxPQUFPLENBQUNDLFVBQVIsR0FBcUIsSUFBckI7QUFDQUQsT0FBTyxDQUFDRSxjQUFSLEdBQXlCQSxjQUF6QjtBQUNBRixPQUFPLENBQUNHLGlCQUFSLEdBQTRCQSxpQkFBNUI7QUFDQUgsT0FBTyxDQUFDSSx1QkFBUixHQUFrQ0EsdUJBQWxDO0FBQ0FKLE9BQU8sQ0FBQ0ssZ0JBQVIsR0FBMkJBLGdCQUEzQjtBQUNBTCxPQUFPLENBQUNNLGlCQUFSLEdBQTRCQSxpQkFBNUI7QUFDQU4sT0FBTyxDQUFDTyxvQkFBUixHQUErQkEsb0JBQS9COztBQUVBLElBQUlDLGlCQUFpQixHQUFHQyxzQkFBc0IsQ0FBQ0MsT0FBTyxrQ0FBUixDQUE5Qzs7QUFFQSxTQUFTRCxzQkFBVCxDQUFnQ0UsR0FBaEMsRUFBcUM7QUFBRSxTQUFPQSxHQUFHLElBQUlBLEdBQUcsQ0FBQ1YsVUFBWCxHQUF3QlUsR0FBeEIsR0FBOEI7QUFBRUMsSUFBQUEsT0FBTyxFQUFFRDtBQUFYLEdBQXJDO0FBQXdEOztBQVUvRixJQUFJRSxPQUFPLEdBQUcsb0JBQWQ7O0FBRUEsU0FBU0MsWUFBVCxDQUFzQkMsUUFBdEIsRUFBZ0M7QUFJOUIsTUFBSUEsUUFBUSxDQUFDQyxJQUFULEtBQWtCLGlCQUF0QixFQUF5QztBQUN2QyxRQUFJQyxNQUFNLEdBQUdDLE1BQU0sQ0FBQ0MsWUFBUCxHQUFzQkMsVUFBbkM7QUFDQSxXQUFPQyxvQkFBb0IsQ0FBQ0osTUFBRCxDQUEzQjtBQUNELEdBSEQsTUFHTztBQUNMLFFBQUlLLElBQUksR0FBR1AsUUFBUSxDQUFDUSxZQUFULElBQXlCLElBQXpCLEdBQWdDUixRQUFRLENBQUNRLFlBQVQsRUFBaEMsR0FBMERGLG9CQUFvQixDQUFDTixRQUFRLENBQUNFLE1BQVYsQ0FBekY7QUFDQSxXQUFPSyxJQUFQO0FBQ0Q7QUFDRjs7QUFFRCxTQUFTRCxvQkFBVCxDQUE4QkosTUFBOUIsRUFBc0M7QUFDcEMsTUFBSUssSUFBSSxHQUFHLEVBQVg7O0FBRUEsU0FBT0wsTUFBTSxJQUFJLElBQVYsSUFBa0JBLE1BQU0sS0FBS08sUUFBUSxDQUFDQyxJQUE3QyxFQUFtRDtBQUNqREgsSUFBQUEsSUFBSSxDQUFDSSxJQUFMLENBQVVULE1BQVY7QUFDQUEsSUFBQUEsTUFBTSxHQUFHQSxNQUFNLENBQUNVLFVBQWhCO0FBQ0Q7O0FBRUQsU0FBT0wsSUFBUDtBQUNEOztBQU1ELFNBQVNNLGNBQVQsQ0FBd0JDLElBQXhCLEVBQThCO0FBQzVCLE1BQUlBLElBQUksSUFBSSxJQUFaLEVBQWtCO0FBQ2hCLFdBQU9BLElBQUksQ0FBQ2hCLE9BQUQsQ0FBWDtBQUNEOztBQUVELFNBQU8sSUFBUDtBQUNEOztBQU1ELFNBQVNYLGNBQVQsQ0FBd0IyQixJQUF4QixFQUE4QkMsRUFBOUIsRUFBa0M7QUFDaEMsTUFBSUQsSUFBSSxJQUFJLElBQVosRUFBa0I7QUFDaEJBLElBQUFBLElBQUksQ0FBQ2hCLE9BQUQsQ0FBSixHQUFnQmlCLEVBQWhCO0FBQ0Q7QUFDRjs7QUFNRCxTQUFTM0IsaUJBQVQsQ0FBMkJZLFFBQTNCLEVBQXFDO0FBQ25DLE1BQUlnQixNQUFNLEdBQUcsRUFBYjtBQUNBLE1BQUlDLFFBQVEsR0FBRyxFQUFmO0FBQ0EsTUFBSUMsU0FBUyxHQUFHbkIsWUFBWSxDQUFDQyxRQUFELENBQTVCOztBQUVBLE9BQUssSUFBSW1CLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdELFNBQVMsQ0FBQ0UsTUFBOUIsRUFBc0NELENBQUMsRUFBdkMsRUFBMkM7QUFDekMsUUFBSUwsSUFBSSxHQUFHSSxTQUFTLENBQUNDLENBQUQsQ0FBcEI7QUFDQSxRQUFJSixFQUFFLEdBQUdGLGNBQWMsQ0FBQ0MsSUFBRCxDQUF2Qjs7QUFFQSxRQUFJQyxFQUFFLElBQUksSUFBVixFQUFnQjtBQUNkQyxNQUFBQSxNQUFNLENBQUNMLElBQVAsQ0FBWUksRUFBWjtBQUNBRSxNQUFBQSxRQUFRLENBQUNOLElBQVQsQ0FBY0csSUFBZDtBQUNEO0FBQ0Y7O0FBRUQsU0FBTztBQUNMRSxJQUFBQSxNQUFNLEVBQUVBLE1BREg7QUFFTEMsSUFBQUEsUUFBUSxFQUFFQTtBQUZMLEdBQVA7QUFJRDs7QUFNRCxTQUFTNUIsdUJBQVQsQ0FBaUNnQyxLQUFqQyxFQUF3Q0MsS0FBeEMsRUFBK0M7QUFDN0MsTUFBSUMsV0FBVyxHQUFHRixLQUFLLENBQUNELE1BQXhCO0FBQ0EsTUFBSUksV0FBVyxHQUFHRixLQUFLLENBQUNGLE1BQXhCOztBQUVBLE1BQ0FHLFdBQVcsS0FBSyxDQUFoQixJQUFxQkMsV0FBVyxLQUFLLENBQXJDLElBRUFILEtBQUssQ0FBQ0UsV0FBVyxHQUFHLENBQWYsQ0FBTCxLQUEyQkQsS0FBSyxDQUFDRSxXQUFXLEdBQUcsQ0FBZixDQUhoQyxFQUdtRDtBQUNqRCxXQUFPLElBQVA7QUFDRDs7QUFFRCxNQUFJQyxLQUFLLEdBQUdKLEtBQUssQ0FBQyxDQUFELENBQWpCO0FBQ0EsTUFBSUssTUFBTSxHQUFHLENBQWI7QUFDQSxNQUFJQyxLQUFLLEdBQUdMLEtBQUssQ0FBQyxDQUFELENBQWpCO0FBQ0EsTUFBSU0sTUFBTSxHQUFHLENBQWI7O0FBRUEsTUFBSUwsV0FBVyxHQUFHQyxXQUFkLEdBQTRCLENBQWhDLEVBQW1DO0FBQ2pDRSxJQUFBQSxNQUFNLEdBQUdILFdBQVcsR0FBR0MsV0FBdkI7QUFDQUMsSUFBQUEsS0FBSyxHQUFHSixLQUFLLENBQUNLLE1BQUQsQ0FBYjtBQUNBSCxJQUFBQSxXQUFXLEdBQUdDLFdBQWQ7QUFDRDs7QUFHRCxNQUFJQSxXQUFXLEdBQUdELFdBQWQsR0FBNEIsQ0FBaEMsRUFBbUM7QUFDakNLLElBQUFBLE1BQU0sR0FBR0osV0FBVyxHQUFHRCxXQUF2QjtBQUNBSSxJQUFBQSxLQUFLLEdBQUdMLEtBQUssQ0FBQ00sTUFBRCxDQUFiO0FBQ0FKLElBQUFBLFdBQVcsR0FBR0QsV0FBZDtBQUNEOztBQUdELE1BQUlNLEtBQUssR0FBR04sV0FBWjs7QUFFQSxTQUFPTSxLQUFLLEVBQVosRUFBZ0I7QUFDZCxRQUFJSixLQUFLLEtBQUtFLEtBQWQsRUFBcUI7QUFDbkIsYUFBT0YsS0FBUDtBQUNEOztBQUVEQSxJQUFBQSxLQUFLLEdBQUdKLEtBQUssQ0FBQ0ssTUFBTSxFQUFQLENBQWI7QUFDQUMsSUFBQUEsS0FBSyxHQUFHTCxLQUFLLENBQUNNLE1BQU0sRUFBUCxDQUFiO0FBQ0Q7O0FBRUQsU0FBTyxJQUFQO0FBQ0Q7O0FBT0QsU0FBU3RDLGdCQUFULENBQTBCWSxNQUExQixFQUFrQzRCLE9BQWxDLEVBQTJDO0FBQ3pDLE1BQUksQ0FBQ0EsT0FBRCxJQUFZQSxPQUFPLENBQUNWLE1BQVIsS0FBbUIsQ0FBbkMsRUFBc0M7QUFDcEMsV0FBTyxLQUFQO0FBQ0Q7O0FBRUQsT0FBSyxJQUFJRCxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHVyxPQUFPLENBQUNWLE1BQTVCLEVBQW9DRCxDQUFDLEVBQXJDLEVBQXlDO0FBQ3ZDLFFBQUlMLElBQUksR0FBR2dCLE9BQU8sQ0FBQ1gsQ0FBRCxDQUFQLENBQVdqQixNQUF0Qjs7QUFFQSxRQUFJWSxJQUFJLElBQUksSUFBWixFQUFrQjtBQUNoQixVQUFJWixNQUFNLENBQUM2QixRQUFQLENBQWdCakIsSUFBaEIsQ0FBSixFQUEyQjtBQUN6QixlQUFPLElBQVA7QUFDRDtBQUNGO0FBQ0Y7O0FBRUQsU0FBTyxLQUFQO0FBQ0Q7O0FBT0QsU0FBU3ZCLGlCQUFULENBQTJCUyxRQUEzQixFQUFxQztBQUNuQyxNQUFJQSxRQUFRLENBQUNDLElBQVQsS0FBa0IsaUJBQXRCLEVBQXlDO0FBQ3ZDLFdBQU8sQ0FBQyxHQUFHUixpQkFBaUIsQ0FBQ0ksT0FBdEIsR0FBUDtBQUNEOztBQUVELFNBQU9HLFFBQVEsQ0FBQ0MsSUFBVCxLQUFrQixRQUF6QjtBQUNEOztBQU1ELFNBQVNULG9CQUFULENBQThCUSxRQUE5QixFQUF3QztBQUN0QyxNQUFJZ0MsTUFBTSxHQUFHaEMsUUFBUSxDQUFDZ0MsTUFBdEI7QUFBQSxNQUNJQyxNQUFNLEdBQUdqQyxRQUFRLENBQUNpQyxNQUR0QjtBQUFBLE1BRUlDLE9BQU8sR0FBR2xDLFFBQVEsQ0FBQ2tDLE9BRnZCO0FBQUEsTUFHSUMsT0FBTyxHQUFHbkMsUUFBUSxDQUFDbUMsT0FIdkI7QUFBQSxNQUlJbEMsSUFBSSxHQUFHRCxRQUFRLENBQUNDLElBSnBCO0FBS0EsTUFBSW1DLE9BQU8sR0FBR25DLElBQUksS0FBSyxZQUFULElBQXlCQSxJQUFJLEtBQUssV0FBaEQ7QUFDQSxNQUFJb0Msa0JBQWtCLEdBQUdwQyxJQUFJLEtBQUssV0FBVCxLQUF5QmdDLE1BQU0sS0FBSyxDQUFYLElBQWdCQyxPQUFPLEtBQUssQ0FBckQsQ0FBekI7QUFDQSxNQUFJSSxrQkFBa0IsR0FBR3JDLElBQUksS0FBSyxXQUFULElBQXdCaUMsT0FBTyxLQUFLLENBQTdEO0FBQ0EsTUFBSUssV0FBVyxHQUFHUCxNQUFNLEtBQUssS0FBWCxJQUFvQkcsT0FBTyxLQUFLLEtBQWxEOztBQUVBLE1BQUlDLE9BQU8sSUFBSUMsa0JBQWtCLElBQUlFLFdBQWpDLElBQWdERCxrQkFBa0IsSUFBSUMsV0FBMUUsRUFBdUY7QUFDckYsV0FBTyxJQUFQO0FBQ0Q7O0FBRUQsU0FBTyxLQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuc2V0UmVzcG9uZGVySWQgPSBzZXRSZXNwb25kZXJJZDtcbmV4cG9ydHMuZ2V0UmVzcG9uZGVyUGF0aHMgPSBnZXRSZXNwb25kZXJQYXRocztcbmV4cG9ydHMuZ2V0TG93ZXN0Q29tbW9uQW5jZXN0b3IgPSBnZXRMb3dlc3RDb21tb25BbmNlc3RvcjtcbmV4cG9ydHMuaGFzVGFyZ2V0VG91Y2hlcyA9IGhhc1RhcmdldFRvdWNoZXM7XG5leHBvcnRzLmhhc1ZhbGlkU2VsZWN0aW9uID0gaGFzVmFsaWRTZWxlY3Rpb247XG5leHBvcnRzLmlzUHJpbWFyeVBvaW50ZXJEb3duID0gaXNQcmltYXJ5UG9pbnRlckRvd247XG5cbnZhciBfaXNTZWxlY3Rpb25WYWxpZCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4uLy4uL21vZHVsZXMvaXNTZWxlY3Rpb25WYWxpZFwiKSk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbi8qKlxuICogQ29weXJpZ2h0IChjKSBOaWNvbGFzIEdhbGxhZ2hlclxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIFxuICovXG52YXIga2V5TmFtZSA9ICdfX3JlYWN0UmVzcG9uZGVySWQnO1xuXG5mdW5jdGlvbiBnZXRFdmVudFBhdGgoZG9tRXZlbnQpIHtcbiAgLy8gVGhlICdzZWxlY3Rpb25jaGFuZ2UnIGV2ZW50IGFsd2F5cyBoYXMgdGhlICdkb2N1bWVudCcgYXMgdGhlIHRhcmdldC5cbiAgLy8gVXNlIHRoZSBhbmNob3Igbm9kZSBhcyB0aGUgaW5pdGlhbCB0YXJnZXQgdG8gcmVjb25zdHJ1Y3QgYSBwYXRoLlxuICAvLyAoV2UgYWN0dWFsbHkgb25seSBuZWVkIHRoZSBmaXJzdCBcInJlc3BvbmRlclwiIG5vZGUgaW4gcHJhY3RpY2UuKVxuICBpZiAoZG9tRXZlbnQudHlwZSA9PT0gJ3NlbGVjdGlvbmNoYW5nZScpIHtcbiAgICB2YXIgdGFyZ2V0ID0gd2luZG93LmdldFNlbGVjdGlvbigpLmFuY2hvck5vZGU7XG4gICAgcmV0dXJuIGNvbXBvc2VkUGF0aEZhbGxiYWNrKHRhcmdldCk7XG4gIH0gZWxzZSB7XG4gICAgdmFyIHBhdGggPSBkb21FdmVudC5jb21wb3NlZFBhdGggIT0gbnVsbCA/IGRvbUV2ZW50LmNvbXBvc2VkUGF0aCgpIDogY29tcG9zZWRQYXRoRmFsbGJhY2soZG9tRXZlbnQudGFyZ2V0KTtcbiAgICByZXR1cm4gcGF0aDtcbiAgfVxufVxuXG5mdW5jdGlvbiBjb21wb3NlZFBhdGhGYWxsYmFjayh0YXJnZXQpIHtcbiAgdmFyIHBhdGggPSBbXTtcblxuICB3aGlsZSAodGFyZ2V0ICE9IG51bGwgJiYgdGFyZ2V0ICE9PSBkb2N1bWVudC5ib2R5KSB7XG4gICAgcGF0aC5wdXNoKHRhcmdldCk7XG4gICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGU7XG4gIH1cblxuICByZXR1cm4gcGF0aDtcbn1cbi8qKlxuICogUmV0cmlldmUgdGhlIHJlc3BvbmRlcklkIGZyb20gYSBob3N0IG5vZGVcbiAqL1xuXG5cbmZ1bmN0aW9uIGdldFJlc3BvbmRlcklkKG5vZGUpIHtcbiAgaWYgKG5vZGUgIT0gbnVsbCkge1xuICAgIHJldHVybiBub2RlW2tleU5hbWVdO1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59XG4vKipcbiAqIFN0b3JlIHRoZSByZXNwb25kZXJJZCBvbiBhIGhvc3Qgbm9kZVxuICovXG5cblxuZnVuY3Rpb24gc2V0UmVzcG9uZGVySWQobm9kZSwgaWQpIHtcbiAgaWYgKG5vZGUgIT0gbnVsbCkge1xuICAgIG5vZGVba2V5TmFtZV0gPSBpZDtcbiAgfVxufVxuLyoqXG4gKiBGaWx0ZXIgdGhlIGV2ZW50IHBhdGggdG8gY29udGFpbiBvbmx5IHRoZSBub2RlcyBhdHRhY2hlZCB0byB0aGUgcmVzcG9uZGVyIHN5c3RlbVxuICovXG5cblxuZnVuY3Rpb24gZ2V0UmVzcG9uZGVyUGF0aHMoZG9tRXZlbnQpIHtcbiAgdmFyIGlkUGF0aCA9IFtdO1xuICB2YXIgbm9kZVBhdGggPSBbXTtcbiAgdmFyIGV2ZW50UGF0aCA9IGdldEV2ZW50UGF0aChkb21FdmVudCk7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBldmVudFBhdGgubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgbm9kZSA9IGV2ZW50UGF0aFtpXTtcbiAgICB2YXIgaWQgPSBnZXRSZXNwb25kZXJJZChub2RlKTtcblxuICAgIGlmIChpZCAhPSBudWxsKSB7XG4gICAgICBpZFBhdGgucHVzaChpZCk7XG4gICAgICBub2RlUGF0aC5wdXNoKG5vZGUpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaWRQYXRoOiBpZFBhdGgsXG4gICAgbm9kZVBhdGg6IG5vZGVQYXRoXG4gIH07XG59XG4vKipcbiAqIFdhbGsgdGhlIHBhdGhzIGFuZCBmaW5kIHRoZSBmaXJzdCBjb21tb24gYW5jZXN0b3JcbiAqL1xuXG5cbmZ1bmN0aW9uIGdldExvd2VzdENvbW1vbkFuY2VzdG9yKHBhdGhBLCBwYXRoQikge1xuICB2YXIgcGF0aEFMZW5ndGggPSBwYXRoQS5sZW5ndGg7XG4gIHZhciBwYXRoQkxlbmd0aCA9IHBhdGhCLmxlbmd0aDtcblxuICBpZiAoIC8vIElmIGVpdGhlciBwYXRoIGlzIGVtcHR5XG4gIHBhdGhBTGVuZ3RoID09PSAwIHx8IHBhdGhCTGVuZ3RoID09PSAwIHx8IC8vIElmIHRoZSBsYXN0IGVsZW1lbnRzIGFyZW4ndCB0aGUgc2FtZSB0aGVyZSBjYW4ndCBiZSBhIGNvbW1vbiBhbmNlc3RvclxuICAvLyB0aGF0IGlzIGNvbm5lY3RlZCB0byB0aGUgcmVzcG9uZGVyIHN5c3RlbVxuICBwYXRoQVtwYXRoQUxlbmd0aCAtIDFdICE9PSBwYXRoQltwYXRoQkxlbmd0aCAtIDFdKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICB2YXIgaXRlbUEgPSBwYXRoQVswXTtcbiAgdmFyIGluZGV4QSA9IDA7XG4gIHZhciBpdGVtQiA9IHBhdGhCWzBdO1xuICB2YXIgaW5kZXhCID0gMDsgLy8gSWYgQSBpcyBkZWVwZXIsIHNraXAgaW5kaWNlcyB0aGF0IGNhbid0IG1hdGNoLlxuXG4gIGlmIChwYXRoQUxlbmd0aCAtIHBhdGhCTGVuZ3RoID4gMCkge1xuICAgIGluZGV4QSA9IHBhdGhBTGVuZ3RoIC0gcGF0aEJMZW5ndGg7XG4gICAgaXRlbUEgPSBwYXRoQVtpbmRleEFdO1xuICAgIHBhdGhBTGVuZ3RoID0gcGF0aEJMZW5ndGg7XG4gIH0gLy8gSWYgQiBpcyBkZWVwZXIsIHNraXAgaW5kaWNlcyB0aGF0IGNhbid0IG1hdGNoXG5cblxuICBpZiAocGF0aEJMZW5ndGggLSBwYXRoQUxlbmd0aCA+IDApIHtcbiAgICBpbmRleEIgPSBwYXRoQkxlbmd0aCAtIHBhdGhBTGVuZ3RoO1xuICAgIGl0ZW1CID0gcGF0aEJbaW5kZXhCXTtcbiAgICBwYXRoQkxlbmd0aCA9IHBhdGhBTGVuZ3RoO1xuICB9IC8vIFdhbGsgaW4gbG9ja3N0ZXAgdW50aWwgYSBtYXRjaCBpcyBmb3VuZFxuXG5cbiAgdmFyIGRlcHRoID0gcGF0aEFMZW5ndGg7XG5cbiAgd2hpbGUgKGRlcHRoLS0pIHtcbiAgICBpZiAoaXRlbUEgPT09IGl0ZW1CKSB7XG4gICAgICByZXR1cm4gaXRlbUE7XG4gICAgfVxuXG4gICAgaXRlbUEgPSBwYXRoQVtpbmRleEErK107XG4gICAgaXRlbUIgPSBwYXRoQltpbmRleEIrK107XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn1cbi8qKlxuICogRGV0ZXJtaW5lIHdoZXRoZXIgYW55IG9mIHRoZSBhY3RpdmUgdG91Y2hlcyBhcmUgd2l0aGluIHRoZSBjdXJyZW50IHJlc3BvbmRlci5cbiAqIFRoaXMgY2Fubm90IHJlbHkgb24gVzNDIGB0YXJnZXRUb3VjaGVzYCwgYXMgbmVpdGhlciBJRTExIG5vciBTYWZhcmkgaW1wbGVtZW50IGl0LlxuICovXG5cblxuZnVuY3Rpb24gaGFzVGFyZ2V0VG91Y2hlcyh0YXJnZXQsIHRvdWNoZXMpIHtcbiAgaWYgKCF0b3VjaGVzIHx8IHRvdWNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b3VjaGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIG5vZGUgPSB0b3VjaGVzW2ldLnRhcmdldDtcblxuICAgIGlmIChub2RlICE9IG51bGwpIHtcbiAgICAgIGlmICh0YXJnZXQuY29udGFpbnMobm9kZSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufVxuLyoqXG4gKiBJZ25vcmUgJ3NlbGVjdGlvbmNoYW5nZScgZXZlbnRzIHRoYXQgZG9uJ3QgY29ycmVzcG9uZCB3aXRoIGEgcGVyc29uJ3MgaW50ZW50IHRvXG4gKiBzZWxlY3QgdGV4dC5cbiAqL1xuXG5cbmZ1bmN0aW9uIGhhc1ZhbGlkU2VsZWN0aW9uKGRvbUV2ZW50KSB7XG4gIGlmIChkb21FdmVudC50eXBlID09PSAnc2VsZWN0aW9uY2hhbmdlJykge1xuICAgIHJldHVybiAoMCwgX2lzU2VsZWN0aW9uVmFsaWQuZGVmYXVsdCkoKTtcbiAgfVxuXG4gIHJldHVybiBkb21FdmVudC50eXBlID09PSAnc2VsZWN0Jztcbn1cbi8qKlxuICogRXZlbnRzIGFyZSBvbmx5IHZhbGlkIGlmIHRoZSBwcmltYXJ5IGJ1dHRvbiB3YXMgdXNlZCB3aXRob3V0IHNwZWNpZmljIG1vZGlmaWVyIGtleXMuXG4gKi9cblxuXG5mdW5jdGlvbiBpc1ByaW1hcnlQb2ludGVyRG93bihkb21FdmVudCkge1xuICB2YXIgYWx0S2V5ID0gZG9tRXZlbnQuYWx0S2V5LFxuICAgICAgYnV0dG9uID0gZG9tRXZlbnQuYnV0dG9uLFxuICAgICAgYnV0dG9ucyA9IGRvbUV2ZW50LmJ1dHRvbnMsXG4gICAgICBjdHJsS2V5ID0gZG9tRXZlbnQuY3RybEtleSxcbiAgICAgIHR5cGUgPSBkb21FdmVudC50eXBlO1xuICB2YXIgaXNUb3VjaCA9IHR5cGUgPT09ICd0b3VjaHN0YXJ0JyB8fCB0eXBlID09PSAndG91Y2htb3ZlJztcbiAgdmFyIGlzUHJpbWFyeU1vdXNlRG93biA9IHR5cGUgPT09ICdtb3VzZWRvd24nICYmIChidXR0b24gPT09IDAgfHwgYnV0dG9ucyA9PT0gMSk7XG4gIHZhciBpc1ByaW1hcnlNb3VzZU1vdmUgPSB0eXBlID09PSAnbW91c2Vtb3ZlJyAmJiBidXR0b25zID09PSAxO1xuICB2YXIgbm9Nb2RpZmllcnMgPSBhbHRLZXkgPT09IGZhbHNlICYmIGN0cmxLZXkgPT09IGZhbHNlO1xuXG4gIGlmIChpc1RvdWNoIHx8IGlzUHJpbWFyeU1vdXNlRG93biAmJiBub01vZGlmaWVycyB8fCBpc1ByaW1hcnlNb3VzZU1vdmUgJiYgbm9Nb2RpZmllcnMpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn0iXX0=