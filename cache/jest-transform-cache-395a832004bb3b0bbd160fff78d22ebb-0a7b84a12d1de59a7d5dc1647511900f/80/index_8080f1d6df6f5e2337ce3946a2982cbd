49a48f8d7ccb998977b4517e8651366b
"use strict";

exports.__esModule = true;
exports.default = useResponderEvents;

var React = _interopRequireWildcard(require("react"));

var ResponderSystem = _interopRequireWildcard(require("./ResponderSystem"));

function _getRequireWildcardCache() {
  if (typeof WeakMap !== "function") return null;
  var cache = new WeakMap();

  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };

  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache();

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

var emptyObject = {};
var idCounter = 0;

function useStable(getInitialValue) {
  var ref = React.useRef(null);

  if (ref.current == null) {
    ref.current = getInitialValue();
  }

  return ref.current;
}

function useResponderEvents(hostRef, config) {
  if (config === void 0) {
    config = emptyObject;
  }

  var id = useStable(function () {
    return idCounter++;
  });
  var isAttachedRef = React.useRef(false);
  React.useEffect(function () {
    ResponderSystem.attachListeners();
    return function () {
      ResponderSystem.removeNode(id);
    };
  }, [id]);
  React.useEffect(function () {
    var _config = config,
        onMoveShouldSetResponder = _config.onMoveShouldSetResponder,
        onMoveShouldSetResponderCapture = _config.onMoveShouldSetResponderCapture,
        onScrollShouldSetResponder = _config.onScrollShouldSetResponder,
        onScrollShouldSetResponderCapture = _config.onScrollShouldSetResponderCapture,
        onSelectionChangeShouldSetResponder = _config.onSelectionChangeShouldSetResponder,
        onSelectionChangeShouldSetResponderCapture = _config.onSelectionChangeShouldSetResponderCapture,
        onStartShouldSetResponder = _config.onStartShouldSetResponder,
        onStartShouldSetResponderCapture = _config.onStartShouldSetResponderCapture;
    var requiresResponderSystem = onMoveShouldSetResponder != null || onMoveShouldSetResponderCapture != null || onScrollShouldSetResponder != null || onScrollShouldSetResponderCapture != null || onSelectionChangeShouldSetResponder != null || onSelectionChangeShouldSetResponderCapture != null || onStartShouldSetResponder != null || onStartShouldSetResponderCapture != null;
    var node = hostRef.current;

    if (requiresResponderSystem) {
      ResponderSystem.addNode(id, node, config);
      isAttachedRef.current = true;
    } else if (isAttachedRef.current) {
      ResponderSystem.removeNode(id);
      isAttachedRef.current = false;
    }
  }, [config, hostRef, id]);
  React.useDebugValue({
    isResponder: hostRef.current === ResponderSystem.getResponderNode()
  });
  React.useDebugValue(config);
}

module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsInVzZVJlc3BvbmRlckV2ZW50cyIsIlJlYWN0IiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJyZXF1aXJlIiwiUmVzcG9uZGVyU3lzdGVtIiwiX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlIiwiV2Vha01hcCIsImNhY2hlIiwib2JqIiwiaGFzIiwiZ2V0IiwibmV3T2JqIiwiaGFzUHJvcGVydHlEZXNjcmlwdG9yIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJrZXkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJkZXNjIiwic2V0IiwiZW1wdHlPYmplY3QiLCJpZENvdW50ZXIiLCJ1c2VTdGFibGUiLCJnZXRJbml0aWFsVmFsdWUiLCJyZWYiLCJ1c2VSZWYiLCJjdXJyZW50IiwiaG9zdFJlZiIsImNvbmZpZyIsImlkIiwiaXNBdHRhY2hlZFJlZiIsInVzZUVmZmVjdCIsImF0dGFjaExpc3RlbmVycyIsInJlbW92ZU5vZGUiLCJfY29uZmlnIiwib25Nb3ZlU2hvdWxkU2V0UmVzcG9uZGVyIiwib25Nb3ZlU2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZSIsIm9uU2Nyb2xsU2hvdWxkU2V0UmVzcG9uZGVyIiwib25TY3JvbGxTaG91bGRTZXRSZXNwb25kZXJDYXB0dXJlIiwib25TZWxlY3Rpb25DaGFuZ2VTaG91bGRTZXRSZXNwb25kZXIiLCJvblNlbGVjdGlvbkNoYW5nZVNob3VsZFNldFJlc3BvbmRlckNhcHR1cmUiLCJvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyIiwib25TdGFydFNob3VsZFNldFJlc3BvbmRlckNhcHR1cmUiLCJyZXF1aXJlc1Jlc3BvbmRlclN5c3RlbSIsIm5vZGUiLCJhZGROb2RlIiwidXNlRGVidWdWYWx1ZSIsImlzUmVzcG9uZGVyIiwiZ2V0UmVzcG9uZGVyTm9k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QUEwQixJQUFJLElBQTdHLElBQXFIQyxpQ0FBaUMsSUFBSSxJQUExSixJQUFrS0MsbUNBQW1DLElBQUksSUFBek0sSUFBaU5DLDBDQUEwQyxJQUFJLElBQS9QLElBQXVRQyx5QkFBeUIsSUFBSSxJQUFwUyxJQUE0U0MsZ0NBQWdDLElBQUksSUFBOVc7QUFDQSxRQUFJRSxJQUFJLEdBQUdqQixPQUFPLENBQUNELE9BQW5COztBQUVBLFFBQUlpQix1QkFBSixFQUE2QjtBQUMzQnpDLE1BQUFBLGVBQWUsQ0FBQzJDLE9BQWhCLENBQXdCaEIsRUFBeEIsRUFBNEJlLElBQTVCLEVBQWtDaEIsTUFBbEM7QUFDQUUsTUFBQUEsYUFBYSxDQUFDSixPQUFkLEdBQXdCLElBQXhCO0FBQ0QsS0FIRCxNQUdPLElBQUlJLGFBQWEsQ0FBQ0osT0FBbEIsRUFBMkI7QUFDaEN4QixNQUFBQSxlQUFlLENBQUMrQixVQUFoQixDQUEyQkosRUFBM0I7QUFDQUMsTUFBQUEsYUFBYSxDQUFDSixPQUFkLEdBQXdCLEtBQXhCO0FBQ0Q7QUFDRixHQXBCRCxFQW9CRyxDQUFDRSxNQUFELEVBQVNELE9BQVQsRUFBa0JFLEVBQWxCLENBcEJIO0FBcUJBOUIsRUFBQUEsS0FBSyxDQUFDK0MsYUFBTixDQUFvQjtBQUNsQkMsSUFBQUEsV0FBVyxFQUFFcEIsT0FBTyxDQUFDRCxPQUFSLEtBQW9CeEIsZUFBZSxDQUFDOEMsZ0JBQWhCO0FBRGYsR0FBcEI7QUFHQWpELEVBQUFBLEtBQUssQ0FBQytDLGFBQU4sQ0FBb0JsQixNQUFwQjtBQUNEOztBQUVEcUIsTUFBTSxDQUFDdEQsT0FBUCxHQUFpQkEsT0FBTyxDQUFDRSxPQUF6QiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0cy5kZWZhdWx0ID0gdXNlUmVzcG9uZGVyRXZlbnRzO1xuXG52YXIgUmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKFwicmVhY3RcIikpO1xuXG52YXIgUmVzcG9uZGVyU3lzdGVtID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZShcIi4vUmVzcG9uZGVyU3lzdGVtXCIpKTtcblxuZnVuY3Rpb24gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKCkgeyBpZiAodHlwZW9mIFdlYWtNYXAgIT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIG51bGw7IHZhciBjYWNoZSA9IG5ldyBXZWFrTWFwKCk7IF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSA9IGZ1bmN0aW9uIF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSgpIHsgcmV0dXJuIGNhY2hlOyB9OyByZXR1cm4gY2FjaGU7IH1cblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7IGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsgcmV0dXJuIG9iajsgfSBpZiAob2JqID09PSBudWxsIHx8IHR5cGVvZiBvYmogIT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIG9iaiAhPT0gXCJmdW5jdGlvblwiKSB7IHJldHVybiB7IGRlZmF1bHQ6IG9iaiB9OyB9IHZhciBjYWNoZSA9IF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSgpOyBpZiAoY2FjaGUgJiYgY2FjaGUuaGFzKG9iaikpIHsgcmV0dXJuIGNhY2hlLmdldChvYmopOyB9IHZhciBuZXdPYmogPSB7fTsgdmFyIGhhc1Byb3BlcnR5RGVzY3JpcHRvciA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gaGFzUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiBudWxsOyBpZiAoZGVzYyAmJiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7IH0gZWxzZSB7IG5ld09ialtrZXldID0gb2JqW2tleV07IH0gfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyBpZiAoY2FjaGUpIHsgY2FjaGUuc2V0KG9iaiwgbmV3T2JqKTsgfSByZXR1cm4gbmV3T2JqOyB9XG5cbi8qKlxuICogQ29weXJpZ2h0IChjKSBOaWNvbGFzIEdhbGxhZ2hlclxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIFxuICovXG5cbi8qKlxuICogSG9vayBmb3IgaW50ZWdyYXRpbmcgdGhlIFJlc3BvbmRlciBTeXN0ZW0gaW50byBSZWFjdFxuICpcbiAqICAgZnVuY3Rpb24gU29tZUNvbXBvbmVudCh7IG9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXIgfSkge1xuICogICAgIGNvbnN0IHJlZiA9IHVzZVJlZihudWxsKTtcbiAqICAgICB1c2VSZXNwb25kZXJFdmVudHMocmVmLCB7IG9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXIgfSk7XG4gKiAgICAgcmV0dXJuIDxkaXYgcmVmPXtyZWZ9IC8+XG4gKiAgIH1cbiAqL1xudmFyIGVtcHR5T2JqZWN0ID0ge307XG52YXIgaWRDb3VudGVyID0gMDtcblxuZnVuY3Rpb24gdXNlU3RhYmxlKGdldEluaXRpYWxWYWx1ZSkge1xuICB2YXIgcmVmID0gUmVhY3QudXNlUmVmKG51bGwpO1xuXG4gIGlmIChyZWYuY3VycmVudCA9PSBudWxsKSB7XG4gICAgcmVmLmN1cnJlbnQgPSBnZXRJbml0aWFsVmFsdWUoKTtcbiAgfVxuXG4gIHJldHVybiByZWYuY3VycmVudDtcbn1cblxuZnVuY3Rpb24gdXNlUmVzcG9uZGVyRXZlbnRzKGhvc3RSZWYsIGNvbmZpZykge1xuICBpZiAoY29uZmlnID09PSB2b2lkIDApIHtcbiAgICBjb25maWcgPSBlbXB0eU9iamVjdDtcbiAgfVxuXG4gIHZhciBpZCA9IHVzZVN0YWJsZShmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGlkQ291bnRlcisrO1xuICB9KTtcbiAgdmFyIGlzQXR0YWNoZWRSZWYgPSBSZWFjdC51c2VSZWYoZmFsc2UpOyAvLyBUaGlzIGlzIGEgc2VwYXJhdGUgZWZmZWN0cyBzbyBpdCBkb2Vzbid0IHJ1biB3aGVuIHRoZSBjb25maWcgY2hhbmdlcy5cbiAgLy8gT24gaW5pdGlhbCBtb3VudCwgYXR0YWNoIGdsb2JhbCBsaXN0ZW5lcnMgaWYgbmVlZGVkLlxuICAvLyBPbiB1bm1vdW50LCByZW1vdmUgbm9kZSBwb3RlbnRpYWxseSBhdHRhY2hlZCB0byB0aGUgUmVzcG9uZGVyIFN5c3RlbS5cblxuICBSZWFjdC51c2VFZmZlY3QoZnVuY3Rpb24gKCkge1xuICAgIFJlc3BvbmRlclN5c3RlbS5hdHRhY2hMaXN0ZW5lcnMoKTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgUmVzcG9uZGVyU3lzdGVtLnJlbW92ZU5vZGUoaWQpO1xuICAgIH07XG4gIH0sIFtpZF0pOyAvLyBSZWdpc3RlciBhbmQgdW5yZWdpc3RlciB3aXRoIHRoZSBSZXNwb25kZXIgU3lzdGVtIGFzIG5lY2Vzc2FyeVxuXG4gIFJlYWN0LnVzZUVmZmVjdChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIF9jb25maWcgPSBjb25maWcsXG4gICAgICAgIG9uTW92ZVNob3VsZFNldFJlc3BvbmRlciA9IF9jb25maWcub25Nb3ZlU2hvdWxkU2V0UmVzcG9uZGVyLFxuICAgICAgICBvbk1vdmVTaG91bGRTZXRSZXNwb25kZXJDYXB0dXJlID0gX2NvbmZpZy5vbk1vdmVTaG91bGRTZXRSZXNwb25kZXJDYXB0dXJlLFxuICAgICAgICBvblNjcm9sbFNob3VsZFNldFJlc3BvbmRlciA9IF9jb25maWcub25TY3JvbGxTaG91bGRTZXRSZXNwb25kZXIsXG4gICAgICAgIG9uU2Nyb2xsU2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZSA9IF9jb25maWcub25TY3JvbGxTaG91bGRTZXRSZXNwb25kZXJDYXB0dXJlLFxuICAgICAgICBvblNlbGVjdGlvbkNoYW5nZVNob3VsZFNldFJlc3BvbmRlciA9IF9jb25maWcub25TZWxlY3Rpb25DaGFuZ2VTaG91bGRTZXRSZXNwb25kZXIsXG4gICAgICAgIG9uU2VsZWN0aW9uQ2hhbmdlU2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZSA9IF9jb25maWcub25TZWxlY3Rpb25DaGFuZ2VTaG91bGRTZXRSZXNwb25kZXJDYXB0dXJlLFxuICAgICAgICBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyID0gX2NvbmZpZy5vblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyLFxuICAgICAgICBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZSA9IF9jb25maWcub25TdGFydFNob3VsZFNldFJlc3BvbmRlckNhcHR1cmU7XG4gICAgdmFyIHJlcXVpcmVzUmVzcG9uZGVyU3lzdGVtID0gb25Nb3ZlU2hvdWxkU2V0UmVzcG9uZGVyICE9IG51bGwgfHwgb25Nb3ZlU2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZSAhPSBudWxsIHx8IG9uU2Nyb2xsU2hvdWxkU2V0UmVzcG9uZGVyICE9IG51bGwgfHwgb25TY3JvbGxTaG91bGRTZXRSZXNwb25kZXJDYXB0dXJlICE9IG51bGwgfHwgb25TZWxlY3Rpb25DaGFuZ2VTaG91bGRTZXRSZXNwb25kZXIgIT0gbnVsbCB8fCBvblNlbGVjdGlvbkNoYW5nZVNob3VsZFNldFJlc3BvbmRlckNhcHR1cmUgIT0gbnVsbCB8fCBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyICE9IG51bGwgfHwgb25TdGFydFNob3VsZFNldFJlc3BvbmRlckNhcHR1cmUgIT0gbnVsbDtcbiAgICB2YXIgbm9kZSA9IGhvc3RSZWYuY3VycmVudDtcblxuICAgIGlmIChyZXF1aXJlc1Jlc3BvbmRlclN5c3RlbSkge1xuICAgICAgUmVzcG9uZGVyU3lzdGVtLmFkZE5vZGUoaWQsIG5vZGUsIGNvbmZpZyk7XG4gICAgICBpc0F0dGFjaGVkUmVmLmN1cnJlbnQgPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAoaXNBdHRhY2hlZFJlZi5jdXJyZW50KSB7XG4gICAgICBSZXNwb25kZXJTeXN0ZW0ucmVtb3ZlTm9kZShpZCk7XG4gICAgICBpc0F0dGFjaGVkUmVmLmN1cnJlbnQgPSBmYWxzZTtcbiAgICB9XG4gIH0sIFtjb25maWcsIGhvc3RSZWYsIGlkXSk7XG4gIFJlYWN0LnVzZURlYnVnVmFsdWUoe1xuICAgIGlzUmVzcG9uZGVyOiBob3N0UmVmLmN1cnJlbnQgPT09IFJlc3BvbmRlclN5c3RlbS5nZXRSZXNwb25kZXJOb2RlKClcbiAgfSk7XG4gIFJlYWN0LnVzZURlYnVnVmFsdWUoY29uZmlnKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzLmRlZmF1bHQ7Il19