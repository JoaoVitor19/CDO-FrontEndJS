944ae0025c20da80f045ca0a9f3d499f
"use strict";

exports.__esModule = true;
exports.default = void 0;

var _getBoundingClientRect = _interopRequireDefault(require("../../modules/getBoundingClientRect"));

var _setValueForStyles = _interopRequireDefault(require("../../modules/setValueForStyles"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

var getRect = function getRect(node) {
  var _getBoundingClientRec = (0, _getBoundingClientRect.default)(node),
      x = _getBoundingClientRec.x,
      y = _getBoundingClientRec.y,
      top = _getBoundingClientRec.top,
      left = _getBoundingClientRec.left;

  var width = node.offsetWidth;
  var height = node.offsetHeight;
  return {
    x: x,
    y: y,
    width: width,
    height: height,
    top: top,
    left: left
  };
};

var _measureLayout = function measureLayout(node, relativeToNativeNode, callback) {
  var relativeNode = relativeToNativeNode || node && node.parentNode;

  if (node && relativeNode) {
    setTimeout(function () {
      var relativeRect = (0, _getBoundingClientRect.default)(relativeNode);

      var _getRect = getRect(node),
          height = _getRect.height,
          left = _getRect.left,
          top = _getRect.top,
          width = _getRect.width;

      var x = left - relativeRect.left;
      var y = top - relativeRect.top;
      callback(x, y, width, height, left, top);
    }, 0);
  }
};

var focusableElements = {
  A: true,
  INPUT: true,
  SELECT: true,
  TEXTAREA: true
};
var UIManager = {
  blur: function blur(node) {
    try {
      node.blur();
    } catch (err) {}
  },
  focus: function focus(node) {
    try {
      var name = node.nodeName;

      if (node.getAttribute('tabIndex') == null && focusableElements[name] == null) {
        node.setAttribute('tabIndex', '-1');
      }

      node.focus();
    } catch (err) {}
  },
  measure: function measure(node, callback) {
    _measureLayout(node, null, callback);
  },
  measureInWindow: function measureInWindow(node, callback) {
    if (node) {
      setTimeout(function () {
        var _getRect2 = getRect(node),
            height = _getRect2.height,
            left = _getRect2.left,
            top = _getRect2.top,
            width = _getRect2.width;

        callback(left, top, width, height);
      }, 0);
    }
  },
  measureLayout: function measureLayout(node, relativeToNativeNode, onFail, onSuccess) {
    _measureLayout(node, relativeToNativeNode, onSuccess);
  },
  updateView: function updateView(node, props) {
    for (var prop in props) {
      if (!Object.prototype.hasOwnProperty.call(props, prop)) {
        continue;
      }

      var value = props[prop];

      switch (prop) {
        case 'style':
          {
            (0, _setValueForStyles.default)(node, value);
            break;
          }

        case 'class':
        case 'className':
          {
            node.setAttribute('class', value);
            break;
          }

        case 'text':
        case 'value':
          node.value = value;
          break;

        default:
          node.setAttribute(prop, value);
      }
    }
  },
  configureNextLayoutAnimation: function configureNextLayoutAnimation(config, onAnimationDidEnd) {
    onAnimationDidEnd();
  },
  setLayoutAnimationEnabledExperimental: function setLayoutAnimationEnabledExperimental() {}
};
var _default = UIManager;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9nZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9zZXRWYWx1ZUZvclN0eWxlcyIsIm9iaiIsImdldFJlY3QiLCJub2RlIiwiX2dldEJvdW5kaW5nQ2xpZW50UmVjIiwieCIsInkiLCJ0b3AiLCJsZWZ0Iiwid2lkdGgiLCJvZmZzZXRXaWR0aCIsImhlaWdodCIsIm9mZnNldEhlaWdodCIsIl9tZWFzdXJlTGF5b3V0IiwibWVhc3VyZUxheW91dCIsInJlbGF0aXZlVG9OYXRpdmVOb2RlIiwiY2FsbGJhY2siLCJyZWxhdGl2ZU5vZGUiLCJwYXJlbnROb2RlIiwic2V0VGltZW91dCIsInJlbGF0aXZlUmVjdCIsIl9nZXRSZWN0IiwiZm9jdXNhYmxlRWxlbWVudHMiLCJBIiwiSU5QVVQiLCJTRUxFQ1QiLCJURVhUQVJFQSIsIlVJTWFuYWdlciIsImJsdXIiLCJlcnIiLCJmb2N1cyIsIm5hbWUiLCJub2RlTmFtZSIsImdldEF0dHJpYnV0ZSIsInNldEF0dHJpYnV0ZSIsIm1lYXN1cmUiLCJtZWFzdXJlSW5XaW5kb3ciLCJfZ2V0UmVjdDIiLCJvbkZhaWwiLCJvblN1Y2Nlc3MiLCJ1cGRhdGVWaWV3IiwicHJvcHMiLCJwcm9wIiwiT2JqZWN0IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwidmFsdWUiLCJjb25maWd1cmVOZXh0TGF5b3V0QW5pbWF0aW9uIiwiY29uZmlnIiwib25BbmltYXRpb25EaWRFbmQiLCJzZXRMYXlvdXRBbmltYXRpb25FbmFibGVkRXhwZXJpbWVudGFsIiwiX2RlZmF1bHQiLCJtb2R1bGUiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBQSxPQUFPLENBQUNDLFVBQVIsR0FBcUIsSUFBckI7QUFDQUQsT0FBTyxDQUFDRSxPQUFSLEdBQWtCLEtBQUssQ0FBdkI7O0FBRUEs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LEVBQWlFO0FBQzdGQSxJQUFBQSxpQkFBaUI7QUFDbEIsR0F6RWE7QUEyRWRDLEVBQUFBLHFDQUFxQyxFQUFFLFNBQVNBLHFDQUFULEdBQWlELENBQUU7QUEzRTVFLENBQWhCO0FBNkVBLElBQUlDLFFBQVEsR0FBR3pCLFNBQWY7QUFDQWpDLE9BQU8sQ0FBQ0UsT0FBUixHQUFrQndELFFBQWxCO0FBQ0FDLE1BQU0sQ0FBQzNELE9BQVAsR0FBaUJBLE9BQU8sQ0FBQ0UsT0FBekIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDtcblxudmFyIF9nZXRCb3VuZGluZ0NsaWVudFJlY3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi8uLi9tb2R1bGVzL2dldEJvdW5kaW5nQ2xpZW50UmVjdFwiKSk7XG5cbnZhciBfc2V0VmFsdWVGb3JTdHlsZXMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi8uLi9tb2R1bGVzL3NldFZhbHVlRm9yU3R5bGVzXCIpKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuLyoqXG4gKiBDb3B5cmlnaHQgKGMpIE5pY29sYXMgR2FsbGFnaGVyLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIFxuICovXG52YXIgZ2V0UmVjdCA9IGZ1bmN0aW9uIGdldFJlY3Qobm9kZSkge1xuICAvLyBVbmxpa2UgdGhlIERPTSdzIGdldEJvdW5kaW5nQ2xpZW50UmVjdCwgUmVhY3QgTmF0aXZlIGxheW91dCBtZWFzdXJlbWVudHNcbiAgLy8gZm9yIFwiaGVpZ2h0XCIgYW5kIFwid2lkdGhcIiBpZ25vcmUgc2NhbGUgdHJhbnNmb3Jtcy5cbiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0NTU19PYmplY3RfTW9kZWwvRGV0ZXJtaW5pbmdfdGhlX2RpbWVuc2lvbnNfb2ZfZWxlbWVudHNcbiAgdmFyIF9nZXRCb3VuZGluZ0NsaWVudFJlYyA9ICgwLCBfZ2V0Qm91bmRpbmdDbGllbnRSZWN0LmRlZmF1bHQpKG5vZGUpLFxuICAgICAgeCA9IF9nZXRCb3VuZGluZ0NsaWVudFJlYy54LFxuICAgICAgeSA9IF9nZXRCb3VuZGluZ0NsaWVudFJlYy55LFxuICAgICAgdG9wID0gX2dldEJvdW5kaW5nQ2xpZW50UmVjLnRvcCxcbiAgICAgIGxlZnQgPSBfZ2V0Qm91bmRpbmdDbGllbnRSZWMubGVmdDtcblxuICB2YXIgd2lkdGggPSBub2RlLm9mZnNldFdpZHRoO1xuICB2YXIgaGVpZ2h0ID0gbm9kZS5vZmZzZXRIZWlnaHQ7XG4gIHJldHVybiB7XG4gICAgeDogeCxcbiAgICB5OiB5LFxuICAgIHdpZHRoOiB3aWR0aCxcbiAgICBoZWlnaHQ6IGhlaWdodCxcbiAgICB0b3A6IHRvcCxcbiAgICBsZWZ0OiBsZWZ0XG4gIH07XG59O1xuXG52YXIgX21lYXN1cmVMYXlvdXQgPSBmdW5jdGlvbiBtZWFzdXJlTGF5b3V0KG5vZGUsIHJlbGF0aXZlVG9OYXRpdmVOb2RlLCBjYWxsYmFjaykge1xuICB2YXIgcmVsYXRpdmVOb2RlID0gcmVsYXRpdmVUb05hdGl2ZU5vZGUgfHwgbm9kZSAmJiBub2RlLnBhcmVudE5vZGU7XG5cbiAgaWYgKG5vZGUgJiYgcmVsYXRpdmVOb2RlKSB7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgcmVsYXRpdmVSZWN0ID0gKDAsIF9nZXRCb3VuZGluZ0NsaWVudFJlY3QuZGVmYXVsdCkocmVsYXRpdmVOb2RlKTtcblxuICAgICAgdmFyIF9nZXRSZWN0ID0gZ2V0UmVjdChub2RlKSxcbiAgICAgICAgICBoZWlnaHQgPSBfZ2V0UmVjdC5oZWlnaHQsXG4gICAgICAgICAgbGVmdCA9IF9nZXRSZWN0LmxlZnQsXG4gICAgICAgICAgdG9wID0gX2dldFJlY3QudG9wLFxuICAgICAgICAgIHdpZHRoID0gX2dldFJlY3Qud2lkdGg7XG5cbiAgICAgIHZhciB4ID0gbGVmdCAtIHJlbGF0aXZlUmVjdC5sZWZ0O1xuICAgICAgdmFyIHkgPSB0b3AgLSByZWxhdGl2ZVJlY3QudG9wO1xuICAgICAgY2FsbGJhY2soeCwgeSwgd2lkdGgsIGhlaWdodCwgbGVmdCwgdG9wKTtcbiAgICB9LCAwKTtcbiAgfVxufTtcblxudmFyIGZvY3VzYWJsZUVsZW1lbnRzID0ge1xuICBBOiB0cnVlLFxuICBJTlBVVDogdHJ1ZSxcbiAgU0VMRUNUOiB0cnVlLFxuICBURVhUQVJFQTogdHJ1ZVxufTtcbnZhciBVSU1hbmFnZXIgPSB7XG4gIGJsdXI6IGZ1bmN0aW9uIGJsdXIobm9kZSkge1xuICAgIHRyeSB7XG4gICAgICBub2RlLmJsdXIoKTtcbiAgICB9IGNhdGNoIChlcnIpIHt9XG4gIH0sXG4gIGZvY3VzOiBmdW5jdGlvbiBmb2N1cyhub2RlKSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBuYW1lID0gbm9kZS5ub2RlTmFtZTsgLy8gQSB0YWJJbmRleCBvZiAtMSBhbGxvd3MgZWxlbWVudCB0byBiZSBwcm9ncmFtbWF0aWNhbGx5IGZvY3VzZWQgYnV0XG4gICAgICAvLyBwcmV2ZW50cyBrZXlib2FyZCBmb2N1cywgc28gd2UgZG9uJ3Qgd2FudCB0byBzZXQgdGhlIHZhbHVlIG9uIGVsZW1lbnRzXG4gICAgICAvLyB0aGF0IHN1cHBvcnQga2V5Ym9hcmQgZm9jdXMgYnkgZGVmYXVsdC5cblxuICAgICAgaWYgKG5vZGUuZ2V0QXR0cmlidXRlKCd0YWJJbmRleCcpID09IG51bGwgJiYgZm9jdXNhYmxlRWxlbWVudHNbbmFtZV0gPT0gbnVsbCkge1xuICAgICAgICBub2RlLnNldEF0dHJpYnV0ZSgndGFiSW5kZXgnLCAnLTEnKTtcbiAgICAgIH1cblxuICAgICAgbm9kZS5mb2N1cygpO1xuICAgIH0gY2F0Y2ggKGVycikge31cbiAgfSxcbiAgbWVhc3VyZTogZnVuY3Rpb24gbWVhc3VyZShub2RlLCBjYWxsYmFjaykge1xuICAgIF9tZWFzdXJlTGF5b3V0KG5vZGUsIG51bGwsIGNhbGxiYWNrKTtcbiAgfSxcbiAgbWVhc3VyZUluV2luZG93OiBmdW5jdGlvbiBtZWFzdXJlSW5XaW5kb3cobm9kZSwgY2FsbGJhY2spIHtcbiAgICBpZiAobm9kZSkge1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfZ2V0UmVjdDIgPSBnZXRSZWN0KG5vZGUpLFxuICAgICAgICAgICAgaGVpZ2h0ID0gX2dldFJlY3QyLmhlaWdodCxcbiAgICAgICAgICAgIGxlZnQgPSBfZ2V0UmVjdDIubGVmdCxcbiAgICAgICAgICAgIHRvcCA9IF9nZXRSZWN0Mi50b3AsXG4gICAgICAgICAgICB3aWR0aCA9IF9nZXRSZWN0Mi53aWR0aDtcblxuICAgICAgICBjYWxsYmFjayhsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgfSwgMCk7XG4gICAgfVxuICB9LFxuICBtZWFzdXJlTGF5b3V0OiBmdW5jdGlvbiBtZWFzdXJlTGF5b3V0KG5vZGUsIHJlbGF0aXZlVG9OYXRpdmVOb2RlLCBvbkZhaWwsIG9uU3VjY2Vzcykge1xuICAgIF9tZWFzdXJlTGF5b3V0KG5vZGUsIHJlbGF0aXZlVG9OYXRpdmVOb2RlLCBvblN1Y2Nlc3MpO1xuICB9LFxuICB1cGRhdGVWaWV3OiBmdW5jdGlvbiB1cGRhdGVWaWV3KG5vZGUsIHByb3BzKSB7XG4gICAgZm9yICh2YXIgcHJvcCBpbiBwcm9wcykge1xuICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocHJvcHMsIHByb3ApKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB2YXIgdmFsdWUgPSBwcm9wc1twcm9wXTtcblxuICAgICAgc3dpdGNoIChwcm9wKSB7XG4gICAgICAgIGNhc2UgJ3N0eWxlJzpcbiAgICAgICAgICB7XG4gICAgICAgICAgICAoMCwgX3NldFZhbHVlRm9yU3R5bGVzLmRlZmF1bHQpKG5vZGUsIHZhbHVlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cblxuICAgICAgICBjYXNlICdjbGFzcyc6XG4gICAgICAgIGNhc2UgJ2NsYXNzTmFtZSc6XG4gICAgICAgICAge1xuICAgICAgICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgdmFsdWUpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuXG4gICAgICAgIGNhc2UgJ3RleHQnOlxuICAgICAgICBjYXNlICd2YWx1ZSc6XG4gICAgICAgICAgLy8gbmF0aXZlIHBsYXRmb3JtcyB1c2UgYHRleHRgIHByb3AgdG8gcmVwbGFjZSB0ZXh0IGlucHV0IHZhbHVlXG4gICAgICAgICAgbm9kZS52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUocHJvcCwgdmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgY29uZmlndXJlTmV4dExheW91dEFuaW1hdGlvbjogZnVuY3Rpb24gY29uZmlndXJlTmV4dExheW91dEFuaW1hdGlvbihjb25maWcsIG9uQW5pbWF0aW9uRGlkRW5kKSB7XG4gICAgb25BbmltYXRpb25EaWRFbmQoKTtcbiAgfSxcbiAgLy8gbW9ja3NcbiAgc2V0TGF5b3V0QW5pbWF0aW9uRW5hYmxlZEV4cGVyaW1lbnRhbDogZnVuY3Rpb24gc2V0TGF5b3V0QW5pbWF0aW9uRW5hYmxlZEV4cGVyaW1lbnRhbCgpIHt9XG59O1xudmFyIF9kZWZhdWx0ID0gVUlNYW5hZ2VyO1xuZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHMuZGVmYXVsdDsiXX0=