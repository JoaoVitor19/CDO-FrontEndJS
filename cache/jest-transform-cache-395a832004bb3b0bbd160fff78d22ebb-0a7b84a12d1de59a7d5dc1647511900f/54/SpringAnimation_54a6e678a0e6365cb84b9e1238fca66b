7f743a55a3ae1e8b971cf4f35de423e9
'use strict';

exports.__esModule = true;
exports.default = void 0;

var _AnimatedValue = _interopRequireDefault(require("../nodes/AnimatedValue"));

var _AnimatedValueXY = _interopRequireDefault(require("../nodes/AnimatedValueXY"));

var _AnimatedInterpolation = _interopRequireDefault(require("../nodes/AnimatedInterpolation"));

var _Animation2 = _interopRequireDefault(require("./Animation"));

var _SpringConfig = _interopRequireDefault(require("../SpringConfig"));

var _invariant = _interopRequireDefault(require("fbjs/lib/invariant"));

var _NativeAnimatedHelper = require("../NativeAnimatedHelper");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _inheritsLoose(subClass, superClass) {
  subClass.prototype = Object.create(superClass.prototype);
  subClass.prototype.constructor = subClass;

  _setPrototypeOf(subClass, superClass);
}

function _setPrototypeOf(o, p) {
  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {
    o.__proto__ = p;
    return o;
  };

  return _setPrototypeOf(o, p);
}

var SpringAnimation = function (_Animation) {
  _inheritsLoose(SpringAnimation, _Animation);

  function SpringAnimation(config) {
    var _config$overshootClam, _config$restDisplacem, _config$restSpeedThre, _config$velocity, _config$velocity2, _config$delay, _config$isInteraction, _config$iterations;

    var _this;

    _this = _Animation.call(this) || this;
    _this._overshootClamping = (_config$overshootClam = config.overshootClamping) !== null && _config$overshootClam !== void 0 ? _config$overshootClam : false;
    _this._restDisplacementThreshold = (_config$restDisplacem = config.restDisplacementThreshold) !== null && _config$restDisplacem !== void 0 ? _config$restDisplacem : 0.001;
    _this._restSpeedThreshold = (_config$restSpeedThre = config.restSpeedThreshold) !== null && _config$restSpeedThre !== void 0 ? _config$restSpeedThre : 0.001;
    _this._initialVelocity = (_config$velocity = config.velocity) !== null && _config$velocity !== void 0 ? _config$velocity : 0;
    _this._lastVelocity = (_config$velocity2 = config.velocity) !== null && _config$velocity2 !== void 0 ? _config$velocity2 : 0;
    _this._toValue = config.toValue;
    _this._delay = (_config$delay = config.delay) !== null && _config$delay !== void 0 ? _config$delay : 0;
    _this._useNativeDriver = (0, _NativeAnimatedHelper.shouldUseNativeDriver)(config);
    _this.__isInteraction = (_config$isInteraction = config.isInteraction) !== null && _config$isInteraction !== void 0 ? _config$isInteraction : !_this._useNativeDriver;
    _this.__iterations = (_config$iterations = config.iterations) !== null && _config$iterations !== void 0 ? _config$iterations : 1;

    if (config.stiffness !== undefined || config.damping !== undefined || config.mass !== undefined) {
      var _config$stiffness, _config$damping, _config$mass;

      (0, _invariant.default)(config.bounciness === undefined && config.speed === undefined && config.tension === undefined && config.friction === undefined, 'You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one');
      _this._stiffness = (_config$stiffness = config.stiffness) !== null && _config$stiffness !== void 0 ? _config$stiffness : 100;
      _this._damping = (_config$damping = config.damping) !== null && _config$damping !== void 0 ? _config$damping : 10;
      _this._mass = (_config$mass = config.mass) !== null && _config$mass !== void 0 ? _config$mass : 1;
    } else if (config.bounciness !== undefined || config.speed !== undefined) {
      var _config$bounciness, _config$speed;

      (0, _invariant.default)(config.tension === undefined && config.friction === undefined && config.stiffness === undefined && config.damping === undefined && config.mass === undefined, 'You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one');

      var springConfig = _SpringConfig.default.fromBouncinessAndSpeed((_config$bounciness = config.bounciness) !== null && _config$bounciness !== void 0 ? _config$bounciness : 8, (_config$speed = config.speed) !== null && _config$speed !== void 0 ? _config$speed : 12);

      _this._stiffness = springConfig.stiffness;
      _this._damping = springConfig.damping;
      _this._mass = 1;
    } else {
      var _config$tension, _config$friction;

      var _springConfig = _SpringConfig.default.fromOrigamiTensionAndFriction((_config$tension = config.tension) !== null && _config$tension !== void 0 ? _config$tension : 40, (_config$friction = config.friction) !== null && _config$friction !== void 0 ? _config$friction : 7);

      _this._stiffness = _springConfig.stiffness;
      _this._damping = _springConfig.damping;
      _this._mass = 1;
    }

    (0, _invariant.default)(_this._stiffness > 0, 'Stiffness value must be greater than 0');
    (0, _invariant.default)(_this._damping > 0, 'Damping value must be greater than 0');
    (0, _invariant.default)(_this._mass > 0, 'Mass value must be greater than 0');
    return _this;
  }

  var _proto = SpringAnimation.prototype;

  _proto.__getNativeAnimationConfig = function __getNativeAnimationConfig() {
    var _this$_initialVelocit;

    return {
      type: 'spring',
      overshootClamping: this._overshootClamping,
      restDisplacementThreshold: this._restDisplacementThreshold,
      restSpeedThreshold: this._restSpeedThreshold,
      stiffness: this._stiffness,
      damping: this._damping,
      mass: this._mass,
      initialVelocity: (_this$_initialVelocit = this._initialVelocity) !== null && _this$_initialVelocit !== void 0 ? _this$_initialVelocit : this._lastVelocity,
      toValue: this._toValue,
      iterations: this.__iterations
    };
  };

  _proto.start = function start(fromValue, onUpdate, onEnd, previousAnimation, animatedValue) {
    var _this2 = this;

    this.__active = true;
    this._startPosition = fromValue;
    this._lastPosition = this._startPosition;
    this._onUpdate = onUpdate;
    this.__onEnd = onEnd;
    this._lastTime = Date.now();
    this._frameTime = 0.0;

    if (previousAnimation instanceof SpringAnimation) {
      var internalState = previousAnimation.getInternalState();
      this._lastPosition = internalState.lastPosition;
      this._lastVelocity = internalState.lastVelocity;
      this._initialVelocity = this._lastVelocity;
      this._lastTime = internalState.lastTime;
    }

    var start = function start() {
      if (_this2._useNativeDriver) {
        _this2.__startNativeAnimation(animatedValue);
      } else {
        _this2.onUpdate();
      }
    };

    if (this._delay) {
      this._timeout = setTimeout(start, this._delay);
    } else {
      start();
    }
  };

  _proto.getInternalState = function getInternalState() {
    return {
      lastPosition: this._lastPosition,
      lastVelocity: this._lastVelocity,
      lastTime: this._lastTime
    };
  };

  _proto.onUpdate = function onUpdate() {
    var MAX_STEPS = 64;
    var now = Date.now();

    if (now > this._lastTime + MAX_STEPS) {
      now = this._lastTime + MAX_STEPS;
    }

    var deltaTime = (now - this._lastTime) / 1000;
    this._frameTime += deltaTime;
    var c = this._damping;
    var m = this._mass;
    var k = this._stiffness;
    var v0 = -this._initialVelocity;
    var zeta = c / (2 * Math.sqrt(k * m));
    var omega0 = Math.sqrt(k / m);
    var omega1 = omega0 * Math.sqrt(1.0 - zeta * zeta);
    var x0 = this._toValue - this._startPosition;
    var position = 0.0;
    var velocity = 0.0;
    var t = this._frameTime;

    if (zeta < 1) {
      var envelope = Math.exp(-zeta * omega0 * t);
      position = this._toValue - envelope * ((v0 + zeta * omega0 * x0) / omega1 * Math.sin(omega1 * t) + x0 * Math.cos(omega1 * t));
      velocity = zeta * omega0 * envelope * (Math.sin(omega1 * t) * (v0 + zeta * omega0 * x0) / omega1 + x0 * Math.cos(omega1 * t)) - envelope * (Math.cos(omega1 * t) * (v0 + zeta * omega0 * x0) - omega1 * x0 * Math.sin(omega1 * t));
    } else {
      var _envelope = Math.exp(-omega0 * t);

      position = this._toValue - _envelope * (x0 + (v0 + omega0 * x0) * t);
      velocity = _envelope * (v0 * (t * omega0 - 1) + t * x0 * (omega0 * omega0));
    }

    this._lastTime = now;
    this._lastPosition = position;
    this._lastVelocity = velocity;

    this._onUpdate(position);

    if (!this.__active) {
      return;
    }

    var isOvershooting = false;

    if (this._overshootClamping && this._stiffness !== 0) {
      if (this._startPosition < this._toValue) {
        isOvershooting = position > this._toValue;
      } else {
        isOvershooting = position < this._toValue;
      }
    }

    var isVelocity = Math.abs(velocity) <= this._restSpeedThreshold;

    var isDisplacement = true;

    if (this._stiffness !== 0) {
      isDisplacement = Math.abs(this._toValue - position) <= this._restDisplacementThreshold;
    }

    if (isOvershooting || isVelocity && isDisplacement) {
      if (this._stiffness !== 0) {
        this._lastPosition = this._toValue;
        this._lastVelocity = 0;

        this._onUpdate(this._toValue);
      }

      this.__debouncedOnEnd({
        finished: true
      });

      return;
    }

    this._animationFrame = requestAnimationFrame(this.onUpdate.bind(this));
  };

  _proto.stop = function stop() {
    _Animation.prototype.stop.call(this);

    this.__active = false;
    clearTimeout(this._timeout);
    global.cancelAnimationFrame(this._animationFrame);

    this.__debouncedOnEnd({
      finished: false
    });
  };

  return SpringAnimation;
}(_Animation2.default);

var _default = SpringAnimation;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNwcmluZ0FuaW1hdGlvbi5qcyJdLCJuYW1lcyI6WyJleHBvcnRzIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfQW5pbWF0ZWRWYWx1ZSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX0FuaW1hdGVkVmFsdWVYWSIsIl9BbmltYXRlZEludGVycG9sYXRpb24iLCJfQW5pbWF0aW9uMiIsIl9TcHJpbmdDb25maWciLCJfaW52YXJpYW50IiwiX05hdGl2ZUFuaW1hdGVkSGVscGVyIiwib2JqIiwiX2luaGVyaXRzTG9vc2UiLCJzdWJDbGFzcyIsInN1cGVyQ2xhc3MiLCJwcm90b3R5cGUiLCJPYmplY3QiLCJjcmVhdGUiLCJjb25zdHJ1Y3RvciIsIl9zZXRQcm90b3R5cGVPZiIsIm8iLCJwIiwic2V0UHJvdG90eXBlT2YiLCJfX3Byb3RvX18iLCJTcHJpbmdBbmltYXRpb24iLCJfQW5pbWF0aW9uIiwiY29uZmlnIiwiX2NvbmZpZyRvdmVyc2hvb3RDbGFtIiwiX2NvbmZpZyRyZXN0RGlzcGxhY2VtIiwiX2NvbmZpZyRyZXN0U3BlZWRUaHJlIiwiX2NvbmZpZyR2ZWxvY2l0eSIsIl9jb25maWckdmVsb2NpdHkyIiwiX2NvbmZpZyRkZWxheSIsIl9jb25maWckaXNJbnRlcmFjdGlvbiIsIl9jb25maWckaXRlcmF0aW9ucyIsIl90aGlzIiwiY2FsbCIsIl9vdmVyc2hvb3RDbGFtcGluZyIsIm92ZXJzaG9vdENsYW1waW5nIiwiX3Jlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQiLCJyZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkIiwiX3Jlc3RTcGVlZFRocmVzaG9sZCIsInJlc3RTcGVlZFRocmVzaG9sZCIsIl9pbml0aWFsVmVsb2NpdHkiLCJ2ZWxvY2l0eSIsIl9sYXN0VmVsb2NpdHkiLCJfdG9WYWx1ZSIsInRvVmFsdWUiLCJfZGVsYXkiLCJkZWxheSIsIl91c2VOYXRpdmVEcml2ZXIiLCJzaG91bGRVc2VOYXRpdmVEcml2ZXIiLCJfX2lzSW50ZXJhY3Rpb24iLCJpc0ludGVyYWN0aW9uIiwiX19pdGVyYXRpb25zIiwiaXRlcmF0aW9ucyIsInN0aWZmbmVzcyIsInVuZGVmaW5lZCIsImRhbXBpbmciLCJtYXNzIiwiX2NvbmZpZyRzdGlmZm5lc3MiLCJfY29uZmlnJGRhbXBpbmciLCJfY29uZmlnJG1hc3MiLCJib3VuY2luZXNzIiwic3BlZWQiLCJ0ZW5zaW9uIiwiZnJpY3Rpb24iLCJfc3RpZmZuZXNzIiwiX2RhbXBpbmciLCJfbWFzcyIsIl9jb25maWckYm91bmNpbmVzcyIsIl9jb25maWckc3BlZWQiLCJzcHJpbmdDb25maWciLCJmcm9tQm91bmNpbmVzc0FuZFNwZWVkIiwiX2NvbmZpZyR0ZW5zaW9uIiwiX2NvbmZpZyRmcmljdGlvbiIsIl9zcHJpbmdDb25maWciLCJmcm9tT3JpZ2FtaVRlbnNpb25BbmRGcmljdGlvbiIsIl9wcm90byIsIl9fZ2V0TmF0aXZlQW5pbWF0aW9uQ29uZmlnIiwiX3RoaXMkX2luaXRpYWxWZWxvY2l0IiwidHlwZSIsImluaXRpYWxWZWxvY2l0eSIsInN0YXJ0IiwiZnJvbVZhbHVlIiwib25VcGRhdGUiLCJvbkVuZCIsInByZXZpb3VzQW5pbWF0aW9uIiwiYW5pbWF0ZWRWYWx1ZSIsIl90aGlzMiIsIl9fYWN0aXZlIiwiX3N0YXJ0UG9zaXRpb24iLCJfbGFzdFBvc2l0aW9uIiwiX29uVXBkYXRlIiwiX19vbkVuZCIsIl9sYXN0VGltZSIsIkRhdGUiLCJub3ciLCJfZnJhbWVUaW1lIiwiaW50ZXJuYWxTdGF0ZSIsImdldEludGVybmFsU3RhdGUiLCJsYXN0UG9zaXRpb24iLCJsYXN0VmVsb2NpdHkiLCJsYXN0VGltZSIsIl9fc3RhcnROYXRpdmVBbmltYXRpb24iLCJfdGltZW91dCIsInNldFRpbWVvdXQiLCJNQVhfU1RFUFMiLCJkZWx0YVRpbWUiLCJjIiwibSIsImsiLCJ2MCIsInpldGEiLCJNYXRoIiwic3FydCIsIm9tZWdhMCIsIm9tZWdhMSIsIngwIiwicG9zaXRpb24iLCJ0IiwiZW52ZWxvcGUiLCJleHAiLCJzaW4iLCJjb3MiLCJfZW52ZWxvcGUiLCJpc092ZXJzaG9vdGluZyIsImlzVmVsb2NpdHkiLCJhYnMiLCJpc0Rpc3BsYWNlbWVudCIsIl9fZGVib3VuY2VkT25FbmQiLCJmaW5pc2hlZCIsIl9hbmltYXRpb25GcmFtZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImJpbmQiLCJzdG9wIiwiY2xlYXJUaW1lb3V0IiwiZ2xvYmFsIiwiY2FuY2VsQW5pbWF0aW9uRnJhbWUiLCJfZGVmYXVsdCIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6IkFBU0E7O0FBRUFBLE9BQU8sQ0FBQ0MsVUFBUixHQUFxQixJQUFyQjtBQUNBRCxPQUFPLENBQUNFLE9BQVIsR0FBa0IsS0FBSyxDQUF2Qjs7QUFFQSxJQUFJQyxjQUFjLEdBQUdDLHNCQUFzQixDQUFDQyxPQUFPLDBCQUFSLENBQTNDOztBQUVBLElBQUlDLGdCQUFnQixHQUFHRixzQkFBc0IsQ0FBQ0MsT0FBTyw0QkFBUixDQUE3Qzs7QUFFQSxJQUFJRSxzQkFBc0IsR0FBR0gsc0JBQXNCLENBQUNDLE9BQU8sa0NBQVIsQ0FBbkQ7O0FBRUEsSUFBSUcsV0FBVyxHQUFHSixzQkFBc0IsQ0FBQ0MsT0FBTyxlQUFSLENBQXhDOztBQUVBLElBQUlJLGFBQWEsR0FBR0wsc0JBQXNCLENBQUNDLE9BQU8sbUJBQVIsQ0FBMUM7O0FBRUEsSUFBSUssVUFBVSxHQUFHTixzQkFBc0IsQ0FBQ0MsT0FBTyxDQUFDLG9CQUFELENBQVIsQ0FBdkM7O0FBRUEsSUFBSU0scUJBQXFCLEdBQUdOLE9BQU8sMkJBQW5DOztBQUVBLFNBQVNELHNCQUFULENBQWdDUSxHQUFoQyxFQUFxQztBQUFFLFNBQU9BLEdBQUcsSUFBSUEsR0FBRyxDQUFDWCxVQUFYLEdBQXdCVyxHQUF4QixHQUE4QjtBQUFFVixJQUFBQSxPQUFPLEVBQUVVO0FBQVgsR0FBckM7QUFBd0Q7O0FBRS9GLFNBQVNDLGNBQVQsQ0FBd0JDLFFBQXhCLEVBQWtDQyxVQUFsQyxFQUE4QztBQUFFRCxFQUFBQSxRQUFRLENBQUNFLFNB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RkF4RCxFQUFBQSxNQUFNLENBQUN5RCxJQUFQLEdBQWMsU0FBU0EsSUFBVCxHQUFnQjtBQUM1QjlHLElBQUFBLFVBQVUsQ0FBQ1YsU0FBWCxDQUFxQndILElBQXJCLENBQTBCbkcsSUFBMUIsQ0FBK0IsSUFBL0I7O0FBRUEsU0FBS3NELFFBQUwsR0FBZ0IsS0FBaEI7QUFDQThDLElBQUFBLFlBQVksQ0FBQyxLQUFLL0IsUUFBTixDQUFaO0FBQ0FnQyxJQUFBQSxNQUFNLENBQUNDLG9CQUFQLENBQTRCLEtBQUtOLGVBQWpDOztBQUVBLFNBQUtGLGdCQUFMLENBQXNCO0FBQ3BCQyxNQUFBQSxRQUFRLEVBQUU7QUFEVSxLQUF0QjtBQUdELEdBVkQ7O0FBWUEsU0FBTzNHLGVBQVA7QUFDRCxDQXpQa0MsQ0F5UGpDakIsV0FBVyxDQUFDTixPQXpQcUIsQ0FBbkM7O0FBMlBBLElBQUkwSSxRQUFRLEdBQUduSCxlQUFmO0FBQ0F6QixPQUFPLENBQUNFLE9BQVIsR0FBa0IwSSxRQUFsQjtBQUNBQyxNQUFNLENBQUM3SSxPQUFQLEdBQWlCQSxPQUFPLENBQUNFLE9BQXpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBcbiAqIEBmb3JtYXRcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwO1xuXG52YXIgX0FuaW1hdGVkVmFsdWUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi9ub2Rlcy9BbmltYXRlZFZhbHVlXCIpKTtcblxudmFyIF9BbmltYXRlZFZhbHVlWFkgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi9ub2Rlcy9BbmltYXRlZFZhbHVlWFlcIikpO1xuXG52YXIgX0FuaW1hdGVkSW50ZXJwb2xhdGlvbiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4uL25vZGVzL0FuaW1hdGVkSW50ZXJwb2xhdGlvblwiKSk7XG5cbnZhciBfQW5pbWF0aW9uMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vQW5pbWF0aW9uXCIpKTtcblxudmFyIF9TcHJpbmdDb25maWcgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi9TcHJpbmdDb25maWdcIikpO1xuXG52YXIgX2ludmFyaWFudCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcImZianMvbGliL2ludmFyaWFudFwiKSk7XG5cbnZhciBfTmF0aXZlQW5pbWF0ZWRIZWxwZXIgPSByZXF1aXJlKFwiLi4vTmF0aXZlQW5pbWF0ZWRIZWxwZXJcIik7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9pbmhlcml0c0xvb3NlKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcy5wcm90b3R5cGUpOyBzdWJDbGFzcy5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBzdWJDbGFzczsgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsgfVxuXG5mdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfVxuXG52YXIgU3ByaW5nQW5pbWF0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQW5pbWF0aW9uKSB7XG4gIF9pbmhlcml0c0xvb3NlKFNwcmluZ0FuaW1hdGlvbiwgX0FuaW1hdGlvbik7XG5cbiAgZnVuY3Rpb24gU3ByaW5nQW5pbWF0aW9uKGNvbmZpZykge1xuICAgIHZhciBfY29uZmlnJG92ZXJzaG9vdENsYW0sIF9jb25maWckcmVzdERpc3BsYWNlbSwgX2NvbmZpZyRyZXN0U3BlZWRUaHJlLCBfY29uZmlnJHZlbG9jaXR5LCBfY29uZmlnJHZlbG9jaXR5MiwgX2NvbmZpZyRkZWxheSwgX2NvbmZpZyRpc0ludGVyYWN0aW9uLCBfY29uZmlnJGl0ZXJhdGlvbnM7XG5cbiAgICB2YXIgX3RoaXM7XG5cbiAgICBfdGhpcyA9IF9BbmltYXRpb24uY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgIF90aGlzLl9vdmVyc2hvb3RDbGFtcGluZyA9IChfY29uZmlnJG92ZXJzaG9vdENsYW0gPSBjb25maWcub3ZlcnNob290Q2xhbXBpbmcpICE9PSBudWxsICYmIF9jb25maWckb3ZlcnNob290Q2xhbSAhPT0gdm9pZCAwID8gX2NvbmZpZyRvdmVyc2hvb3RDbGFtIDogZmFsc2U7XG4gICAgX3RoaXMuX3Jlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQgPSAoX2NvbmZpZyRyZXN0RGlzcGxhY2VtID0gY29uZmlnLnJlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQpICE9PSBudWxsICYmIF9jb25maWckcmVzdERpc3BsYWNlbSAhPT0gdm9pZCAwID8gX2NvbmZpZyRyZXN0RGlzcGxhY2VtIDogMC4wMDE7XG4gICAgX3RoaXMuX3Jlc3RTcGVlZFRocmVzaG9sZCA9IChfY29uZmlnJHJlc3RTcGVlZFRocmUgPSBjb25maWcucmVzdFNwZWVkVGhyZXNob2xkKSAhPT0gbnVsbCAmJiBfY29uZmlnJHJlc3RTcGVlZFRocmUgIT09IHZvaWQgMCA/IF9jb25maWckcmVzdFNwZWVkVGhyZSA6IDAuMDAxO1xuICAgIF90aGlzLl9pbml0aWFsVmVsb2NpdHkgPSAoX2NvbmZpZyR2ZWxvY2l0eSA9IGNvbmZpZy52ZWxvY2l0eSkgIT09IG51bGwgJiYgX2NvbmZpZyR2ZWxvY2l0eSAhPT0gdm9pZCAwID8gX2NvbmZpZyR2ZWxvY2l0eSA6IDA7XG4gICAgX3RoaXMuX2xhc3RWZWxvY2l0eSA9IChfY29uZmlnJHZlbG9jaXR5MiA9IGNvbmZpZy52ZWxvY2l0eSkgIT09IG51bGwgJiYgX2NvbmZpZyR2ZWxvY2l0eTIgIT09IHZvaWQgMCA/IF9jb25maWckdmVsb2NpdHkyIDogMDtcbiAgICBfdGhpcy5fdG9WYWx1ZSA9IGNvbmZpZy50b1ZhbHVlO1xuICAgIF90aGlzLl9kZWxheSA9IChfY29uZmlnJGRlbGF5ID0gY29uZmlnLmRlbGF5KSAhPT0gbnVsbCAmJiBfY29uZmlnJGRlbGF5ICE9PSB2b2lkIDAgPyBfY29uZmlnJGRlbGF5IDogMDtcbiAgICBfdGhpcy5fdXNlTmF0aXZlRHJpdmVyID0gKDAsIF9OYXRpdmVBbmltYXRlZEhlbHBlci5zaG91bGRVc2VOYXRpdmVEcml2ZXIpKGNvbmZpZyk7XG4gICAgX3RoaXMuX19pc0ludGVyYWN0aW9uID0gKF9jb25maWckaXNJbnRlcmFjdGlvbiA9IGNvbmZpZy5pc0ludGVyYWN0aW9uKSAhPT0gbnVsbCAmJiBfY29uZmlnJGlzSW50ZXJhY3Rpb24gIT09IHZvaWQgMCA/IF9jb25maWckaXNJbnRlcmFjdGlvbiA6ICFfdGhpcy5fdXNlTmF0aXZlRHJpdmVyO1xuICAgIF90aGlzLl9faXRlcmF0aW9ucyA9IChfY29uZmlnJGl0ZXJhdGlvbnMgPSBjb25maWcuaXRlcmF0aW9ucykgIT09IG51bGwgJiYgX2NvbmZpZyRpdGVyYXRpb25zICE9PSB2b2lkIDAgPyBfY29uZmlnJGl0ZXJhdGlvbnMgOiAxO1xuXG4gICAgaWYgKGNvbmZpZy5zdGlmZm5lc3MgIT09IHVuZGVmaW5lZCB8fCBjb25maWcuZGFtcGluZyAhPT0gdW5kZWZpbmVkIHx8IGNvbmZpZy5tYXNzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHZhciBfY29uZmlnJHN0aWZmbmVzcywgX2NvbmZpZyRkYW1waW5nLCBfY29uZmlnJG1hc3M7XG5cbiAgICAgICgwLCBfaW52YXJpYW50LmRlZmF1bHQpKGNvbmZpZy5ib3VuY2luZXNzID09PSB1bmRlZmluZWQgJiYgY29uZmlnLnNwZWVkID09PSB1bmRlZmluZWQgJiYgY29uZmlnLnRlbnNpb24gPT09IHVuZGVmaW5lZCAmJiBjb25maWcuZnJpY3Rpb24gPT09IHVuZGVmaW5lZCwgJ1lvdSBjYW4gZGVmaW5lIG9uZSBvZiBib3VuY2luZXNzL3NwZWVkLCB0ZW5zaW9uL2ZyaWN0aW9uLCBvciBzdGlmZm5lc3MvZGFtcGluZy9tYXNzLCBidXQgbm90IG1vcmUgdGhhbiBvbmUnKTtcbiAgICAgIF90aGlzLl9zdGlmZm5lc3MgPSAoX2NvbmZpZyRzdGlmZm5lc3MgPSBjb25maWcuc3RpZmZuZXNzKSAhPT0gbnVsbCAmJiBfY29uZmlnJHN0aWZmbmVzcyAhPT0gdm9pZCAwID8gX2NvbmZpZyRzdGlmZm5lc3MgOiAxMDA7XG4gICAgICBfdGhpcy5fZGFtcGluZyA9IChfY29uZmlnJGRhbXBpbmcgPSBjb25maWcuZGFtcGluZykgIT09IG51bGwgJiYgX2NvbmZpZyRkYW1waW5nICE9PSB2b2lkIDAgPyBfY29uZmlnJGRhbXBpbmcgOiAxMDtcbiAgICAgIF90aGlzLl9tYXNzID0gKF9jb25maWckbWFzcyA9IGNvbmZpZy5tYXNzKSAhPT0gbnVsbCAmJiBfY29uZmlnJG1hc3MgIT09IHZvaWQgMCA/IF9jb25maWckbWFzcyA6IDE7XG4gICAgfSBlbHNlIGlmIChjb25maWcuYm91bmNpbmVzcyAhPT0gdW5kZWZpbmVkIHx8IGNvbmZpZy5zcGVlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB2YXIgX2NvbmZpZyRib3VuY2luZXNzLCBfY29uZmlnJHNwZWVkO1xuXG4gICAgICAvLyBDb252ZXJ0IHRoZSBvcmlnYW1pIGJvdW5jaW5lc3Mvc3BlZWQgdmFsdWVzIHRvIHN0aWZmbmVzcy9kYW1waW5nXG4gICAgICAvLyBXZSBhc3N1bWUgbWFzcyBpcyAxLlxuICAgICAgKDAsIF9pbnZhcmlhbnQuZGVmYXVsdCkoY29uZmlnLnRlbnNpb24gPT09IHVuZGVmaW5lZCAmJiBjb25maWcuZnJpY3Rpb24gPT09IHVuZGVmaW5lZCAmJiBjb25maWcuc3RpZmZuZXNzID09PSB1bmRlZmluZWQgJiYgY29uZmlnLmRhbXBpbmcgPT09IHVuZGVmaW5lZCAmJiBjb25maWcubWFzcyA9PT0gdW5kZWZpbmVkLCAnWW91IGNhbiBkZWZpbmUgb25lIG9mIGJvdW5jaW5lc3Mvc3BlZWQsIHRlbnNpb24vZnJpY3Rpb24sIG9yIHN0aWZmbmVzcy9kYW1waW5nL21hc3MsIGJ1dCBub3QgbW9yZSB0aGFuIG9uZScpO1xuXG4gICAgICB2YXIgc3ByaW5nQ29uZmlnID0gX1NwcmluZ0NvbmZpZy5kZWZhdWx0LmZyb21Cb3VuY2luZXNzQW5kU3BlZWQoKF9jb25maWckYm91bmNpbmVzcyA9IGNvbmZpZy5ib3VuY2luZXNzKSAhPT0gbnVsbCAmJiBfY29uZmlnJGJvdW5jaW5lc3MgIT09IHZvaWQgMCA/IF9jb25maWckYm91bmNpbmVzcyA6IDgsIChfY29uZmlnJHNwZWVkID0gY29uZmlnLnNwZWVkKSAhPT0gbnVsbCAmJiBfY29uZmlnJHNwZWVkICE9PSB2b2lkIDAgPyBfY29uZmlnJHNwZWVkIDogMTIpO1xuXG4gICAgICBfdGhpcy5fc3RpZmZuZXNzID0gc3ByaW5nQ29uZmlnLnN0aWZmbmVzcztcbiAgICAgIF90aGlzLl9kYW1waW5nID0gc3ByaW5nQ29uZmlnLmRhbXBpbmc7XG4gICAgICBfdGhpcy5fbWFzcyA9IDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBfY29uZmlnJHRlbnNpb24sIF9jb25maWckZnJpY3Rpb247XG5cbiAgICAgIC8vIENvbnZlcnQgdGhlIG9yaWdhbWkgdGVuc2lvbi9mcmljdGlvbiB2YWx1ZXMgdG8gc3RpZmZuZXNzL2RhbXBpbmdcbiAgICAgIC8vIFdlIGFzc3VtZSBtYXNzIGlzIDEuXG4gICAgICB2YXIgX3NwcmluZ0NvbmZpZyA9IF9TcHJpbmdDb25maWcuZGVmYXVsdC5mcm9tT3JpZ2FtaVRlbnNpb25BbmRGcmljdGlvbigoX2NvbmZpZyR0ZW5zaW9uID0gY29uZmlnLnRlbnNpb24pICE9PSBudWxsICYmIF9jb25maWckdGVuc2lvbiAhPT0gdm9pZCAwID8gX2NvbmZpZyR0ZW5zaW9uIDogNDAsIChfY29uZmlnJGZyaWN0aW9uID0gY29uZmlnLmZyaWN0aW9uKSAhPT0gbnVsbCAmJiBfY29uZmlnJGZyaWN0aW9uICE9PSB2b2lkIDAgPyBfY29uZmlnJGZyaWN0aW9uIDogNyk7XG5cbiAgICAgIF90aGlzLl9zdGlmZm5lc3MgPSBfc3ByaW5nQ29uZmlnLnN0aWZmbmVzcztcbiAgICAgIF90aGlzLl9kYW1waW5nID0gX3NwcmluZ0NvbmZpZy5kYW1waW5nO1xuICAgICAgX3RoaXMuX21hc3MgPSAxO1xuICAgIH1cblxuICAgICgwLCBfaW52YXJpYW50LmRlZmF1bHQpKF90aGlzLl9zdGlmZm5lc3MgPiAwLCAnU3RpZmZuZXNzIHZhbHVlIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAnKTtcbiAgICAoMCwgX2ludmFyaWFudC5kZWZhdWx0KShfdGhpcy5fZGFtcGluZyA+IDAsICdEYW1waW5nIHZhbHVlIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAnKTtcbiAgICAoMCwgX2ludmFyaWFudC5kZWZhdWx0KShfdGhpcy5fbWFzcyA+IDAsICdNYXNzIHZhbHVlIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAnKTtcbiAgICByZXR1cm4gX3RoaXM7XG4gIH1cblxuICB2YXIgX3Byb3RvID0gU3ByaW5nQW5pbWF0aW9uLnByb3RvdHlwZTtcblxuICBfcHJvdG8uX19nZXROYXRpdmVBbmltYXRpb25Db25maWcgPSBmdW5jdGlvbiBfX2dldE5hdGl2ZUFuaW1hdGlvbkNvbmZpZygpIHtcbiAgICB2YXIgX3RoaXMkX2luaXRpYWxWZWxvY2l0O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdzcHJpbmcnLFxuICAgICAgb3ZlcnNob290Q2xhbXBpbmc6IHRoaXMuX292ZXJzaG9vdENsYW1waW5nLFxuICAgICAgcmVzdERpc3BsYWNlbWVudFRocmVzaG9sZDogdGhpcy5fcmVzdERpc3BsYWNlbWVudFRocmVzaG9sZCxcbiAgICAgIHJlc3RTcGVlZFRocmVzaG9sZDogdGhpcy5fcmVzdFNwZWVkVGhyZXNob2xkLFxuICAgICAgc3RpZmZuZXNzOiB0aGlzLl9zdGlmZm5lc3MsXG4gICAgICBkYW1waW5nOiB0aGlzLl9kYW1waW5nLFxuICAgICAgbWFzczogdGhpcy5fbWFzcyxcbiAgICAgIGluaXRpYWxWZWxvY2l0eTogKF90aGlzJF9pbml0aWFsVmVsb2NpdCA9IHRoaXMuX2luaXRpYWxWZWxvY2l0eSkgIT09IG51bGwgJiYgX3RoaXMkX2luaXRpYWxWZWxvY2l0ICE9PSB2b2lkIDAgPyBfdGhpcyRfaW5pdGlhbFZlbG9jaXQgOiB0aGlzLl9sYXN0VmVsb2NpdHksXG4gICAgICB0b1ZhbHVlOiB0aGlzLl90b1ZhbHVlLFxuICAgICAgaXRlcmF0aW9uczogdGhpcy5fX2l0ZXJhdGlvbnNcbiAgICB9O1xuICB9O1xuXG4gIF9wcm90by5zdGFydCA9IGZ1bmN0aW9uIHN0YXJ0KGZyb21WYWx1ZSwgb25VcGRhdGUsIG9uRW5kLCBwcmV2aW91c0FuaW1hdGlvbiwgYW5pbWF0ZWRWYWx1ZSkge1xuICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgdGhpcy5fX2FjdGl2ZSA9IHRydWU7XG4gICAgdGhpcy5fc3RhcnRQb3NpdGlvbiA9IGZyb21WYWx1ZTtcbiAgICB0aGlzLl9sYXN0UG9zaXRpb24gPSB0aGlzLl9zdGFydFBvc2l0aW9uO1xuICAgIHRoaXMuX29uVXBkYXRlID0gb25VcGRhdGU7XG4gICAgdGhpcy5fX29uRW5kID0gb25FbmQ7XG4gICAgdGhpcy5fbGFzdFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIHRoaXMuX2ZyYW1lVGltZSA9IDAuMDtcblxuICAgIGlmIChwcmV2aW91c0FuaW1hdGlvbiBpbnN0YW5jZW9mIFNwcmluZ0FuaW1hdGlvbikge1xuICAgICAgdmFyIGludGVybmFsU3RhdGUgPSBwcmV2aW91c0FuaW1hdGlvbi5nZXRJbnRlcm5hbFN0YXRlKCk7XG4gICAgICB0aGlzLl9sYXN0UG9zaXRpb24gPSBpbnRlcm5hbFN0YXRlLmxhc3RQb3NpdGlvbjtcbiAgICAgIHRoaXMuX2xhc3RWZWxvY2l0eSA9IGludGVybmFsU3RhdGUubGFzdFZlbG9jaXR5OyAvLyBTZXQgdGhlIGluaXRpYWwgdmVsb2NpdHkgdG8gdGhlIGxhc3QgdmVsb2NpdHlcblxuICAgICAgdGhpcy5faW5pdGlhbFZlbG9jaXR5ID0gdGhpcy5fbGFzdFZlbG9jaXR5O1xuICAgICAgdGhpcy5fbGFzdFRpbWUgPSBpbnRlcm5hbFN0YXRlLmxhc3RUaW1lO1xuICAgIH1cblxuICAgIHZhciBzdGFydCA9IGZ1bmN0aW9uIHN0YXJ0KCkge1xuICAgICAgaWYgKF90aGlzMi5fdXNlTmF0aXZlRHJpdmVyKSB7XG4gICAgICAgIF90aGlzMi5fX3N0YXJ0TmF0aXZlQW5pbWF0aW9uKGFuaW1hdGVkVmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX3RoaXMyLm9uVXBkYXRlKCk7XG4gICAgICB9XG4gICAgfTsgLy8gIElmIHRoaXMuX2RlbGF5IGlzIG1vcmUgdGhhbiAwLCB3ZSBzdGFydCBhZnRlciB0aGUgdGltZW91dC5cblxuXG4gICAgaWYgKHRoaXMuX2RlbGF5KSB7XG4gICAgICB0aGlzLl90aW1lb3V0ID0gc2V0VGltZW91dChzdGFydCwgdGhpcy5fZGVsYXkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdGFydCgpO1xuICAgIH1cbiAgfTtcblxuICBfcHJvdG8uZ2V0SW50ZXJuYWxTdGF0ZSA9IGZ1bmN0aW9uIGdldEludGVybmFsU3RhdGUoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxhc3RQb3NpdGlvbjogdGhpcy5fbGFzdFBvc2l0aW9uLFxuICAgICAgbGFzdFZlbG9jaXR5OiB0aGlzLl9sYXN0VmVsb2NpdHksXG4gICAgICBsYXN0VGltZTogdGhpcy5fbGFzdFRpbWVcbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBUaGlzIHNwcmluZyBtb2RlbCBpcyBiYXNlZCBvZmYgb2YgYSBkYW1wZWQgaGFybW9uaWMgb3NjaWxsYXRvclxuICAgKiAoaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSGFybW9uaWNfb3NjaWxsYXRvciNEYW1wZWRfaGFybW9uaWNfb3NjaWxsYXRvcikuXG4gICAqXG4gICAqIFdlIHVzZSB0aGUgY2xvc2VkIGZvcm0gb2YgdGhlIHNlY29uZCBvcmRlciBkaWZmZXJlbnRpYWwgZXF1YXRpb246XG4gICAqXG4gICAqIHgnJyArICgyzrbijbVfMCl4JyArIOKNtV4yeCA9IDBcbiAgICpcbiAgICogd2hlcmVcbiAgICogICAg4o21XzAgPSDiiJooayAvIG0pICh1bmRhbXBlZCBhbmd1bGFyIGZyZXF1ZW5jeSBvZiB0aGUgb3NjaWxsYXRvciksXG4gICAqICAgIM62ID0gYyAvIDLiiJptayAoZGFtcGluZyByYXRpbyksXG4gICAqICAgIGMgPSBkYW1waW5nIGNvbnN0YW50XG4gICAqICAgIGsgPSBzdGlmZm5lc3NcbiAgICogICAgbSA9IG1hc3NcbiAgICpcbiAgICogVGhlIGRlcml2YXRpb24gb2YgdGhlIGNsb3NlZCBmb3JtIGlzIGRlc2NyaWJlZCBpbiBkZXRhaWwgaGVyZTpcbiAgICogaHR0cDovL3BsYW5ldG1hdGgub3JnL3NpdGVzL2RlZmF1bHQvZmlsZXMvdGV4cGRmLzM5NzQ1LnBkZlxuICAgKlxuICAgKiBUaGlzIGFsZ29yaXRobSBoYXBwZW5zIHRvIG1hdGNoIHRoZSBhbGdvcml0aG0gdXNlZCBieSBDQVNwcmluZ0FuaW1hdGlvbixcbiAgICogYSBRdWFydHpDb3JlIChpT1MpIEFQSSB0aGF0IGNyZWF0ZXMgc3ByaW5nIGFuaW1hdGlvbnMuXG4gICAqL1xuICA7XG5cbiAgX3Byb3RvLm9uVXBkYXRlID0gZnVuY3Rpb24gb25VcGRhdGUoKSB7XG4gICAgLy8gSWYgZm9yIHNvbWUgcmVhc29uIHdlIGxvc3QgYSBsb3Qgb2YgZnJhbWVzIChlLmcuIHByb2Nlc3MgbGFyZ2UgcGF5bG9hZCBvclxuICAgIC8vIHN0b3BwZWQgaW4gdGhlIGRlYnVnZ2VyKSwgd2Ugb25seSBhZHZhbmNlIGJ5IDQgZnJhbWVzIHdvcnRoIG9mXG4gICAgLy8gY29tcHV0YXRpb24gYW5kIHdpbGwgY29udGludWUgb24gdGhlIG5leHQgZnJhbWUuIEl0J3MgYmV0dGVyIHRvIGhhdmUgaXRcbiAgICAvLyBydW5uaW5nIGF0IGZhc3RlciBzcGVlZCB0aGFuIGp1bXBpbmcgdG8gdGhlIGVuZC5cbiAgICB2YXIgTUFYX1NURVBTID0gNjQ7XG4gICAgdmFyIG5vdyA9IERhdGUubm93KCk7XG5cbiAgICBpZiAobm93ID4gdGhpcy5fbGFzdFRpbWUgKyBNQVhfU1RFUFMpIHtcbiAgICAgIG5vdyA9IHRoaXMuX2xhc3RUaW1lICsgTUFYX1NURVBTO1xuICAgIH1cblxuICAgIHZhciBkZWx0YVRpbWUgPSAobm93IC0gdGhpcy5fbGFzdFRpbWUpIC8gMTAwMDtcbiAgICB0aGlzLl9mcmFtZVRpbWUgKz0gZGVsdGFUaW1lO1xuICAgIHZhciBjID0gdGhpcy5fZGFtcGluZztcbiAgICB2YXIgbSA9IHRoaXMuX21hc3M7XG4gICAgdmFyIGsgPSB0aGlzLl9zdGlmZm5lc3M7XG4gICAgdmFyIHYwID0gLXRoaXMuX2luaXRpYWxWZWxvY2l0eTtcbiAgICB2YXIgemV0YSA9IGMgLyAoMiAqIE1hdGguc3FydChrICogbSkpOyAvLyBkYW1waW5nIHJhdGlvXG5cbiAgICB2YXIgb21lZ2EwID0gTWF0aC5zcXJ0KGsgLyBtKTsgLy8gdW5kYW1wZWQgYW5ndWxhciBmcmVxdWVuY3kgb2YgdGhlIG9zY2lsbGF0b3IgKHJhZC9tcylcblxuICAgIHZhciBvbWVnYTEgPSBvbWVnYTAgKiBNYXRoLnNxcnQoMS4wIC0gemV0YSAqIHpldGEpOyAvLyBleHBvbmVudGlhbCBkZWNheVxuXG4gICAgdmFyIHgwID0gdGhpcy5fdG9WYWx1ZSAtIHRoaXMuX3N0YXJ0UG9zaXRpb247IC8vIGNhbGN1bGF0ZSB0aGUgb3NjaWxsYXRpb24gZnJvbSB4MCA9IDEgdG8geCA9IDBcblxuICAgIHZhciBwb3NpdGlvbiA9IDAuMDtcbiAgICB2YXIgdmVsb2NpdHkgPSAwLjA7XG4gICAgdmFyIHQgPSB0aGlzLl9mcmFtZVRpbWU7XG5cbiAgICBpZiAoemV0YSA8IDEpIHtcbiAgICAgIC8vIFVuZGVyIGRhbXBlZFxuICAgICAgdmFyIGVudmVsb3BlID0gTWF0aC5leHAoLXpldGEgKiBvbWVnYTAgKiB0KTtcbiAgICAgIHBvc2l0aW9uID0gdGhpcy5fdG9WYWx1ZSAtIGVudmVsb3BlICogKCh2MCArIHpldGEgKiBvbWVnYTAgKiB4MCkgLyBvbWVnYTEgKiBNYXRoLnNpbihvbWVnYTEgKiB0KSArIHgwICogTWF0aC5jb3Mob21lZ2ExICogdCkpOyAvLyBUaGlzIGxvb2tzIGNyYXp5IC0tIGl0J3MgYWN0dWFsbHkganVzdCB0aGUgZGVyaXZhdGl2ZSBvZiB0aGVcbiAgICAgIC8vIG9zY2lsbGF0aW9uIGZ1bmN0aW9uXG5cbiAgICAgIHZlbG9jaXR5ID0gemV0YSAqIG9tZWdhMCAqIGVudmVsb3BlICogKE1hdGguc2luKG9tZWdhMSAqIHQpICogKHYwICsgemV0YSAqIG9tZWdhMCAqIHgwKSAvIG9tZWdhMSArIHgwICogTWF0aC5jb3Mob21lZ2ExICogdCkpIC0gZW52ZWxvcGUgKiAoTWF0aC5jb3Mob21lZ2ExICogdCkgKiAodjAgKyB6ZXRhICogb21lZ2EwICogeDApIC0gb21lZ2ExICogeDAgKiBNYXRoLnNpbihvbWVnYTEgKiB0KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIENyaXRpY2FsbHkgZGFtcGVkXG4gICAgICB2YXIgX2VudmVsb3BlID0gTWF0aC5leHAoLW9tZWdhMCAqIHQpO1xuXG4gICAgICBwb3NpdGlvbiA9IHRoaXMuX3RvVmFsdWUgLSBfZW52ZWxvcGUgKiAoeDAgKyAodjAgKyBvbWVnYTAgKiB4MCkgKiB0KTtcbiAgICAgIHZlbG9jaXR5ID0gX2VudmVsb3BlICogKHYwICogKHQgKiBvbWVnYTAgLSAxKSArIHQgKiB4MCAqIChvbWVnYTAgKiBvbWVnYTApKTtcbiAgICB9XG5cbiAgICB0aGlzLl9sYXN0VGltZSA9IG5vdztcbiAgICB0aGlzLl9sYXN0UG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICB0aGlzLl9sYXN0VmVsb2NpdHkgPSB2ZWxvY2l0eTtcblxuICAgIHRoaXMuX29uVXBkYXRlKHBvc2l0aW9uKTtcblxuICAgIGlmICghdGhpcy5fX2FjdGl2ZSkge1xuICAgICAgLy8gYSBsaXN0ZW5lciBtaWdodCBoYXZlIHN0b3BwZWQgdXMgaW4gX29uVXBkYXRlXG4gICAgICByZXR1cm47XG4gICAgfSAvLyBDb25kaXRpb25zIGZvciBzdG9wcGluZyB0aGUgc3ByaW5nIGFuaW1hdGlvblxuXG5cbiAgICB2YXIgaXNPdmVyc2hvb3RpbmcgPSBmYWxzZTtcblxuICAgIGlmICh0aGlzLl9vdmVyc2hvb3RDbGFtcGluZyAmJiB0aGlzLl9zdGlmZm5lc3MgIT09IDApIHtcbiAgICAgIGlmICh0aGlzLl9zdGFydFBvc2l0aW9uIDwgdGhpcy5fdG9WYWx1ZSkge1xuICAgICAgICBpc092ZXJzaG9vdGluZyA9IHBvc2l0aW9uID4gdGhpcy5fdG9WYWx1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlzT3ZlcnNob290aW5nID0gcG9zaXRpb24gPCB0aGlzLl90b1ZhbHVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBpc1ZlbG9jaXR5ID0gTWF0aC5hYnModmVsb2NpdHkpIDw9IHRoaXMuX3Jlc3RTcGVlZFRocmVzaG9sZDtcblxuICAgIHZhciBpc0Rpc3BsYWNlbWVudCA9IHRydWU7XG5cbiAgICBpZiAodGhpcy5fc3RpZmZuZXNzICE9PSAwKSB7XG4gICAgICBpc0Rpc3BsYWNlbWVudCA9IE1hdGguYWJzKHRoaXMuX3RvVmFsdWUgLSBwb3NpdGlvbikgPD0gdGhpcy5fcmVzdERpc3BsYWNlbWVudFRocmVzaG9sZDtcbiAgICB9XG5cbiAgICBpZiAoaXNPdmVyc2hvb3RpbmcgfHwgaXNWZWxvY2l0eSAmJiBpc0Rpc3BsYWNlbWVudCkge1xuICAgICAgaWYgKHRoaXMuX3N0aWZmbmVzcyAhPT0gMCkge1xuICAgICAgICAvLyBFbnN1cmUgdGhhdCB3ZSBlbmQgdXAgd2l0aCBhIHJvdW5kIHZhbHVlXG4gICAgICAgIHRoaXMuX2xhc3RQb3NpdGlvbiA9IHRoaXMuX3RvVmFsdWU7XG4gICAgICAgIHRoaXMuX2xhc3RWZWxvY2l0eSA9IDA7XG5cbiAgICAgICAgdGhpcy5fb25VcGRhdGUodGhpcy5fdG9WYWx1ZSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX19kZWJvdW5jZWRPbkVuZCh7XG4gICAgICAgIGZpbmlzaGVkOiB0cnVlXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX2FuaW1hdGlvbkZyYW1lID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMub25VcGRhdGUuYmluZCh0aGlzKSk7XG4gIH07XG5cbiAgX3Byb3RvLnN0b3AgPSBmdW5jdGlvbiBzdG9wKCkge1xuICAgIF9BbmltYXRpb24ucHJvdG90eXBlLnN0b3AuY2FsbCh0aGlzKTtcblxuICAgIHRoaXMuX19hY3RpdmUgPSBmYWxzZTtcbiAgICBjbGVhclRpbWVvdXQodGhpcy5fdGltZW91dCk7XG4gICAgZ2xvYmFsLmNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuX2FuaW1hdGlvbkZyYW1lKTtcblxuICAgIHRoaXMuX19kZWJvdW5jZWRPbkVuZCh7XG4gICAgICBmaW5pc2hlZDogZmFsc2VcbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4gU3ByaW5nQW5pbWF0aW9uO1xufShfQW5pbWF0aW9uMi5kZWZhdWx0KTtcblxudmFyIF9kZWZhdWx0ID0gU3ByaW5nQW5pbWF0aW9uO1xuZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHMuZGVmYXVsdDsiXX0=