876e7d0f84cd2d8973bef9162e9f34c7
'use strict';

exports.__esModule = true;
exports.default = void 0;

var _AnimatedNode = _interopRequireDefault(require("./AnimatedNode"));

var _AnimatedWithChildren2 = _interopRequireDefault(require("./AnimatedWithChildren"));

var _NativeAnimatedHelper = _interopRequireDefault(require("../NativeAnimatedHelper"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _inheritsLoose(subClass, superClass) {
  subClass.prototype = Object.create(superClass.prototype);
  subClass.prototype.constructor = subClass;

  _setPrototypeOf(subClass, superClass);
}

function _setPrototypeOf(o, p) {
  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {
    o.__proto__ = p;
    return o;
  };

  return _setPrototypeOf(o, p);
}

var AnimatedTransform = function (_AnimatedWithChildren) {
  _inheritsLoose(AnimatedTransform, _AnimatedWithChildren);

  function AnimatedTransform(transforms) {
    var _this;

    _this = _AnimatedWithChildren.call(this) || this;
    _this._transforms = transforms;
    return _this;
  }

  var _proto = AnimatedTransform.prototype;

  _proto.__makeNative = function __makeNative() {
    this._transforms.forEach(function (transform) {
      for (var key in transform) {
        var value = transform[key];

        if (value instanceof _AnimatedNode.default) {
          value.__makeNative();
        }
      }
    });

    _AnimatedWithChildren.prototype.__makeNative.call(this);
  };

  _proto.__getValue = function __getValue() {
    return this._transforms.map(function (transform) {
      var result = {};

      for (var key in transform) {
        var value = transform[key];

        if (value instanceof _AnimatedNode.default) {
          result[key] = value.__getValue();
        } else {
          result[key] = value;
        }
      }

      return result;
    });
  };

  _proto.__getAnimatedValue = function __getAnimatedValue() {
    return this._transforms.map(function (transform) {
      var result = {};

      for (var key in transform) {
        var value = transform[key];

        if (value instanceof _AnimatedNode.default) {
          result[key] = value.__getAnimatedValue();
        } else {
          result[key] = value;
        }
      }

      return result;
    });
  };

  _proto.__attach = function __attach() {
    var _this2 = this;

    this._transforms.forEach(function (transform) {
      for (var key in transform) {
        var value = transform[key];

        if (value instanceof _AnimatedNode.default) {
          value.__addChild(_this2);
        }
      }
    });
  };

  _proto.__detach = function __detach() {
    var _this3 = this;

    this._transforms.forEach(function (transform) {
      for (var key in transform) {
        var value = transform[key];

        if (value instanceof _AnimatedNode.default) {
          value.__removeChild(_this3);
        }
      }
    });

    _AnimatedWithChildren.prototype.__detach.call(this);
  };

  _proto.__getNativeConfig = function __getNativeConfig() {
    var transConfigs = [];

    this._transforms.forEach(function (transform) {
      for (var key in transform) {
        var value = transform[key];

        if (value instanceof _AnimatedNode.default) {
          transConfigs.push({
            type: 'animated',
            property: key,
            nodeTag: value.__getNativeTag()
          });
        } else {
          transConfigs.push({
            type: 'static',
            property: key,
            value: _NativeAnimatedHelper.default.transformDataType(value)
          });
        }
      }
    });

    _NativeAnimatedHelper.default.validateTransform(transConfigs);

    return {
      type: 'transform',
      transforms: transConfigs
    };
  };

  return AnimatedTransform;
}(_AnimatedWithChildren2.default);

var _default = AnimatedTransform;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuaW1hdGVkVHJhbnNmb3JtLmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9BbmltYXRlZE5vZGUiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9BbmltYXRlZFdpdGhDaGlsZHJlbjIiLCJfTmF0aXZlQW5pbWF0ZWRIZWxwZXIiLCJvYmoiLCJfaW5oZXJpdHNMb29zZSIsInN1YkNsYXNzIiwic3VwZXJDbGFzcyIsInByb3RvdHlwZSIsIk9iamVjdCIsImNyZWF0ZSIsImNvbnN0cnVjdG9yIiwiX3NldFByb3RvdHlwZU9mIiwibyIsInAiLCJzZXRQcm90b3R5cGVPZiIsIl9fcHJvdG9fXyIsIkFuaW1hdGVkVHJhbnNmb3JtIiwiX0FuaW1hdGVkV2l0aENoaWxkcmVuIiwidHJhbnNmb3JtcyIsIl90aGlzIiwiY2FsbCIsIl90cmFuc2Zvcm1zIiwiX3Byb3RvIiwiX19tYWtlTmF0aXZlIiwiZm9yRWFjaCIsInRyYW5zZm9ybSIsImtleSIsInZhbHVlIiwiX19nZXRWYWx1ZSIsIm1hcCIsInJlc3VsdCIsIl9fZ2V0QW5pbWF0ZWRWYWx1ZSIsIl9fYXR0YWNoIiwiX3RoaXMyIiwiX19hZGRDaGlsZCIsIl9fZGV0YWNoIiwiX3RoaXMzIiwiX19yZW1vdmVDaGlsZCIsIl9fZ2V0TmF0aXZlQ29uZmlnIiwidHJhbnNDb25maWdzIiwicHVzaCIsInR5cGUiLCJwcm9wZXJ0eSIsIm5vZGVUYWciLCJfX2dldE5hdGl2ZVRhZyIsInRyYW5zZm9ybURhdGFUeXBlIiwidmFsaWRhdGVUcmFuc2Zvcm0iLCJfZGVmYXVsdCIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6IkFBU0E7O0FBRUFBLE9BQU8sQ0FBQ0MsVUFBUixHQUFxQixJQUFyQjtBQUNBRCxPQUFPLENBQUNFLE9BQVIsR0FBa0IsS0FBSyxDQUF2Qjs7QUFFQSxJQUFJQyxhQUFhLEdBQUdDLHNCQUFzQixDQUFDQyxPQUFPLGtCQUFSLENBQTFDOztBQUVBLElB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QUssRUFBRXpCLHFCQUFxQixDQUFDTCxPQUF0QixDQUE4QmdELGlCQUE5QixDQUFnRGxCLEtBQWhEO0FBSFMsV0FBbEI7QUFLRDtBQUNGO0FBQ0YsS0FsQkQ7O0FBb0JBekIsSUFBQUEscUJBQXFCLENBQUNMLE9BQXRCLENBQThCaUQsaUJBQTlCLENBQWdEUCxZQUFoRDs7QUFFQSxXQUFPO0FBQ0xFLE1BQUFBLElBQUksRUFBRSxXQUREO0FBRUx2QixNQUFBQSxVQUFVLEVBQUVxQjtBQUZQLEtBQVA7QUFJRCxHQTdCRDs7QUErQkEsU0FBT3ZCLGlCQUFQO0FBQ0QsQ0E5SG9DLENBOEhuQ2Ysc0JBQXNCLENBQUNKLE9BOUhZLENBQXJDOztBQWdJQSxJQUFJa0QsUUFBUSxHQUFHL0IsaUJBQWY7QUFDQXJCLE9BQU8sQ0FBQ0UsT0FBUixHQUFrQmtELFFBQWxCO0FBQ0FDLE1BQU0sQ0FBQ3JELE9BQVAsR0FBaUJBLE9BQU8sQ0FBQ0UsT0FBekIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIFxuICogQGZvcm1hdFxuICovXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5leHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7XG5cbnZhciBfQW5pbWF0ZWROb2RlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9BbmltYXRlZE5vZGVcIikpO1xuXG52YXIgX0FuaW1hdGVkV2l0aENoaWxkcmVuMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vQW5pbWF0ZWRXaXRoQ2hpbGRyZW5cIikpO1xuXG52YXIgX05hdGl2ZUFuaW1hdGVkSGVscGVyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vTmF0aXZlQW5pbWF0ZWRIZWxwZXJcIikpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHNMb29zZShzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MucHJvdG90eXBlKTsgc3ViQ2xhc3MucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gc3ViQ2xhc3M7IF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH1cblxuZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH1cblxudmFyIEFuaW1hdGVkVHJhbnNmb3JtID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfQW5pbWF0ZWRXaXRoQ2hpbGRyZW4pIHtcbiAgX2luaGVyaXRzTG9vc2UoQW5pbWF0ZWRUcmFuc2Zvcm0sIF9BbmltYXRlZFdpdGhDaGlsZHJlbik7XG5cbiAgZnVuY3Rpb24gQW5pbWF0ZWRUcmFuc2Zvcm0odHJhbnNmb3Jtcykge1xuICAgIHZhciBfdGhpcztcblxuICAgIF90aGlzID0gX0FuaW1hdGVkV2l0aENoaWxkcmVuLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICBfdGhpcy5fdHJhbnNmb3JtcyA9IHRyYW5zZm9ybXM7XG4gICAgcmV0dXJuIF90aGlzO1xuICB9XG5cbiAgdmFyIF9wcm90byA9IEFuaW1hdGVkVHJhbnNmb3JtLnByb3RvdHlwZTtcblxuICBfcHJvdG8uX19tYWtlTmF0aXZlID0gZnVuY3Rpb24gX19tYWtlTmF0aXZlKCkge1xuICAgIHRoaXMuX3RyYW5zZm9ybXMuZm9yRWFjaChmdW5jdGlvbiAodHJhbnNmb3JtKSB7XG4gICAgICBmb3IgKHZhciBrZXkgaW4gdHJhbnNmb3JtKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHRyYW5zZm9ybVtrZXldO1xuXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIF9BbmltYXRlZE5vZGUuZGVmYXVsdCkge1xuICAgICAgICAgIHZhbHVlLl9fbWFrZU5hdGl2ZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBfQW5pbWF0ZWRXaXRoQ2hpbGRyZW4ucHJvdG90eXBlLl9fbWFrZU5hdGl2ZS5jYWxsKHRoaXMpO1xuICB9O1xuXG4gIF9wcm90by5fX2dldFZhbHVlID0gZnVuY3Rpb24gX19nZXRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fdHJhbnNmb3Jtcy5tYXAoZnVuY3Rpb24gKHRyYW5zZm9ybSkge1xuICAgICAgdmFyIHJlc3VsdCA9IHt9O1xuXG4gICAgICBmb3IgKHZhciBrZXkgaW4gdHJhbnNmb3JtKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHRyYW5zZm9ybVtrZXldO1xuXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIF9BbmltYXRlZE5vZGUuZGVmYXVsdCkge1xuICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWUuX19nZXRWYWx1ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9KTtcbiAgfTtcblxuICBfcHJvdG8uX19nZXRBbmltYXRlZFZhbHVlID0gZnVuY3Rpb24gX19nZXRBbmltYXRlZFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLl90cmFuc2Zvcm1zLm1hcChmdW5jdGlvbiAodHJhbnNmb3JtKSB7XG4gICAgICB2YXIgcmVzdWx0ID0ge307XG5cbiAgICAgIGZvciAodmFyIGtleSBpbiB0cmFuc2Zvcm0pIHtcbiAgICAgICAgdmFyIHZhbHVlID0gdHJhbnNmb3JtW2tleV07XG5cbiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgX0FuaW1hdGVkTm9kZS5kZWZhdWx0KSB7XG4gICAgICAgICAgcmVzdWx0W2tleV0gPSB2YWx1ZS5fX2dldEFuaW1hdGVkVmFsdWUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBBbGwgdHJhbnNmb3JtIGNvbXBvbmVudHMgbmVlZGVkIHRvIHJlY29tcG9zZSBtYXRyaXhcbiAgICAgICAgICByZXN1bHRba2V5XSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSk7XG4gIH07XG5cbiAgX3Byb3RvLl9fYXR0YWNoID0gZnVuY3Rpb24gX19hdHRhY2goKSB7XG4gICAgdmFyIF90aGlzMiA9IHRoaXM7XG5cbiAgICB0aGlzLl90cmFuc2Zvcm1zLmZvckVhY2goZnVuY3Rpb24gKHRyYW5zZm9ybSkge1xuICAgICAgZm9yICh2YXIga2V5IGluIHRyYW5zZm9ybSkge1xuICAgICAgICB2YXIgdmFsdWUgPSB0cmFuc2Zvcm1ba2V5XTtcblxuICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBfQW5pbWF0ZWROb2RlLmRlZmF1bHQpIHtcbiAgICAgICAgICB2YWx1ZS5fX2FkZENoaWxkKF90aGlzMik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICBfcHJvdG8uX19kZXRhY2ggPSBmdW5jdGlvbiBfX2RldGFjaCgpIHtcbiAgICB2YXIgX3RoaXMzID0gdGhpcztcblxuICAgIHRoaXMuX3RyYW5zZm9ybXMuZm9yRWFjaChmdW5jdGlvbiAodHJhbnNmb3JtKSB7XG4gICAgICBmb3IgKHZhciBrZXkgaW4gdHJhbnNmb3JtKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHRyYW5zZm9ybVtrZXldO1xuXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIF9BbmltYXRlZE5vZGUuZGVmYXVsdCkge1xuICAgICAgICAgIHZhbHVlLl9fcmVtb3ZlQ2hpbGQoX3RoaXMzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgX0FuaW1hdGVkV2l0aENoaWxkcmVuLnByb3RvdHlwZS5fX2RldGFjaC5jYWxsKHRoaXMpO1xuICB9O1xuXG4gIF9wcm90by5fX2dldE5hdGl2ZUNvbmZpZyA9IGZ1bmN0aW9uIF9fZ2V0TmF0aXZlQ29uZmlnKCkge1xuICAgIHZhciB0cmFuc0NvbmZpZ3MgPSBbXTtcblxuICAgIHRoaXMuX3RyYW5zZm9ybXMuZm9yRWFjaChmdW5jdGlvbiAodHJhbnNmb3JtKSB7XG4gICAgICBmb3IgKHZhciBrZXkgaW4gdHJhbnNmb3JtKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IHRyYW5zZm9ybVtrZXldO1xuXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIF9BbmltYXRlZE5vZGUuZGVmYXVsdCkge1xuICAgICAgICAgIHRyYW5zQ29uZmlncy5wdXNoKHtcbiAgICAgICAgICAgIHR5cGU6ICdhbmltYXRlZCcsXG4gICAgICAgICAgICBwcm9wZXJ0eToga2V5LFxuICAgICAgICAgICAgbm9kZVRhZzogdmFsdWUuX19nZXROYXRpdmVUYWcoKVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRyYW5zQ29uZmlncy5wdXNoKHtcbiAgICAgICAgICAgIHR5cGU6ICdzdGF0aWMnLFxuICAgICAgICAgICAgcHJvcGVydHk6IGtleSxcbiAgICAgICAgICAgIHZhbHVlOiBfTmF0aXZlQW5pbWF0ZWRIZWxwZXIuZGVmYXVsdC50cmFuc2Zvcm1EYXRhVHlwZSh2YWx1ZSlcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgX05hdGl2ZUFuaW1hdGVkSGVscGVyLmRlZmF1bHQudmFsaWRhdGVUcmFuc2Zvcm0odHJhbnNDb25maWdzKTtcblxuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAndHJhbnNmb3JtJyxcbiAgICAgIHRyYW5zZm9ybXM6IHRyYW5zQ29uZmlnc1xuICAgIH07XG4gIH07XG5cbiAgcmV0dXJuIEFuaW1hdGVkVHJhbnNmb3JtO1xufShfQW5pbWF0ZWRXaXRoQ2hpbGRyZW4yLmRlZmF1bHQpO1xuXG52YXIgX2RlZmF1bHQgPSBBbmltYXRlZFRyYW5zZm9ybTtcbmV4cG9ydHMuZGVmYXVsdCA9IF9kZWZhdWx0O1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzLmRlZmF1bHQ7Il19