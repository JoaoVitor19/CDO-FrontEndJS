c76b38cedacabf282d3745b97af4814b
"use strict";

exports.__esModule = true;
exports.default = void 0;

var _invariant = _interopRequireDefault(require("fbjs/lib/invariant"));

var _unmountComponentAtNode = _interopRequireDefault(require("../unmountComponentAtNode"));

var _renderApplication = _interopRequireWildcard(require("./renderApplication"));

function _getRequireWildcardCache() {
  if (typeof WeakMap !== "function") return null;
  var cache = new WeakMap();

  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };

  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache();

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function ownKeys(object, enumerableOnly) {
  var keys = Object.keys(object);

  if (Object.getOwnPropertySymbols) {
    var symbols = Object.getOwnPropertySymbols(object);
    if (enumerableOnly) symbols = symbols.filter(function (sym) {
      return Object.getOwnPropertyDescriptor(object, sym).enumerable;
    });
    keys.push.apply(keys, symbols);
  }

  return keys;
}

function _objectSpread(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};

    if (i % 2) {
      ownKeys(Object(source), true).forEach(function (key) {
        _defineProperty(target, key, source[key]);
      });
    } else if (Object.getOwnPropertyDescriptors) {
      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));
    } else {
      ownKeys(Object(source)).forEach(function (key) {
        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
      });
    }
  }

  return target;
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

var emptyObject = {};
var runnables = {};

var componentProviderInstrumentationHook = function componentProviderInstrumentationHook(component) {
  return component();
};

var wrapperComponentProvider;

var AppRegistry = function () {
  function AppRegistry() {}

  AppRegistry.getAppKeys = function getAppKeys() {
    return Object.keys(runnables);
  };

  AppRegistry.getApplication = function getApplication(appKey, appParameters) {
    (0, _invariant.default)(runnables[appKey] && runnables[appKey].getApplication, "Application " + appKey + " has not been registered. " + 'This is either due to an import error during initialization or failure to call AppRegistry.registerComponent.');
    return runnables[appKey].getApplication(appParameters);
  };

  AppRegistry.registerComponent = function registerComponent(appKey, componentProvider) {
    runnables[appKey] = {
      getApplication: function getApplication(appParameters) {
        return (0, _renderApplication.getApplication)(componentProviderInstrumentationHook(componentProvider), appParameters ? appParameters.initialProps : emptyObject, wrapperComponentProvider && wrapperComponentProvider(appParameters));
      },
      run: function run(appParameters) {
        return (0, _renderApplication.default)(componentProviderInstrumentationHook(componentProvider), wrapperComponentProvider && wrapperComponentProvider(appParameters), appParameters.callback, {
          hydrate: appParameters.hydrate || false,
          initialProps: appParameters.initialProps || emptyObject,
          rootTag: appParameters.rootTag
        });
      }
    };
    return appKey;
  };

  AppRegistry.registerConfig = function registerConfig(config) {
    config.forEach(function (_ref) {
      var appKey = _ref.appKey,
          component = _ref.component,
          run = _ref.run;

      if (run) {
        AppRegistry.registerRunnable(appKey, run);
      } else {
        (0, _invariant.default)(component, 'No component provider passed in');
        AppRegistry.registerComponent(appKey, component);
      }
    });
  };

  AppRegistry.registerRunnable = function registerRunnable(appKey, run) {
    runnables[appKey] = {
      run: run
    };
    return appKey;
  };

  AppRegistry.runApplication = function runApplication(appKey, appParameters) {
    var isDevelopment = process.env.NODE_ENV !== 'production' && process.env.NODE_ENV !== 'test';

    if (isDevelopment) {
      var params = _objectSpread({}, appParameters);

      params.rootTag = "#" + params.rootTag.id;
      console.log("Running application \"" + appKey + "\" with appParams:\n", params, "\nDevelopment-level warnings: " + (isDevelopment ? 'ON' : 'OFF') + "." + ("\nPerformance optimizations: " + (isDevelopment ? 'OFF' : 'ON') + "."));
    }

    (0, _invariant.default)(runnables[appKey] && runnables[appKey].run, "Application \"" + appKey + "\" has not been registered. " + 'This is either due to an import error during initialization or failure to call AppRegistry.registerComponent.');
    runnables[appKey].run(appParameters);
  };

  AppRegistry.setComponentProviderInstrumentationHook = function setComponentProviderInstrumentationHook(hook) {
    componentProviderInstrumentationHook = hook;
  };

  AppRegistry.setWrapperComponentProvider = function setWrapperComponentProvider(provider) {
    wrapperComponentProvider = provider;
  };

  AppRegistry.unmountApplicationComponentAtRootTag = function unmountApplicationComponentAtRootTag(rootTag) {
    (0, _unmountComponentAtNode.default)(rootTag);
  };

  return AppRegistry;
}();

exports.default = AppRegistry;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9pbnZhcmlhbnQiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl91bm1vdW50Q29tcG9uZW50QXROb2RlIiwiX3JlbmRlckFwcGxpY2F0aW9uIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUiLCJXZWFrTWFwIiwiY2FjaGUiLCJvYmoiLCJoYXMiLCJnZXQiLCJuZXdPYmoiLCJoYXNQcm9wZXJ0eURlc2NyaXB0b3IiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImtleSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImRlc2MiLCJzZXQiLCJvd25LZXlzIiwib2JqZWN0IiwiZW51bWVyYWJsZU9ubHkiLCJrZXlzIiwiZ2V0T3duUHJvcGVydHlTeW1ib2xzIiwic3ltYm9scyIsImZpbHRlciIsInN5bSIsImVudW1lcmFibGUiLCJwdXNoIiwiYXBwbHkiLCJfb2JqZWN0U3ByZWFkIiwidGFyZ2V0IiwiaSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInNvdXJjZSIsImZvckVhY2giLCJfZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwiZGVmaW5lUHJvcGVydGllcyIsInZhbHVlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJlbXB0eU9iamVjdCIsInJ1bm5hYmxlcyIsImNvbXBvbmVudFByb3ZpZGVySW5zdHJ1bWVudGF0aW9uSG9vayIsImNvbXBvbmVudCIsIndyYXBwZXJDb21wb25lbnRQcm92aWRlciIsIkFwcFJlZ2lzdHJ5IiwiZ2V0QXBwS2V5cyIsImdldEFwcGxpY2F0aW9uIiwiYXBwS2V5IiwiYXBwUGFyYW1ldGVycyIsInJlZ2lzdGVyQ29tcG9uZW50IiwiY29tcG9uZW50UHJvdmlkZXIiLCJpbml0aWFsUHJvcHMiLCJydW4iLCJjYWxsYmFjayIsImh5ZHJhdGUiLCJyb290VGFnIiwicmVnaXN0ZXJDb25maWciLCJjb25maWciLCJfcmVmIiwicmVnaXN0ZXJSdW5uYWJsZSIsInJ1bkFwcGxpY2F0aW9uIiwiaXNEZXZlbG9wbWVudCIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsInBhcmFtcyIsImlkIiwiY29uc29sZSIsImxvZyIsInNldENvbXBvbmVudFByb3ZpZGVySW5zdHJ1bWVudGF0aW9uSG9vayIsImhvb2siLCJzZXRXcmFwcGVyQ29tcG9uZW50UHJvdmlkZXIiLCJwcm92aWRlciIsInVubW91bnRBcHBsaWNhdGlvbkNvbXBvbmVudEF0Um9vdFRhZyIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUFBLE9BQU8sQ0FBQ0MsVUFBUixHQUFxQixJQUFyQjtBQUNBRCxPQUFPLENBQUNFLE9BQVIsR0FBa0IsS0FBSyxDQUF2Qjs7QUFFQSxJQUFJQyxVQUFVLEdBQUdDLHNCQUFzQixDQUFDQyxPQUFPLENBQUMsb0JBQUQsQ0FBUixDQUF2Qzs7QUFFQSxJQUFJQyx1QkFBdUIsR0FBR0Ysc0JBQXNCLENBQUNDLE9BQU8sNkJBQVIsQ0FBcEQ7O0FBRUEsSUFBSUUsa0JBQWtCLEdBQUdDLHVCQUF1QixDQUFDSCxPQUFPLHVCQUFSLENBQWhEOztBQUVBLFNBQVNJLHdCQUFULEdBQW9DO0FBQUUsTUFBSSxPQUFPQyxPQUFQLEtBQW1CLFVBQXZCLEVBQW1DLE9BQU8sSUFBUDtBQUFhLE1BQUlDLEtBQUssR0FBRyxJQUFJRCxPQUFKLEVBQVo7O0FBQTJCRCxFQUFBQSx3QkFBd0IsR0FBRyxTQUFTQSx3QkFBVCxHQUFvQztBQUFFLFdBQU9FLEtBQVA7QUFBZSxHQUFoRjs7QUFBa0YsU0FBT0EsS0FBUDtBQUFlOztBQUVsTixTQUFTSCx1QkFBVCxDQUFpQ0ksR0FBakMsRUFBc0M7QUFBRSxNQUFJQSxHQUFHLElBQUlBLEdBQUcsQ0FBQ1gsVUFBZixFQUEyQjtBQUFFLFdBQU9XLEdB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QmlELFNBQVMsQ0FBQ08sTUFBRCxDQUFULElBQXFCUCxTQUFTLENBQUNPLE1BQUQsQ0FBVCxDQUFrQkssR0FBL0QsRUFBb0UsbUJBQW1CTCxNQUFuQixHQUE0Qiw4QkFBNUIsR0FBNkQsK0dBQWpJO0FBQ0FQLElBQUFBLFNBQVMsQ0FBQ08sTUFBRCxDQUFULENBQWtCSyxHQUFsQixDQUFzQkosYUFBdEI7QUFDRCxHQVpEOztBQWNBSixFQUFBQSxXQUFXLENBQUN5Qix1Q0FBWixHQUFzRCxTQUFTQSx1Q0FBVCxDQUFpREMsSUFBakQsRUFBdUQ7QUFDM0c3QixJQUFBQSxvQ0FBb0MsR0FBRzZCLElBQXZDO0FBQ0QsR0FGRDs7QUFJQTFCLEVBQUFBLFdBQVcsQ0FBQzJCLDJCQUFaLEdBQTBDLFNBQVNBLDJCQUFULENBQXFDQyxRQUFyQyxFQUErQztBQUN2RjdCLElBQUFBLHdCQUF3QixHQUFHNkIsUUFBM0I7QUFDRCxHQUZEOztBQUlBNUIsRUFBQUEsV0FBVyxDQUFDNkIsb0NBQVosR0FBbUQsU0FBU0Esb0NBQVQsQ0FBOENsQixPQUE5QyxFQUF1RDtBQUN4RyxLQUFDLEdBQUc1RCx1QkFBdUIsQ0FBQ0osT0FBNUIsRUFBcUNnRSxPQUFyQztBQUNELEdBRkQ7O0FBSUEsU0FBT1gsV0FBUDtBQUNELENBOUU4QixFQUEvQjs7QUFnRkF2RCxPQUFPLENBQUNFLE9BQVIsR0FBa0JxRCxXQUFsQjtBQUNBOEIsTUFBTSxDQUFDckYsT0FBUCxHQUFpQkEsT0FBTyxDQUFDRSxPQUF6QiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwO1xuXG52YXIgX2ludmFyaWFudCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcImZianMvbGliL2ludmFyaWFudFwiKSk7XG5cbnZhciBfdW5tb3VudENvbXBvbmVudEF0Tm9kZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4uL3VubW91bnRDb21wb25lbnRBdE5vZGVcIikpO1xuXG52YXIgX3JlbmRlckFwcGxpY2F0aW9uID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZShcIi4vcmVuZGVyQXBwbGljYXRpb25cIikpO1xuXG5mdW5jdGlvbiBfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUoKSB7IGlmICh0eXBlb2YgV2Vha01hcCAhPT0gXCJmdW5jdGlvblwiKSByZXR1cm4gbnVsbDsgdmFyIGNhY2hlID0gbmV3IFdlYWtNYXAoKTsgX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlID0gZnVuY3Rpb24gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKCkgeyByZXR1cm4gY2FjaGU7IH07IHJldHVybiBjYWNoZTsgfVxuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGlmIChvYmogPT09IG51bGwgfHwgdHlwZW9mIG9iaiAhPT0gXCJvYmplY3RcIiAmJiB0eXBlb2Ygb2JqICE9PSBcImZ1bmN0aW9uXCIpIHsgcmV0dXJuIHsgZGVmYXVsdDogb2JqIH07IH0gdmFyIGNhY2hlID0gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKCk7IGlmIChjYWNoZSAmJiBjYWNoZS5oYXMob2JqKSkgeyByZXR1cm4gY2FjaGUuZ2V0KG9iaik7IH0gdmFyIG5ld09iaiA9IHt9OyB2YXIgaGFzUHJvcGVydHlEZXNjcmlwdG9yID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsgdmFyIGRlc2MgPSBoYXNQcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IG51bGw7IGlmIChkZXNjICYmIChkZXNjLmdldCB8fCBkZXNjLnNldCkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsgfSBlbHNlIHsgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IH0gbmV3T2JqLmRlZmF1bHQgPSBvYmo7IGlmIChjYWNoZSkgeyBjYWNoZS5zZXQob2JqLCBuZXdPYmopOyB9IHJldHVybiBuZXdPYmo7IH1cblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH1cblxuZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoT2JqZWN0KHNvdXJjZSkpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9XG5cbmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9XG5cbnZhciBlbXB0eU9iamVjdCA9IHt9O1xudmFyIHJ1bm5hYmxlcyA9IHt9O1xuXG52YXIgY29tcG9uZW50UHJvdmlkZXJJbnN0cnVtZW50YXRpb25Ib29rID0gZnVuY3Rpb24gY29tcG9uZW50UHJvdmlkZXJJbnN0cnVtZW50YXRpb25Ib29rKGNvbXBvbmVudCkge1xuICByZXR1cm4gY29tcG9uZW50KCk7XG59O1xuXG52YXIgd3JhcHBlckNvbXBvbmVudFByb3ZpZGVyO1xuLyoqXG4gKiBgQXBwUmVnaXN0cnlgIGlzIHRoZSBKUyBlbnRyeSBwb2ludCB0byBydW5uaW5nIGFsbCBSZWFjdCBOYXRpdmUgYXBwcy5cbiAqL1xuXG52YXIgQXBwUmVnaXN0cnkgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBBcHBSZWdpc3RyeSgpIHt9XG5cbiAgQXBwUmVnaXN0cnkuZ2V0QXBwS2V5cyA9IGZ1bmN0aW9uIGdldEFwcEtleXMoKSB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHJ1bm5hYmxlcyk7XG4gIH07XG5cbiAgQXBwUmVnaXN0cnkuZ2V0QXBwbGljYXRpb24gPSBmdW5jdGlvbiBnZXRBcHBsaWNhdGlvbihhcHBLZXksIGFwcFBhcmFtZXRlcnMpIHtcbiAgICAoMCwgX2ludmFyaWFudC5kZWZhdWx0KShydW5uYWJsZXNbYXBwS2V5XSAmJiBydW5uYWJsZXNbYXBwS2V5XS5nZXRBcHBsaWNhdGlvbiwgXCJBcHBsaWNhdGlvbiBcIiArIGFwcEtleSArIFwiIGhhcyBub3QgYmVlbiByZWdpc3RlcmVkLiBcIiArICdUaGlzIGlzIGVpdGhlciBkdWUgdG8gYW4gaW1wb3J0IGVycm9yIGR1cmluZyBpbml0aWFsaXphdGlvbiBvciBmYWlsdXJlIHRvIGNhbGwgQXBwUmVnaXN0cnkucmVnaXN0ZXJDb21wb25lbnQuJyk7XG4gICAgcmV0dXJuIHJ1bm5hYmxlc1thcHBLZXldLmdldEFwcGxpY2F0aW9uKGFwcFBhcmFtZXRlcnMpO1xuICB9O1xuXG4gIEFwcFJlZ2lzdHJ5LnJlZ2lzdGVyQ29tcG9uZW50ID0gZnVuY3Rpb24gcmVnaXN0ZXJDb21wb25lbnQoYXBwS2V5LCBjb21wb25lbnRQcm92aWRlcikge1xuICAgIHJ1bm5hYmxlc1thcHBLZXldID0ge1xuICAgICAgZ2V0QXBwbGljYXRpb246IGZ1bmN0aW9uIGdldEFwcGxpY2F0aW9uKGFwcFBhcmFtZXRlcnMpIHtcbiAgICAgICAgcmV0dXJuICgwLCBfcmVuZGVyQXBwbGljYXRpb24uZ2V0QXBwbGljYXRpb24pKGNvbXBvbmVudFByb3ZpZGVySW5zdHJ1bWVudGF0aW9uSG9vayhjb21wb25lbnRQcm92aWRlciksIGFwcFBhcmFtZXRlcnMgPyBhcHBQYXJhbWV0ZXJzLmluaXRpYWxQcm9wcyA6IGVtcHR5T2JqZWN0LCB3cmFwcGVyQ29tcG9uZW50UHJvdmlkZXIgJiYgd3JhcHBlckNvbXBvbmVudFByb3ZpZGVyKGFwcFBhcmFtZXRlcnMpKTtcbiAgICAgIH0sXG4gICAgICBydW46IGZ1bmN0aW9uIHJ1bihhcHBQYXJhbWV0ZXJzKSB7XG4gICAgICAgIHJldHVybiAoMCwgX3JlbmRlckFwcGxpY2F0aW9uLmRlZmF1bHQpKGNvbXBvbmVudFByb3ZpZGVySW5zdHJ1bWVudGF0aW9uSG9vayhjb21wb25lbnRQcm92aWRlciksIHdyYXBwZXJDb21wb25lbnRQcm92aWRlciAmJiB3cmFwcGVyQ29tcG9uZW50UHJvdmlkZXIoYXBwUGFyYW1ldGVycyksIGFwcFBhcmFtZXRlcnMuY2FsbGJhY2ssIHtcbiAgICAgICAgICBoeWRyYXRlOiBhcHBQYXJhbWV0ZXJzLmh5ZHJhdGUgfHwgZmFsc2UsXG4gICAgICAgICAgaW5pdGlhbFByb3BzOiBhcHBQYXJhbWV0ZXJzLmluaXRpYWxQcm9wcyB8fCBlbXB0eU9iamVjdCxcbiAgICAgICAgICByb290VGFnOiBhcHBQYXJhbWV0ZXJzLnJvb3RUYWdcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gYXBwS2V5O1xuICB9O1xuXG4gIEFwcFJlZ2lzdHJ5LnJlZ2lzdGVyQ29uZmlnID0gZnVuY3Rpb24gcmVnaXN0ZXJDb25maWcoY29uZmlnKSB7XG4gICAgY29uZmlnLmZvckVhY2goZnVuY3Rpb24gKF9yZWYpIHtcbiAgICAgIHZhciBhcHBLZXkgPSBfcmVmLmFwcEtleSxcbiAgICAgICAgICBjb21wb25lbnQgPSBfcmVmLmNvbXBvbmVudCxcbiAgICAgICAgICBydW4gPSBfcmVmLnJ1bjtcblxuICAgICAgaWYgKHJ1bikge1xuICAgICAgICBBcHBSZWdpc3RyeS5yZWdpc3RlclJ1bm5hYmxlKGFwcEtleSwgcnVuKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICgwLCBfaW52YXJpYW50LmRlZmF1bHQpKGNvbXBvbmVudCwgJ05vIGNvbXBvbmVudCBwcm92aWRlciBwYXNzZWQgaW4nKTtcbiAgICAgICAgQXBwUmVnaXN0cnkucmVnaXN0ZXJDb21wb25lbnQoYXBwS2V5LCBjb21wb25lbnQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9IC8vIFRPRE86IGZpeCBzdHlsZSBzaGVldCBjcmVhdGlvbiB3aGVuIHVzaW5nIHRoaXMgbWV0aG9kXG4gIDtcblxuICBBcHBSZWdpc3RyeS5yZWdpc3RlclJ1bm5hYmxlID0gZnVuY3Rpb24gcmVnaXN0ZXJSdW5uYWJsZShhcHBLZXksIHJ1bikge1xuICAgIHJ1bm5hYmxlc1thcHBLZXldID0ge1xuICAgICAgcnVuOiBydW5cbiAgICB9O1xuICAgIHJldHVybiBhcHBLZXk7XG4gIH07XG5cbiAgQXBwUmVnaXN0cnkucnVuQXBwbGljYXRpb24gPSBmdW5jdGlvbiBydW5BcHBsaWNhdGlvbihhcHBLZXksIGFwcFBhcmFtZXRlcnMpIHtcbiAgICB2YXIgaXNEZXZlbG9wbWVudCA9IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICd0ZXN0JztcblxuICAgIGlmIChpc0RldmVsb3BtZW50KSB7XG4gICAgICB2YXIgcGFyYW1zID0gX29iamVjdFNwcmVhZCh7fSwgYXBwUGFyYW1ldGVycyk7XG5cbiAgICAgIHBhcmFtcy5yb290VGFnID0gXCIjXCIgKyBwYXJhbXMucm9vdFRhZy5pZDtcbiAgICAgIGNvbnNvbGUubG9nKFwiUnVubmluZyBhcHBsaWNhdGlvbiBcXFwiXCIgKyBhcHBLZXkgKyBcIlxcXCIgd2l0aCBhcHBQYXJhbXM6XFxuXCIsIHBhcmFtcywgXCJcXG5EZXZlbG9wbWVudC1sZXZlbCB3YXJuaW5nczogXCIgKyAoaXNEZXZlbG9wbWVudCA/ICdPTicgOiAnT0ZGJykgKyBcIi5cIiArIChcIlxcblBlcmZvcm1hbmNlIG9wdGltaXphdGlvbnM6IFwiICsgKGlzRGV2ZWxvcG1lbnQgPyAnT0ZGJyA6ICdPTicpICsgXCIuXCIpKTtcbiAgICB9XG5cbiAgICAoMCwgX2ludmFyaWFudC5kZWZhdWx0KShydW5uYWJsZXNbYXBwS2V5XSAmJiBydW5uYWJsZXNbYXBwS2V5XS5ydW4sIFwiQXBwbGljYXRpb24gXFxcIlwiICsgYXBwS2V5ICsgXCJcXFwiIGhhcyBub3QgYmVlbiByZWdpc3RlcmVkLiBcIiArICdUaGlzIGlzIGVpdGhlciBkdWUgdG8gYW4gaW1wb3J0IGVycm9yIGR1cmluZyBpbml0aWFsaXphdGlvbiBvciBmYWlsdXJlIHRvIGNhbGwgQXBwUmVnaXN0cnkucmVnaXN0ZXJDb21wb25lbnQuJyk7XG4gICAgcnVubmFibGVzW2FwcEtleV0ucnVuKGFwcFBhcmFtZXRlcnMpO1xuICB9O1xuXG4gIEFwcFJlZ2lzdHJ5LnNldENvbXBvbmVudFByb3ZpZGVySW5zdHJ1bWVudGF0aW9uSG9vayA9IGZ1bmN0aW9uIHNldENvbXBvbmVudFByb3ZpZGVySW5zdHJ1bWVudGF0aW9uSG9vayhob29rKSB7XG4gICAgY29tcG9uZW50UHJvdmlkZXJJbnN0cnVtZW50YXRpb25Ib29rID0gaG9vaztcbiAgfTtcblxuICBBcHBSZWdpc3RyeS5zZXRXcmFwcGVyQ29tcG9uZW50UHJvdmlkZXIgPSBmdW5jdGlvbiBzZXRXcmFwcGVyQ29tcG9uZW50UHJvdmlkZXIocHJvdmlkZXIpIHtcbiAgICB3cmFwcGVyQ29tcG9uZW50UHJvdmlkZXIgPSBwcm92aWRlcjtcbiAgfTtcblxuICBBcHBSZWdpc3RyeS51bm1vdW50QXBwbGljYXRpb25Db21wb25lbnRBdFJvb3RUYWcgPSBmdW5jdGlvbiB1bm1vdW50QXBwbGljYXRpb25Db21wb25lbnRBdFJvb3RUYWcocm9vdFRhZykge1xuICAgICgwLCBfdW5tb3VudENvbXBvbmVudEF0Tm9kZS5kZWZhdWx0KShyb290VGFnKTtcbiAgfTtcblxuICByZXR1cm4gQXBwUmVnaXN0cnk7XG59KCk7XG5cbmV4cG9ydHMuZGVmYXVsdCA9IEFwcFJlZ2lzdHJ5O1xubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzLmRlZmF1bHQ7Il19