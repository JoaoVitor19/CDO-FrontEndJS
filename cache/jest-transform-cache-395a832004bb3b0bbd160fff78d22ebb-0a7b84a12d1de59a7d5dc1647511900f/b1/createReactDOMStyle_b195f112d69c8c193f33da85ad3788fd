5b6f3a07cf42a7528d2d08711ae56b42
"use strict";

exports.__esModule = true;
exports.default = void 0;

var _ExecutionEnvironment = require("fbjs/lib/ExecutionEnvironment");

var _constants = require("./constants");

var _normalizeValueWithProperty = _interopRequireDefault(require("./normalizeValueWithProperty"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

var emptyObject = {};
var supportsCSS3TextDecoration = !_ExecutionEnvironment.canUseDOM || window.CSS != null && window.CSS.supports != null && (window.CSS.supports('text-decoration-line', 'none') || window.CSS.supports('-webkit-text-decoration-line', 'none'));

var mapTransform = function mapTransform(transform) {
  var type = Object.keys(transform)[0];
  var value = transform[type];

  if (type === 'matrix' || type === 'matrix3d') {
    return type + "(" + value.join(',') + ")";
  } else {
    var normalizedValue = (0, _normalizeValueWithProperty.default)(value, type);
    return type + "(" + normalizedValue + ")";
  }
};

var resolveTransform = function resolveTransform(resolvedStyle, style) {
  var transform = style.transform;

  if (Array.isArray(style.transform)) {
    transform = style.transform.map(mapTransform).join(' ');
  }

  resolvedStyle.transform = transform;
};

var createReactDOMStyle = function createReactDOMStyle(style) {
  if (!style) {
    return emptyObject;
  }

  var resolvedStyle = {};
  Object.keys(style).sort().forEach(function (prop) {
    var value = (0, _normalizeValueWithProperty.default)(style[prop], prop);

    if (value == null) {
      return;
    }

    switch (prop) {
      case 'elevation':
      case 'overlayColor':
      case 'resizeMode':
      case 'tintColor':
        {
          break;
        }

      case 'aspectRatio':
        {
          resolvedStyle[prop] = value.toString();
          break;
        }

      case 'backgroundClip':
        {
          if (value === 'text') {
            resolvedStyle.backgroundClip = value;
            resolvedStyle.WebkitBackgroundClip = value;
          }

          break;
        }

      case 'flex':
        {
          if (value === -1) {
            resolvedStyle.flexGrow = 0;
            resolvedStyle.flexShrink = 1;
            resolvedStyle.flexBasis = 'auto';
          } else {
            resolvedStyle.flex = value;
          }

          break;
        }

      case 'font':
        {
          resolvedStyle[prop] = value.replace('System', _constants.SYSTEM_FONT_STACK);
          break;
        }

      case 'fontFamily':
        {
          if (value.indexOf('System') > -1) {
            var stack = value.split(/,\s*/);
            stack[stack.indexOf('System')] = _constants.SYSTEM_FONT_STACK;
            resolvedStyle[prop] = stack.join(',');
          } else if (value === 'monospace') {
            resolvedStyle[prop] = _constants.MONOSPACE_FONT_STACK;
          } else {
            resolvedStyle[prop] = value;
          }

          break;
        }

      case 'fontVariant':
        {
          if (Array.isArray(value) && value.length > 0) {
            resolvedStyle.fontVariant = value.join(' ');
          }

          break;
        }

      case 'textAlignVertical':
        {
          resolvedStyle.verticalAlign = value === 'center' ? 'middle' : value;
          break;
        }

      case 'textDecorationLine':
        {
          if (!supportsCSS3TextDecoration) {
            resolvedStyle.textDecoration = value;
          } else {
            resolvedStyle.textDecorationLine = value;
          }

          break;
        }

      case 'transform':
      case 'transformMatrix':
        {
          resolveTransform(resolvedStyle, style);
          break;
        }

      case 'writingDirection':
        {
          resolvedStyle.direction = value;
          break;
        }

      default:
        {
          var longFormProperties = _constants.STYLE_SHORT_FORM_EXPANSIONS[prop];

          if (longFormProperties) {
            longFormProperties.forEach(function (longForm, i) {
              if (typeof style[longForm] === 'undefined') {
                resolvedStyle[longForm] = value;
              }
            });
          } else {
            resolvedStyle[prop] = Array.isArray(value) ? value.join(',') : value;
          }
        }
    }
  });
  return resolvedStyle;
};

var _default = createReactDOMStyle;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZVJlYWN0RE9NU3R5bGUuanMiXSwibmFtZXMiOlsiZXhwb3J0cyIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiX0V4ZWN1dGlvbkVudmlyb25tZW50IiwicmVxdWlyZSIsIl9jb25zdGFudHMiLCJfbm9ybWFsaXplVmFsdWVXaXRoUHJvcGVydHkiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0Iiwib2JqIiwiZW1wdHlPYmplY3QiLCJzdXBwb3J0c0NTUzNUZXh0RGVjb3JhdGlvbiIsImNhblVzZURPTSIsIndpbmRvdyIsIkNTUyIsInN1cHBvcnRzIiwibWFwVHJhbnNmb3JtIiwidHJhbnNmb3JtIiwidHlwZSIsIk9iamVjdCIsImtleXMiLCJ2YWx1ZSIsImpvaW4iLCJub3JtYWxpemVkVmFsdWUiLCJyZXNvbHZlVHJhbnNmb3JtIiwicmVzb2x2ZWRTdHlsZSIsInN0eWxlIiwiQXJyYXkiLCJpc0FycmF5IiwibWFwIiwiY3JlYXRlUmVhY3RET01TdHlsZSIsInNvcnQiLCJmb3JFYWNoIiwicHJvcCIsInRvU3RyaW5nIiwiYmFja2dyb3VuZENsaXAiLCJXZWJraXRCYWNrZ3JvdW5kQ2xpcCIsImZsZXhHcm93IiwiZmxleFNocmluayIsImZsZXhCYXNpcyIsImZsZXgiLCJyZXBsYWNlIiwiU1lTVEVNX0ZPTlRfU1RBQ0siLCJpbmRleE9mIiwic3RhY2siLCJzcGxpdCIsIk1PTk9TUEFDRV9GT05UX1NUQUNLIiwibGVuZ3RoIiwiZm9udFZhcmlhbnQiLCJ2ZXJ0aWNhbEFsaWduIiwidGV4dERlY29yYXRpb24iLCJ0ZXh0RGVjb3JhdGlvbkxpbmUiLCJkaXJlY3Rpb24iLCJsb25nRm9ybVByb3BlcnRpZXMiLCJTVFlMRV9TSE9SVF9GT1JNX0VYUEFOU0lPTlMiLCJsb25nRm9ybSIsImkiLCJfZGVmYXVsdCIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUFBLE9BQU8sQ0FBQ0MsVUFBUixHQUFxQixJQUFyQjtBQUNBRCxPQUFPLENBQUNFLE9BQVIs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LENBQUNnRCwyQkFBWCxDQUF1Q3JCLElBQXZDLENBQXpCOztBQUVBLGNBQUlvQixrQkFBSixFQUF3QjtBQUN0QkEsWUFBQUEsa0JBQWtCLENBQUNyQixPQUFuQixDQUEyQixVQUFVdUIsUUFBVixFQUFvQkMsQ0FBcEIsRUFBdUI7QUFHaEQsa0JBQUksT0FBTzlCLEtBQUssQ0FBQzZCLFFBQUQsQ0FBWixLQUEyQixXQUEvQixFQUE0QztBQUMxQzlCLGdCQUFBQSxhQUFhLENBQUM4QixRQUFELENBQWIsR0FBMEJsQyxLQUExQjtBQUNEO0FBQ0YsYUFORDtBQU9ELFdBUkQsTUFRTztBQUNMSSxZQUFBQSxhQUFhLENBQUNRLElBQUQsQ0FBYixHQUFzQk4sS0FBSyxDQUFDQyxPQUFOLENBQWNQLEtBQWQsSUFBdUJBLEtBQUssQ0FBQ0MsSUFBTixDQUFXLEdBQVgsQ0FBdkIsR0FBeUNELEtBQS9EO0FBQ0Q7QUFDRjtBQXhITDtBQTBIRCxHQWpJRDtBQWtJQSxTQUFPSSxhQUFQO0FBQ0QsQ0F6SUQ7O0FBMklBLElBQUlnQyxRQUFRLEdBQUczQixtQkFBZjtBQUNBN0IsT0FBTyxDQUFDRSxPQUFSLEdBQWtCc0QsUUFBbEI7QUFDQUMsTUFBTSxDQUFDekQsT0FBUCxHQUFpQkEsT0FBTyxDQUFDRSxPQUF6QiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwO1xuXG52YXIgX0V4ZWN1dGlvbkVudmlyb25tZW50ID0gcmVxdWlyZShcImZianMvbGliL0V4ZWN1dGlvbkVudmlyb25tZW50XCIpO1xuXG52YXIgX2NvbnN0YW50cyA9IHJlcXVpcmUoXCIuL2NvbnN0YW50c1wiKTtcblxudmFyIF9ub3JtYWxpemVWYWx1ZVdpdGhQcm9wZXJ0eSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vbm9ybWFsaXplVmFsdWVXaXRoUHJvcGVydHlcIikpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG4vKipcbiAqIENvcHlyaWdodCAoYykgTmljb2xhcyBHYWxsYWdoZXIuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogXG4gKi9cblxuLyoqXG4gKiBUaGUgYnJvd3NlciBpbXBsZW1lbnRzIHRoZSBDU1MgY2FzY2FkZSwgd2hlcmUgdGhlIG9yZGVyIG9mIHByb3BlcnRpZXMgaXMgYVxuICogZmFjdG9yIGluIGRldGVybWluaW5nIHdoaWNoIHN0eWxlcyB0byBwYWludC4gUmVhY3QgTmF0aXZlIGlzIGRpZmZlcmVudC4gSXRcbiAqIGdpdmVzIGdpdmluZyBwcmVjZWRlbmNlIHRvIHRoZSBtb3JlIHNwZWNpZmljIHN0eWxlIHByb3BlcnR5LiBGb3IgZXhhbXBsZSxcbiAqIHRoZSB2YWx1ZSBvZiBgcGFkZGluZ1RvcGAgdGFrZXMgcHJlY2VkZW5jZSBvdmVyIHRoYXQgb2YgYHBhZGRpbmdgLlxuICpcbiAqIFRoaXMgbW9kdWxlIGNyZWF0ZXMgbXV0YWxseSBleGNsdXNpdmUgc3R5bGUgZGVjbGFyYXRpb25zIGJ5IGV4cGFuZGluZyBhbGwgb2ZcbiAqIFJlYWN0IE5hdGl2ZSdzIHN1cHBvcnRlZCBzaG9ydGZvcm0gcHJvcGVydGllcyAoZS5nLiBgcGFkZGluZ2ApIHRvIHRoZWlyXG4gKiBsb25nZnJvbSBlcXVpdmFsZW50cy5cbiAqL1xudmFyIGVtcHR5T2JqZWN0ID0ge307XG52YXIgc3VwcG9ydHNDU1MzVGV4dERlY29yYXRpb24gPSAhX0V4ZWN1dGlvbkVudmlyb25tZW50LmNhblVzZURPTSB8fCB3aW5kb3cuQ1NTICE9IG51bGwgJiYgd2luZG93LkNTUy5zdXBwb3J0cyAhPSBudWxsICYmICh3aW5kb3cuQ1NTLnN1cHBvcnRzKCd0ZXh0LWRlY29yYXRpb24tbGluZScsICdub25lJykgfHwgd2luZG93LkNTUy5zdXBwb3J0cygnLXdlYmtpdC10ZXh0LWRlY29yYXRpb24tbGluZScsICdub25lJykpO1xuLyoqXG4gKiBUcmFuc2Zvcm1cbiAqL1xuLy8geyBzY2FsZTogMiB9ID0+ICdzY2FsZSgyKSdcbi8vIHsgdHJhbnNsYXRlWDogMjAgfSA9PiAndHJhbnNsYXRlWCgyMHB4KSdcbi8vIHsgbWF0cml4OiBbMSwyLDMsNCw1LDZdIH0gPT4gJ21hdHJpeCgxLDIsMyw0LDUsNiknXG5cbnZhciBtYXBUcmFuc2Zvcm0gPSBmdW5jdGlvbiBtYXBUcmFuc2Zvcm0odHJhbnNmb3JtKSB7XG4gIHZhciB0eXBlID0gT2JqZWN0LmtleXModHJhbnNmb3JtKVswXTtcbiAgdmFyIHZhbHVlID0gdHJhbnNmb3JtW3R5cGVdO1xuXG4gIGlmICh0eXBlID09PSAnbWF0cml4JyB8fCB0eXBlID09PSAnbWF0cml4M2QnKSB7XG4gICAgcmV0dXJuIHR5cGUgKyBcIihcIiArIHZhbHVlLmpvaW4oJywnKSArIFwiKVwiO1xuICB9IGVsc2Uge1xuICAgIHZhciBub3JtYWxpemVkVmFsdWUgPSAoMCwgX25vcm1hbGl6ZVZhbHVlV2l0aFByb3BlcnR5LmRlZmF1bHQpKHZhbHVlLCB0eXBlKTtcbiAgICByZXR1cm4gdHlwZSArIFwiKFwiICsgbm9ybWFsaXplZFZhbHVlICsgXCIpXCI7XG4gIH1cbn07XG5cbnZhciByZXNvbHZlVHJhbnNmb3JtID0gZnVuY3Rpb24gcmVzb2x2ZVRyYW5zZm9ybShyZXNvbHZlZFN0eWxlLCBzdHlsZSkge1xuICB2YXIgdHJhbnNmb3JtID0gc3R5bGUudHJhbnNmb3JtO1xuXG4gIGlmIChBcnJheS5pc0FycmF5KHN0eWxlLnRyYW5zZm9ybSkpIHtcbiAgICB0cmFuc2Zvcm0gPSBzdHlsZS50cmFuc2Zvcm0ubWFwKG1hcFRyYW5zZm9ybSkuam9pbignICcpO1xuICB9XG5cbiAgcmVzb2x2ZWRTdHlsZS50cmFuc2Zvcm0gPSB0cmFuc2Zvcm07XG59O1xuLyoqXG4gKiBSZWR1Y2VyXG4gKi9cblxuXG52YXIgY3JlYXRlUmVhY3RET01TdHlsZSA9IGZ1bmN0aW9uIGNyZWF0ZVJlYWN0RE9NU3R5bGUoc3R5bGUpIHtcbiAgaWYgKCFzdHlsZSkge1xuICAgIHJldHVybiBlbXB0eU9iamVjdDtcbiAgfVxuXG4gIHZhciByZXNvbHZlZFN0eWxlID0ge307XG4gIE9iamVjdC5rZXlzKHN0eWxlKS5zb3J0KCkuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xuICAgIHZhciB2YWx1ZSA9ICgwLCBfbm9ybWFsaXplVmFsdWVXaXRoUHJvcGVydHkuZGVmYXVsdCkoc3R5bGVbcHJvcF0sIHByb3ApOyAvLyBJZ25vcmUgZXZlcnl0aGluZyBlbHNlIHdpdGggYSBudWxsIHZhbHVlXG5cbiAgICBpZiAodmFsdWUgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHN3aXRjaCAocHJvcCkge1xuICAgICAgLy8gSWdub3JlIHNvbWUgUmVhY3QgTmF0aXZlIHN0eWxlc1xuICAgICAgY2FzZSAnZWxldmF0aW9uJzpcbiAgICAgIGNhc2UgJ292ZXJsYXlDb2xvcic6XG4gICAgICBjYXNlICdyZXNpemVNb2RlJzpcbiAgICAgIGNhc2UgJ3RpbnRDb2xvcic6XG4gICAgICAgIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICBjYXNlICdhc3BlY3RSYXRpbyc6XG4gICAgICAgIHtcbiAgICAgICAgICByZXNvbHZlZFN0eWxlW3Byb3BdID0gdmFsdWUudG9TdHJpbmcoKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgLy8gVE9ETzogcmVtb3ZlIG9uY2UgdGhpcyBpc3N1ZSBpcyBmaXhlZFxuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3JvZnJpc2NobWFubi9pbmxpbmUtc3R5bGUtcHJlZml4ZXIvaXNzdWVzLzE1OVxuXG4gICAgICBjYXNlICdiYWNrZ3JvdW5kQ2xpcCc6XG4gICAgICAgIHtcbiAgICAgICAgICBpZiAodmFsdWUgPT09ICd0ZXh0Jykge1xuICAgICAgICAgICAgcmVzb2x2ZWRTdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9IHZhbHVlO1xuICAgICAgICAgICAgcmVzb2x2ZWRTdHlsZS5XZWJraXRCYWNrZ3JvdW5kQ2xpcCA9IHZhbHVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAvLyBUaGUgJ2ZsZXgnIHByb3BlcnR5IHZhbHVlIGluIFJlYWN0IE5hdGl2ZSBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlcixcbiAgICAgIC8vIDAsIG9yIC0xLlxuXG4gICAgICBjYXNlICdmbGV4JzpcbiAgICAgICAge1xuICAgICAgICAgIGlmICh2YWx1ZSA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJlc29sdmVkU3R5bGUuZmxleEdyb3cgPSAwO1xuICAgICAgICAgICAgcmVzb2x2ZWRTdHlsZS5mbGV4U2hyaW5rID0gMTtcbiAgICAgICAgICAgIHJlc29sdmVkU3R5bGUuZmxleEJhc2lzID0gJ2F1dG8nO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlZFN0eWxlLmZsZXggPSB2YWx1ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICBjYXNlICdmb250JzpcbiAgICAgICAge1xuICAgICAgICAgIHJlc29sdmVkU3R5bGVbcHJvcF0gPSB2YWx1ZS5yZXBsYWNlKCdTeXN0ZW0nLCBfY29uc3RhbnRzLlNZU1RFTV9GT05UX1NUQUNLKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICBjYXNlICdmb250RmFtaWx5JzpcbiAgICAgICAge1xuICAgICAgICAgIGlmICh2YWx1ZS5pbmRleE9mKCdTeXN0ZW0nKSA+IC0xKSB7XG4gICAgICAgICAgICB2YXIgc3RhY2sgPSB2YWx1ZS5zcGxpdCgvLFxccyovKTtcbiAgICAgICAgICAgIHN0YWNrW3N0YWNrLmluZGV4T2YoJ1N5c3RlbScpXSA9IF9jb25zdGFudHMuU1lTVEVNX0ZPTlRfU1RBQ0s7XG4gICAgICAgICAgICByZXNvbHZlZFN0eWxlW3Byb3BdID0gc3RhY2suam9pbignLCcpO1xuICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09ICdtb25vc3BhY2UnKSB7XG4gICAgICAgICAgICByZXNvbHZlZFN0eWxlW3Byb3BdID0gX2NvbnN0YW50cy5NT05PU1BBQ0VfRk9OVF9TVEFDSztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzb2x2ZWRTdHlsZVtwcm9wXSA9IHZhbHVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgIGNhc2UgJ2ZvbnRWYXJpYW50JzpcbiAgICAgICAge1xuICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXNvbHZlZFN0eWxlLmZvbnRWYXJpYW50ID0gdmFsdWUuam9pbignICcpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgIGNhc2UgJ3RleHRBbGlnblZlcnRpY2FsJzpcbiAgICAgICAge1xuICAgICAgICAgIHJlc29sdmVkU3R5bGUudmVydGljYWxBbGlnbiA9IHZhbHVlID09PSAnY2VudGVyJyA/ICdtaWRkbGUnIDogdmFsdWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgY2FzZSAndGV4dERlY29yYXRpb25MaW5lJzpcbiAgICAgICAge1xuICAgICAgICAgIC8vIHVzZSAndGV4dC1kZWNvcmF0aW9uJyBmb3IgYnJvd3NlcnMgdGhhdCBvbmx5IHN1cHBvcnQgQ1NTMlxuICAgICAgICAgIC8vIHRleHQtZGVjb3JhdGlvbiAoZS5nLiwgSUUsIEVkZ2UpXG4gICAgICAgICAgaWYgKCFzdXBwb3J0c0NTUzNUZXh0RGVjb3JhdGlvbikge1xuICAgICAgICAgICAgcmVzb2x2ZWRTdHlsZS50ZXh0RGVjb3JhdGlvbiA9IHZhbHVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlZFN0eWxlLnRleHREZWNvcmF0aW9uTGluZSA9IHZhbHVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgIGNhc2UgJ3RyYW5zZm9ybSc6XG4gICAgICBjYXNlICd0cmFuc2Zvcm1NYXRyaXgnOlxuICAgICAgICB7XG4gICAgICAgICAgcmVzb2x2ZVRyYW5zZm9ybShyZXNvbHZlZFN0eWxlLCBzdHlsZSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgY2FzZSAnd3JpdGluZ0RpcmVjdGlvbic6XG4gICAgICAgIHtcbiAgICAgICAgICByZXNvbHZlZFN0eWxlLmRpcmVjdGlvbiA9IHZhbHVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHtcbiAgICAgICAgICB2YXIgbG9uZ0Zvcm1Qcm9wZXJ0aWVzID0gX2NvbnN0YW50cy5TVFlMRV9TSE9SVF9GT1JNX0VYUEFOU0lPTlNbcHJvcF07XG5cbiAgICAgICAgICBpZiAobG9uZ0Zvcm1Qcm9wZXJ0aWVzKSB7XG4gICAgICAgICAgICBsb25nRm9ybVByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAobG9uZ0Zvcm0sIGkpIHtcbiAgICAgICAgICAgICAgLy8gVGhlIHZhbHVlIG9mIGFueSBsb25nZm9ybSBwcm9wZXJ0eSBpbiB0aGUgb3JpZ2luYWwgc3R5bGVzIHRha2VzXG4gICAgICAgICAgICAgIC8vIHByZWNlZGVuY2Ugb3ZlciB0aGUgc2hvcnRmb3JtJ3MgdmFsdWUuXG4gICAgICAgICAgICAgIGlmICh0eXBlb2Ygc3R5bGVbbG9uZ0Zvcm1dID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHJlc29sdmVkU3R5bGVbbG9uZ0Zvcm1dID0gdmFsdWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlZFN0eWxlW3Byb3BdID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5qb2luKCcsJykgOiB2YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gIH0pO1xuICByZXR1cm4gcmVzb2x2ZWRTdHlsZTtcbn07XG5cbnZhciBfZGVmYXVsdCA9IGNyZWF0ZVJlYWN0RE9NU3R5bGU7XG5leHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0cy5kZWZhdWx0OyJdfQ==