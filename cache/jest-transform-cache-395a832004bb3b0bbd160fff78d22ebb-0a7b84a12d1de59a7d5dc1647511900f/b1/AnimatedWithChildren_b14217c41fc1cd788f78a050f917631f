ef4f25fd7a5935361acc912d0ad8ef9f
'use strict';

exports.__esModule = true;
exports.default = void 0;

var _AnimatedNode2 = _interopRequireDefault(require("./AnimatedNode"));

var _NativeAnimatedHelper = _interopRequireDefault(require("../NativeAnimatedHelper"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _createForOfIteratorHelperLoose(o, allowArrayLike) {
  var it;

  if (typeof Symbol === "undefined" || o[Symbol.iterator] == null) {
    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {
      if (it) o = it;
      var i = 0;
      return function () {
        if (i >= o.length) return {
          done: true
        };
        return {
          done: false,
          value: o[i++]
        };
      };
    }

    throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
  }

  it = o[Symbol.iterator]();
  return it.next.bind(it);
}

function _unsupportedIterableToArray(o, minLen) {
  if (!o) return;
  if (typeof o === "string") return _arrayLikeToArray(o, minLen);
  var n = Object.prototype.toString.call(o).slice(8, -1);
  if (n === "Object" && o.constructor) n = o.constructor.name;
  if (n === "Map" || n === "Set") return Array.from(o);
  if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}

function _arrayLikeToArray(arr, len) {
  if (len == null || len > arr.length) len = arr.length;

  for (var i = 0, arr2 = new Array(len); i < len; i++) {
    arr2[i] = arr[i];
  }

  return arr2;
}

function _inheritsLoose(subClass, superClass) {
  subClass.prototype = Object.create(superClass.prototype);
  subClass.prototype.constructor = subClass;

  _setPrototypeOf(subClass, superClass);
}

function _setPrototypeOf(o, p) {
  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {
    o.__proto__ = p;
    return o;
  };

  return _setPrototypeOf(o, p);
}

var AnimatedWithChildren = function (_AnimatedNode) {
  _inheritsLoose(AnimatedWithChildren, _AnimatedNode);

  function AnimatedWithChildren() {
    var _this;

    _this = _AnimatedNode.call(this) || this;
    _this._children = [];
    return _this;
  }

  var _proto = AnimatedWithChildren.prototype;

  _proto.__makeNative = function __makeNative() {
    if (!this.__isNative) {
      this.__isNative = true;

      for (var _iterator = _createForOfIteratorHelperLoose(this._children), _step; !(_step = _iterator()).done;) {
        var child = _step.value;

        child.__makeNative();

        _NativeAnimatedHelper.default.API.connectAnimatedNodes(this.__getNativeTag(), child.__getNativeTag());
      }
    }

    _AnimatedNode.prototype.__makeNative.call(this);
  };

  _proto.__addChild = function __addChild(child) {
    if (this._children.length === 0) {
      this.__attach();
    }

    this._children.push(child);

    if (this.__isNative) {
      child.__makeNative();

      _NativeAnimatedHelper.default.API.connectAnimatedNodes(this.__getNativeTag(), child.__getNativeTag());
    }
  };

  _proto.__removeChild = function __removeChild(child) {
    var index = this._children.indexOf(child);

    if (index === -1) {
      console.warn("Trying to remove a child that doesn't exist");
      return;
    }

    if (this.__isNative && child.__isNative) {
      _NativeAnimatedHelper.default.API.disconnectAnimatedNodes(this.__getNativeTag(), child.__getNativeTag());
    }

    this._children.splice(index, 1);

    if (this._children.length === 0) {
      this.__detach();
    }
  };

  _proto.__getChildren = function __getChildren() {
    return this._children;
  };

  _proto.__callListeners = function __callListeners(value) {
    _AnimatedNode.prototype.__callListeners.call(this, value);

    if (!this.__isNative) {
      for (var _iterator2 = _createForOfIteratorHelperLoose(this._children), _step2; !(_step2 = _iterator2()).done;) {
        var child = _step2.value;

        if (child.__getValue) {
          child.__callListeners(child.__getValue());
        }
      }
    }
  };

  return AnimatedWithChildren;
}(_AnimatedNode2.default);

var _default = AnimatedWithChildren;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuaW1hdGVkV2l0aENoaWxkcmVuLmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9BbmltYXRlZE5vZGUyIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfTmF0aXZlQW5pbWF0ZWRIZWxwZXIiLCJvYmoiLCJfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlckxvb3NlIiwibyIsImFsbG93QXJyYXlMaWtlIiwiaXQiLCJTeW1ib2wiLCJpdGVyYXRvciIsIkFycmF5IiwiaXNBcnJheSIsIl91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheSIsImxlbmd0aCIsImkiLCJkb25lIiwidmFsdWUiLCJUeXBlRXJyb3IiLCJuZXh0IiwiYmluZCIsIm1pbkxlbiIsIl9hcnJheUxpa2VUb0FycmF5IiwibiIsIk9iamVjdCIsInByb3RvdHlwZSIsInRvU3RyaW5nIiwiY2FsbCIsInNsaWNlIiwiY29uc3RydWN0b3IiLCJuYW1lIiwiZnJvbSIsInRlc3QiLCJhcnIiLCJsZW4iLCJhcnIyIiwiX2luaGVyaXRzTG9vc2UiLCJzdWJDbGFzcyIsInN1cGVyQ2xhc3MiLCJjcmVhdGUiLCJfc2V0UHJvdG90eXBlT2YiLCJwIiwic2V0UHJvdG90eXBlT2YiLCJfX3Byb3RvX18iLCJBbmltYXRlZFdpdGhDaGlsZHJlbiIsIl9BbmltYXRlZE5vZGUiLCJfdGhpcyIsIl9jaGlsZHJlbiIsIl9wcm90byIsIl9fbWFrZU5hdGl2ZSIsIl9faXNOYXRpdmUiLCJfaXRlcmF0b3IiLCJfc3RlcCIsImNoaWxkIiwiQVBJIiwiY29ubmVjdEFuaW1hdGVkTm9kZXMiLCJfX2dldE5hdGl2ZVRhZyIsIl9fYWRkQ2hpbGQiLCJfX2F0dGFjaCIsInB1c2giLCJfX3JlbW92ZUNoaWxkIiwiaW5kZXgiLCJpbmRleE9mIiwiY29uc29sZSIsIndhcm4iLCJkaXNjb25uZWN0QW5pbWF0ZWROb2RlcyIsInNwbGljZSIsIl9fZGV0YWNoIiwiX19nZXRDaGlsZHJlbiIsIl9fY2FsbExpc3RlbmVycyIsIl9pdGVyYXRvcjIiLCJfc3RlcDIiLCJfX2dldFZhbHVlIiwiX2RlZmF1bHQiLCJtb2R1bGUiXSwibWFwcGluZ3MiOiJBQVNBOztBQUVBQSxPQUFPLENBQUNDLFVBQVIsR0FBcUIsSUFBckI7QUFDQUQsT0FBTyxDQUFDRSxPQUFSLEdBQWtCLEtBQUssQ0FBdkI7O0FBRUEsSUFBSUMsY0FBYyxHQUFHQyxzQkFBc0IsQ0FBQ0MsT0FBTyxrQkFBUixDQUEzQzs7QUFFQSxJQUFJQyxxQkFBcUIsR0FBR0Ysc0JBQXNCLENBQUNDLE9BQU8sMkJBQVIsQ0FBbEQ7O0FBRUEsU0FBU0Qsc0JBQVQsQ0FBZ0NHLEdBQWhDLEVBQXFDO0FBQUUsU0FBT0EsR0FBRyxJQUFJQSxHQUFHLENBQUNOLFVBQVgsR0FBd0JNLEdBQXhCLEdBQThCO0FBQUVMLElBQUFBLE9BQU8sRUFBRUs7QUFBWCxHQUFyQztBQUF3RDs7QUFFL0YsU0FBU0MsK0JBQVQsQ0FBeUNDLENBQXpDLEVBQTRDQyxjQUE1QyxFQUE0RDtBQUFFLE1BQUlDLEVBQUo7O0FBQVEsTUFBSSxPQUFPQyxNQUFQLEtBQWtCLFdBQWxCLElBQWlDSCxDQUFDLENBQUNHLE1BQU0sQ0FBQ0MsUUFBUixDQUFELElBQXNCLElBQTNELEVBQWlFO0FBQUUsUUFBSUMsS0FBSyxDQUFDQyxPQUFOLENBQWNOLENBQWQsTUFBcUJFLEVBQUUsR0FBR0ssMkJBQTJCLENBQUNQLENBQUQsQ0FBckQsS0FBNkRDLGNBQWMsSUFBSUQsQ0FBbEIsSUFBdUIsT0FBT0EsQ0FBQyxDQUFDUSxNQUFULEtBQW9CLFFBQTVHLEVBQXNIO0FBQUUsVUFBSU4sRUFBSixFQUFRRixDQUFDLEdBQUdFLEVBQUo7QUFBUSxVQUFJTyxDQUFDLEdBQUcsQ0FBUjtBQUFXLGFBQU8sWUFBWTtBQUFFLFlBQUlBLENBQUMsSUFBSVQsQ0FBQyxDQUFDUSxNQUFYLEVBQW1CLE9BQU87QUFBRUUsVUFBQUEsSUFBSSxFQUFFO0FBQVIsU0FBUDtBQUF1QixlQUFPO0FBQUVBLFVB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QXpCLEVBQWdDO0FBQ3ZENEIsSUFBQUEsYUFBYSxDQUFDcEIsU0FBZCxDQUF3QjRDLGVBQXhCLENBQXdDMUMsSUFBeEMsQ0FBNkMsSUFBN0MsRUFBbURWLEtBQW5EOztBQUVBLFFBQUksQ0FBQyxLQUFLaUMsVUFBVixFQUFzQjtBQUNwQixXQUFLLElBQUlvQixVQUFVLEdBQUdqRSwrQkFBK0IsQ0FBQyxLQUFLMEMsU0FBTixDQUFoRCxFQUFrRXdCLE1BQXZFLEVBQStFLENBQUMsQ0FBQ0EsTUFBTSxHQUFHRCxVQUFVLEVBQXBCLEVBQXdCdEQsSUFBeEcsR0FBK0c7QUFDN0csWUFBSXFDLEtBQUssR0FBR2tCLE1BQU0sQ0FBQ3RELEtBQW5COztBQUVBLFlBQUlvQyxLQUFLLENBQUNtQixVQUFWLEVBQXNCO0FBQ3BCbkIsVUFBQUEsS0FBSyxDQUFDZ0IsZUFBTixDQUFzQmhCLEtBQUssQ0FBQ21CLFVBQU4sRUFBdEI7QUFDRDtBQUNGO0FBQ0Y7QUFDRixHQVpEOztBQWNBLFNBQU81QixvQkFBUDtBQUNELENBbEZ1QyxDQWtGdEM1QyxjQUFjLENBQUNELE9BbEZ1QixDQUF4Qzs7QUFvRkEsSUFBSTBFLFFBQVEsR0FBRzdCLG9CQUFmO0FBQ0EvQyxPQUFPLENBQUNFLE9BQVIsR0FBa0IwRSxRQUFsQjtBQUNBQyxNQUFNLENBQUM3RSxPQUFQLEdBQWlCQSxPQUFPLENBQUNFLE9BQXpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBcbiAqIEBmb3JtYXRcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwO1xuXG52YXIgX0FuaW1hdGVkTm9kZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL0FuaW1hdGVkTm9kZVwiKSk7XG5cbnZhciBfTmF0aXZlQW5pbWF0ZWRIZWxwZXIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi9OYXRpdmVBbmltYXRlZEhlbHBlclwiKSk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyTG9vc2UobywgYWxsb3dBcnJheUxpa2UpIHsgdmFyIGl0OyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gXCJ1bmRlZmluZWRcIiB8fCBvW1N5bWJvbC5pdGVyYXRvcl0gPT0gbnVsbCkgeyBpZiAoQXJyYXkuaXNBcnJheShvKSB8fCAoaXQgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobykpIHx8IGFsbG93QXJyYXlMaWtlICYmIG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSBcIm51bWJlclwiKSB7IGlmIChpdCkgbyA9IGl0OyB2YXIgaSA9IDA7IHJldHVybiBmdW5jdGlvbiAoKSB7IGlmIChpID49IG8ubGVuZ3RoKSByZXR1cm4geyBkb25lOiB0cnVlIH07IHJldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07IH07IH0gdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuXCIpOyB9IGl0ID0gb1tTeW1ib2wuaXRlcmF0b3JdKCk7IHJldHVybiBpdC5uZXh0LmJpbmQoaXQpOyB9XG5cbmZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHsgaWYgKCFvKSByZXR1cm47IGlmICh0eXBlb2YgbyA9PT0gXCJzdHJpbmdcIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7IHZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTsgaWYgKG4gPT09IFwiT2JqZWN0XCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTsgaWYgKG4gPT09IFwiTWFwXCIgfHwgbiA9PT0gXCJTZXRcIikgcmV0dXJuIEFycmF5LmZyb20obyk7IGlmIChuID09PSBcIkFyZ3VtZW50c1wiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsgfVxuXG5mdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikgeyBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH1cblxuZnVuY3Rpb24gX2luaGVyaXRzTG9vc2Uoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzLnByb3RvdHlwZSk7IHN1YkNsYXNzLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IHN1YkNsYXNzOyBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9XG5cbmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9XG5cbnZhciBBbmltYXRlZFdpdGhDaGlsZHJlbiA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0FuaW1hdGVkTm9kZSkge1xuICBfaW5oZXJpdHNMb29zZShBbmltYXRlZFdpdGhDaGlsZHJlbiwgX0FuaW1hdGVkTm9kZSk7XG5cbiAgZnVuY3Rpb24gQW5pbWF0ZWRXaXRoQ2hpbGRyZW4oKSB7XG4gICAgdmFyIF90aGlzO1xuXG4gICAgX3RoaXMgPSBfQW5pbWF0ZWROb2RlLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICBfdGhpcy5fY2hpbGRyZW4gPSBbXTtcbiAgICByZXR1cm4gX3RoaXM7XG4gIH1cblxuICB2YXIgX3Byb3RvID0gQW5pbWF0ZWRXaXRoQ2hpbGRyZW4ucHJvdG90eXBlO1xuXG4gIF9wcm90by5fX21ha2VOYXRpdmUgPSBmdW5jdGlvbiBfX21ha2VOYXRpdmUoKSB7XG4gICAgaWYgKCF0aGlzLl9faXNOYXRpdmUpIHtcbiAgICAgIHRoaXMuX19pc05hdGl2ZSA9IHRydWU7XG5cbiAgICAgIGZvciAodmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyTG9vc2UodGhpcy5fY2hpbGRyZW4pLCBfc3RlcDsgIShfc3RlcCA9IF9pdGVyYXRvcigpKS5kb25lOykge1xuICAgICAgICB2YXIgY2hpbGQgPSBfc3RlcC52YWx1ZTtcblxuICAgICAgICBjaGlsZC5fX21ha2VOYXRpdmUoKTtcblxuICAgICAgICBfTmF0aXZlQW5pbWF0ZWRIZWxwZXIuZGVmYXVsdC5BUEkuY29ubmVjdEFuaW1hdGVkTm9kZXModGhpcy5fX2dldE5hdGl2ZVRhZygpLCBjaGlsZC5fX2dldE5hdGl2ZVRhZygpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBfQW5pbWF0ZWROb2RlLnByb3RvdHlwZS5fX21ha2VOYXRpdmUuY2FsbCh0aGlzKTtcbiAgfTtcblxuICBfcHJvdG8uX19hZGRDaGlsZCA9IGZ1bmN0aW9uIF9fYWRkQ2hpbGQoY2hpbGQpIHtcbiAgICBpZiAodGhpcy5fY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLl9fYXR0YWNoKCk7XG4gICAgfVxuXG4gICAgdGhpcy5fY2hpbGRyZW4ucHVzaChjaGlsZCk7XG5cbiAgICBpZiAodGhpcy5fX2lzTmF0aXZlKSB7XG4gICAgICAvLyBPbmx5IGFjY2VwdCBcIm5hdGl2ZVwiIGFuaW1hdGVkIG5vZGVzIGFzIGNoaWxkcmVuXG4gICAgICBjaGlsZC5fX21ha2VOYXRpdmUoKTtcblxuICAgICAgX05hdGl2ZUFuaW1hdGVkSGVscGVyLmRlZmF1bHQuQVBJLmNvbm5lY3RBbmltYXRlZE5vZGVzKHRoaXMuX19nZXROYXRpdmVUYWcoKSwgY2hpbGQuX19nZXROYXRpdmVUYWcoKSk7XG4gICAgfVxuICB9O1xuXG4gIF9wcm90by5fX3JlbW92ZUNoaWxkID0gZnVuY3Rpb24gX19yZW1vdmVDaGlsZChjaGlsZCkge1xuICAgIHZhciBpbmRleCA9IHRoaXMuX2NoaWxkcmVuLmluZGV4T2YoY2hpbGQpO1xuXG4gICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgY29uc29sZS53YXJuKFwiVHJ5aW5nIHRvIHJlbW92ZSBhIGNoaWxkIHRoYXQgZG9lc24ndCBleGlzdFwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fX2lzTmF0aXZlICYmIGNoaWxkLl9faXNOYXRpdmUpIHtcbiAgICAgIF9OYXRpdmVBbmltYXRlZEhlbHBlci5kZWZhdWx0LkFQSS5kaXNjb25uZWN0QW5pbWF0ZWROb2Rlcyh0aGlzLl9fZ2V0TmF0aXZlVGFnKCksIGNoaWxkLl9fZ2V0TmF0aXZlVGFnKCkpO1xuICAgIH1cblxuICAgIHRoaXMuX2NoaWxkcmVuLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICBpZiAodGhpcy5fY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLl9fZGV0YWNoKCk7XG4gICAgfVxuICB9O1xuXG4gIF9wcm90by5fX2dldENoaWxkcmVuID0gZnVuY3Rpb24gX19nZXRDaGlsZHJlbigpIHtcbiAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW47XG4gIH07XG5cbiAgX3Byb3RvLl9fY2FsbExpc3RlbmVycyA9IGZ1bmN0aW9uIF9fY2FsbExpc3RlbmVycyh2YWx1ZSkge1xuICAgIF9BbmltYXRlZE5vZGUucHJvdG90eXBlLl9fY2FsbExpc3RlbmVycy5jYWxsKHRoaXMsIHZhbHVlKTtcblxuICAgIGlmICghdGhpcy5fX2lzTmF0aXZlKSB7XG4gICAgICBmb3IgKHZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXJMb29zZSh0aGlzLl9jaGlsZHJlbiksIF9zdGVwMjsgIShfc3RlcDIgPSBfaXRlcmF0b3IyKCkpLmRvbmU7KSB7XG4gICAgICAgIHZhciBjaGlsZCA9IF9zdGVwMi52YWx1ZTtcblxuICAgICAgICBpZiAoY2hpbGQuX19nZXRWYWx1ZSkge1xuICAgICAgICAgIGNoaWxkLl9fY2FsbExpc3RlbmVycyhjaGlsZC5fX2dldFZhbHVlKCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBBbmltYXRlZFdpdGhDaGlsZHJlbjtcbn0oX0FuaW1hdGVkTm9kZTIuZGVmYXVsdCk7XG5cbnZhciBfZGVmYXVsdCA9IEFuaW1hdGVkV2l0aENoaWxkcmVuO1xuZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHMuZGVmYXVsdDsiXX0=