e36c9655bebb3053dd03d9502b1fb941
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _wrapNativeSuper2 = _interopRequireDefault(require("@babel/runtime/helpers/wrapNativeSuper"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2.default)(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2.default)(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2.default)(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

var SyntheticError = function (_Error) {
  (0, _inherits2.default)(SyntheticError, _Error);

  var _super = _createSuper(SyntheticError);

  function SyntheticError() {
    var _this;

    (0, _classCallCheck2.default)(this, SyntheticError);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _super.call.apply(_super, [this].concat(args));
    _this.name = '';
    return _this;
  }

  return SyntheticError;
}((0, _wrapNativeSuper2.default)(Error));

var userExceptionDecorator;
var inUserExceptionDecorator = false;

function unstable_setExceptionDecorator(exceptionDecorator) {
  userExceptionDecorator = exceptionDecorator;
}

function preprocessException(data) {
  if (userExceptionDecorator && !inUserExceptionDecorator) {
    inUserExceptionDecorator = true;

    try {
      return userExceptionDecorator(data);
    } catch (_unused) {} finally {
      inUserExceptionDecorator = false;
    }
  }

  return data;
}

var exceptionID = 0;

function reportException(e, isFatal, reportToConsole) {
  var NativeExceptionsManager = require("./NativeExceptionsManager").default;

  if (NativeExceptionsManager) {
    var parseErrorStack = require("./Devtools/parseErrorStack");

    var stack = parseErrorStack(e == null ? void 0 : e.stack);
    var currentExceptionID = ++exceptionID;
    var originalMessage = e.message || '';
    var message = originalMessage;

    if (e.componentStack != null) {
      message += "\n\nThis error is located at:" + e.componentStack;
    }

    var namePrefix = e.name == null || e.name === '' ? '' : e.name + ": ";

    if (!message.startsWith(namePrefix)) {
      message = namePrefix + message;
    }

    message = e.jsEngine == null ? message : message + ", js engine: " + e.jsEngine;
    var isHandledByLogBox = e.forceRedbox !== true && !global.RN$Bridgeless && !global.RN$Express;
    var data = preprocessException({
      message: message,
      originalMessage: message === originalMessage ? null : originalMessage,
      name: e.name == null || e.name === '' ? null : e.name,
      componentStack: typeof e.componentStack === 'string' ? e.componentStack : null,
      stack: stack,
      id: currentExceptionID,
      isFatal: isFatal,
      extraData: {
        jsEngine: e.jsEngine,
        rawStack: e.stack,
        suppressRedBox: isHandledByLogBox
      }
    });

    if (reportToConsole) {
      console.error(data.message);
    }

    if (__DEV__ && isHandledByLogBox) {
      var LogBoxData = require("../LogBox/Data/LogBoxData");

      LogBoxData.addException(_objectSpread(_objectSpread({}, data), {}, {
        isComponentError: !!e.isComponentError
      }));
    }

    NativeExceptionsManager.reportException(data);

    if (__DEV__ && !global.RN$Express) {
      if (e.preventSymbolication === true) {
        return;
      }

      var symbolicateStackTrace = require("./Devtools/symbolicateStackTrace");

      symbolicateStackTrace(stack).then(function (_ref) {
        var prettyStack = _ref.stack;

        if (prettyStack) {
          NativeExceptionsManager.updateExceptionMessage(data.message, prettyStack, currentExceptionID);
        } else {
          throw new Error('The stack is null');
        }
      }).catch(function (error) {
        console.log('Unable to symbolicate stack trace: ' + error.message);
      });
    }
  } else if (reportToConsole) {
    console.error(e);
  }
}

var inExceptionHandler = false;

function handleException(e, isFatal) {
  var error;

  if (e instanceof Error) {
    error = e;
  } else {
    error = new SyntheticError(e);
  }

  try {
    inExceptionHandler = true;
    reportException(error, isFatal, true);
  } finally {
    inExceptionHandler = false;
  }
}

function reactConsoleErrorHandler() {
  console._errorOriginal.apply(console, arguments);

  if (!console.reportErrorsAsExceptions) {
    return;
  }

  if (inExceptionHandler) {
    return;
  }

  if (arguments[0] && arguments[0].stack) {
    reportException(arguments[0], false, false);
  } else {
    var stringifySafe = require("../Utilities/stringifySafe").default;

    var str = Array.prototype.map.call(arguments, function (value) {
      return typeof value === 'string' ? value : stringifySafe(value);
    }).join(' ');

    if (str.slice(0, 9) === 'Warning: ') {
      return;
    }

    var _error = new SyntheticError(str);

    _error.name = 'console.error';
    reportException(_error, false, false);
  }
}

function installConsoleErrorReporter() {
  if (console._errorOriginal) {
    return;
  }

  console._errorOriginal = console.error.bind(console);
  console.error = reactConsoleErrorHandler;

  if (console.reportErrorsAsExceptions === undefined) {
    console.reportErrorsAsExceptions = true;
  }
}

module.exports = {
  handleException: handleException,
  installConsoleErrorReporter: installConsoleErrorReporter,
  SyntheticError: SyntheticError,
  unstable_setExceptionDecorator: unstable_setExceptionDecorator
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkV4Y2VwdGlvbnNNYW5hZ2VyLmpzIl0sIm5hbWVzIjpbIlN5bnRoZXRpY0Vycm9yIiwibmFtZSIsIkVycm9yIiwidXNlckV4Y2VwdGlvbkRlY29yYXRvciIsImluVXNlckV4Y2VwdGlvbkRlY29yYXRvciIsInVuc3RhYmxlX3NldEV4Y2VwdGlvbkRlY29yYXRvciIsImV4Y2VwdGlvbkRlY29yYXRvciIsInByZXByb2Nlc3NFeGNlcHRpb24iLCJkYXRhIiwiZXhjZXB0aW9uSUQiLCJyZXBvcnRFeGNlcHRpb24iLCJlIiwiaXNGYXRhbCIsInJlcG9ydFRvQ29uc29sZSIsIk5hdGl2ZUV4Y2VwdGlvbnNNYW5hZ2VyIiwicmVxdWlyZSIsImRlZmF1bHQiLCJwYXJzZUVycm9yU3RhY2siLCJzdGFjayIsImN1cnJlbnRFeGNlcHRpb25JRCIsIm9yaWdpbmFsTWVzc2FnZSIsIm1lc3NhZ2UiLCJjb21wb25lbnRTdGFjayIsIm5hbWVQcmVmaXgiLCJzdGFydHNXaXRoIiwianNFbmdpbmUiLCJpc0hhbmRsZWRCeUxvZ0JveCIsImZvcmNlUmVkYm94IiwiZ2xvYmFsIiwiUk4kQnJpZGdlbGVzcyIsIlJOJEV4cHJlc3MiLCJpZCIsImV4dHJhRGF0YSIsInJhd1N0YWNrIiwic3VwcHJlc3NSZWRCb3giLCJjb25zb2xlIiwiZXJyb3IiLCJfX0RFVl9fIiwiTG9nQm94RGF0YSIsImFkZEV4Y2VwdGlvbiIsImlzQ29tcG9uZW50RXJyb3IiLCJwcmV2ZW50U3ltYm9saWNhdGlvbiIsInN5bWJvbGljYXRlU3RhY2tUcmFjZSIsInRoZW4iLCJwcmV0dHlTdGFjayIsInVwZGF0ZUV4Y2VwdGlvbk1lc3NhZ2UiLCJjYXRjaCIsImxvZyIsImluRXhjZXB0aW9uSGFuZGxlciIsImhhbmRsZUV4Y2VwdGlvbiIsInJlYWN0Q29uc29sZUVycm9ySGFuZGxlciIsIl9lcnJvck9yaWdpbmFsIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJyZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnMiLCJzdHJpbmdpZnlTYWZlIiwic3RyIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJtYXAiLCJjYWxsIiwidmFsdWUiLCJqb2luIiwic2xpY2UiLCJpbnN0YWxsQ29uc29sZUVycm9yUmVwb3J0ZXIiLCJiaW5kIiwidW5kZWZpbmVkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQUtNQSxjOzs7Ozs7Ozs7Ozs7Ozs7VUFDSkMsSSxHQUFlLEU7Ozs7O2lDQURZQyxLOztBQU03QixJQUFJQyxzQkFBSjtBQUNBLElBQUlDLHdCQUF3QixHQUFHLEtBQS9COztBQU9BLFNBQVNDLDhCQUFULENBQ0VDLGtCQURGLEVBRUU7QUFDQUgsRUFBQUEsc0JBQXNCLEdBQUdHLGtCQUF6QjtBQUNEOztBQUVELFNBQVNDLG1CQUFULENBQTZCQyxJQUE3QixFQUFpRTtBQUMvRCxNQUFJTCxzQkFBc0IsSUFBSSxDQUFDQyx3QkFBL0IsRUFBeUQ7QUFDdkRBLElBQUFBLHdCQUF3QixHQUFHLElBQTNCOztBQUNBLFFBQUk7QUFDRixhQUFPRCxzQkFBc0IsQ0FBQ0ssSUFBRCxDQUE3QjtBQUNELEtBRkQsQ0FFRSxnQkFBTSxDQUVQLENBSkQsU0FJVTtBQUNSSixNQUFBQSx3QkFBd0IsR0FBRyxLQUEzQjtBQUNEO0FBQ0Y7O0FBQ0QsU0FBT0ksSUFBUDtBQUNEOztBQUtELElBQUlDLFdBQVcsR0FBRyxDQUFsQjs7QUFDQSxTQUFTQyxlQUFULENBQ0VDLENBREYsRUFFRUMsT0FGRixFQUdFQyxlQUhGLEVBSUU7QUFDQSxNQUFNQyx1QkFBdUIsR0FBR0MsT0FBTyw2QkFBUCxDQUFxQ0MsT0FBckU7O0FBQ0EsTUFBSUYsdUJBQUosRUFBNkI7QUFDM0IsUUFBTUcsZUFBZSxHQUFHRixPQUFPLDhCQUEvQjs7QUFDQSxRQUFNRyxLQUFLLEdBQUdELGVBQWUsQ0FBQ04sQ0FBRCxvQkFBQ0EsQ0FBQyxDQUFFTyxLQUFKLENBQTdCO0FBQ0EsUUFBTUMsa0JBQWtCLEdBQUcsRUFBRVYsV0FBN0I7QUFD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RC9CLElBQUFBLE9BQU8sQ0FBQ21CLHdCQUFSLEdBQW1DLElBQW5DO0FBQ0Q7QUFDRjs7QUFFRGEsTUFBTSxDQUFDQyxPQUFQLEdBQWlCO0FBQ2ZuQixFQUFBQSxlQUFlLEVBQWZBLGVBRGU7QUFFZmUsRUFBQUEsMkJBQTJCLEVBQTNCQSwyQkFGZTtBQUdmaEUsRUFBQUEsY0FBYyxFQUFkQSxjQUhlO0FBSWZLLEVBQUFBLDhCQUE4QixFQUE5QkE7QUFKZSxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZvcm1hdFxuICogQGZsb3cgc3RyaWN0LWxvY2FsXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgdHlwZSB7RXh0ZW5kZWRFcnJvcn0gZnJvbSAnLi9EZXZ0b29scy9wYXJzZUVycm9yU3RhY2snO1xuaW1wb3J0IHR5cGUge0V4Y2VwdGlvbkRhdGF9IGZyb20gJy4vTmF0aXZlRXhjZXB0aW9uc01hbmFnZXInO1xuXG5jbGFzcyBTeW50aGV0aWNFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgbmFtZTogc3RyaW5nID0gJyc7XG59XG5cbnR5cGUgRXhjZXB0aW9uRGVjb3JhdG9yID0gRXhjZXB0aW9uRGF0YSA9PiBFeGNlcHRpb25EYXRhO1xuXG5sZXQgdXNlckV4Y2VwdGlvbkRlY29yYXRvcjogP0V4Y2VwdGlvbkRlY29yYXRvcjtcbmxldCBpblVzZXJFeGNlcHRpb25EZWNvcmF0b3IgPSBmYWxzZTtcblxuLyoqXG4gKiBBbGxvd3MgdGhlIGFwcCB0byBhZGQgaW5mb3JtYXRpb24gdG8gdGhlIGV4Y2VwdGlvbiByZXBvcnQgYmVmb3JlIGl0IGlzIHNlbnRcbiAqIHRvIG5hdGl2ZS4gVGhpcyBBUEkgaXMgbm90IGZpbmFsLlxuICovXG5cbmZ1bmN0aW9uIHVuc3RhYmxlX3NldEV4Y2VwdGlvbkRlY29yYXRvcihcbiAgZXhjZXB0aW9uRGVjb3JhdG9yOiA/RXhjZXB0aW9uRGVjb3JhdG9yLFxuKSB7XG4gIHVzZXJFeGNlcHRpb25EZWNvcmF0b3IgPSBleGNlcHRpb25EZWNvcmF0b3I7XG59XG5cbmZ1bmN0aW9uIHByZXByb2Nlc3NFeGNlcHRpb24oZGF0YTogRXhjZXB0aW9uRGF0YSk6IEV4Y2VwdGlvbkRhdGEge1xuICBpZiAodXNlckV4Y2VwdGlvbkRlY29yYXRvciAmJiAhaW5Vc2VyRXhjZXB0aW9uRGVjb3JhdG9yKSB7XG4gICAgaW5Vc2VyRXhjZXB0aW9uRGVjb3JhdG9yID0gdHJ1ZTtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIHVzZXJFeGNlcHRpb25EZWNvcmF0b3IoZGF0YSk7XG4gICAgfSBjYXRjaCB7XG4gICAgICAvLyBGYWxsIHRocm91Z2hcbiAgICB9IGZpbmFsbHkge1xuICAgICAgaW5Vc2VyRXhjZXB0aW9uRGVjb3JhdG9yID0gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiBkYXRhO1xufVxuXG4vKipcbiAqIEhhbmRsZXMgdGhlIGRldmVsb3Blci12aXNpYmxlIGFzcGVjdCBvZiBlcnJvcnMgYW5kIGV4Y2VwdGlvbnNcbiAqL1xubGV0IGV4Y2VwdGlvbklEID0gMDtcbmZ1bmN0aW9uIHJlcG9ydEV4Y2VwdGlvbihcbiAgZTogRXh0ZW5kZWRFcnJvcixcbiAgaXNGYXRhbDogYm9vbGVhbixcbiAgcmVwb3J0VG9Db25zb2xlOiBib29sZWFuLCAvLyBvbmx5IHRydWUgd2hlbiBjb21pbmcgZnJvbSBoYW5kbGVFeGNlcHRpb247IHRoZSBlcnJvciBoYXMgbm90IHlldCBiZWVuIGxvZ2dlZFxuKSB7XG4gIGNvbnN0IE5hdGl2ZUV4Y2VwdGlvbnNNYW5hZ2VyID0gcmVxdWlyZSgnLi9OYXRpdmVFeGNlcHRpb25zTWFuYWdlcicpLmRlZmF1bHQ7XG4gIGlmIChOYXRpdmVFeGNlcHRpb25zTWFuYWdlcikge1xuICAgIGNvbnN0IHBhcnNlRXJyb3JTdGFjayA9IHJlcXVpcmUoJy4vRGV2dG9vbHMvcGFyc2VFcnJvclN0YWNrJyk7XG4gICAgY29uc3Qgc3RhY2sgPSBwYXJzZUVycm9yU3RhY2soZT8uc3RhY2spO1xuICAgIGNvbnN0IGN1cnJlbnRFeGNlcHRpb25JRCA9ICsrZXhjZXB0aW9uSUQ7XG4gICAgY29uc3Qgb3JpZ2luYWxNZXNzYWdlID0gZS5tZXNzYWdlIHx8ICcnO1xuICAgIGxldCBtZXNzYWdlID0gb3JpZ2luYWxNZXNzYWdlO1xuICAgIGlmIChlLmNvbXBvbmVudFN0YWNrICE9IG51bGwpIHtcbiAgICAgIG1lc3NhZ2UgKz0gYFxcblxcblRoaXMgZXJyb3IgaXMgbG9jYXRlZCBhdDoke2UuY29tcG9uZW50U3RhY2t9YDtcbiAgICB9XG4gICAgY29uc3QgbmFtZVByZWZpeCA9IGUubmFtZSA9PSBudWxsIHx8IGUubmFtZSA9PT0gJycgPyAnJyA6IGAke2UubmFtZX06IGA7XG5cbiAgICBpZiAoIW1lc3NhZ2Uuc3RhcnRzV2l0aChuYW1lUHJlZml4KSkge1xuICAgICAgbWVzc2FnZSA9IG5hbWVQcmVmaXggKyBtZXNzYWdlO1xuICAgIH1cblxuICAgIG1lc3NhZ2UgPVxuICAgICAgZS5qc0VuZ2luZSA9PSBudWxsID8gbWVzc2FnZSA6IGAke21lc3NhZ2V9LCBqcyBlbmdpbmU6ICR7ZS5qc0VuZ2luZX1gO1xuXG4gICAgY29uc3QgaXNIYW5kbGVkQnlMb2dCb3ggPVxuICAgICAgZS5mb3JjZVJlZGJveCAhPT0gdHJ1ZSAmJiAhZ2xvYmFsLlJOJEJyaWRnZWxlc3MgJiYgIWdsb2JhbC5STiRFeHByZXNzO1xuXG4gICAgY29uc3QgZGF0YSA9IHByZXByb2Nlc3NFeGNlcHRpb24oe1xuICAgICAgbWVzc2FnZSxcbiAgICAgIG9yaWdpbmFsTWVzc2FnZTogbWVzc2FnZSA9PT0gb3JpZ2luYWxNZXNzYWdlID8gbnVsbCA6IG9yaWdpbmFsTWVzc2FnZSxcbiAgICAgIG5hbWU6IGUubmFtZSA9PSBudWxsIHx8IGUubmFtZSA9PT0gJycgPyBudWxsIDogZS5uYW1lLFxuICAgICAgY29tcG9uZW50U3RhY2s6XG4gICAgICAgIHR5cGVvZiBlLmNvbXBvbmVudFN0YWNrID09PSAnc3RyaW5nJyA/IGUuY29tcG9uZW50U3RhY2sgOiBudWxsLFxuICAgICAgc3RhY2ssXG4gICAgICBpZDogY3VycmVudEV4Y2VwdGlvbklELFxuICAgICAgaXNGYXRhbCxcbiAgICAgIGV4dHJhRGF0YToge1xuICAgICAgICBqc0VuZ2luZTogZS5qc0VuZ2luZSxcbiAgICAgICAgcmF3U3RhY2s6IGUuc3RhY2ssXG5cbiAgICAgICAgLy8gSGFjayB0byBoaWRlIG5hdGl2ZSByZWRib3hlcyB3aGVuIGluIHRoZSBMb2dCb3ggZXhwZXJpbWVudC5cbiAgICAgICAgLy8gVGhpcyBpcyBpbnRlbnRpb25hbGx5IHVudHlwZWQgYW5kIHN0dWZmZWQgaGVyZSwgYmVjYXVzZSBpdCBpcyB0ZW1wb3JhcnkuXG4gICAgICAgIHN1cHByZXNzUmVkQm94OiBpc0hhbmRsZWRCeUxvZ0JveCxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAocmVwb3J0VG9Db25zb2xlKSB7XG4gICAgICAvLyB3ZSBmZWVkIGJhY2sgaW50byBjb25zb2xlLmVycm9yLCB0byBtYWtlIHN1cmUgYW55IG1ldGhvZHMgdGhhdCBhcmVcbiAgICAgIC8vIG1vbmtleSBwYXRjaGVkIG9uIHRvcCBvZiBjb25zb2xlLmVycm9yIGFyZSBjYWxsZWQgd2hlbiBjb21pbmcgZnJvbVxuICAgICAgLy8gaGFuZGxlRXhjZXB0aW9uXG4gICAgICBjb25zb2xlLmVycm9yKGRhdGEubWVzc2FnZSk7XG4gICAgfVxuXG4gICAgaWYgKF9fREVWX18gJiYgaXNIYW5kbGVkQnlMb2dCb3gpIHtcbiAgICAgIGNvbnN0IExvZ0JveERhdGEgPSByZXF1aXJlKCcuLi9Mb2dCb3gvRGF0YS9Mb2dCb3hEYXRhJyk7XG4gICAgICBMb2dCb3hEYXRhLmFkZEV4Y2VwdGlvbih7XG4gICAgICAgIC4uLmRhdGEsXG4gICAgICAgIGlzQ29tcG9uZW50RXJyb3I6ICEhZS5pc0NvbXBvbmVudEVycm9yLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgTmF0aXZlRXhjZXB0aW9uc01hbmFnZXIucmVwb3J0RXhjZXB0aW9uKGRhdGEpO1xuXG4gICAgaWYgKF9fREVWX18gJiYgIWdsb2JhbC5STiRFeHByZXNzKSB7XG4gICAgICBpZiAoZS5wcmV2ZW50U3ltYm9saWNhdGlvbiA9PT0gdHJ1ZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBzeW1ib2xpY2F0ZVN0YWNrVHJhY2UgPSByZXF1aXJlKCcuL0RldnRvb2xzL3N5bWJvbGljYXRlU3RhY2tUcmFjZScpO1xuICAgICAgc3ltYm9saWNhdGVTdGFja1RyYWNlKHN0YWNrKVxuICAgICAgICAudGhlbigoe3N0YWNrOiBwcmV0dHlTdGFja30pID0+IHtcbiAgICAgICAgICBpZiAocHJldHR5U3RhY2spIHtcbiAgICAgICAgICAgIE5hdGl2ZUV4Y2VwdGlvbnNNYW5hZ2VyLnVwZGF0ZUV4Y2VwdGlvbk1lc3NhZ2UoXG4gICAgICAgICAgICAgIGRhdGEubWVzc2FnZSxcbiAgICAgICAgICAgICAgcHJldHR5U3RhY2ssXG4gICAgICAgICAgICAgIGN1cnJlbnRFeGNlcHRpb25JRCxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHN0YWNrIGlzIG51bGwnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ1VuYWJsZSB0byBzeW1ib2xpY2F0ZSBzdGFjayB0cmFjZTogJyArIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICB9KTtcbiAgICB9XG4gIH0gZWxzZSBpZiAocmVwb3J0VG9Db25zb2xlKSB7XG4gICAgLy8gd2UgZmVlZCBiYWNrIGludG8gY29uc29sZS5lcnJvciwgdG8gbWFrZSBzdXJlIGFueSBtZXRob2RzIHRoYXQgYXJlXG4gICAgLy8gbW9ua2V5IHBhdGNoZWQgb24gdG9wIG9mIGNvbnNvbGUuZXJyb3IgYXJlIGNhbGxlZCB3aGVuIGNvbWluZyBmcm9tXG4gICAgLy8gaGFuZGxlRXhjZXB0aW9uXG4gICAgY29uc29sZS5lcnJvcihlKTtcbiAgfVxufVxuXG5kZWNsYXJlIHZhciBjb25zb2xlOiB0eXBlb2YgY29uc29sZSAmIHtcbiAgX2Vycm9yT3JpZ2luYWw6IHR5cGVvZiBjb25zb2xlLmVycm9yLFxuICByZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnM6IGJvb2xlYW4sXG4gIC4uLlxufTtcblxuLy8gSWYgd2UgdHJpZ2dlciBjb25zb2xlLmVycm9yIF9mcm9tXyBoYW5kbGVFeGNlcHRpb24sXG4vLyB3ZSBkbyB3YW50IHRvIG1ha2Ugc3VyZSB0aGF0IGNvbnNvbGUuZXJyb3IgZG9lc24ndCB0cmlnZ2VyIGVycm9yIHJlcG9ydGluZyBhZ2FpblxubGV0IGluRXhjZXB0aW9uSGFuZGxlciA9IGZhbHNlO1xuXG4vKipcbiAqIExvZ3MgZXhjZXB0aW9ucyB0byB0aGUgKG5hdGl2ZSkgY29uc29sZSBhbmQgZGlzcGxheXMgdGhlbVxuICovXG5mdW5jdGlvbiBoYW5kbGVFeGNlcHRpb24oZTogbWl4ZWQsIGlzRmF0YWw6IGJvb2xlYW4pIHtcbiAgbGV0IGVycm9yOiBFcnJvcjtcbiAgaWYgKGUgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIGVycm9yID0gZTtcbiAgfSBlbHNlIHtcbiAgICAvLyBXb3JrYXJvdW5kIGZvciByZXBvcnRpbmcgZXJyb3JzIGNhdXNlZCBieSBgdGhyb3cgJ3NvbWUgc3RyaW5nJ2BcbiAgICAvLyBVbmZvcnR1bmF0ZWx5IHRoZXJlIGlzIG5vIHdheSB0byBmaWd1cmUgb3V0IHRoZSBzdGFja3RyYWNlIGluIHRoaXNcbiAgICAvLyBjYXNlLCBzbyBpZiB5b3UgZW5kZWQgdXAgaGVyZSB0cnlpbmcgdG8gdHJhY2UgYW4gZXJyb3IsIGxvb2sgZm9yXG4gICAgLy8gYHRocm93ICc8ZXJyb3IgbWVzc2FnZT4nYCBzb21ld2hlcmUgaW4geW91ciBjb2RlYmFzZS5cbiAgICBlcnJvciA9IG5ldyBTeW50aGV0aWNFcnJvcihlKTtcbiAgfVxuICB0cnkge1xuICAgIGluRXhjZXB0aW9uSGFuZGxlciA9IHRydWU7XG4gICAgcmVwb3J0RXhjZXB0aW9uKGVycm9yLCBpc0ZhdGFsLCAvKnJlcG9ydFRvQ29uc29sZSovIHRydWUpO1xuICB9IGZpbmFsbHkge1xuICAgIGluRXhjZXB0aW9uSGFuZGxlciA9IGZhbHNlO1xuICB9XG59XG5cbmZ1bmN0aW9uIHJlYWN0Q29uc29sZUVycm9ySGFuZGxlcigpIHtcbiAgLy8gYnViYmxlIHVwIHRvIGFueSBvcmlnaW5hbCBoYW5kbGVyc1xuICBjb25zb2xlLl9lcnJvck9yaWdpbmFsLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gIGlmICghY29uc29sZS5yZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnMpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKGluRXhjZXB0aW9uSGFuZGxlcikge1xuICAgIC8vIFRoZSBmdW5kYW1lbnRhbCB0cmljayBoZXJlIGlzIHRoYXQgYXJlIG11bHRpcGxlIGVudHJ5IHBvaW50IHRvIGxvZ2dpbmcgZXJyb3JzOlxuICAgIC8vIChzZWUgRDE5NzQzMDc1IGZvciBtb3JlIGJhY2tncm91bmQpXG4gICAgLy9cbiAgICAvLyAxLiBBbiB1bmNhdWdodCBleGNlcHRpb24gYmVpbmcgY2F1Z2h0IGJ5IHRoZSBnbG9iYWwgaGFuZGxlclxuICAgIC8vIDIuIEFuIGVycm9yIGJlaW5nIGxvZ2dlZCB0aHJvdyBjb25zb2xlLmVycm9yXG4gICAgLy9cbiAgICAvLyBIb3dldmVyLCBjb25zb2xlLmVycm9yIGlzIG1vbmtleSBwYXRjaGVkIG11bHRpcGxlIHRpbWVzOiBieSB0aGlzIG1vZHVsZSwgYW5kIGJ5IHRoZVxuICAgIC8vIERldlRvb2xzIHNldHVwIHRoYXQgc2VuZHMgbWVzc2FnZXMgdG8gTWV0cm8uXG4gICAgLy8gVGhlIHBhdGNoaW5nIG9yZGVyIGNhbm5vdCBiZSByZWxpZWQgdXBvbi5cbiAgICAvL1xuICAgIC8vIFNvLCBzb21lIHNjZW5hcmlvcyB0aGF0IGFyZSBoYW5kbGVkIGJ5IHRoaXMgZmxhZzpcbiAgICAvL1xuICAgIC8vIExvZ2dpbmcgYW4gZXJyb3I6XG4gICAgLy8gMS4gY29uc29sZS5lcnJvciBjYWxsZWQgZnJvbSB1c2VyIGNvZGVcbiAgICAvLyAyLiAocG9zc2libHkpIGFycml2ZXMgX2ZpcnN0XyBhdCBEZXZUb29sIGhhbmRsZXIsIHNlbmQgdG8gTWV0cm9cbiAgICAvLyAzLiBCdWJibGVzIHRvIGhlcmVcbiAgICAvLyA0LiBnb2VzIGludG8gcmVwb3J0IEV4Y2VwdGlvbi5cbiAgICAvLyA1LiBzaG91bGQgbm90IHRyaWdnZXIgY29uc29sZS5lcnJvciBhZ2FpbiwgdG8gYXZvaWQgbG9vcGluZyAvIGxvZ2dpbmcgdHdpY2VcbiAgICAvLyA2LiBzaG91bGQgc3RpbGwgYnViYmxlIHVwIHRvIG9yaWdpbmFsIGNvbnNvbGVcbiAgICAvLyAgICAod2hpY2ggbWlnaHQgZWl0aGVyIGJlIGNvbnNvbGUubG9nLCBvciB0aGUgRGV2VG9vbHMgaGFuZGxlciBpbiBjYXNlIGl0IHBhdGNoZWQgX2VhcmxpZXJfIGFuZCAoMikgZGlkbid0IGhhcHBlbilcbiAgICAvL1xuICAgIC8vIFRocm93aW5nIGFuIHVuY2F1Z2h0IGV4Y2VwdGlvbjpcbiAgICAvLyAxLiBleGNlcHRpb24gdGhyb3duXG4gICAgLy8gMi4gcGlja2VkIHVwIGJ5IGhhbmRsZUV4Y2VwdGlvblxuICAgIC8vIDMuIHNob3VsZCBiZSBzZW5kIHRvIGNvbnNvbGUuZXJyb3IgKG5vdCBjb25zb2xlLl9lcnJvck9yaWdpbmFsLCBhcyBEZXZUb29scyBtaWdodCBoYXZlIHBhdGNoZWQgX2xhdGVyXyBhbmQgaXQgbmVlZHMgdG8gc2VuZCBpdCB0byBNZXRybylcbiAgICAvLyA0LiB0aGF0IF9taWdodF8gYnViYmxlIGFnYWluIHRvIHRoZSBgcmVhY3RDb25zb2xlRXJyb3JIYW5kbGVgIGRlZmluZWQgaGVyZVxuICAgIC8vICAgIC0+IHNob3VsZCBub3QgaGFuZGxlIGV4Y2VwdGlvbiBfYWdhaW5fLCB0byBhdm9pZCBsb29waW5nIC8gc2hvd2luZyB0d2ljZSAodGhpcyBjb2RlIGJyYW5jaClcbiAgICAvLyA1LiBzaG91bGQgc3RpbGwgYnViYmxlIHVwIHRvIG9yaWdpbmFsIGNvbnNvbGUgKHdoaWNoIG1pZ2h0IGVpdGhlciBiZSBjb25zb2xlLmxvZywgb3IgdGhlIERldlRvb2xzIGhhbmRsZXIgaW4gY2FzZSB0aGF0IG9uZSBwYXRjaGVkIF9lYXJsaWVyXylcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoYXJndW1lbnRzWzBdICYmIGFyZ3VtZW50c1swXS5zdGFjaykge1xuICAgIC8vIHJlcG9ydEV4Y2VwdGlvbiB3aWxsIGNvbnNvbGUuZXJyb3IgdGhpcyB3aXRoIGhpZ2ggZW5vdWdoIGZpZGVsaXR5LlxuICAgIHJlcG9ydEV4Y2VwdGlvbihcbiAgICAgIGFyZ3VtZW50c1swXSxcbiAgICAgIC8qIGlzRmF0YWwgKi8gZmFsc2UsXG4gICAgICAvKnJlcG9ydFRvQ29uc29sZSovIGZhbHNlLFxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3Qgc3RyaW5naWZ5U2FmZSA9IHJlcXVpcmUoJy4uL1V0aWxpdGllcy9zdHJpbmdpZnlTYWZlJykuZGVmYXVsdDtcbiAgICBjb25zdCBzdHIgPSBBcnJheS5wcm90b3R5cGUubWFwXG4gICAgICAuY2FsbChhcmd1bWVudHMsIHZhbHVlID0+XG4gICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyB2YWx1ZSA6IHN0cmluZ2lmeVNhZmUodmFsdWUpLFxuICAgICAgKVxuICAgICAgLmpvaW4oJyAnKTtcblxuICAgIGlmIChzdHIuc2xpY2UoMCwgOSkgPT09ICdXYXJuaW5nOiAnKSB7XG4gICAgICAvLyBSZWFjdCB3YXJuaW5ncyB1c2UgY29uc29sZS5lcnJvciBzbyB0aGF0IGEgc3RhY2sgdHJhY2UgaXMgc2hvd24sIGJ1dFxuICAgICAgLy8gd2UgZG9uJ3QgKGN1cnJlbnRseSkgd2FudCB0aGVzZSB0byBzaG93IGEgcmVkYm94XG4gICAgICAvLyAoTm90ZTogTG9naWMgZHVwbGljYXRlZCBpbiBwb2x5ZmlsbHMvY29uc29sZS5qcy4pXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGVycm9yOiBFeHRlbmRlZEVycm9yID0gbmV3IFN5bnRoZXRpY0Vycm9yKHN0cik7XG4gICAgZXJyb3IubmFtZSA9ICdjb25zb2xlLmVycm9yJztcbiAgICByZXBvcnRFeGNlcHRpb24oZXJyb3IsIC8qIGlzRmF0YWwgKi8gZmFsc2UsIC8qcmVwb3J0VG9Db25zb2xlKi8gZmFsc2UpO1xuICB9XG59XG5cbi8qKlxuICogU2hvd3MgYSByZWRib3ggd2l0aCBzdGFja3RyYWNlIGZvciBhbGwgY29uc29sZS5lcnJvciBtZXNzYWdlcy4gIERpc2FibGUgYnlcbiAqIHNldHRpbmcgYGNvbnNvbGUucmVwb3J0RXJyb3JzQXNFeGNlcHRpb25zID0gZmFsc2U7YCBpbiB5b3VyIGFwcC5cbiAqL1xuZnVuY3Rpb24gaW5zdGFsbENvbnNvbGVFcnJvclJlcG9ydGVyKCkge1xuICAvLyBFbmFibGUgcmVwb3J0RXJyb3JzQXNFeGNlcHRpb25zXG4gIGlmIChjb25zb2xlLl9lcnJvck9yaWdpbmFsKSB7XG4gICAgcmV0dXJuOyAvLyBhbHJlYWR5IGluc3RhbGxlZFxuICB9XG4gIC8vIEZsb3cgZG9lc24ndCBsaWtlIGl0IHdoZW4geW91IHNldCBhcmJpdHJhcnkgdmFsdWVzIG9uIGEgZ2xvYmFsIG9iamVjdFxuICBjb25zb2xlLl9lcnJvck9yaWdpbmFsID0gY29uc29sZS5lcnJvci5iaW5kKGNvbnNvbGUpO1xuICBjb25zb2xlLmVycm9yID0gcmVhY3RDb25zb2xlRXJyb3JIYW5kbGVyO1xuICBpZiAoY29uc29sZS5yZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnMgPT09IHVuZGVmaW5lZCkge1xuICAgIC8vIEluZGl2aWR1YWwgYXBwcyBjYW4gZGlzYWJsZSB0aGlzXG4gICAgLy8gRmxvdyBkb2Vzbid0IGxpa2UgaXQgd2hlbiB5b3Ugc2V0IGFyYml0cmFyeSB2YWx1ZXMgb24gYSBnbG9iYWwgb2JqZWN0XG4gICAgY29uc29sZS5yZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnMgPSB0cnVlO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBoYW5kbGVFeGNlcHRpb24sXG4gIGluc3RhbGxDb25zb2xlRXJyb3JSZXBvcnRlcixcbiAgU3ludGhldGljRXJyb3IsXG4gIHVuc3RhYmxlX3NldEV4Y2VwdGlvbkRlY29yYXRvcixcbn07XG4iXX0=