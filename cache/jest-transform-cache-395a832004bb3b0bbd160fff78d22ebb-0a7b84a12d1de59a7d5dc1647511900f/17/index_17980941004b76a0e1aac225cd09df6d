d7e4a9ba945b7112e1ddde2a27e26edc
"use strict";

exports.__esModule = true;
exports.default = useHover;

var _modality = require("../modality");

var _useEvent = _interopRequireDefault(require("../useEvent"));

var _useLayoutEffect = _interopRequireDefault(require("../useLayoutEffect"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

var emptyObject = {};
var opts = {
  passive: true
};
var lockEventType = 'react-gui:hover:lock';
var unlockEventType = 'react-gui:hover:unlock';

var supportsPointerEvent = function supportsPointerEvent() {
  return !!(typeof window !== 'undefined' && window.PointerEvent != null);
};

function dispatchCustomEvent(target, type, payload) {
  var event = document.createEvent('CustomEvent');

  var _ref = payload || emptyObject,
      _ref$bubbles = _ref.bubbles,
      bubbles = _ref$bubbles === void 0 ? true : _ref$bubbles,
      _ref$cancelable = _ref.cancelable,
      cancelable = _ref$cancelable === void 0 ? true : _ref$cancelable,
      detail = _ref.detail;

  event.initCustomEvent(type, bubbles, cancelable, detail);
  target.dispatchEvent(event);
}

function getPointerType(event) {
  var pointerType = event.pointerType;
  return pointerType != null ? pointerType : (0, _modality.getModality)();
}

function useHover(targetRef, config) {
  var contain = config.contain,
      disabled = config.disabled,
      onHoverStart = config.onHoverStart,
      onHoverChange = config.onHoverChange,
      onHoverUpdate = config.onHoverUpdate,
      onHoverEnd = config.onHoverEnd;
  var canUsePE = supportsPointerEvent();
  var addMoveListener = (0, _useEvent.default)(canUsePE ? 'pointermove' : 'mousemove', opts);
  var addEnterListener = (0, _useEvent.default)(canUsePE ? 'pointerenter' : 'mouseenter', opts);
  var addLeaveListener = (0, _useEvent.default)(canUsePE ? 'pointerleave' : 'mouseleave', opts);
  var addLockListener = (0, _useEvent.default)(lockEventType, opts);
  var addUnlockListener = (0, _useEvent.default)(unlockEventType, opts);
  (0, _useLayoutEffect.default)(function () {
    var target = targetRef.current;

    if (target !== null) {
      var hoverEnd = function hoverEnd(e) {
        if (onHoverEnd != null) {
          onHoverEnd(e);
        }

        if (onHoverChange != null) {
          onHoverChange(false);
        }

        addMoveListener(target, null);
        addLeaveListener(target, null);
      };

      var leaveListener = function leaveListener(e) {
        var target = targetRef.current;

        if (target != null && getPointerType(e) !== 'touch') {
          if (contain) {
            dispatchCustomEvent(target, unlockEventType);
          }

          hoverEnd(e);
        }
      };

      var moveListener = function moveListener(e) {
        if (getPointerType(e) !== 'touch') {
          if (onHoverUpdate != null) {
            if (e.x == null) {
              e.x = e.clientX;
            }

            if (e.y == null) {
              e.y = e.clientY;
            }

            onHoverUpdate(e);
          }
        }
      };

      var hoverStart = function hoverStart(e) {
        if (onHoverStart != null) {
          onHoverStart(e);
        }

        if (onHoverChange != null) {
          onHoverChange(true);
        }

        if (onHoverUpdate != null) {
          addMoveListener(target, !disabled ? moveListener : null);
        }

        addLeaveListener(target, !disabled ? leaveListener : null);
      };

      var enterListener = function enterListener(e) {
        var target = targetRef.current;

        if (target != null && getPointerType(e) !== 'touch') {
          if (contain) {
            dispatchCustomEvent(target, lockEventType);
          }

          hoverStart(e);

          var lockListener = function lockListener(lockEvent) {
            if (lockEvent.target !== target) {
              hoverEnd(e);
            }
          };

          var unlockListener = function unlockListener(lockEvent) {
            if (lockEvent.target !== target) {
              hoverStart(e);
            }
          };

          addLockListener(target, !disabled ? lockListener : null);
          addUnlockListener(target, !disabled ? unlockListener : null);
        }
      };

      addEnterListener(target, !disabled ? enterListener : null);
    }
  }, [addEnterListener, addMoveListener, addLeaveListener, addLockListener, addUnlockListener, contain, disabled, onHoverStart, onHoverChange, onHoverUpdate, onHoverEnd, targetRef]);
}

module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsInVzZUhvdmVyIiwiX21vZGFsaXR5IiwicmVxdWlyZSIsIl91c2VFdmVudCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfdXNlTGF5b3V0RWZmZWN0Iiwib2JqIiwiZW1wdHlPYmplY3QiLCJvcHRzIiwicGFzc2l2ZSIsImxvY2tFdmVudFR5cGUiLCJ1bmxvY2tFdmVudFR5cGUiLCJzdXBwb3J0c1BvaW50ZXJFdmVudCIsIndpbmRvdyIsIlBvaW50ZXJFdmVudCIsImRpc3BhdGNoQ3VzdG9tRXZlbnQiLCJ0YXJnZXQiLCJ0eXBlIiwicGF5bG9hZCIsImV2ZW50IiwiZG9jdW1lbnQiLCJjcmVhdGVFdmVudCIsIl9yZWYiLCJfcmVmJGJ1YmJsZXMiLCJidWJibGVzIiwiX3JlZiRjYW5jZWxhYmxlIiwiY2FuY2VsYWJsZSIsImRldGFpbCIsImluaXRDdXN0b21FdmVudCIsImRpc3BhdGNoRXZlbnQiLCJnZXRQb2ludGVyVHlwZSIsInBvaW50ZXJUeXBlIiwiZ2V0TW9kYWxpdHkiLCJ0YXJnZXRSZWYiLCJjb25maWciLCJjb250YWluIiwiZGlzYWJsZWQiLCJvbkhvdmVyU3RhcnQiLCJvbkhvdmVyQ2hhbmdlIiwib25Ib3ZlclVwZGF0ZSIsIm9uSG92ZXJFbmQiLCJjYW5Vc2VQRSIsImFkZE1vdmVMaXN0ZW5lciIsImFkZEVudGVyTGlzdGVuZXIiLCJhZGRMZWF2ZUxpc3RlbmVyIiwiYWRkTG9ja0xpc3RlbmVyIiwiYWRkVW5sb2NrTGlzdGVuZXIiLCJjdXJyZW50IiwiaG92ZXJFbmQiLCJlIiwibGVhdmVMaXN0ZW5lciIsIm1vdmVMaXN0ZW5lciIsIngiLCJjbGllbnRYIiwieSIsImNsaWVudFkiLCJob3ZlclN0YXJ0IiwiZW50ZXJMaXN0ZW5lciIsImxvY2tMaXN0ZW5lciIsImxvY2tFdmVudCIsInVubG9ja0xpc3RlbmVyIiwibW9kdWxlIl0sIm1hcHBpbmdz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Z0hHLENBQUNkLGdCQUFELEVBQW1CRCxlQUFuQixFQUFvQ0UsZ0JBQXBDLEVBQXNEQyxlQUF0RCxFQUF1RUMsaUJBQXZFLEVBQTBGWCxPQUExRixFQUFtR0MsUUFBbkcsRUFBNkdDLFlBQTdHLEVBQTJIQyxhQUEzSCxFQUEwSUMsYUFBMUksRUFBeUpDLFVBQXpKLEVBQXFLUCxTQUFySyxDQWhISDtBQWlIRDs7QUFFRDRCLE1BQU0sQ0FBQ2hFLE9BQVAsR0FBaUJBLE9BQU8sQ0FBQ0UsT0FBekIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuZGVmYXVsdCA9IHVzZUhvdmVyO1xuXG52YXIgX21vZGFsaXR5ID0gcmVxdWlyZShcIi4uL21vZGFsaXR5XCIpO1xuXG52YXIgX3VzZUV2ZW50ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vdXNlRXZlbnRcIikpO1xuXG52YXIgX3VzZUxheW91dEVmZmVjdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4uL3VzZUxheW91dEVmZmVjdFwiKSk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogXG4gKi9cblxuLyoqXG4gKiBJbXBsZW1lbnRhdGlvblxuICovXG52YXIgZW1wdHlPYmplY3QgPSB7fTtcbnZhciBvcHRzID0ge1xuICBwYXNzaXZlOiB0cnVlXG59O1xudmFyIGxvY2tFdmVudFR5cGUgPSAncmVhY3QtZ3VpOmhvdmVyOmxvY2snO1xudmFyIHVubG9ja0V2ZW50VHlwZSA9ICdyZWFjdC1ndWk6aG92ZXI6dW5sb2NrJztcblxudmFyIHN1cHBvcnRzUG9pbnRlckV2ZW50ID0gZnVuY3Rpb24gc3VwcG9ydHNQb2ludGVyRXZlbnQoKSB7XG4gIHJldHVybiAhISh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuUG9pbnRlckV2ZW50ICE9IG51bGwpO1xufTtcblxuZnVuY3Rpb24gZGlzcGF0Y2hDdXN0b21FdmVudCh0YXJnZXQsIHR5cGUsIHBheWxvYWQpIHtcbiAgdmFyIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0N1c3RvbUV2ZW50Jyk7XG5cbiAgdmFyIF9yZWYgPSBwYXlsb2FkIHx8IGVtcHR5T2JqZWN0LFxuICAgICAgX3JlZiRidWJibGVzID0gX3JlZi5idWJibGVzLFxuICAgICAgYnViYmxlcyA9IF9yZWYkYnViYmxlcyA9PT0gdm9pZCAwID8gdHJ1ZSA6IF9yZWYkYnViYmxlcyxcbiAgICAgIF9yZWYkY2FuY2VsYWJsZSA9IF9yZWYuY2FuY2VsYWJsZSxcbiAgICAgIGNhbmNlbGFibGUgPSBfcmVmJGNhbmNlbGFibGUgPT09IHZvaWQgMCA/IHRydWUgOiBfcmVmJGNhbmNlbGFibGUsXG4gICAgICBkZXRhaWwgPSBfcmVmLmRldGFpbDtcblxuICBldmVudC5pbml0Q3VzdG9tRXZlbnQodHlwZSwgYnViYmxlcywgY2FuY2VsYWJsZSwgZGV0YWlsKTtcbiAgdGFyZ2V0LmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xufSAvLyBUaGlzIGFjY291bnRzIGZvciB0aGUgbm9uLVBvaW50ZXJFdmVudCBmYWxsYmFjayBldmVudHMuXG5cblxuZnVuY3Rpb24gZ2V0UG9pbnRlclR5cGUoZXZlbnQpIHtcbiAgdmFyIHBvaW50ZXJUeXBlID0gZXZlbnQucG9pbnRlclR5cGU7XG4gIHJldHVybiBwb2ludGVyVHlwZSAhPSBudWxsID8gcG9pbnRlclR5cGUgOiAoMCwgX21vZGFsaXR5LmdldE1vZGFsaXR5KSgpO1xufVxuXG5mdW5jdGlvbiB1c2VIb3Zlcih0YXJnZXRSZWYsIGNvbmZpZykge1xuICB2YXIgY29udGFpbiA9IGNvbmZpZy5jb250YWluLFxuICAgICAgZGlzYWJsZWQgPSBjb25maWcuZGlzYWJsZWQsXG4gICAgICBvbkhvdmVyU3RhcnQgPSBjb25maWcub25Ib3ZlclN0YXJ0LFxuICAgICAgb25Ib3ZlckNoYW5nZSA9IGNvbmZpZy5vbkhvdmVyQ2hhbmdlLFxuICAgICAgb25Ib3ZlclVwZGF0ZSA9IGNvbmZpZy5vbkhvdmVyVXBkYXRlLFxuICAgICAgb25Ib3ZlckVuZCA9IGNvbmZpZy5vbkhvdmVyRW5kO1xuICB2YXIgY2FuVXNlUEUgPSBzdXBwb3J0c1BvaW50ZXJFdmVudCgpO1xuICB2YXIgYWRkTW92ZUxpc3RlbmVyID0gKDAsIF91c2VFdmVudC5kZWZhdWx0KShjYW5Vc2VQRSA/ICdwb2ludGVybW92ZScgOiAnbW91c2Vtb3ZlJywgb3B0cyk7XG4gIHZhciBhZGRFbnRlckxpc3RlbmVyID0gKDAsIF91c2VFdmVudC5kZWZhdWx0KShjYW5Vc2VQRSA/ICdwb2ludGVyZW50ZXInIDogJ21vdXNlZW50ZXInLCBvcHRzKTtcbiAgdmFyIGFkZExlYXZlTGlzdGVuZXIgPSAoMCwgX3VzZUV2ZW50LmRlZmF1bHQpKGNhblVzZVBFID8gJ3BvaW50ZXJsZWF2ZScgOiAnbW91c2VsZWF2ZScsIG9wdHMpOyAvLyBUaGVzZSBjdXN0b20gZXZlbnRzIGFyZSB1c2VkIHRvIGltcGxlbWVudCB0aGUgXCJjb250YWluXCIgcHJvcC5cblxuICB2YXIgYWRkTG9ja0xpc3RlbmVyID0gKDAsIF91c2VFdmVudC5kZWZhdWx0KShsb2NrRXZlbnRUeXBlLCBvcHRzKTtcbiAgdmFyIGFkZFVubG9ja0xpc3RlbmVyID0gKDAsIF91c2VFdmVudC5kZWZhdWx0KSh1bmxvY2tFdmVudFR5cGUsIG9wdHMpO1xuICAoMCwgX3VzZUxheW91dEVmZmVjdC5kZWZhdWx0KShmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHRhcmdldCA9IHRhcmdldFJlZi5jdXJyZW50O1xuXG4gICAgaWYgKHRhcmdldCAhPT0gbnVsbCkge1xuICAgICAgLyoqXG4gICAgICAgKiBFbmQgdGhlIGhvdmVyIGdlc3R1cmVcbiAgICAgICAqL1xuICAgICAgdmFyIGhvdmVyRW5kID0gZnVuY3Rpb24gaG92ZXJFbmQoZSkge1xuICAgICAgICBpZiAob25Ib3ZlckVuZCAhPSBudWxsKSB7XG4gICAgICAgICAgb25Ib3ZlckVuZChlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvbkhvdmVyQ2hhbmdlICE9IG51bGwpIHtcbiAgICAgICAgICBvbkhvdmVyQ2hhbmdlKGZhbHNlKTtcbiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIGxpc3RlbmVycyBvbmNlIGZpbmlzaGVkLlxuXG5cbiAgICAgICAgYWRkTW92ZUxpc3RlbmVyKHRhcmdldCwgbnVsbCk7XG4gICAgICAgIGFkZExlYXZlTGlzdGVuZXIodGFyZ2V0LCBudWxsKTtcbiAgICAgIH07XG4gICAgICAvKipcbiAgICAgICAqIExlYXZlIGVsZW1lbnRcbiAgICAgICAqL1xuXG5cbiAgICAgIHZhciBsZWF2ZUxpc3RlbmVyID0gZnVuY3Rpb24gbGVhdmVMaXN0ZW5lcihlKSB7XG4gICAgICAgIHZhciB0YXJnZXQgPSB0YXJnZXRSZWYuY3VycmVudDtcblxuICAgICAgICBpZiAodGFyZ2V0ICE9IG51bGwgJiYgZ2V0UG9pbnRlclR5cGUoZSkgIT09ICd0b3VjaCcpIHtcbiAgICAgICAgICBpZiAoY29udGFpbikge1xuICAgICAgICAgICAgZGlzcGF0Y2hDdXN0b21FdmVudCh0YXJnZXQsIHVubG9ja0V2ZW50VHlwZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaG92ZXJFbmQoZSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICAvKipcbiAgICAgICAqIE1vdmUgd2l0aGluIGVsZW1lbnRcbiAgICAgICAqL1xuXG5cbiAgICAgIHZhciBtb3ZlTGlzdGVuZXIgPSBmdW5jdGlvbiBtb3ZlTGlzdGVuZXIoZSkge1xuICAgICAgICBpZiAoZ2V0UG9pbnRlclR5cGUoZSkgIT09ICd0b3VjaCcpIHtcbiAgICAgICAgICBpZiAob25Ib3ZlclVwZGF0ZSAhPSBudWxsKSB7XG4gICAgICAgICAgICAvLyBOb3QgYWxsIGJyb3dzZXJzIGhhdmUgdGhlc2UgcHJvcGVydGllc1xuICAgICAgICAgICAgaWYgKGUueCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgIGUueCA9IGUuY2xpZW50WDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGUueSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgIGUueSA9IGUuY2xpZW50WTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgb25Ib3ZlclVwZGF0ZShlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICAvKipcbiAgICAgICAqIFN0YXJ0IHRoZSBob3ZlciBnZXN0dXJlXG4gICAgICAgKi9cblxuXG4gICAgICB2YXIgaG92ZXJTdGFydCA9IGZ1bmN0aW9uIGhvdmVyU3RhcnQoZSkge1xuICAgICAgICBpZiAob25Ib3ZlclN0YXJ0ICE9IG51bGwpIHtcbiAgICAgICAgICBvbkhvdmVyU3RhcnQoZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob25Ib3ZlckNoYW5nZSAhPSBudWxsKSB7XG4gICAgICAgICAgb25Ib3ZlckNoYW5nZSh0cnVlKTtcbiAgICAgICAgfSAvLyBTZXQgdGhlIGxpc3RlbmVycyBuZWVkZWQgZm9yIHRoZSByZXN0IG9mIHRoZSBob3ZlciBnZXN0dXJlLlxuXG5cbiAgICAgICAgaWYgKG9uSG92ZXJVcGRhdGUgIT0gbnVsbCkge1xuICAgICAgICAgIGFkZE1vdmVMaXN0ZW5lcih0YXJnZXQsICFkaXNhYmxlZCA/IG1vdmVMaXN0ZW5lciA6IG51bGwpO1xuICAgICAgICB9XG5cbiAgICAgICAgYWRkTGVhdmVMaXN0ZW5lcih0YXJnZXQsICFkaXNhYmxlZCA/IGxlYXZlTGlzdGVuZXIgOiBudWxsKTtcbiAgICAgIH07XG4gICAgICAvKipcbiAgICAgICAqIEVudGVyIGVsZW1lbnRcbiAgICAgICAqL1xuXG5cbiAgICAgIHZhciBlbnRlckxpc3RlbmVyID0gZnVuY3Rpb24gZW50ZXJMaXN0ZW5lcihlKSB7XG4gICAgICAgIHZhciB0YXJnZXQgPSB0YXJnZXRSZWYuY3VycmVudDtcblxuICAgICAgICBpZiAodGFyZ2V0ICE9IG51bGwgJiYgZ2V0UG9pbnRlclR5cGUoZSkgIT09ICd0b3VjaCcpIHtcbiAgICAgICAgICBpZiAoY29udGFpbikge1xuICAgICAgICAgICAgZGlzcGF0Y2hDdXN0b21FdmVudCh0YXJnZXQsIGxvY2tFdmVudFR5cGUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGhvdmVyU3RhcnQoZSk7XG5cbiAgICAgICAgICB2YXIgbG9ja0xpc3RlbmVyID0gZnVuY3Rpb24gbG9ja0xpc3RlbmVyKGxvY2tFdmVudCkge1xuICAgICAgICAgICAgaWYgKGxvY2tFdmVudC50YXJnZXQgIT09IHRhcmdldCkge1xuICAgICAgICAgICAgICBob3ZlckVuZChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgdmFyIHVubG9ja0xpc3RlbmVyID0gZnVuY3Rpb24gdW5sb2NrTGlzdGVuZXIobG9ja0V2ZW50KSB7XG4gICAgICAgICAgICBpZiAobG9ja0V2ZW50LnRhcmdldCAhPT0gdGFyZ2V0KSB7XG4gICAgICAgICAgICAgIGhvdmVyU3RhcnQoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIGFkZExvY2tMaXN0ZW5lcih0YXJnZXQsICFkaXNhYmxlZCA/IGxvY2tMaXN0ZW5lciA6IG51bGwpO1xuICAgICAgICAgIGFkZFVubG9ja0xpc3RlbmVyKHRhcmdldCwgIWRpc2FibGVkID8gdW5sb2NrTGlzdGVuZXIgOiBudWxsKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgYWRkRW50ZXJMaXN0ZW5lcih0YXJnZXQsICFkaXNhYmxlZCA/IGVudGVyTGlzdGVuZXIgOiBudWxsKTtcbiAgICB9XG4gIH0sIFthZGRFbnRlckxpc3RlbmVyLCBhZGRNb3ZlTGlzdGVuZXIsIGFkZExlYXZlTGlzdGVuZXIsIGFkZExvY2tMaXN0ZW5lciwgYWRkVW5sb2NrTGlzdGVuZXIsIGNvbnRhaW4sIGRpc2FibGVkLCBvbkhvdmVyU3RhcnQsIG9uSG92ZXJDaGFuZ2UsIG9uSG92ZXJVcGRhdGUsIG9uSG92ZXJFbmQsIHRhcmdldFJlZl0pO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHMuZGVmYXVsdDsiXX0=